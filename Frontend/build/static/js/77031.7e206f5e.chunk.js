/*! For license information please see 77031.7e206f5e.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[77031],{77031:(e,t,i)=>{i.r(t),i.d(t,{arcgis_version_management:()=>c});var s=i(62042),n=i(53466),o=i(34872),r=i(62153),a=i(64880);i(14285);const l=(0,a.m)(r.ag),c=class{constructor(e){(0,s.r)(this,e),this.arcgisReady=(0,s.c)(this,"arcgisReady",7),this.arcgisVersioningStateChanged=(0,s.c)(this,"arcgisVersioningStateChanged",7),this.manager=(0,o.u)(this),this.reactiveUtils=(0,n.l)(r.i),this.viewModel=l(this),this.messages=this.manager.readonly((0,a.u)({blocking:!0})),this.allowEditingDisabled=!1,this.autoDestroyDisabled=!1,this.closable=!1,this.icon=void 0,this.label=void 0,this.mode=void 0,this.pageSize=5,this.position="top-right",this.referenceElement=void 0,this.state=this.viewModel.state,this.versioningStates=this.viewModel.versioningStates,this.view=this.viewModel.view}async componentWillLoad(){const{watch:e}=this.reactiveUtils;this.manager.onLifecycle((()=>[e((()=>this.viewModel.state),(e=>{const{flowElement:t}=this,i=null===t||void 0===t?void 0:t.getElementsByTagName("arcgis-version-management-version-properties")[0],s=null===t||void 0===t?void 0:t.getElementsByTagName("arcgis-version-management-version-list")[0];if("disabled"===e)return i&&this._removeVersionPropertiesFlowItem(t),void(s&&this._removeVersionListFlowItem(t));s&&(s.versionListElementProps={...s.versionListElementProps,executionError:this.viewModel.executionError},s.versionListElementProps={...s.versionListElementProps,state:e}),i&&(i.versionPropertiesElementProps={...i.versionPropertiesElementProps,state:e})}))]))}async destroy(){await this.manager.destroy()}render(){const{allowEditingDisabled:e,closable:t,flowElement:i,label:n,messages:o,pageSize:r,viewModel:a,viewModel:{loadError:l,state:c}}=this,d=Array.from(a.serviceNameLookup,(e=>{let[t,i]=e;return{url:t,name:i}})),h="disabled"!==c?(0,s.h)(s.F,null,d.map((l=>{var d,h,v;const m={allowEditing:!e,closable:t,currentUser:a.userLookup.get(l.url),currentVersionIdentifier:a.versioningStateLookup.get(l.url).currentVersionInfo.versionIdentifier,executionError:void 0,flowElement:i,hasAdvEditingUte:a.advancedEditingUserTypeExtensionLookup.get(l.url),heading:n,isVersioningApiAvailable:(null!==(d=a.serverVersionLookup.get(l.url))&&void 0!==d?d:0)>=11.2,pageSize:r,serviceName:l.name,state:c,serviceUrl:l.url,strings:o,versionInfos:null!==(h=null===(v=a.versioningStateLookup.get(l.url))||void 0===v?void 0:v.versionInfos)&&void 0!==h?h:[]};return(0,s.h)("arcgis-version-management-service-item",{serviceItemElementProps:m,onArcgisGetVersions:async e=>{await this._refreshVersionList(e.detail.serviceUrl)},onArcgisFlowItemBack:()=>{this._removeVersionListFlowItem(i)},onArcgisFlowItemClose:()=>{this._handleFlowItemClose()},onArcgisManageVersion:e=>{this._handleManageVersionAction(e,i)},onArcgisNewVersion:e=>{const t=this._createVersionPropertiesFlowItem(e.detail.serviceUrl,void 0);null===i||void 0===i||i.appendChild(t)}})}))):void 0,v="disabled"===c?(0,s.h)("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer",width:"full"},(0,s.h)("div",{slot:"message"},this._getLoadError(l))):void 0;return(0,s.h)("calcite-flow",{ref:e=>{this.flowElement=e},class:"dialog"===this.mode?"":"calcite-flow-widget"},(0,s.h)("calcite-flow-item",{closable:this.closable,heading:n,onCalciteFlowItemClose:()=>{this._handleFlowItemClose()}},(0,s.h)("calcite-panel",{loading:"loading"===c||"executing"===c},h,v)))}_createVersionPropertiesFlowItem(e,t){const{closable:i,flowElement:s,viewModel:n,viewModel:{state:o}}=this,r=document.createElement("arcgis-version-management-version-properties");return r.versionPropertiesElementProps={closable:i,currentUser:n.userLookup.get(e),hasAdvEditingUte:n.advancedEditingUserTypeExtensionLookup.get(e),serviceUrl:e,state:o,strings:this.messages,versionInfo:t},r.addEventListener("arcgisCreateVersion",(t=>{const{createVersionParameters:i,switchToVersion:o}=t.detail;n.createVersion(i).then((async t=>{t&&this.arcgisVersioningStateChanged.emit({type:"version-created",versionIdentifier:t.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),o&&await this.viewModel.changeVersion(e,t.versionIdentifier.name,t.versionIdentifier.guid).then((i=>{i&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:t.versionIdentifier,versioningState:n.versioningStateLookup.get(e)})}))})).finally((async()=>{await this._refreshVersionList(e),this._removeVersionPropertiesFlowItem(s)}))})),r.addEventListener("arcgisAlterVersion",(async t=>{const{flowElement:i}=this,{alterVersionParameters:s}=t.detail;await n.alterVersion(s).then((async t=>{t&&this.arcgisVersioningStateChanged.emit({type:"version-changed",versionIdentifier:s.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),await this._refreshVersionList(e)})).finally((()=>{this._removeVersionPropertiesFlowItem(i)}))})),r.addEventListener("arcgisFlowItemBack",(()=>{this._removeVersionPropertiesFlowItem(this.flowElement)})),r.addEventListener("calciteFlowItemBack",(e=>{e.preventDefault(),this._removeVersionPropertiesFlowItem(this.flowElement)})),r.addEventListener("calciteFlowItemClose",(()=>{this._handleFlowItemClose()})),r}_getLoadError(e){const{messages:t}=this;switch(e){case"no-feature-services":return t.loadErrors.noFeatureServices;case"no-view-property":return t.loadErrors.noViewProperty;default:return e}}_handleFlowItemClose(){const e=document.querySelector("arcgis-version-management"),t=e.parentElement;null===t||void 0===t||t.removeChild(e)}async _handleManageVersionAction(e,t){const{actionType:i,serviceUrl:s,versionInfo:n}=e.detail,{viewModel:o}=this;switch(i){case"changeVersion":o.changeVersion(s,n.versionIdentifier.name,n.versionIdentifier.guid).then((e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:n.versionIdentifier,versioningState:o.versioningStateLookup.get(s)});const i=null===t||void 0===t?void 0:t.getElementsByTagName("arcgis-version-management-version-list")[0];i&&i&&(i.versionListElementProps={...i.versionListElementProps,currentVersionIdentifier:o.versioningStateLookup.get(s).currentVersionInfo.versionIdentifier})}));break;case"deleteVersion":o.deleteVersion(s,n.versionIdentifier.name,n.versionIdentifier.guid).then((async e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-deleted",versionIdentifier:n.versionIdentifier,versioningState:o.versioningStateLookup.get(s)}),await this._refreshVersionList(s)}));break;case"editVersion":{const e=this._createVersionPropertiesFlowItem(s,n);t.appendChild(e);break}}}async _refreshVersionList(e){const{flowElement:t,viewModel:i}=this;if(t){const s=await i.getVersionInfos(e),n=t.getElementsByTagName("arcgis-version-management-service-item");for(const t of n)t.serviceItemElementProps.serviceUrl===e&&(t.serviceItemElementProps={...t.serviceItemElementProps,versionInfos:s});const o=t.getElementsByTagName("arcgis-version-management-version-list")[0];o&&(o.versionListElementProps={...o.versionListElementProps,currentVersionIdentifier:i.versioningStateLookup.get(e).currentVersionInfo.versionIdentifier,versionInfos:s})}}_removeVersionListFlowItem(e){for(const t of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"===t.nodeName.toUpperCase()&&e.removeChild(t),"CALCITE-FLOW-ITEM"===t.nodeName.toUpperCase()&&(t.hidden=!1)}_removeVersionPropertiesFlowItem(e){for(const t of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES"===t.nodeName.toUpperCase()&&e.removeChild(t),"ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"===t.nodeName.toUpperCase()&&(t.getElementsByTagName("calcite-flow-item")[0].hidden=!1)}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};c.style=".calcite-flow-widget{width:350px}calcite-block{margin:0}calcite-pagination{justify-content:center}"},53466:(e,t,i)=>{i.d(t,{l:()=>o,m:()=>r,u:()=>a});var s=i(34872),n=i(62153),o=e=>(0,s.b)(e),r=e=>function(){let{blocking:t=!1,name:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.b)(((s,o)=>{if(o.onLifecycle((()=>(0,n.s)(s.el,e("./assets"),(e=>{var t;let{t9nLocale:i,t9nStrings:n,lang:r}=e;o.exports={...n,_lang:r,_t9nLocale:i};const a=null!==(t=n.componentLabel)&&void 0!==t?t:n.widgetLabel;var l;"string"===typeof a&&"label"in s&&null==s.label&&(null!==(l=s.label)&&void 0!==l||(s.label=a))}),i))),t)return o.ready;const r=(0,n.g)(s.el);return{_lang:r.lang,_t9nLocale:r.t9nLocale}}))},a=e=>c,l="arcgisPropertyChange",c=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,s.b)(((e,i)=>{const s=e;e.manager.isLit&&(s[l]={emit:t=>{const i=new CustomEvent(l,{detail:t,cancelable:!0});return e.el.dispatchEvent(i),i}});const n=s[l];return i.onLoad((()=>i.onLifecycle((()=>t.map((t=>e.manager.watch(t,(()=>n.emit({name:t}))))))))),n}))}},64880:(e,t,i)=>{i.d(t,{m:()=>a,u:()=>d});var s=i(34872),n=(i(62153),i(14285)),o=i(53466),r=i(62042);const a=(e,t)=>(t,i)=>c(t,e,i);class l extends s.A{hostConnected(){this.component.manager.didLoadCalled&&(0,n.a)(this.component)}async hostLoad(){await super.hostLoad(),this.component.manager.destroyed||(this._watchMetaProperties(),s.a.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"viewModel"))}hostLoaded(){var e,t,i;const{el:s}=this.component,o=null!==(e=null!==(t=null===(i=s.shadowRoot)||void 0===i?void 0:i.firstElementChild)&&void 0!==t?t:s.firstElementChild)&&void 0!==e?e:void 0;s.childElem=null!==o&&void 0!==o?o:s.childElem,s.childElem;let r=!1;const a=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view,set:e=>{this._instance.view=e,this._watchViewDestroy(),this.component.requestUpdate(),r||(r=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),a&&(this._instance.view=a),this.component.el.isConnected&&((0,n.a)(this.component),this._watchViewDestroy())}hostDisconnected(){var e;"object"===typeof this.component.el.childElem&&(null===(e=this.component.el.view)||void 0===e||null===(e=e.ui)||void 0===e||e.remove(this.component.el.childElem))}hostDestroy(){var e;super.hostDestroy(),null===(e=this._watchViewDestroyHandle)||void 0===e||e.remove()}_watchMetaProperties(){this.watch("position",(e=>{null!=this.component.el.childElem&&"string"===typeof e&&(0,n.a)(this.component)})),this.watch("referenceElement",(()=>(0,n.a)(this.component)))}_watchViewDestroy(){var e;null===(e=this._watchViewDestroyHandle)||void 0===e||e.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when((()=>{var e;return!0===(null===(e=this.component.el.view)||void 0===e?void 0:e.destroyed)}),(()=>{this.component.destroy().catch(console.error)}),{sync:!0})}}const c=(0,s.p)(l),d=(0,o.m)(r.a)}}]);
//# sourceMappingURL=77031.7e206f5e.chunk.js.map