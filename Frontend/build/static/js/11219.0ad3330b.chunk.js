"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[11219],{38365:(e,t,r)=>{r.d(t,{O:()=>u,a:()=>f,b:()=>p});var i,n=r(30168),o=r(54134),s=r(24967),a=r(58406),l=r(99339),d=r(98634),c=r(64201),h=r(19253);class u extends d.K{constructor(){super(...arguments),this.overlayIndex=o.fu.INNER,this.opacity=1}}function p(){const e=new c.kG;return e.include(s.k),e.fragment.uniforms.add(new h.A("tex",(e=>e.texture))),e.fragment.uniforms.add(new l._("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new a.p("opacity",(e=>e.opacity))),e.fragment.code.add((0,d.H)(i||(i=(0,n.Z)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:p},Symbol.toStringTag,{value:"Module"}))},98186:(e,t,r)=>{r.d(t,{R:()=>ge,b:()=>fe,r:()=>pe});var i,n,o,s,a,l,d,c,h,u,p,f,g,v,m,_,y,w,C,x,T,b,S,R,O,A,D,E,M,I,P,L,N,U,F,H,j,z,V,Z,G,W,B=r(30168),k=r(37081),q=r(33280),J=r(14801),Y=r(48353),K=r(60300),X=r(40526),Q=r(15226),$=r(85586),ee=r(26461),te=r(116),re=r(41012),ie=r(82999),ne=r(95276),oe=r(58406),se=r(98634),ae=r(8654),le=r(64201),de=r(25920),ce=r(4760),he=r(33720),ue=r(737);const pe=1;function fe(e){const t=new le.kG,{attributes:r,varyings:fe,constants:ge,vertex:ve,fragment:me}=t;t.include($.e),t.include(Y.U,e),t.include(K.q,e);const _e=e.applyMarkerOffset&&!e.draped;_e&&(ve.uniforms.add(new oe.p("markerScale",(e=>e.markerScale))),t.include(X.Q,{space:he.I9.World,draped:!1})),t.include(J.R,e),(0,re.Sv)(ve,e),ve.uniforms.add(new ae.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new ie.A("nearFar",((e,t)=>t.camera.nearFar)),new oe.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new ne.N("viewport",((e,t)=>t.camera.fullViewport))),ve.constants.add("LARGE_HALF_FLOAT","float",65500),r.add(ce.T.POSITION,"vec3"),r.add(ce.T.PREVPOSITION,"vec3"),r.add(ce.T.NEXTPOSITION,"vec3"),r.add(ce.T.SUBDIVISIONFACTOR,"float"),r.add(ce.T.UV0,"vec2"),fe.add("vColor","vec4"),fe.add("vpos","vec3"),fe.add("vLineDistance","float"),fe.add("vLineWidth","float");const ye=e.multipassEnabled&&e.output===k.H_.Color;ye&&fe.add("depth","float");const we=e.stippleEnabled;we&&fe.add("vLineSizeInv","float"),ge.add("aaWidth","float",e.stippleEnabled?0:1);const Ce=e.capType===ue.R.ROUND,xe=e.stippleEnabled&&Ce,Te=e.falloffEnabled||xe;Te&&fe.add("vLineDistanceNorm","float"),Ce&&(fe.add("vSegmentSDF","float"),fe.add("vReverseSegmentSDF","float")),ve.code.add((0,se.H)(i||(i=(0,B.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),ve.code.add((0,se.H)(n||(n=(0,B.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),ve.code.add((0,se.H)(o||(o=(0,B.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),ye?"depth = pos.z;":"")),(0,re.ZI)(ve),ve.code.add((0,se.H)(s||(s=(0,B.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n      float lineSize = getSize();\n\n      if (lineSize < 1.0) {\n        coverage = lineSize; // convert sub-pixel coverage to alpha\n        lineSize = 1.0;\n      }\n      lineSize += aaWidth;\n\n      float lineWidth = lineSize * pixelRatio;\n      vLineWidth = lineWidth;\n      ","\n\n      vec4 pos  = view * vec4(position, 1.0);\n      vec4 prev = view * vec4(prevPosition, 1.0);\n      vec4 next = view * vec4(nextPosition, 1.0);\n  "])),we?(0,se.H)(a||(a=(0,B.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),_e&&ve.code.add((0,se.H)(l||(l=(0,B.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),ve.code.add((0,se.H)(d||(d=(0,B.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Ce)&&ve.code.add((0,se.H)(c||(c=(0,B.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Ce?(0,se.H)(h||(h=(0,B.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),ve.code.add((0,se.H)(u||(u=(0,B.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?ve.code.add((0,se.H)(p||(p=(0,B.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,se.H)(f||(f=(0,B.Z)(["min(1.0, subdivisionFactor * ",")"])),se.H.float((pe+2)/(pe+1))):(0,se.H)(g||(g=(0,B.Z)(["subdivisionFactor"]))))):ve.code.add((0,se.H)(v||(v=(0,B.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));const be=e.capType!==ue.R.BUTT;return ve.code.add((0,se.H)(m||(m=(0,B.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),be?(0,se.H)(_||(_=(0,B.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),ve.code.add((0,se.H)(y||(y=(0,B.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n    float lineDistNorm = sign(uv0.y) * pos.w;\n\n    vLineDistance =  lineWidth * lineDistNorm;\n    ","\n\n    pos.xy += dpos;\n  "])),Te?(0,se.H)(w||(w=(0,B.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Ce&&ve.code.add((0,se.H)(C||(C=(0,B.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?ve.uniforms.add(new oe.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):ve.code.add((0,se.H)(x||(x=(0,B.Z)(["vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),ve.code.add((0,se.H)(T||(T=(0,B.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?ve.code.add((0,se.H)(b||(b=(0,B.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):ve.code.add((0,se.H)(S||(S=(0,B.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),ve.uniforms.add(new oe.p("stipplePatternPixelSize",(e=>(0,K.C)(e)))),ve.code.add((0,se.H)(R||(R=(0,B.Z)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),ve.code.add((0,se.H)(O||(O=(0,B.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),ye&&t.include(Q.l,e),t.include(q.f5,e),me.include(te.Y),me.code.add((0,se.H)(A||(A=(0,B.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),ye?"terrainDepthTest(depth);":"")),e.wireframe?me.code.add((0,se.H)(D||(D=(0,B.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Ce&&me.code.add((0,se.H)(E||(E=(0,B.Z)(["\n        float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n        vec2 fragmentPosition = vec2(\n          min(sdf, 0.0),\n          vLineDistance\n        ) * gl_FragCoord.w;\n\n        float fragmentRadius = length(fragmentPosition);\n        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n        if (capCoverage < ",") {\n          discard;\n        }\n      "])),se.H.float(ee.b))),xe?me.code.add((0,se.H)(M||(M=(0,B.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),se.H.float(ee.b))):me.code.add((0,se.H)(I||(I=(0,B.Z)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==k.H_.ObjectAndLayerIdColor&&me.code.add((0,se.H)(P||(P=(0,B.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),me.uniforms.add(new ne.N("intrinsicColor",(e=>e.color))),me.code.add((0,se.H)(L||(L=(0,B.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(me.uniforms.add(new ne.N("innerColor",(e=>{var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new oe.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),me.code.add((0,se.H)(N||(N=(0,B.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),me.code.add((0,se.H)(U||(U=(0,B.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(me.uniforms.add(new oe.p("falloff",(e=>e.falloff))),me.code.add((0,se.H)(F||(F=(0,B.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"]))))),e.stippleEnabled||me.code.add((0,se.H)(H||(H=(0,B.Z)(["float featherStartDistance = max(vLineWidth - 2.0, 0.0);\nfloat value = abs(vLineDistance) * gl_FragCoord.w;\nfloat feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);\nfinalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);"]))))),e.transparencyPassType===de.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),me.code.add((0,se.H)(j||(j=(0,B.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===k.H_.ObjectAndLayerIdColor?(0,se.H)(z||(z=(0,B.Z)(["finalColor.a = 1.0;"]))):"",se.H.float(ee.b),e.output===k.H_.Color?(0,se.H)(V||(V=(0,B.Z)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===k.H_.Color&&e.transparencyPassType===de.A.ColorAlpha?(0,se.H)(Z||(Z=(0,B.Z)(["\n            fragColor = premultiplyAlpha(fragColor);\n            fragAlpha = fragColor.a;"]))):"",e.output===k.H_.Highlight?(0,se.H)(G||(G=(0,B.Z)(["fragColor = vec4(1.0);"]))):"",e.output===k.H_.ObjectAndLayerIdColor?(0,se.H)(W||(W=(0,B.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const ge=Object.freeze(Object.defineProperty({__proto__:null,build:fe,ribbonlineNumRoundJoinSubdivisions:pe},Symbol.toStringTag,{value:"Module"}))},61863:(e,t,r)=>{r.d(t,{T:()=>h,a:()=>p,b:()=>u});var i,n=r(30168),o=r(12400),s=r(24967),a=r(49450),l=r(98634),d=r(64201),c=r(19253);class h extends l.K{constructor(){super(...arguments),this.color=(0,o.al)(1,1,1)}}function u(){const e=new d.kG;return e.include(s.k),e.fragment.uniforms.add(new c.A("tex",(e=>e.texture)),new a.J("uColor",(e=>e.color))),e.fragment.code.add((0,l.H)(i||(i=(0,n.Z)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * vec4(uColor, 1.0);\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:u},Symbol.toStringTag,{value:"Module"}))},76861:(e,t,r)=>{r.d(t,{N:()=>n});var i=r(18759);class n{constructor(e,t){this._cache=e(t,((e,t,r)=>{switch(t){case i.lN.ALL:return e.forEach((e=>e.dispose())),0;case i.lN.SOME:{const t=e.shift();return t&&(r-=Math.round(t.usedMemory),t.dispose()),r}}}))}hitrate(){return this._cache.hitRate}destroy(){this._cache.destroy()}clear(){this._cache.clear()}getSize(e){return this._cache.getSize(e)}pop(e){const t=this._cache.peek(e);if(!t)return;const r=t.pop();if(t.length>0){if(r){const i=this._cache.getSize(e)-Math.round(r.usedMemory);this._cache.updateSize(e,t,i)}}else this._cache.pop(e);return r}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.Jv;const n=this._cache.peek(e);if(!n)return void this._cache.put(e,[t],t.usedMemory,r);n.push(t);const o=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,n,o)}}},46228:(e,t,r)=>{r.d(t,{I:()=>n,v:()=>o});var i=r(16889);function n(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(0,i.uZ)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*d(n*s[i]))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const s=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));function d(e){return e-Math.floor(e)}},93311:(e,t,r)=>{function i(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(){return i()}function a(){return o(1,1,1)}function l(){return o(1,0,0)}function d(){return o(0,1,0)}function c(){return o(0,0,1)}r.d(t,{Ue:()=>i,al:()=>o,d9:()=>n,ll:()=>s});const h=s(),u=a(),p=l(),f=d(),g=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:p,UNIT_Y:f,UNIT_Z:g,ZEROS:h,clone:n,create:i,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:o,ones:a,unitX:l,unitY:d,unitZ:c,zeros:s},Symbol.toStringTag,{value:"Module"}))},86372:(e,t,r)=>{r.d(t,{JK:()=>a,QZ:()=>o,Rq:()=>s,bg:()=>n,mB:()=>l});var i=r(18722);function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.c8?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function o(e){return((0,i.kJ)(e)?e.length:e.byteLength/8)<=i.c8?Array.from(e):new Float64Array(e)}function s(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}function a(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},45238:(e,t,r)=>{r.d(t,{EU:()=>m,Ue:()=>c,WH:()=>_,ZZ:()=>v,q_:()=>p,qw:()=>g,uT:()=>h,up:()=>w,zk:()=>u});var i=r(16889),n=r(29134),o=r(68700),s=r(50894),a=r(32035),l=r(12400),d=r(86361);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;return[e[0],e[1],e[2],e[3]]}function h(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,a.c)(r,e),r[3]=t,r}function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.Ue)();return(0,a.b)(r,e,t),(0,a.n)(r,r),r[3]=-(0,a.d)(e,t),r}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c();const r=(0,n.j6)(C,e);return y(t,(0,i.BV)((0,o.Bh)(t,r))),t}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,o.yY)(C,e,_(e)),(0,o.yY)(x,t,_(t)),(0,o.Jp)(C,x,C),y(r,(0,i.BV)((0,o.Bh)(r,C)))}function g(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return h(l.E9,e,T),h(l.IO,t,b),h(l.eG,r,S),f(T,b,T),f(T,S,i),i}function v(e){return e}function m(e){return e[3]}function _(e){return(0,i.Vl)(e[3])}function y(e,t){return e[3]=t,e}const w=[0,0,1,0],C=(0,s.Ue)(),x=(0,s.Ue)(),T=(c(),c()),b=c(),S=c()},37818:(e,t,r)=>{r.d(t,{D:()=>m,Ou:()=>d,WG:()=>v,kB:()=>u,mW:()=>h});r(59486);var i=r(52639),n=(r(93169),r(84652)),o=r(18722),s=r(77981),a=r(55946),l=r(78952);function d(e){return"declaredClass"in e}function c(e){return"declaredClass"in e}function h(e,t){return e?"declaredClass"in e?e:new i.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,n.d9)(e.symbol),attributes:(0,n.d9)(e.attributes),geometry:u(e.geometry)}):null}function u(e){return null==e?null:d(e)?e:(0,s.im)(function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e.spatialReference,o={wkid:t,wkt:r,wkt2:i,latestWkid:n};switch(e.type){case"point":{const{x:t,y:r,z:i,m:n}=e;return{x:t,y:r,z:i,m:n,spatialReference:o}}case"polygon":{const{rings:t,hasZ:r,hasM:i}=e;return{rings:p(t),hasZ:r,hasM:i,spatialReference:o}}case"polyline":{const{paths:t,hasZ:r,hasM:i}=e;return{paths:p(t),hasZ:r,hasM:i,spatialReference:o}}case"extent":{const{xmin:t,xmax:r,ymin:i,ymax:n,zmin:s,zmax:a,mmin:l,mmax:d,hasZ:c,hasM:h}=e;return{xmin:t,xmax:r,ymin:i,ymax:n,zmin:s,zmax:a,mmin:l,mmax:d,hasZ:c,hasM:h,spatialReference:o}}case"multipoint":{const{points:t,hasZ:r,hasM:i}=e;return{points:g(t)?f(t):t,hasZ:r,hasM:i,spatialReference:o}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return g(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Array.from(e)))}function g(e){return e.length>0&&((0,o.xZ)(e[0])||(0,o.fS)(e[0]))}function v(e,t){if(!e)return null;let r;if(c(e)){if(null==t)return e.clone();if(c(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}function m(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:n}=e,o={wkid:t,wkt:r,wkt2:i,latestWkid:n};return l.Z.fromJSON(o)}},46208:(e,t,r)=>{var i,n;function o(e){return null!=(null===e||void 0===e?void 0:e.cubeMap)}function s(e){return null!=e&&!e.running}r.d(t,{Ck:()=>o,WU:()=>s,jL:()=>i,uz:()=>n}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},5573:(e,t,r)=>{r.d(t,{Kf:()=>g,lL:()=>i});var i,n,o=r(16889),s=r(29134),a=r(7025),l=r(32035),d=r(12400),c=r(45238),h=r(22186),u=r(46208),p=r(50902),f=r(75248);class g{constructor(){this.readChannels=u.uz.RG,this.renderingStage=u.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,d.Ue)(),this.parallax=new v,this.parallaxNew=new v,this.pointOnGround=(0,d.Ue)(),this.fadeMode=i.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,r=(0,l.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(r*r-h.sv.radius*h.sv.radius,0))/r,(0,c.zk)(m,t.anchorPointClouds,_),(0,s.U1)(t.transform,a.Wd,_[3],(0,c.ZZ)(_)),this.fadeMode===i.CROSS_FADE){const e=this.parallaxNew;(0,c.zk)(m,e.anchorPointClouds,_),(0,s.U1)(e.transform,a.Wd,_[3],(0,c.ZZ)(_))}}updateFading(e,t,r,i){this.isFading&&this._advanceFading(r,i),this._evaluateFading(e,t,r)}_evaluateFading(e,t,r){const n=e.relativeElevation,o=this._calculateDistanceToAnchorPoint(e);if((n>1.7*p.nq||n<-p.nq||o>T)&&this.opacity>0)this._setFade(i.HIDE,r);else if(!this.isFading)if((n>p.nq||n<-.35*p.nq||o>x)&&this.opacity>0)this._setFade(i.FADE_OUT,r);else if(n<=p.nq&&n>=-.35*p.nq&&t===f.n.IDLE&&(0,u.WU)(this.data)){if(0===this.opacity)return void this._setFade(i.FADE_IN,r);(o>C||this.renderingStage===u.jL.FADING)&&this._setFade(i.CROSS_FADE,r)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,o.uZ)((e-this.startTime)/(w*t),0,1):1,this.fadeMode===i.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===i.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===i.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===i.FADE_OUT&&(this.opacity=0),this.fadeMode===i.FADE_IN&&(this.opacity=1),this.fadeMode===i.CROSS_FADE&&(this.opacity=1),this.fadeMode=i.NONE}_switchReadChannels(){const e=this.fadeMode===i.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===i.FADE_IN&&0===this.fadeFactor;this.renderingStage===u.jL.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=u.jL.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,l.n)(this.pointOnGround,e.eye),(0,l.j)(this.pointOnGround,this.pointOnGround,h.sv.radius),(0,l.l)((0,l.f)(y,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===i.CROSS_FADE&&(0===this.fadeFactor&&(0,l.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===i.FADE_IN&&0===this.fadeFactor&&(0,l.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case i.HIDE:this.opacity=0;break;case i.FADE_OUT:this.opacity=1;break;case i.FADE_IN:this.opacity=0;break;case i.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===i.FADE_OUT||this.fadeMode===i.FADE_IN||this.fadeMode===i.CROSS_FADE}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.HIDE=1]="HIDE",n[n.FADE_OUT=2]="FADE_OUT",n[n.FADE_IN=3]="FADE_IN",n[n.CROSS_FADE=4]="CROSS_FADE";class v{constructor(){this.anchorPointClouds=(0,d.Ue)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,a.Ue)()}}const m=(0,d.al)(0,0,1),_=(0,c.Ue)(),y=(0,d.Ue)(),w=1.25,C=34e3,x=64e3,T=2e5},90868:(e,t,r)=>{r.d(t,{Z:()=>c});var i,n=r(27366),o=r(46784),s=r(49861),a=(r(93169),r(32718),r(84936),r(27135)),l=r(69912);let d=i=class extends o.wq{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({cloudy:"cloudy"})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=i=(0,n._)([(0,l.j)("esri.views.3d.environment.CloudyWeather")],d);const c=d},89110:(e,t,r)=>{r.d(t,{Z:()=>c});var i,n=r(27366),o=r(46784),s=r(49861),a=(r(93169),r(32718),r(84936),r(27135)),l=r(69912);let d=i=class extends o.wq{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new i({fogStrength:this.fogStrength})}};(0,n._)([(0,a.J)({foggy:"foggy"})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=i=(0,n._)([(0,l.j)("esri.views.3d.environment.FoggyWeather")],d);const c=d},61052:(e,t,r)=>{r.d(t,{Z:()=>c});var i,n=r(27366),o=r(46784),s=r(49861),a=(r(93169),r(32718),r(84936),r(27135)),l=r(69912);let d=i=class extends o.wq{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new i({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.J)({rainy:"rainy"})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),d=i=(0,n._)([(0,l.j)("esri.views.3d.environment.RainyWeather")],d);const c=d},37063:(e,t,r)=>{r.d(t,{Z:()=>c});var i,n=r(27366),o=r(46784),s=r(49861),a=(r(93169),r(32718),r(84936),r(27135)),l=r(69912);let d=i=class extends o.wq{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new i({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.J)({snowy:"snowy"})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),(0,n._)([(0,s.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],d.prototype,"snowCover",void 0),d=i=(0,n._)([(0,l.j)("esri.views.3d.environment.SnowyWeather")],d);const c=d},3389:(e,t,r)=>{r.d(t,{Z:()=>c});var i,n=r(27366),o=r(46784),s=r(49861),a=(r(93169),r(32718),r(84936),r(27135)),l=r(69912);let d=i=class extends o.wq{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new i({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({sunny:"sunny"})],d.prototype,"type",void 0),(0,n._)([(0,s.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=i=(0,n._)([(0,l.j)("esri.views.3d.environment.SunnyWeather")],d);const c=d},50902:(e,t,r)=>{r.d(t,{$T:()=>u,Hr:()=>l,T$:()=>d,b8:()=>c,nq:()=>h});var i=r(90868),n=r(89110),o=r(61052),s=r(37063),a=r(3389);const l={key:"type",base:a.Z,typeMap:{sunny:a.Z,cloudy:i.Z,rainy:o.Z,snowy:s.Z,foggy:n.Z}},d=Object.keys(l.typeMap);function c(e,t){return!!d.includes(e)||(t.error('"'.concat(e,'" is not a valid weather type')),!1)}const h=1e4,u=1e5},78935:(e,t,r)=>{r.d(t,{o:()=>o});var i=r(88152),n=r(8821);class o{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,i.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,n.ht)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){var t;this.mode=e.mode,this.unit=(0,i.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}updateFeatureExpressionInfoContext(e,t,r){if(null==e)return void(this._featureExpressionInfoContext=null);const i=null===e||void 0===e?void 0:e.arcade;i&&null!=t&&null!=r?(this._featureExpressionInfoContext=(0,n.d9)(e),(0,n.aO)(this._featureExpressionInfoContext,(0,n.Tz)(i.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new o;return null!=e&&t.setFromElevationInfo(e),t}}},69691:(e,t,r)=>{r.d(t,{B5:()=>_,GC:()=>v,Lm:()=>C,Xf:()=>m,bD:()=>y,lO:()=>i,qZ:()=>f,rR:()=>p,ub:()=>w,w7:()=>g});var i,n,o=r(29134),s=r(7025),a=r(12400),l=r(37998),d=r(50628),c=r(81020),h=r(77648),u=r(4760);function p(e,t,r,i,n,o,s,a,l,c,h){const u=x[h.mode];let p,f,g=0;if((0,d.projectBuffer)(e,t,r,i,l.spatialReference,n,a))return u.requiresAlignment(h)?(g=u.applyElevationAlignmentBuffer(i,n,o,s,a,l,c,h),p=o,f=s):(p=i,f=n),(0,d.projectBuffer)(p,l.spatialReference,f,o,c.spatialReference,s,a)?g:void 0}function f(e,t,r,i,n){const o=((0,c.f)(e)?e.z:(0,h.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{var s;const r=null!==(s=(0,h.KO)(t,e,"ground"))&&void 0!==s?s:0;return n.verticalDistanceToGround=0,n.sampledElevation=r,void(n.z=r)}case"relative-to-ground":{var a;const s=null!==(a=(0,h.KO)(t,e,"ground"))&&void 0!==a?a:0,l=r.geometryZWithOffset(o,i);return n.verticalDistanceToGround=l,n.sampledElevation=s,void(n.z=l+s)}case"relative-to-scene":{var l;const s=null!==(l=(0,h.KO)(t,e,"scene"))&&void 0!==l?l:0,a=r.geometryZWithOffset(o,i);return n.verticalDistanceToGround=a,n.sampledElevation=s,void(n.z=a+s)}case"absolute-height":{var d;const s=r.geometryZWithOffset(o,i),a=null!==(d=(0,h.KO)(t,e,"ground"))&&void 0!==d?d:0;return n.verticalDistanceToGround=s-a,n.sampledElevation=a,void(n.z=s)}default:return void(n.z=0)}}function g(e,t,r,i){return f(e,t,r,i,b),b.z}function v(e,t,r){return"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?null==t||null==r?e.definedChanged:i.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function y(e,t,r,i,n){f(t,r,n,i,b),w(e,b.verticalDistanceToGround);const s=b.sampledElevation,a=(0,o.JG)(T,e.transformation);return S[0]=t.x,S[1]=t.y,S[2]=b.z,(0,l.B)(t.spatialReference,S,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function w(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(u.T.CENTEROFFSETANDDISTANCE);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[r],u.T.CENTEROFFSETANDDISTANCE))}}class C{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(n=i||(i={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const x={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){const l=a.calculateOffsetRenderUnits(s),d=a.featureExpressionInfoContext;t*=3,i*=3;for(let c=0;c<n;++c){const n=e[t],o=e[t+1],s=e[t+2];r[i]=n,r[i+1]=o,r[i+2]=null==d?s+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o){let s=0;const a=o.spatialReference;t*=3,i*=3;for(let d=0;d<n;++d){var l;const n=e[t],d=e[t+1],c=e[t+2],h=null!==(l=o.getElevation(n,d,c,a,"ground"))&&void 0!==l?l:0;s+=h,r[i]=n,r[i+1]=d,r[i+2]=h,t+=3,i+=3}return s/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){let l=0;const d=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"ground"))&&void 0!==u?u:0;l+=p,r[i]=n,r[i+1]=s,r[i+2]=null==c?a+p+d:p+d,t+=3,i+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,n,o,s,a){let l=0;const d=a.calculateOffsetRenderUnits(s),c=a.featureExpressionInfoContext,h=o.spatialReference;t*=3,i*=3;for(let p=0;p<n;++p){var u;const n=e[t],s=e[t+1],a=e[t+2],p=null!==(u=o.getElevation(n,s,a,h,"scene"))&&void 0!==u?u:0;l+=p,r[i]=n,r[i+1]=s,r[i+2]=null==c?a+p+d:p+d,t+=3,i+=3}return l/n},requiresAlignment:()=>!0}},T=(0,s.Ue)(),b=new C,S=(0,a.Ue)()},8821:(e,t,r)=>{r.d(t,{O$:()=>g,Tz:()=>h,WI:()=>f,aO:()=>u,bw:()=>d,d9:()=>l,ht:()=>p,kr:()=>c});var i=r(32718),n=r(66978),o=r(37818),s=r(819);const a=()=>i.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function d(e){const t=null===e||void 0===e?void 0:e.expression;if("string"==typeof t){const e=m(t);if(null!=e)return{cachedResult:e}}return null}async function c(e,t,r,i){const o=null===e||void 0===e?void 0:e.expression;if("string"!=typeof o)return null;const a=m(o);if(null!=a)return{cachedResult:a};const l=await(0,s.LC)();(0,n.k_)(r);const d=l.arcadeUtils,c=d.createSyntaxTree(o);return d.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(c),context:d.createExecContext(null,{sr:t}),modules:l}}}function h(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function u(e,t){if(null!=e&&!v(e)){if(!t||!e.arcade)return void a().errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,o.kB)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(v(e))return e.cachedResult;const t=e.arcade;let r=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function f(e){var t,r;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null===e||void 0===e?void 0:e.featureExpressionInfo;const o=null===(t=n)||void 0===t?void 0:t.expression;return i||"0"===o||(n=null),null!==(r=n)&&void 0!==r?r:null}const g={cachedResult:0};function v(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},26279:(e,t,r)=>{var i,n,o;r.d(t,{Lw:()=>i,al:()=>o,eZ:()=>n}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},2522:(e,t,r)=>{r.d(t,{LM:()=>u,M_:()=>c,OJ:()=>a,qO:()=>l,zA:()=>h});var i=r(22351),n=r(8548),o=r(57808),s=r(52311);const a=64,l=a/2,d=l/5,c=a/d,h=.25;function u(e,t){const r=(0,i.aJ)(e,a,l,d),c=new s.X;return c.internalFormat=n.VI.RGBA,c.width=a,c.height=a,c.wrapMode=n.e8.CLAMP_TO_EDGE,new o.x(t,c,r)}},22351:(e,t,r)=>{r.d(t,{Rg:()=>l,aJ:()=>c,cU:()=>d,hy:()=>a,wm:()=>s});r(93169);var i=r(46228),n=r(1487),o=r(8548);const s=128,a=.5;function l(e){return"cross"===e||"x"===e}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const r=c(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new n.x(r,{mipmap:!1,wrap:{s:o.e8.CLAMP_TO_EDGE,t:o.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const r=e/2-.5;return g(e,p(r,r,t/2))}(t,r);case"square":return function(e,t){return h(e,t,!1)}(t,r);case"cross":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!1,r)}(t,r,i);case"x":return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!0,r)}(t,r,i);case"kite":return function(e,t){return h(e,t,!0)}(t,r);case"triangle":return function(e,t){return g(e,f(e/2,t,t/2))}(t,r);case"arrow":return function(e,t){const r=t,i=t/2,n=e/2,o=.8*r,s=p(n,(e-t)/2-o,Math.sqrt(o*o+i*i)),a=f(n,r,i);return g(e,((e,t)=>Math.max(a(e,t),-s(e,t))))}(t,r)}}function h(e,t,r){return r&&(t/=Math.SQRT2),g(e,((i,n)=>{let o=i-.5*e+.25,s=.5*e-n-.75;if(r){const e=(o+s)/Math.SQRT2;s=(s-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(s))-.5*t}))}function u(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=i,r&&(t*=Math.SQRT2);const n=.5*t;return g(e,((t,o)=>{let s,a=t-.5*e,l=.5*e-o-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),s=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,s-=i/2,s}))}function p(e,t,r){return(i,n)=>{const o=i-e,s=n-t;return Math.sqrt(o*o+s*s)-r}}function f(e,t,r){const i=Math.sqrt(t*t+r*r);return(n,o)=>{const s=Math.abs(n-e)-r,a=o-e+t/2+.75,l=(t*s+r*a)/i,d=-a;return Math.max(l,d)}}function g(e,t){const r=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let o=0;o<e;o++){const s=o+e*n;let a=t(o,n);a=a/e+.5,(0,i.I)(a,r,4*s)}return r}},92015:(e,t,r)=>{var i;r.d(t,{D:()=>i}),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(i||(i={}))},19265:(e,t,r)=>{r.d(t,{CB:()=>ne,gi:()=>ae,Qi:()=>le});var i=r(27366),n=r(91505),o=r(93169),s=r(77427),a=r(92026),l=r(27546),d=r(94172),c=r(92377),h=r(49861),u=(r(32718),r(84936),r(69912)),p=r(29134),f=r(32035),g=r(12400),v=r(50951),m=r(26279),_=r(94463),y=r(54134),w=r(65156),C=r(61403);class x{constructor(){this._extent=(0,w.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,C.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new T}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,w.cv)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,w.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class T{constructor(){this.extents=[(0,w.Ue)(),(0,w.Ue)(),(0,w.Ue)()],this.numViews=0}}var b=r(92015);class S{constructor(e,t,r){this._fbos=e,this._format=t,this._name=r}get valid(){var e;return null!=(null===(e=this._handle)||void 0===e?void 0:e.getTexture())}dispose(){this._handle=(0,a.RY)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}bind(e,t,r){var i,n,o,s,a;this._handle&&(null===(i=this._handle.fbo)||void 0===i?void 0:i.width)===t&&(null===(n=this._handle.fbo)||void 0===n?void 0:n.height)===r||(null!==(o=this._handle)&&void 0!==o&&o.release(),this._handle=this._fbos.acquire(t,r,this._name,this._format)),e.unbindTexture(null===(s=this._handle)||void 0===s||null===(s=s.fbo)||void 0===s?void 0:s.colorTexture),e.bindFramebuffer(null===(a=this._handle)||void 0===a?void 0:a.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.getTexture())||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t||t.generateMipmap())}}var R=r(18020),O=r(37081);class A{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R.q.RGBA_MIPMAP;this.output=r,this.content=i,this.fbo=new S(e,n,t)}get valid(){return this.fbo.valid}}class D{constructor(e){this.targets=[new A(e,"overlay color",O.H_.Color,b.D.Color),new A(e,"overlay IM color",O.H_.Color,b.D.ColorNoRasterImage),new A(e,"overlay highlight",O.H_.Highlight,b.D.Highlight,R.q.RGBA4),new A(e,"overlay water",O.H_.Normal,b.D.WaterNormal),new A(e,"overlay occluded",O.H_.Color,b.D.Occluded)],(0,o.Z)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new A(e,"overlay oid",O.H_.ObjectAndLayerIdColor,b.D.ObjectAndLayerIdColor))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,r)=>t.valid?e|=1<<r:e),0)}}var E=r(81296),M=r(22702),I=r(61863),P=r(51992),L=r(70374),N=r(53252),U=r(19962),F=r(56529),H=r(46293),j=r(93822),z=r(471),V=r(81341),Z=r(5195),G=r(25049),W=r(25920),B=r(78485),k=r(11954),q=r(38365),J=r(82144),Y=r(31132),K=r(7566),X=r(27627),Q=r(8548),$=r(36207);class ee extends Y.A{initializeProgram(e){return new X.$(e.rctx,ee.shader.get().build(),K.i)}initializePipeline(){return(0,$.sm)({blending:(0,$.if)(Q.zi.ONE,Q.zi.ONE_MINUS_SRC_ALPHA),colorWrite:$.BK})}}ee.shader=new J.J(q.a,(()=>r.e(46487).then(r.bind(r,46487))));var te=r(93463),re=r(57808),ie=r(52311);let ne=class extends L.tY{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new q.O,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new l.Z,this._passParameters=new I.T,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new E.Z,this.worldToPCSRatio=1,this.events=new n.Z,this.longitudeCyclical=null,this.produces=new Map([[j.r.DRAPED_MATERIAL,e=>e!==O.H_.Highlight||this.hasHighlights],[j.r.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextures:r,stippleTextures:i,markerTextures:n}=t;this._techniques=new P.M({rctx:this._rctx,viewingMode:v.JY.Local,stippleTextures:i,markerTextures:n,waterTextures:r}),this._renderContext=new H.Yh(this._rctx,new z.l(e,this.view.state.viewingMode),null),this.addHandles([(0,d.watch)((()=>r.updating),(()=>this.events.emit("content-changed")),d.syncAndInitial),(0,d.watch)((()=>this.spatialReference),(e=>this._localOriginFactory=new U.C(e)),d.syncAndInitial),(0,d.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materials=new N.h(t.textures,this._techniques,(()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=j.r.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=W.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new k.Mi((0,g.al)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(te.T8.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,a.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,a.M2)(this._passParameters.texture),this._techniques=(0,a.SC)(this._techniques),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,s.oE)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((e=>e.drapeSource.layer)).filter((e=>!!e))}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,V.S)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);null!=i&&i.destroy();const n=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,d.watch)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,c.fn)(e,(e=>e.drapeTargetType===m.al.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,c.fn)(e,(e=>e.drapeSourceType===m.Lw.Features)),this._hasDrapedRasterSource=(0,c.fn)(e,(e=>e.drapeSourceType===m.Lw.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new D(this.view._stage.renderer.fboCache),this._overlays=[new x,new x]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=(0,a.M2)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(null!=e)return e===b.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(b.D.Color):null===(r=this._renderTargets)||void 0===r?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,n]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&n.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,s.oE)(this._renderers,(e=>e.hasHighlights)),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(te.G5,(e=>e.updatePolicy===B.j.SYNC))}get isEmpty(){return!_.h.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,s.oE)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=le;const t=this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}));return this._renderContext.renderOccludedMask=e,t}renders(e){return _.h.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==b.D.Occluded||this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)}))}get mode(){var e,t;return this.isEmpty?M.gT.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(b.D.WaterNormal)?M.gT.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture(b.D.Color)?M.gT.Enabled:M.gT.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets){if(t.content===b.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(y.fu.INNER,t,e),i=this._drawTarget(y.fu.OUTER,t,e);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const i=this._overlays[e],n=i.canvasGeometries;if(0===n.numViews)return!1;const{alignPixelEnabled:o,contentPixelRatio:s}=r;this._screenToWorldRatio=s*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const a=t.output;if(this.isEmpty||a===O.H_.Highlight&&!this.hasHighlights||a===O.H_.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const l=this._rctx;if(this._camera.pixelRatio=i.pixelRatio*s,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===O.H_.Normal?j.r.DRAPED_WATER:j.r.DRAPED_MATERIAL,t.content===b.D.Occluded&&(this._renderContext.renderOccludedMask=le),!this.renders(t.content))return this._renderContext.renderOccludedMask=H.C9,!1;const d=i.resolution;this._rctx.setViewport(e===y.fu.INNER?0:d,0,d,d);const c=2*i.resolution,h=i.resolution,u=t.fbo;if(u.bind(l,c,h),e===y.fu.INNER&&(l.setClearColor(0,0,0,0),l.clear(Q.lk.COLOR_BUFFER_BIT)),_.h.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==b.D.Occluded)for(let p=0;p<n.numViews;p++)this._setViewParameters(n.extents[p],i),this._ensureDebugPatternResources(i.resolution,se[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((r=>{let{drapeSource:o,renderer:s}=r;if(t.content===b.D.ColorNoRasterImage&&o.drapeSourceType===m.Lw.RasterImage)return;const{fullOpacity:d}=o,p=null!=d&&d<1&&a===O.H_.Color?this.bindTemporaryFramebuffer(c,h):null;for(let e=0;e<n.numViews;e++)this._setViewParameters(n.extents[e],i),s.render(this._renderContext);if(p){u.bind(l,c,h),this._overlayParameters.texture=p.getTexture(),this._overlayParameters.opacity=d,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniques.acquire(ee);this._rctx.bindTechnique(t,this._renderContext.bindParameters,this._overlayParameters),this._rctx.screen.draw(),t.release(),p.release()}})),l.bindFramebuffer(null),this._renderContext.renderOccludedMask=H.C9,!0}bindTemporaryFramebuffer(e,t){var r;const i=this.view._stage.renderer.fboCache,n=i.acquire(e,t,"overlay tmp");return i.rctx.unbindTexture(null===(r=n.fbo)||void 0===r?void 0:r.colorTexture),i.rctx.bindFramebuffer(n.fbo),i.rctx.clear(Q.lk.COLOR_BUFFER_BIT),n}async reloadShaders(){await this._techniques.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let n=0;for(const{renderer:a}of this._sortedRenderers){var o,s;n=null!==(o=null===(s=a.intersect)||void 0===s?void 0:s.call(a,e,t,r,i,n))&&void 0!==o?o:n}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach(((r,i)=>{var n;const o=e.indexOf(i.layer),s=o>=0,a=null!==(n=i.renderGroup)&&void 0!==n?n:s?m.eZ.MapLayer:m.eZ.ViewLayer,l=t*a+(s?o:0);this._sortedRenderers.push(new oe(i,r,l))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,p.M5)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,p.vc)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,s.oE)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_ensureDebugPatternResources(e,t){if((0,f.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let s=0;s<e;s++)for(let t=0;t<e;t++){const n=Math.floor(t/10),o=Math.floor(s/10);n<2||o<2||10*n>e-20||10*o>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&n&&1&o?1&t^1&s?0:255:1&n^1&o?0:128)}const n=new ie.X(e);n.samplingMode=Q.cw.NEAREST,this._passParameters.texture=new re.x(this._rctx,n,r);const o=new G.V;o.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Z.K,o)}get test(){}};(0,i._)([(0,h.Cb)()],ne.prototype,"hasHighlights",void 0),(0,i._)([(0,h.Cb)()],ne.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,i._)([(0,h.Cb)()],ne.prototype,"_techniques",void 0),(0,i._)([(0,h.Cb)({constructOnly:!0})],ne.prototype,"view",void 0),(0,i._)([(0,h.Cb)()],ne.prototype,"worldToPCSRatio",void 0),(0,i._)([(0,h.Cb)()],ne.prototype,"spatialReference",void 0),(0,i._)([(0,h.Cb)({type:Boolean,readOnly:!0})],ne.prototype,"updating",null),(0,i._)([(0,h.Cb)()],ne.prototype,"isEmpty",null),(0,i._)([(0,h.Cb)({readOnly:!0})],ne.prototype,"rendersOccludedDraped",null),ne=(0,i._)([(0,u.j)("esri.views.3d.terrain.OverlayRenderer")],ne);class oe{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const se=[[1,.5,.5],[.5,.5,1]],ae=-2,le=F.yD.OccludeAndTransparent},54134:(e,t,r)=>{var i,n,o,s;r.d(t,{Ns:()=>s,VB:()=>o,fu:()=>i,tk:()=>n}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(o||(o={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}))},74779:(e,t,r)=>{r.d(t,{SP:()=>d,T5:()=>h,kF:()=>c,o9:()=>i,vF:()=>u});var i,n,o=r(12400),s=r(37081),a=r(85380);class l extends a.d4{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,o.Ue)(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}}(n=i||(i={}))[n.Material=0]="Material",n[n.ShadowMap=1]="ShadowMap",n[n.Highlight=2]="Highlight",n[n.ViewshedShadowMap=3]="ViewshedShadowMap";class d extends l{constructor(){super(...arguments),this.identifier=i.Material,this.output=s.H_.Color,this.transparent=!1}}class c extends l{constructor(){super(...arguments),this.identifier=i.ShadowMap}}class h extends l{constructor(){super(...arguments),this.identifier=i.Highlight}}class u extends l{constructor(){super(...arguments),this.identifier=i.ViewshedShadowMap}}},48353:(e,t,r)=>{r.d(t,{U:()=>m});var i,n,o,s,a,l,d=r(30168),c=r(18607),h=r(49450),u=r(58406),p=r(699),f=r(98634),g=r(4760);const v=8;function m(e,t){const r=e.vertex;r.uniforms.add(new u.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(g.T.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new h.J("vvSizeMinSize",(e=>e.vvSize.minSize)),new h.J("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new h.J("vvSizeOffset",(e=>e.vvSize.offset)),new h.J("vvSizeFactor",(e=>e.vvSize.factor))),r.code.add((0,f.H)(i||(i=(0,d.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(g.T.SIZE,"float"),r.code.add((0,f.H)(n||(n=(0,d.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(g.T.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new p.O("vvOpacityValues",(e=>e.vvOpacity.values),v),new p.O("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),v)),r.code.add((0,f.H)(o||(o=(0,d.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):r.code.add((0,f.H)(s||(s=(0,d.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(c.k,t),e.attributes.add(g.T.COLORFEATUREATTRIBUTE,"float"),r.code.add((0,f.H)(a||(a=(0,d.Z)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(g.T.COLOR,"vec4"),r.code.add((0,f.H)(l||(l=(0,d.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},83866:(e,t,r)=>{var i;r.d(t,{U:()=>i}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}))},7683:(e,t,r)=>{r.d(t,{E:()=>l,K:()=>a});var i,n,o=r(30168),s=r(98634);function a(e){e.fragment.code.add((0,s.H)(i||(i=(0,o.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,s.H)(n||(n=(0,o.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},29202:(e,t,r)=>{r.d(t,{D:()=>s});var i,n=r(30168),o=r(98634);function s(e){e.fragment.code.add((0,o.H)(i||(i=(0,n.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}},60300:(e,t,r)=>{r.d(t,{q:()=>b,C:()=>S});var i=r(30168),n=r(78980),o=r(41012),s=r(95276),a=r(58406),l=r(98634),d=r(19253),c=r(5921),h=r(19093),u=r(86361);function p(e){return null==e?u.AG:4===e.length?e:(0,h.s)(f,e[0],e[1],e[2],1)}const f=(0,u.Ue)();var g,v,m,_,y,w,C,x,T;function b(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:h,fragment:u}=e;u.include(n.n),t.draped||((0,o.hY)(h,t),h.uniforms.add(new a.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),h.code.add((0,l.H)(g||(g=(0,i.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),h.code.add((0,l.H)(v||(v=(0,i.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),R)),h.code.add((0,l.H)(m||(m=(0,i.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),h.code.add((0,l.H)(_||(_=(0,i.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),r?"patternLength":"1e4")),(0,o.ZI)(h),h.code.add((0,l.H)(y||(y=(0,i.Z)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),u.uniforms.add(new d.A("stipplePatternTexture",(e=>e.stippleTexture)),new a.p("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*((0,c.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.p("stipplePatternPixelSizeInv",(e=>1/S(e)))),u.code.add((0,l.H)(w||(w=(0,i.Z)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(u.uniforms.add(new s.N("stippleOffColor",(e=>p(e.stippleOffColor)))),u.code.add((0,l.H)(C||(C=(0,i.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):u.code.add((0,l.H)(x||(x=(0,i.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,l.H)(T||(T=(0,i.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function S(e){const t=e.stipplePattern;return t?(0,c.$A)(e.stipplePattern)/t.pixelRatio:1}const R=l.H.float(.4)},40526:(e,t,r)=>{r.d(t,{Q:()=>h});var i,n,o=r(30168),s=r(2522),a=r(41012),l=r(58406),d=r(98634),c=r(33720);function h(e,t){const{vertex:r,constants:h}=e;h.add("markerSizePerLineWidth","float",s.M_),(0,a.ZI)(r),null==r.uniforms.get("markerScale")&&r.constants.add("markerScale","float",1),r.code.add((0,d.H)(i||(i=(0,o.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===c.I9.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new l.p("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add((0,d.H)(n||(n=(0,o.Z)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},43565:(e,t,r)=>{r.d(t,{S:()=>l,_:()=>d});var i,n=r(30168),o=r(54943),s=r(98634),a=r(19253);function l(e){e.include(o.K),e.uniforms.add(new a.A("geometryDepthTexture",((e,t)=>{var r;return null===(r=t.multipassGeometry.depth)||void 0===r?void 0:r.attachment}))),e.code.add((0,s.H)(i||(i=(0,n.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}class d{}},15107:(e,t,r)=>{r.d(t,{B:()=>S});var i,n=r(30168),o=r(7683),s=r(29202),a=r(2116),l=r(41287),d=r(54943),c=r(82999),h=r(58406),u=r(98634),p=r(8654),f=r(19253);function g(e,t){const r=e.fragment;r.include(d.K),r.uniforms.add(new c.A("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new f.A("depthMap",((e,t)=>{var r;return null===(r=t.depth)||void 0===r?void 0:r.attachment}))),r.uniforms.add(new p.g("proj",((e,t)=>t.camera.projectionMatrix))),r.uniforms.add(new h.p("invResolutionHeight",((e,t)=>1/t.camera.height))),r.uniforms.add(new p.g("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add((0,u.H)(i||(i=(0,n.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var v,m,_,y,w,C,x,T,b=r(73619);function S(e,t){e.include(a.g,t),e.include(s.D),e.include(o.E),t.hasCloudsReflections&&e.include(b.j,t),t.hasScreenSpaceReflections&&e.include(g,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",l.s).add("ssrHeightFadeEnd","float",l.o).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add((0,u.H)(v||(v=(0,n.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),r.uniforms.add(new h.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new h.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),r.code.add((0,u.H)(m||(m=(0,n.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&r.code.add((0,u.H)(_||(_=(0,n.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(r.uniforms.add(new p.g("view",((e,t)=>t.camera.viewMatrix)),new f.A("lastFrameColorTexture",((e,t)=>{var r;return null===(r=t.ssr.lastFrameColor)||void 0===r?void 0:r.getTexture()})),new h.p("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),r.code.add((0,u.H)(y||(y=(0,n.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):r.code.add((0,u.H)(w||(w=(0,n.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add((0,u.H)(C||(C=(0,n.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):r.code.add((0,u.H)(x||(x=(0,n.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):r.code.add((0,u.H)(T||(T=(0,n.Z)(["return waterRenderedColor;\n}"]))))}},22702:(e,t,r)=>{r.d(t,{WB:()=>S,WE:()=>D,gT:()=>l,yl:()=>R});var i,n,o,s,a,l,d,c=r(30168),h=r(86361),u=r(65156),p=r(54134),f=r(92015),g=r(74779),v=r(37081),m=r(92395),_=r(41481),y=r(15107),w=r(20395),C=r(58406),x=r(98634),T=r(19253),b=r(61809);function S(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new w.$("overlayTexOffset",((e,t)=>function(e,t){var r,i;const n=null===(r=t.overlay)||void 0===r||null===(r=r.overlays[p.fu.INNER])||void 0===r?void 0:r.extent;(0,u.py)(n)&&(E[0]=e.toMapSpace[0]/(0,u.d_)(n)-n[0]/(0,u.d_)(n),E[1]=e.toMapSpace[1]/(0,u.Cb)(n)-n[1]/(0,u.Cb)(n));const o=null===(i=t.overlay)||void 0===i||null===(i=i.overlays[p.fu.OUTER])||void 0===i?void 0:i.extent;return(0,u.py)(o)&&(E[2]=e.toMapSpace[0]/(0,u.d_)(o)-o[0]/(0,u.d_)(o),E[3]=e.toMapSpace[1]/(0,u.Cb)(o)-o[1]/(0,u.Cb)(o)),E}(e,t))),new w.$("overlayTexScale",((e,t)=>function(e,t){var r,i;const n=null===(r=t.overlay)||void 0===r||null===(r=r.overlays[p.fu.INNER])||void 0===r?void 0:r.extent;(0,u.py)(n)&&(E[0]=e.toMapSpace[2]/(0,u.d_)(n),E[1]=e.toMapSpace[3]/(0,u.Cb)(n));const o=null===(i=t.overlay)||void 0===i||null===(i=i.overlays[p.fu.OUTER])||void 0===i?void 0:i.extent;return(0,u.py)(o)&&(E[2]=e.toMapSpace[2]/(0,u.d_)(o),E[3]=e.toMapSpace[3]/(0,u.Cb)(o)),E}(e,t)))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new T.A("ovColorTex",((e,t)=>D(e,t)))),A(e,t)}function R(e,t){const{vertex:r,fragment:i}=e;r.uniforms.add(new O("overlayTexOffset"),new O("overlayTexScale")),i.uniforms.add(new C.p("overlayOpacity",(e=>e.overlayOpacity)),new T.A("ovColorTex",((e,t)=>{var r;return null===(r=t.overlay)||void 0===r?void 0:r.getTexture(e.overlayContent)}))),A(e,t)}(d=l||(l={}))[d.Disabled=0]="Disabled",d[d.Enabled=1]="Enabled",d[d.EnabledWithWater=2]="EnabledWithWater",d[d.COUNT=3]="COUNT";class O extends b.x{constructor(e){super(e,"vec4")}}function A(e,t){t.pbrMode!==_.f7.Water&&t.pbrMode!==_.f7.WaterOnIntegratedMesh&&t.pbrMode!==_.f7.TerrainWithWater||e.include(y.B,t);const{vertex:r,fragment:l}=e;e.varyings.add("vtcOverlay","vec4"),r.code.add((0,x.H)(i||(i=(0,c.Z)(["void setOverlayVTC(in vec2 uv) {\nvtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n}"])))),l.code.add((0,x.H)(n||(n=(0,c.Z)(["bool isValid(vec2 uv, vec2 dxdy) {\nreturn (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);\n}\nvec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {\nvec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));\nvec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),l.code.add((0,x.H)(o||(o=(0,c.Z)(["vec4 getCombinedOverlayColor() {\nreturn overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);\n}"])))),l.code.add((0,x.H)(s||(s=(0,c.Z)(["vec4 getOverlayColorTexel(vec4 texCoords) {\nvec2 texDim =  vec2(textureSize(ovColorTex, 0));\nvec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);\nvec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),t.pbrMode!==_.f7.Water&&t.pbrMode!==_.f7.WaterOnIntegratedMesh&&t.pbrMode!==_.f7.TerrainWithWater||((0,m.Pe)(l),(0,m.F1)(l),l.code.add((0,x.H)(a||(a=(0,c.Z)(["vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\nfloat shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {\nvec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\nvec3 v = vposEyeDir;\nvec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);\nreturn vec4(final, colorInput.w);\n}"])))))}function D(e,t){var r,i,n;return e.identifier===g.o9.Material&&e.output===v.H_.Color?null===(r=t.overlay)||void 0===r?void 0:r.getTexture(f.D.ColorNoRasterImage):e.identifier===g.o9.Material&&e.output===v.H_.ObjectAndLayerIdColor?null===(i=t.overlay)||void 0===i?void 0:i.getTexture(f.D.ObjectAndLayerIdColor):e.identifier===g.o9.Highlight?null===(n=t.overlay)||void 0===n?void 0:n.getTexture(f.D.Highlight):null}const E=(0,h.Ue)()},73619:(e,t,r)=>{r.d(t,{j:()=>R});var i,n,o,s,a,l,d,c,h=r(30168),u=r(16889),p=r(22186),f=r(46208),g=r(5573),v=r(50902),m=r(92395),_=r(13773),y=r(49450),w=r(58406),C=r(98634),x=r(8654),T=r(61809),b=r(99340);class S extends T.x{constructor(e,t){super(e,"samplerCube",b.P.Pass,((r,i,n)=>r.bindTexture(e,t(i,n))))}}function R(e){const t=e.fragment;t.uniforms.add(new x.g("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new x.g("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new y.J("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new y.J("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new w.p("cloudsHeight",(()=>v.$T)),new w.p("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new w.p("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new w.p("crossFadeAnchorFactor",((e,t)=>(0,u.uZ)(t.cloudsFade.fadeFactor,0,1))),new S("cubeMap",((e,t)=>{var r,i;return null!==(r=null===(i=t.cloudsFade.data)||void 0===i||null===(i=i.cubeMap)||void 0===i?void 0:i.colorTexture)&&void 0!==r?r:null})),new _.U("crossFade",((e,t)=>t.cloudsFade.fadeMode===g.lL.CROSS_FADE)),new _.U("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===f.uz.RG)),new _.U("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===f.jL.FADING))),t.constants.add("planetRadius","float",p.sv.radius),t.code.add((0,C.H)(i||(i=(0,h.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,C.H)(n||(n=(0,h.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,C.H)(o||(o=(0,h.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,m.Pe)(t),(0,m.F1)(t),t.code.add((0,C.H)(s||(s=(0,h.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,C.H)(a||(a=(0,h.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,C.H)(l||(l=(0,h.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,C.H)(d||(d=(0,h.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,C.H)(c||(c=(0,h.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}},20395:(e,t,r)=>{r.d(t,{$:()=>o});var i=r(61809),n=r(99340);class o extends i.x{constructor(e,t){super(e,"vec4",n.P.Draw,((r,i,n)=>r.setUniform4fv(e,t(i,n))))}}},51992:(e,t,r)=>{r.d(t,{M:()=>o});var i=r(59447),n=r(33559);class o{constructor(e){this._context=e,this._perConstructorInstances=new i.r,this._frameCounter=0,this._keepAliveFrameCount=a}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;const r=t.key;let i=this._perConstructorInstances.get(e,r);if(null==i){const n=new e(this._context,t,(()=>this.release(n)));i=new s(n),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if(null!=r){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==a&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class s{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const a=-1,l=new n.m},70374:(e,t,r)=>{r.d(t,{He:()=>d,P6:()=>c,QA:()=>u,bV:()=>p,jt:()=>o,of:()=>s,tY:()=>l,vO:()=>h});var i=r(7138),n=r(37081);const o={required:[]},s={required:[n.H_.Depth]};class a extends i.default{consumes(){return o}get usedMemory(){return 0}get isDecoration(){return!1}get running(){return!1}get materialReference(){return null}modify(e){}get numGeometries(){return 0}get hasOccludees(){return!1}queryRenderOccludedState(e){return!1}}class l extends a{}class d extends a{constructor(){super(...arguments),this.drapedPriority=0}}class c extends a{}class h extends a{}function u(e){return"prepareTechnique"in e}function p(e){return"prepareTechniques"in e}},83377:(e,t,r)=>{r.d(t,{p:()=>f});var i=r(7025),n=r(6644),o=r(5573),s=r(81296),a=r(83866),l=r(43565),d=r(15226),c=r(68401),h=r(93822),u=r(25920),p=r(48919);class f{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=h.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=u.A.NONE,this.alignPixelEnabled=!1,this.decorations=c.Iq.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new s.Z,this._inverseViewport=(0,n.Ue)(),this.oldLighting=new p.cI,this.newLighting=new p.cI,this._fadedLighting=new p.cI,this._lighting=this.newLighting,this.ssr=new g,this.multipassEnabled=!1,this.multipassTerrain=new d.a,this.multipassGeometry=new l._,this.hudRenderStyle=a.U.Occluded,this.cloudsFade=new o.Kf,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class g{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,i.Ue)()}}},78976:(e,t,r)=>{r.d(t,{as:()=>n,t9:()=>s});var i=r(27546);class n{constructor(){this.adds=new i.Z,this.removes=new i.Z,this.updates=new i.Z({allocator:e=>e||new o,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class o{}class s{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},53252:(e,t,r)=>{r.d(t,{h:()=>a});var i=r(32718),n=r(92026),o=r(59447),s=r(97731);class a{constructor(e,t,r,i){this._textures=e,this._techniques=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new o.r}dispose(){this._textures.destroy()}acquire(e,t,r){this._ownMaterial(e);const i=e.produces.get(t);if(null===i||void 0===i||!i(r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(null==n){const t=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:r});n=new l(t),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);null!=r&&(r.unref(),r.referenced||((0,n.M2)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&i.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class l{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,s.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}},94425:(e,t,r)=>{r.d(t,{p:()=>n});var i=r(68401);class n{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,r){const n=this._material.produces.get(t);if(null===n||void 0===n||!n(r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const o=this._map.get(r);if(null!=o){if(o.ensureResources(e)===i.Rw.LOADED)return o;this._repository.requestRender()}return null}}},70619:(e,t,r)=>{r.d(t,{Cr:()=>ne,IG:()=>S,QL:()=>X,nb:()=>Q,B2:()=>E,DA:()=>re,x2:()=>ee,dV:()=>J,xu:()=>q,mj:()=>k,rh:()=>te,PI:()=>B,g7:()=>K,AW:()=>W,PD:()=>$,Ay:()=>se,mx:()=>ie});var i,n=r(6644),o=r(32035),s=r(93311),a=r(12400),l=r(86372),d=r(38461),c=r(39406),h=r(55652),u=r(40885),p=r(91526);!function(e){e.length=function(e,t){const r=e[t],i=e[t+1],n=e[t+2];return Math.sqrt(r*r+i*i+n*n)},e.normalize=function(e,t){const r=e[t],i=e[t+1],n=e[t+2],o=1/Math.sqrt(r*r+i*i+n*n);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]+r[i],n[o+1]=e[t+1]+r[i+1],n[o+2]=e[t+2]+r[i+2]},e.subtract=function(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[o]=e[t]-r[i],n[o+1]=e[t+1]-r[i+1],n[o+2]=e[t+2]-r[i+2]}}(i||(i={}));var f=r(79100),g=r(40779),v=r(97731),m=r(4760);const _=i,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],C=[0,0,1,0,1,1,0,1],x=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],T=new Array(36);for(let de=0;de<6;de++)for(let e=0;e<6;e++)T[6*de+e]=de;const b=new Array(36);for(let de=0;de<6;de++)b[6*de]=0,b[6*de+1]=1,b[6*de+2]=2,b[6*de+3]=2,b[6*de+4]=3,b[6*de+5]=0;function S(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=y[i][0]*t[0],r[3*i+1]=y[i][1]*t[1],r[3*i+2]=y[i][2]*t[2];return new g.Z(e,[[m.T.POSITION,new p.a(r,x,3,!0)],[m.T.NORMAL,new p.a(w,T,3)],[m.T.UV0,new p.a(C,b,2)]])}const R=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],O=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],A=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],D=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function E(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=R[i][0]*t[0],r[3*i+1]=R[i][1]*t[1],r[3*i+2]=R[i][2]*t[2];return new g.Z(e,[[m.T.POSITION,new p.a(r,A,3,!0)],[m.T.NORMAL,new p.a(O,D,3)]])}const M=(0,s.al)(-.5,0,-.5),I=(0,s.al)(.5,0,-.5),P=(0,s.al)(0,0,.5),L=(0,s.al)(0,.5,0),N=(0,s.Ue)(),U=(0,s.Ue)(),F=(0,s.Ue)(),H=(0,s.Ue)(),j=(0,s.Ue)();(0,o.f)(N,M,L),(0,o.f)(U,M,I),(0,o.b)(F,N,U),(0,o.n)(F,F),(0,o.f)(N,I,L),(0,o.f)(U,I,P),(0,o.b)(H,N,U),(0,o.n)(H,H),(0,o.f)(N,P,L),(0,o.f)(U,P,M),(0,o.b)(j,N,U),(0,o.n)(j,j);const z=[M,I,P,L],V=[0,-1,0,F[0],F[1],F[2],H[0],H[1],H[2],j[0],j[1],j[2]],Z=[0,1,2,3,1,0,3,2,1,3,0,2],G=[0,0,0,1,1,1,2,2,2,3,3,3];function W(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=z[i][0]*t[0],r[3*i+1]=z[i][1]*t[1],r[3*i+2]=z[i][2]*t[2];return new g.Z(e,[[m.T.POSITION,new p.a(r,Z,3,!0)],[m.T.NORMAL,new p.a(V,G,3)]])}function B(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const o=-Math.PI,s=2*Math.PI,a=-Math.PI/2,l=Math.PI,h=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),f=(h+1)*(u+1),v=(0,d.xx)(3*f),_=(0,d.xx)(3*f),y=(0,d.xx)(2*f),w=[];let C=0;for(let d=0;d<=u;d++){const e=[],r=d/u,i=a+r*l,n=Math.cos(i);for(let a=0;a<=h;a++){const l=a/h,d=o+l*s,c=Math.cos(d)*n,u=Math.sin(i),p=-Math.sin(d)*n;v[3*C]=c*t,v[3*C+1]=u*t,v[3*C+2]=p*t,_[3*C]=c,_[3*C+1]=u,_[3*C+2]=p,y[2*C]=l,y[2*C+1]=r,e.push(C),++C}w.push(e)}const x=new Array;for(let d=0;d<u;d++)for(let e=0;e<h;e++){const t=w[d][e],r=w[d][e+1],i=w[d+1][e+1],n=w[d+1][e];0===d?(x.push(t),x.push(i),x.push(n)):d===u-1?(x.push(t),x.push(r),x.push(i)):(x.push(t),x.push(r),x.push(i),x.push(i),x.push(n),x.push(t))}const T=[[m.T.POSITION,new p.a(v,x,3,!0)],[m.T.NORMAL,new p.a(_,x,3,!0)]];return n.uv&&T.push([m.T.UV0,new p.a(y,x,2,!0)]),n.offset&&(T[0][0]=m.T.OFFSET,T.push([m.T.POSITION,new p.a(Float64Array.from(n.offset),(0,c.LE)(x.length),3,!0)])),new g.Z(e,T)}function k(e,t,r,i){const n=q(t,r,i);return new g.Z(e,n)}function q(e,t,r){const i=e;let n,o;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;n=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let d=0;d<n.length;d+=3)_.scale(n,d,e/_.length(n,d));let s={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(s[i])return s[i];let o=n.length;return n.length+=3,_.add(n,3*t,n,3*r,n,o),_.scale(n,o,e/_.length(n,o)),o/=3,s[i]=o,o}for(let d=0;d<t;d++){const e=o.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=o[r],i=o[r+1],n=o[r+2],s=a(e,i),l=a(i,n),d=a(n,e),c=4*r;t[c]=e,t[c+1]=s,t[c+2]=d,t[c+3]=i,t[c+4]=l,t[c+5]=s,t[c+6]=n,t[c+7]=d,t[c+8]=l,t[c+9]=s,t[c+10]=l,t[c+11]=d}o=t,s={}}const l=(0,d.XO)(n);for(let d=0;d<l.length;d+=3)_.normalize(l,d);return[[m.T.POSITION,new p.a((0,d.XO)(n),o,3,!0)],[m.T.NORMAL,new p.a(l,o,3,!0)]]}function J(e,t,r,i,o,s,l,d){var h;let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const v=r?(0,a.d9)(r):(0,a.Ue)(),_=t?(0,a.d9)(t):(0,a.al)(0,0,1);null!==(h=l)&&void 0!==h||(l=(0,n.Ue)());const y=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],w=null!=o&&2===o.length?o:[1,1],C=(0,c.LE)(1),x=[[m.T.POSITION,new p.a(v,C,3,!0)],[m.T.NORMAL,new p.a(_,C,3,!0)],[m.T.UV0,new p.a(l,C,l.length)],[m.T.COLOR,new p.a(y,C,4,!0)],[m.T.SIZE,new p.a(w,C,2)]];if(null!=s&&(s=[s[0],s[1],s[2],s[3]],x.push([m.T.CENTEROFFSETANDDISTANCE,new p.a(s,C,4)])),d){const e=[d[0],d[1],d[2],d[3]];x.push([m.T.FEATUREATTRIBUTE,new p.a(e,C,4)])}return new g.Z(e,x,null,f.U.Point,u)}const Y=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y;const r=new Array(12);for(let s=0;s<4;s++)for(let e=0;e<3;e++)r[3*s+e]=t[s][e];const i=[0,1,2,2,3,0],n=[0,0,0,0,0,0],o=[[m.T.POSITION,new p.a(r,i,3,!0)],[m.T.NORMAL,new p.a([0,0,1],n,3,!0)],[m.T.UV0,new p.a([0,0,1,0,1,1,0,1],i,2,!0)],[m.T.COLOR,new p.a([255,255,255,255],n,4,!0)]];return new g.Z(e,o)}function X(e,t,r,i,n){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=0;const c=r,h=t;let u=(0,s.al)(0,l,0),f=(0,s.al)(0,l+h,0),v=(0,s.al)(0,-1,0),_=(0,s.al)(0,1,0);n&&(l=h,f=(0,s.al)(0,0,0),u=(0,s.al)(0,l,0),v=(0,s.al)(0,1,0),_=(0,s.al)(0,-1,0));const y=[f,u],w=[v,_],C=i+2,x=Math.sqrt(h*h+c*c);if(n)for(let d=i-1;d>=0;d--){const e=d*(2*Math.PI/i),t=(0,s.al)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,s.al)(h*Math.cos(e)/x,-c/x,h*Math.sin(e)/x);w.push(r)}else for(let d=0;d<i;d++){const e=d*(2*Math.PI/i),t=(0,s.al)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,s.al)(h*Math.cos(e)/x,c/x,h*Math.sin(e)/x);w.push(r)}const T=new Array,b=new Array;if(o){for(let e=3;e<y.length;e++)T.push(1),T.push(e-1),T.push(e),b.push(0),b.push(0),b.push(0);T.push(y.length-1),T.push(2),T.push(1),b.push(0),b.push(0),b.push(0)}if(a){for(let e=3;e<y.length;e++)T.push(e),T.push(e-1),T.push(0),b.push(e),b.push(e-1),b.push(1);T.push(0),T.push(2),T.push(y.length-1),b.push(1),b.push(2),b.push(w.length-1)}const S=(0,d.xx)(3*C);for(let s=0;s<C;s++)S[3*s]=y[s][0],S[3*s+1]=y[s][1],S[3*s+2]=y[s][2];const R=(0,d.xx)(3*C);for(let s=0;s<C;s++)R[3*s]=w[s][0],R[3*s+1]=w[s][1],R[3*s+2]=w[s][2];const O=[[m.T.POSITION,new p.a(S,T,3,!0)],[m.T.NORMAL,new p.a(R,b,3,!0)]];return new g.Z(e,O)}function Q(e,t,r,i,n,a,l){var c;const h=n?(0,s.d9)(n):(0,s.al)(1,0,0),u=a?(0,s.d9)(a):(0,s.al)(0,0,0);null!==(c=l)&&void 0!==c||(l=!0);const f=(0,s.Ue)();(0,o.n)(f,h);const v=(0,s.Ue)();(0,o.j)(v,f,Math.abs(t));const _=(0,s.Ue)();(0,o.j)(_,v,-.5),(0,o.g)(_,_,u);const y=(0,s.al)(0,1,0);Math.abs(1-(0,o.m)(f,y))<.2&&(0,o.s)(y,0,0,1);const w=(0,s.Ue)();(0,o.b)(w,f,y),(0,o.n)(w,w),(0,o.b)(y,w,f);const C=2*i+(l?2:0),x=i+(l?2:0),T=(0,d.xx)(3*C),b=(0,d.xx)(3*x),S=(0,d.xx)(2*C),R=new Array(3*i*(l?4:2)),O=new Array(3*i*(l?4:2));l&&(T[3*(C-2)]=_[0],T[3*(C-2)+1]=_[1],T[3*(C-2)+2]=_[2],S[2*(C-2)]=0,S[2*(C-2)+1]=0,T[3*(C-1)]=T[3*(C-2)]+v[0],T[3*(C-1)+1]=T[3*(C-2)+1]+v[1],T[3*(C-1)+2]=T[3*(C-2)+2]+v[2],S[2*(C-1)]=1,S[2*(C-1)+1]=1,b[3*(x-2)]=-f[0],b[3*(x-2)+1]=-f[1],b[3*(x-2)+2]=-f[2],b[3*(x-1)]=f[0],b[3*(x-1)+1]=f[1],b[3*(x-1)+2]=f[2]);const A=(e,t,r)=>{R[e]=t,O[e]=r};let D=0;const E=(0,s.Ue)(),M=(0,s.Ue)();for(let s=0;s<i;s++){const e=s*(2*Math.PI/i);(0,o.j)(E,y,Math.sin(e)),(0,o.j)(M,w,Math.cos(e)),(0,o.g)(E,E,M),b[3*s]=E[0],b[3*s+1]=E[1],b[3*s+2]=E[2],(0,o.j)(E,E,r),(0,o.g)(E,E,_),T[3*s]=E[0],T[3*s+1]=E[1],T[3*s+2]=E[2],S[2*s]=s/i,S[2*s+1]=0,T[3*(s+i)]=T[3*s]+v[0],T[3*(s+i)+1]=T[3*s+1]+v[1],T[3*(s+i)+2]=T[3*s+2]+v[2],S[2*(s+i)]=s/i,S[2*s+1]=1;const t=(s+1)%i;A(D++,s,s),A(D++,s+i,s),A(D++,t,t),A(D++,t,t),A(D++,s+i,s),A(D++,t+i,t)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;A(D++,C-2,x-2),A(D++,e,x-2),A(D++,t,x-2)}for(let e=0;e<i;e++){const t=(e+1)%i;A(D++,e+i,x-1),A(D++,C-1,x-1),A(D++,t+i,x-1)}}const I=[[m.T.POSITION,new p.a(T,R,3,!0)],[m.T.NORMAL,new p.a(b,O,3,!0)],[m.T.UV0,new p.a(S,R,2,!0)]];return new g.Z(e,I)}function $(e,t,r,i,n,o){i=i||10,n=null==n||n,(0,v.hu)(t.length>1);const s=[],a=[];for(let l=0;l<i;l++){s.push([0,-l-1,-(l+1)%i-1]);const e=l/i*2*Math.PI;a.push([Math.cos(e)*r,Math.sin(e)*r])}return ee(e,a,t,[[0,0,0]],s,n,o)}function ee(e,t,r,i,n,l){let c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,s.al)(0,0,0);const f=t.length,v=(0,d.xx)(r.length*f*3+(6*i.length||0)),_=(0,d.xx)(r.length*f*3+(i?6:0)),y=new Array,w=new Array;let C=0,x=0;const T=(0,a.Ue)(),b=(0,a.Ue)(),S=(0,a.Ue)(),R=(0,a.Ue)(),O=(0,a.Ue)(),A=(0,a.Ue)(),D=(0,a.Ue)(),E=(0,a.Ue)(),M=(0,a.Ue)(),I=(0,a.Ue)(),P=(0,a.Ue)(),L=(0,a.Ue)(),N=(0,a.Ue)(),U=(0,h.Ue)();(0,o.s)(M,0,1,0),(0,o.f)(b,r[1],r[0]),(0,o.n)(b,b),l?((0,o.g)(E,r[0],c),(0,o.n)(S,E)):(0,o.s)(S,0,0,1),se(b,S,M,M,O,S,ae),(0,o.c)(R,S),(0,o.c)(L,O);for(let s=0;s<i.length;s++)(0,o.j)(A,O,i[s][0]),(0,o.j)(E,S,i[s][2]),(0,o.g)(A,A,E),(0,o.g)(A,A,r[0]),v[C++]=A[0],v[C++]=A[1],v[C++]=A[2];_[x++]=-b[0],_[x++]=-b[1],_[x++]=-b[2];for(let o=0;o<n.length;o++)y.push(n[o][0]>0?n[o][0]:-n[o][0]-1+i.length),y.push(n[o][1]>0?n[o][1]:-n[o][1]-1+i.length),y.push(n[o][2]>0?n[o][2]:-n[o][2]-1+i.length),w.push(0),w.push(0),w.push(0);let F=i.length;const H=i.length-1;for(let s=0;s<r.length;s++){let e=!1;s>0&&((0,o.c)(T,b),s<r.length-1?((0,o.f)(b,r[s+1],r[s]),(0,o.n)(b,b)):e=!0,(0,o.g)(I,T,b),(0,o.n)(I,I),(0,o.g)(P,r[s-1],R),(0,h.Yq)(r[s],I,U),(0,h.BR)(U,(0,u.re)(P,T),E)?((0,o.f)(E,E,r[s]),(0,o.n)(S,E),(0,o.b)(O,I,S),(0,o.n)(O,O)):se(I,R,L,M,O,S,ae),(0,o.c)(R,S),(0,o.c)(L,O)),l&&((0,o.g)(E,r[s],c),(0,o.n)(N,E));for(let i=0;i<f;i++)if((0,o.j)(A,O,t[i][0]),(0,o.j)(E,S,t[i][1]),(0,o.g)(A,A,E),(0,o.n)(D,A),_[x++]=D[0],_[x++]=D[1],_[x++]=D[2],(0,o.g)(A,A,r[s]),v[C++]=A[0],v[C++]=A[1],v[C++]=A[2],!e){const e=(i+1)%f;y.push(F+i),y.push(F+f+i),y.push(F+e),y.push(F+e),y.push(F+f+i),y.push(F+f+e);for(let t=0;t<6;t++){const e=y.length-6;w.push(y[e+t]-H)}}F+=f}const j=r[r.length-1];for(let s=0;s<i.length;s++)(0,o.j)(A,O,i[s][0]),(0,o.j)(E,S,i[s][1]),(0,o.g)(A,A,E),(0,o.g)(A,A,j),v[C++]=A[0],v[C++]=A[1],v[C++]=A[2];const z=x/3;_[x++]=b[0],_[x++]=b[1],_[x++]=b[2];const V=F-f;for(let o=0;o<n.length;o++)y.push(n[o][0]>=0?F+n[o][0]:-n[o][0]-1+V),y.push(n[o][2]>=0?F+n[o][2]:-n[o][2]-1+V),y.push(n[o][1]>=0?F+n[o][1]:-n[o][1]-1+V),w.push(z),w.push(z),w.push(z);const Z=[[m.T.POSITION,new p.a(v,y,3,!0)],[m.T.NORMAL,new p.a(_,w,3,!0)]];return new g.Z(e,Z)}function te(e,t,r,i){(0,v.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,v.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,v.hu)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,v.hu)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const n=(0,l.bg)(3*t.length),o=new Array(2*(t.length-1));let s=0,a=0;for(let l=0;l<t.length;l++){for(let e=0;e<3;e++)n[s++]=t[l][e];l>0&&(o[a++]=l-1,o[a++]=l)}const h=[[m.T.POSITION,new p.a(n,o,3,!0)]];if(r){const e=(0,d.xx)(3*r.length);let i=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[i++]=r[n][t];h.push([m.T.NORMAL,new p.a(e,o,3,!0)])}return i&&h.push([m.T.COLOR,new p.a(i,(0,c.KF)(i.length/4),4)]),new g.Z(e,h,null,f.U.Line)}function re(e,t,r,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const s=new Array(18),a=[[-r,o,n/2],[i,o,n/2],[0,t+o,n/2],[-r,o,-n/2],[i,o,-n/2],[0,t+o,-n/2]];for(let l=0;l<6;l++)s[3*l]=a[l][0],s[3*l+1]=a[l][1],s[3*l+2]=a[l][2];return new g.Z(e,[[m.T.POSITION,new p.a(s,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])}function ie(e,t){const r=e.getMutableAttribute(m.T.POSITION).data;for(let i=0;i<r.length;i+=3){const e=r[i],n=r[i+1],s=r[i+2];(0,o.s)(le,e,n,s),(0,o.h)(le,le,t),r[i]=le[0],r[i+1]=le[1],r[i+2]=le[2]}}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const r=e.attributes,i=r.get(m.T.POSITION).data,n=r.get(m.T.NORMAL).data;if(n){const e=t.getMutableAttribute(m.T.NORMAL).data;for(let t=0;t<n.length;t+=3){const r=n[t+1];e[t+1]=-n[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(m.T.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}}function oe(e,t,r,i,n){return!(Math.abs((0,o.m)(t,e))>n)&&((0,o.b)(r,e,t),(0,o.n)(r,r),(0,o.b)(i,r,e),(0,o.n)(i,i),!0)}function se(e,t,r,i,n,o,s){return oe(e,t,n,o,s)||oe(e,r,n,o,s)||oe(e,i,n,o,s)}const ae=.99619469809,le=(0,a.Ue)()},19962:(e,t,r)=>{r.d(t,{C:()=>m});r(93169);var i=r(95439),n=r(32035),o=r(12400),s=r(86361),a=r(50628),l=r(91526),d=r(79100),c=r(40779),h=r(61403),u=r(66327),p=r(17852),f=r(4760),g=r(97882),v=r(58901);class m{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,i.D)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=p.p.rootOrigin;if(null!=t)return this._origins.set(this._rootOriginId,(0,h.a)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,h.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,i=Math.round(e[0]/r),o=Math.round(e[1]/r),s=Math.round(e[2]/r),a="".concat(i,"/").concat(o,"/").concat(s);let l=this._origins.get(a);const d=.5*r;if((0,n.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<d&&_[1]<d&&_[2]<d){if(l){const t=Math.max(..._);if((0,n.f)(_,e,l.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max(..._)<t)return l}return t}return l||(l=(0,h.a)(i*r,o*r,s*r,a),this._origins.set(a,l)),l}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.al)(1,1,0,1);const r=window.view,i=r._stage,n=t.toString();if(!this._objects.has(n)){this._material=new v.U({width:2,color:t}),i.add(this._material);const e=new g.F(i,{pickable:!1}),r=new u.T({castShadow:!1});i.add(r),e.add(r),this._objects.set(n,r)}const o=this._objects.get(n),h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=h.length,m=new Array(3*p),_=new Array,y=.5*this._gridSize;for(let s=0;s<p;s++)m[3*s]=e[0]+(1&h[s]?y:-y),m[3*s+1]=e[1]+(2&h[s]?y:-y),m[3*s+2]=e[2]+(4&h[s]?y:-y),s>0&&_.push(s-1,s);(0,a.projectBuffer)(m,this._originSR,0,m,r.renderSpatialReference,0,p);const w=new c.Z(this._material,[[f.T.POSITION,new l.a(m,_,3,!0)]],null,d.U.Line);i.add(w),o.addGeometry(w)}get test(){}}const _=(0,o.Ue)()},61403:(e,t,r)=>{r.d(t,{a:()=>o});var i=r(12400);class n{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,r,o){return new n((0,i.al)(e,t,r),o)}},78289:(e,t,r)=>{var i,n;r.d(t,{$:()=>n,T:()=>i}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(n||(n={}))},66327:(e,t,r)=>{r.d(t,{T:()=>v});r(93169);var i=r(29134),n=r(7025),o=r(32035),s=r(12400),a=r(23470),l=r(80064),d=r(68401),c=r(1395),h=r(79100),u=r(47669),p=r(97731),f=r(4760),g=r(32683);class v extends c.c{get geometries(){return this._geometries}get transformation(){var e;return null!==(e=this._transformation)&&void 0!==e?e:n.Wd}set transformation(e){var t;this._transformation=(0,i.JG)(null!==(t=this._transformation)&&void 0!==t?t:(0,n.Ue)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){var t;this._shaderTransformation=e?(0,i.JG)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,n.Ue)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}constructor(){var e,t;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.U.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=null===(e=r.castShadow)||void 0===e||e,this.usesVerticalDistanceToGround=null!==(t=r.usesVerticalDistanceToGround)&&void 0!==t&&t,this.graphicUid=r.graphicUid,this.layerUid=r.layerUid,r.isElevationSource&&(this.lastValidElevationBB=new m),this._geometries=r.geometries?Array.from(r.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:r}),(0,f.j)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u.O(d.V_.MaskOccludee);for(const t of this._geometries)t.occludees=(0,g.lr)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,g.U_)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u.O(d.V_.Highlight);for(const t of this._geometries)t.highlights=(0,g.lr)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,g.U_)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,i.Jp)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.Ue)();return(0,i.Jp)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new _,this._validateBoundingVolume(this._bvWorldSpace,b.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new _,this._validateBoundingVolume(this._bvObjectSpace,b.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const r=t===b.ObjectSpace;for(const i of this._geometries){const t=i.boundingInfo;t&&y(t,e,r?i.transformation:this.getCombinedShaderTransformation(i))}(0,o.o)((0,a.g)(e.bounds),e.min,e.max,.5);for(const i of this._geometries){const t=i.boundingInfo;if(null==t)continue;const n=r?i.transformation:this.getCombinedShaderTransformation(i),s=(0,l.u1)(n);(0,o.h)(T,t.center,n);const d=(0,o.p)(T,(0,a.g)(e.bounds)),c=t.radius*s;e.bounds[3]=Math.max(e.bounds[3],d+c)}}_invalidateBoundingVolume(){var e;const t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){}}class m{constructor(){this.min=(0,s.al)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,s.al)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends m{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,r){const n=e.bbMin,s=e.bbMax;if((0,i.lv)(r)){const e=(0,o.s)(w,r[12],r[13],r[14]);(0,o.g)(C,n,e),(0,o.g)(x,s,e);for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],C[r]),t.max[r]=Math.max(t.max[r],x[r])}else if((0,o.h)(C,n,r),(0,o.e)(n,s))for(let i=0;i<3;++i)t.min[i]=Math.min(t.min[i],C[i]),t.max[i]=Math.max(t.max[i],C[i]);else{(0,o.h)(x,s,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],x[e]),t.max[e]=Math.max(t.max[e],C[e],x[e]);for(let e=0;e<3;++e){(0,o.c)(C,n),(0,o.c)(x,s),C[e]=s[e],x[e]=n[e],(0,o.h)(C,C,r),(0,o.h)(x,x,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],C[e],x[e]),t.max[e]=Math.max(t.max[e],C[e],x[e])}}}const w=(0,s.Ue)(),C=(0,s.Ue)(),x=(0,s.Ue)(),T=(0,s.Ue)();var b,S;(S=b||(b={}))[S.WorldSpace=0]="WorldSpace",S[S.ObjectSpace=1]="ObjectSpace"},46293:(e,t,r)=>{r.d(t,{C9:()=>c,V1:()=>d,Yh:()=>l});var i=r(38499),n=r(81296),o=r(37081),s=r(83377),a=r(56529);class l{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=r,this.lastFrameCamera=new n.Z,this.output=o.H_.Color,this.renderOccludedMask=c,this.bindParameters=new s.p(t,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0}}class d extends l{constructor(e,t,r,n){super(e,r,n),this.offscreenRenderingHelper=t,this.sliceHelper=n,this.time=(0,i.HA)(0)}}const c=a.yD.Occlude|a.yD.OccludeAndTransparent|a.yD.OccludeAndTransparentStencil},39077:(e,t,r)=>{r.d(t,{z:()=>d});var i=r(95439),n=r(29134),o=r(7025),s=r(32035),a=r(23470),l=r(80064);class d{constructor(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,o.Ue)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,i.D)(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=null!==(t=r.castShadow)&&void 0!==t&&t,null!=r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,n.JG)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,o.Ue)()),(0,n.Jp)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,a.c)()),(0,s.h)((0,a.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,l.u1)(this.shaderTransformation)),this._boundingSphere):a.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){var e;return null!==(e=this._shaderTransformation)&&void 0!==e?e:this.transformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},471:(e,t,r)=>{r.d(t,{l:()=>E,i:()=>x});var i=r(93169),n=r(16889),o=r(92026),s=r(21389),a=r(29134),l=r(7025),d=r(13611),c=r(6644),h=r(32035),u=r(12400),p=r(19093),f=r(86361),g=r(50951),v=r(18020),m=r(27366),_=r(49861),y=(r(32718),r(84936),r(69912)),w=r(81296);let C=class extends w.Z{constructor(){super(...arguments),this._projectionMatrix=(0,l.Ue)()}get projectionMatrix(){return this._projectionMatrix}};(0,m._)([(0,_.Cb)()],C.prototype,"_projectionMatrix",void 0),(0,m._)([(0,_.Cb)({readOnly:!0})],C.prototype,"projectionMatrix",null),C=(0,m._)([(0,y.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],C);var x,T,b=r(32251),S=r(97731),R=r(8548),O=r(57808);(T=x||(x={}))[T.Highlight=0]="Highlight",T[T.ExcludeHighlight=1]="ExcludeHighlight";class A{constructor(){this.camera=new C,this.lightMat=(0,l.Ue)()}}class D{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class E{constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new D,this._projectionView=(0,l.Ue)(),this._projectionViewInverse=(0,l.Ue)(),this._modelViewLight=(0,l.Ue)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,f.Ue)(),this._cascades=[new A,new A,new A,new A],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,i.Z)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,p.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=(0,o.RY)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,n.uZ)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)z[e]=this._cascades[e];return z.length=this._numCascades,z}start(e,t,r,i,n){(0,S.hu)(this.enabled);const{near:o,far:s}=function(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}(r);this._computeCascadeDistances(o,s,i),this._textureHeight=this._computeTextureHeight(e,n,i),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,l,a,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,S.hu)(this.enabled),null===(e=this._handle)||void 0===e||e.detachDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,h.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,u.Ue)(),(0,h.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,a.Iu)(V,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Z[16*t+e]=V[e]}}return Z}moveSnapshot(e){var t,r;(0,S.hu)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.detachDepth(),null!==(r=this._snapshots[e])&&void 0!==r&&r.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}copySnapshot(e){var t,r,i;const n=null===(t=this._handle)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor;if(!this.enabled||!n)return;null===(r=this._snapshots[e])||void 0===r||r.release();const{width:o,height:s}=n,a=e===x.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(o,s,a,v.q.RGBA4);const l=this._fbos.rctx;this._bindFbo();const d=l.bindTexture(null===(i=this._snapshots[e])||void 0===i?void 0:i.getTexture(),O.x.TEXTURE_UNIT_FOR_UPDATES);l.gl.copyTexSubImage2D(R.No.TEXTURE_2D,0,0,0,0,0,o,s),l.bindTexture(d,O.x.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.getTexture():null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(R.lk.COLOR_BUFFER_BIT|R.lk.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,r){const i=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,o=(0,b.nq)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*i*n)),s=Math.min(this._maxTextureWidth,this._numCascades*o);return(0,b.pf)(s/this._numCascades)}_ensureFbo(){var e,t,r,i;(null===(e=this._handle)||void 0===e||null===(e=e.fbo)||void 0===e?void 0:e.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",v.q.RGBA4)),null===(i=this._handle)||void 0===i||i.acquireDepth(v.m.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,o.RY)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;const t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,r,i){const o=this._cascades[e],s=-this._cascadeDistances[e],l=-this._cascadeDistances[e+1],c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),u=(t[10]*l+t[14])/Math.abs(t[11]*l+t[15]);(0,S.hu)(c<u);for(let n=0;n<8;++n){(0,p.s)(I,n%4==0||n%4==3?-1:1,n%4==0||n%4==1?-1:1,n<4?c:u,1);const e=P[n];(0,p.t)(e,I,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,h.k)(j,P[0]),o.camera.viewMatrix=(0,a.Iu)(M,this._modelViewLight,j);for(let n=0;n<8;++n)(0,h.h)(P[n],P[n],o.camera.viewMatrix);let f=P[0][2],g=P[0][2];for(let n=1;n<8;++n)f=Math.min(f,P[n][2]),g=Math.max(g,P[n][2]);f-=200,g+=200,o.camera.near=-g,o.camera.far=-f,function(e,t,r,i,o){const s=1/P[0][3],a=1/P[4][3];(0,S.hu)(s<a);let l=s+Math.sqrt(s*a);const c=Math.sin((0,n.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));l/=c,function(e,t,r,i,n,o,s,a){(0,d.t8)(G,0,0);for(let x=0;x<4;++x)(0,d.IH)(G,G,e[x]);(0,d.bA)(G,G,.25),(0,d.t8)(W,0,0);for(let x=4;x<8;++x)(0,d.IH)(W,W,e[x]);(0,d.bA)(W,W,.25),(0,d.t7)(B[0],e[4],e[5],.5),(0,d.t7)(B[1],e[5],e[6],.5),(0,d.t7)(B[2],e[6],e[7],.5),(0,d.t7)(B[3],e[7],e[4],.5);let l=0,c=(0,d.bI)(B[0],G);for(let x=1;x<4;++x){const e=(0,d.bI)(B[x],G);e<c&&(c=e,l=x)}(0,d.$X)(k,B[l],e[l+4]);const h=k[0];let u,p;k[0]=-k[1],k[1]=h,(0,d.$X)(q,W,G),(0,d.AK)(q,k)<0&&(0,d.tk)(k,k),(0,d.t7)(k,k,q,r),(0,d.Fv)(k,k),u=p=(0,d.AK)((0,d.$X)(J,e[0],G),k);for(let x=1;x<8;++x){const t=(0,d.AK)((0,d.$X)(J,e[x],G),k);t<u?u=t:t>p&&(p=t)}(0,d.JG)(i,G),(0,d.bA)(J,k,u-t),(0,d.IH)(i,i,J);let f=-1,g=1,v=0,m=0;for(let x=0;x<8;++x){(0,d.$X)(Y,e[x],i),(0,d.Fv)(Y,Y);const t=k[0]*Y[1]-k[1]*Y[0];t>0?t>f&&(f=t,v=x):t<g&&(g=t,m=x)}(0,S.T)(f>0,"leftArea"),(0,S.T)(g<0,"rightArea"),(0,d.bA)(K,k,u),(0,d.IH)(K,K,G),(0,d.bA)(X,k,p),(0,d.IH)(X,X,G),Q[0]=-k[1],Q[1]=k[0];const _=(0,S.ep)(i,e[m],X,(0,d.IH)(J,X,Q),1,n),y=(0,S.ep)(i,e[v],X,J,1,o),w=(0,S.ep)(i,e[v],K,(0,d.IH)(J,K,Q),1,s),C=(0,S.ep)(i,e[m],K,J,1,a);(0,S.T)(_,"rayRay"),(0,S.T)(y,"rayRay"),(0,S.T)(w,"rayRay"),(0,S.T)(C,"rayRay")}(P,l,c,L,N,U,F,H),function(e,t,r,i,n){(0,d.$X)(re,r,i),(0,d.bA)(re,re,.5),ie[0]=re[0],ie[1]=re[1],ie[2]=0,ie[3]=re[1],ie[4]=-re[0],ie[5]=0,ie[6]=re[0]*re[0]+re[1]*re[1],ie[7]=re[0]*re[1]-re[1]*re[0],ie[8]=1,ie[$(0,2)]=-(0,d.AK)(te(ie,0),e),ie[$(1,2)]=-(0,d.AK)(te(ie,1),e);let o=(0,d.AK)(te(ie,0),r)+ie[$(0,2)],s=(0,d.AK)(te(ie,1),r)+ie[$(1,2)],a=(0,d.AK)(te(ie,0),i)+ie[$(0,2)],l=(0,d.AK)(te(ie,1),i)+ie[$(1,2)];o=-(o+a)/(s+l),ie[$(0,0)]+=ie[$(1,0)]*o,ie[$(0,1)]+=ie[$(1,1)]*o,ie[$(0,2)]+=ie[$(1,2)]*o,o=1/((0,d.AK)(te(ie,0),r)+ie[$(0,2)]),s=1/((0,d.AK)(te(ie,1),r)+ie[$(1,2)]),ie[$(0,0)]*=o,ie[$(0,1)]*=o,ie[$(0,2)]*=o,ie[$(1,0)]*=s,ie[$(1,1)]*=s,ie[$(1,2)]*=s,ie[$(2,0)]=ie[$(1,0)],ie[$(2,1)]=ie[$(1,1)],ie[$(2,2)]=ie[$(1,2)],ie[$(1,2)]+=1,o=(0,d.AK)(te(ie,1),t)+ie[$(1,2)],s=(0,d.AK)(te(ie,2),t)+ie[$(2,2)],a=(0,d.AK)(te(ie,1),r)+ie[$(1,2)],l=(0,d.AK)(te(ie,2),r)+ie[$(2,2)],o=-.5*(o/s+a/l),ie[$(1,0)]+=ie[$(2,0)]*o,ie[$(1,1)]+=ie[$(2,1)]*o,ie[$(1,2)]+=ie[$(2,2)]*o,o=(0,d.AK)(te(ie,1),t)+ie[$(1,2)],s=(0,d.AK)(te(ie,2),t)+ie[$(2,2)],a=-s/o,ie[$(1,0)]*=a,ie[$(1,1)]*=a,ie[$(1,2)]*=a,n[0]=ie[0],n[1]=ie[1],n[2]=0,n[3]=ie[2],n[4]=ie[3],n[5]=ie[4],n[6]=0,n[7]=ie[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=ie[6],n[13]=ie[7],n[14]=0,n[15]=ie[8]}(L,N,F,H,o.projectionMatrix),o.projectionMatrix[10]=2/(r-i),o.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,f,g,o.camera),(0,a.Jp)(o.lightMat,o.camera.projectionMatrix,o.camera.viewMatrix);const v=this._textureHeight;o.camera.viewport=[e*v,0,v,v]}_setupMatrices(e,t){(0,a.Jp)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,a.U_)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===g.JY.Global?e.eye:(0,h.s)(j,0,0,1);(0,a.zB)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_computeCascadeDistances(e,t,r){const i=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,S.E6)(t/e,4)),i);const o=(t-e)/this._numCascades,s=(t/e)**(1/this._numCascades);let a=e,l=e;for(let d=0;d<this._numCascades+1;++d)this._cascadeDistances[d]=(0,n.t7)(a,l,this.settings.splitSchemeLambda),a*=s,l+=o}get test(){}}const M=(0,l.Ue)(),I=(0,f.Ue)(),P=[];for(let ne=0;ne<8;++ne)P.push((0,f.Ue)());const L=(0,c.Ue)(),N=(0,c.Ue)(),U=(0,c.Ue)(),F=(0,c.Ue)(),H=(0,c.Ue)(),j=(0,u.Ue)(),z=[],V=(0,l.Ue)(),Z=l.Wd.concat(l.Wd,l.Wd,l.Wd,l.Wd),G=(0,c.Ue)(),W=(0,c.Ue)(),B=[(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)()],k=(0,c.Ue)(),q=(0,c.Ue)(),J=(0,c.Ue)(),Y=(0,c.Ue)(),K=(0,c.Ue)(),X=(0,c.Ue)(),Q=(0,c.Ue)();function $(e,t){return 3*t+e}const ee=(0,c.Ue)();function te(e,t){return(0,d.t8)(ee,e[t],e[t+3]),ee}const re=(0,c.Ue)(),ie=(0,s.Ue)()},81341:(e,t,r)=>{r.d(t,{S:()=>C});var i=r(27366),n=r(7138),o=(r(93169),r(77427)),s=r(27546),a=r(49861),l=(r(32718),r(84936),r(69912)),d=r(6644),c=r(23470),h=r(43449),u=r(37081),p=r(78976),f=r(88153),g=r(54463),v=r(56529),m=r(78289),_=r(41947),y=r(93822),w=r(41139);let C=class extends n.default{constructor(e){super(e),this._pending=new x,this._changes=new p.as,this._materialRenderers=new Map,this._sortedMaterialRenderers=new s.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.destroy())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){return(0,o.oE)(this._materialRenderers,(e=>0!==e.numGeometries&&!e.queryRenderOccludedState(v.yD.Occlude)))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}getMaterialRenderer(e){return this._materialRenderers.get(e)}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=(0,_.q9)(this._changes);let t=!1;return e.forEach(((e,r)=>{let i=this.getMaterialRenderer(r);if(!i&&e.adds.length>0){const e=new w.A({material:r});e.initializeRenderContext(this.rendererContext.pluginContext,this._materials),i=e,this._materialRenderers.set(r,i),t=!0}i&&(i.modify(e),0===i.numGeometries&&(this._materialRenderers.delete(r),i.destroy(),t=!0))})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,o.oE)(this._materialRenderers,(e=>{const t=e.produces.get(y.r.DRAPED_MATERIAL);return!!t&&t(u.H_.Highlight)})),this._hasWater=(0,o.oE)(this._materialRenderers,(e=>{const t=e.produces.get(y.r.DRAPED_WATER);return!!t&&t(u.H_.Normal)})),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const n of r)this._geometries.set(n.id,n);const i=this._pending.empty;for(const n of r)this._pending.adds.add(n);i&&this.notifyChange("updating"),t===m.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const n of e)i.has(n)?(this._pending.removed.add(n),i.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===m.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case m.$.TRANSFORMATION:case m.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case m.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const r=t.prepareTechnique(e);null!=r&&t.renderNode(e,r)}))}intersect(e,t,r,i,n){return this._geometries.forEach((o=>{if(i&&!i(o))return;this._intersectRenderGeometry(o,r,t,0,e,n);const s=this.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&this._intersectRenderGeometry(o,r,t,s.range,e,n),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&this._intersectRenderGeometry(o,r,t,-s.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;for(const t of this._materialRenderers.values())t.drapedPriority=e++,this._sortedMaterialRenderers.push(t);this._sortedMaterialRenderers.sort(((e,t)=>{var r,i,n,o;return(null===(r=t.materialReference)||void 0===r?void 0:r.renderPriority)===(null===(i=e.materialReference)||void 0===i?void 0:i.renderPriority)?e.drapedPriority-t.drapedPriority:((null===(n=t.materialReference)||void 0===n?void 0:n.renderPriority)||0)-((null===(o=e.materialReference)||void 0===o?void 0:o.renderPriority)||0)}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,n,o){if(!e.visible)return;let s=0;i+=e.transformation[12],s=e.transformation[13],T[0]=r[0]-i,T[1]=r[1]-s,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,T,((r,i,s)=>{!function(e,t,r,i,n,o,s){const a=new h.T6(o,s,t),l=t=>{t.set(g.q7.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==n.results.min.drapedLayerOrder||r>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==g.eC.MIN&&(null==n.results.max.drapedLayerOrder||r<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===g.eC.ALL){const e=(0,f.LP)(n.ray);l(e),n.results.all.push(e)}}(t,s,o,e.material.renderPriority,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const r of e){const e=r.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,c.g)(e.boundingSphere))),e}get test(){}};(0,i._)([(0,a.Cb)()],C.prototype,"drapeSource",void 0),(0,i._)([(0,a.Cb)()],C.prototype,"updating",null),(0,i._)([(0,a.Cb)()],C.prototype,"rctx",null),(0,i._)([(0,a.Cb)({constructOnly:!0})],C.prototype,"rendererContext",void 0),(0,i._)([(0,a.Cb)()],C.prototype,"_materials",null),(0,i._)([(0,a.Cb)()],C.prototype,"_localOriginFactory",null),(0,i._)([(0,a.Cb)({readOnly:!0})],C.prototype,"isEmpty",null),(0,i._)([(0,a.Cb)()],C.prototype,"_materialRenderers",void 0),(0,i._)([(0,a.Cb)()],C.prototype,"_geometries",void 0),C=(0,i._)([(0,l.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],C);class x{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const T=(0,d.Ue)()},5195:(e,t,r)=>{r.d(t,{K:()=>c});var i=r(61863),n=r(82144),o=r(31132),s=r(7566),a=r(27627),l=r(8548),d=r(36207);class c extends o.A{initializeProgram(e){return new a.$(e.rctx,c.shader.get().build(),s.i)}initializePipeline(){return this.configuration.hasAlpha?(0,d.sm)({blending:(0,d.wK)(l.zi.SRC_ALPHA,l.zi.ONE,l.zi.ONE_MINUS_SRC_ALPHA,l.zi.ONE_MINUS_SRC_ALPHA),colorWrite:d.BK}):(0,d.sm)({colorWrite:d.BK})}}c.shader=new n.J(i.a,(()=>r.e(77026).then(r.bind(r,77026))))},25049:(e,t,r)=>{r.d(t,{V:()=>o});var i=r(27366),n=r(33559);class o extends n.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,i._)([(0,n.o)()],o.prototype,"hasAlpha",void 0)},78485:(e,t,r)=>{var i;r.d(t,{j:()=>i}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},80658:(e,t,r)=>{r.d(t,{U:()=>n});var i=r(45412);class n extends i.U{}},97882:(e,t,r)=>{r.d(t,{F:()=>u,e:()=>p});var i=r(91505),n=r(100),o=r(92026),s=r(27546),a=r(1395),l=r(79100);const d=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var c=r(78329),h=r(78485);class u extends a.c{get objects(){return this._objects}constructor(e,t){var r,o,a,c;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=u,this.type=l.U.Layer,this.events=new i.Z,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new s.Z,this._objectsAdded=new s.Z,this._handles=new n.Z,this.apiLayerUid=u,this.visible=null===(r=null===t||void 0===t?void 0:t.visible)||void 0===r||r,this.pickable=null===(o=null===t||void 0===t?void 0:t.pickable)||void 0===o||o,this.updatePolicy=null!==(a=null===t||void 0===t?void 0:t.updatePolicy)&&void 0!==a?a:h.j.ASYNC,this._disableOctree=null!==(c=null===t||void 0===t?void 0:t.disableOctree)&&void 0!==c&&c,e.add(this);for(const i of d)this._handles.add(this.events.on(i,(t=>e.handleEvent(i,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.j.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new c.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,o.SC)(this._octree),this._objectsAdded.clear()}}function p(e){return null!=e&&e.type===l.U.Layer}},41947:(e,t,r)=>{r.d(t,{Np:()=>n,YE:()=>i,q9:()=>a});var i,n,o,s=r(78976);function a(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new s.t9,t.set(e,r)),r};return e.removes.forAll((e=>{l(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{l(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{l(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}function l(e){return e.geometry.indexCount>=1}(o=i||(i={}))[o.Default=0]="Default",o[o.Screenshot=1]="Screenshot",o[o.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},17852:(e,t,r)=>{r.d(t,{p:()=>n,y:()=>i});const i={stableRendering:!1},n={rootOrigin:null}},73059:(e,t,r)=>{r.d(t,{w:()=>o});var i=r(12400),n=r(85380);class o extends n.Pf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.Ue)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}},91398:(e,t,r)=>{r.d(t,{t:()=>n});var i=r(95439);class n{constructor(e,t,r){this._createTexture=e,this._parametersKey=t,this._repository=new Map,this._orphanCache=r.newCache("procedural-texture-repository:".concat((0,i.D)()),(e=>e.dispose()))}destroy(){for(const[e,{texture:t}]of this._repository)t.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=this._acquire(e);return this.release(t),r}release(e){if(null==e)return;const t=this._parametersKey(e),r=this._repository.get(t);if(r&&(r.refCount--,0===r.refCount)){this._repository.delete(t);const{texture:e}=r,i=e.usedMemory;this._orphanCache.put(t,e,i)}}_acquire(e){var t;if(null==e)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=null!==(t=this._orphanCache.pop(r))&&void 0!==t?t:this._createTexture(e),s=new o(n);return this._repository.set(r,s),n}}class o{constructor(e){this.texture=e,this.refCount=1}}},58901:(e,t,r)=>{r.d(t,{U:()=>H});var i=r(93169),n=r(32718),o=r(16889),s=r(17842),a=r(13611),l=r(32035),d=r(12400),c=r(86361),h=r(95773),u=r(85981),p=r(55652),f=r(55158),g=r(37081),v=r(23620),m=r(56529),_=r(93822),y=r(97731),w=r(4760),C=r(65964),x=r(33720),T=r(98186),b=r(82144),S=r(31132),R=r(78041),O=r(27627),A=r(50411),D=r(25920),E=r(8548),M=r(36207);const I=new Map([[w.T.POSITION,0],[w.T.PREVPOSITION,1],[w.T.NEXTPOSITION,2],[w.T.SUBDIVISIONFACTOR,3],[w.T.UV0,4],[w.T.COLOR,5],[w.T.COLORFEATUREATTRIBUTE,5],[w.T.SIZE,6],[w.T.SIZEFEATUREATTRIBUTE,6],[w.T.OPACITYFEATUREATTRIBUTE,7],[w.T.OBJECTANDLAYERIDCOLOR,8]]);class P extends S.A{initializeProgram(e){return new O.$(e.rctx,P.shader.get().build(this.configuration),I)}_makePipelineState(e,t){const r=this.configuration,i=e===D.A.NONE,n=e===D.A.FrontFace,o=(0,g._D)(r.output);return(0,M.sm)({blending:r.output===g.H_.Color?i?R.wu:(0,R.j7)(e):null,depthTest:{func:(0,R.Bh)(e)},depthWrite:i?r.writeDepth||o?M.LZ:null:(0,R.K5)(e),drawBuffers:r.output===g.H_.Depth?{buffers:[E.Xg.NONE]}:(0,R.V7)(e),colorWrite:M.BK,stencilWrite:r.hasOccludees?A.s3:null,stencilTest:r.hasOccludees?t?A.eD:A.RY:null,polygonOffset:i||n?r.hasPolygonOffset?L:null:R.E0})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?L:null;this._occluderPipelineTransparent=(0,M.sm)({blending:R.wu,polygonOffset:t,depthTest:A.zV,depthWrite:null,colorWrite:M.BK,stencilWrite:null,stencilTest:A.YD,drawBuffers:e.output===g.H_.Depth?{buffers:[E.Xg.NONE]}:null}),this._occluderPipelineOpaque=(0,M.sm)({blending:R.wu,polygonOffset:t,depthTest:A.zV,depthWrite:null,colorWrite:M.BK,stencilWrite:A.P7,stencilTest:A.ii,drawBuffers:e.output===g.H_.Depth?{buffers:[E.Xg.NONE]}:null}),this._occluderPipelineMaskWrite=(0,M.sm)({blending:null,polygonOffset:t,depthTest:A.JN,depthWrite:null,colorWrite:null,stencilWrite:A.s3,stencilTest:A.eD,drawBuffers:e.output===g.H_.Depth?{buffers:[E.Xg.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?E.MX.LINES:E.MX.TRIANGLE_STRIP}getPipeline(e,t,r){return e?this._occludeePipelineState:this.configuration.occluder?r?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}P.shader=new b.J(T.R,(()=>r.e(56279).then(r.bind(r,56279))));const L={factor:0,units:-4};var N,U,F=r(737);(U=N||(N={}))[U.LEFT_JOIN_START=-2]="LEFT_JOIN_START",U[U.LEFT_JOIN_END=-1]="LEFT_JOIN_END",U[U.LEFT_CAP_START=-4]="LEFT_CAP_START",U[U.LEFT_CAP_END=-5]="LEFT_CAP_END",U[U.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",U[U.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",U[U.RIGHT_CAP_START=4]="RIGHT_CAP_START",U[U.RIGHT_CAP_END=5]="RIGHT_CAP_END";class H extends m.F5{constructor(e){super(e,new z),this._configuration=new F.G,this.produces=new Map([[_.r.OPAQUE_MATERIAL,e=>e===g.H_.Highlight||e===g.H_.ObjectAndLayerIdColor||e===g.H_.Color&&this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil],[_.r.OPAQUE_NO_SSAO_DEPTH,e=>(0,g.BX)(e)],[_.r.OCCLUDER_MATERIAL,e=>(0,g._4)(e)&&this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_OCCLUDER_MATERIAL,e=>(0,g._4)(e)&&this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_MATERIAL,e=>e===g.H_.Color&&this.parameters.writeDepth&&this.parameters.renderOccluded!==m.yD.OccludeAndTransparentStencil],[_.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>e===g.H_.Color&&!this.parameters.writeDepth&&this.parameters.renderOccluded!==m.yD.OccludeAndTransparentStencil],[_.r.DRAPED_MATERIAL,e=>(0,g.xs)(e)]]),this._vertexAttributeLocations=I}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===_.r.DRAPED_MATERIAL;const r=null!=this.parameters.stipplePattern&&e!==g.H_.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===x.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===m.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,i,n,s){if(!r.options.selectionMode)return;const a=e.attributes.get(w.T.POSITION).data,l=e.attributes.get(w.T.SIZE);let d=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(w.T.SIZEFEATUREATTRIBUTE).data[0];d*=(0,o.uZ)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(d*=l.data[0]);const c=i[0],h=i[1],u=(d/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let g=0;g<a.length-5;g+=3){const e=a[g],t=a[g+1],r=c-e,i=h-t,n=a[g+3]-e,s=a[g+4]-t,l=(0,o.uZ)((n*r+s*i)/(n*n+s*s),0,1),d=n*l-r,u=s*l-i,v=d*d+u*u;v<p&&(p=v,f=g/3)}p<u*u&&n(s.dist,s.normal,f,!1)}intersect(e,t,r,i,s,d){if(!r.options.selectionMode||!e.visible)return;if(!(0,y.kG)(t))return void n.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const c=e.attributes,f=c.get(w.T.POSITION).data;let g=this.parameters.width;if(this.parameters.vvSize){const e=c.get(w.T.SIZEFEATUREATTRIBUTE).data[0];g*=(0,o.uZ)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else c.has(w.T.SIZE)&&(g*=c.get(w.T.SIZE).data[0]);const v=r.camera,m=J;(0,a.JG)(m,r.point);const _=g*v.pixelRatio/2+4*v.pixelRatio;(0,l.s)(ne[0],m[0]-_,m[1]+_,0),(0,l.s)(ne[1],m[0]+_,m[1]+_,0),(0,l.s)(ne[2],m[0]+_,m[1]-_,0),(0,l.s)(ne[3],m[0]-_,m[1]-_,0);for(let n=0;n<4;n++)if(!v.unprojectFromRenderScreen(ne[n],oe[n]))return;(0,p.zk)(v.eye,oe[0],oe[1],se),(0,p.zk)(v.eye,oe[1],oe[2],ae),(0,p.zk)(v.eye,oe[2],oe[3],le),(0,p.zk)(v.eye,oe[3],oe[0],de);let C=Number.MAX_VALUE,x=0;const T=G(this.parameters,c)?f.length-2:f.length-5;for(let n=0;n<T;n+=3){W[0]=f[n]+t[12],W[1]=f[n+1]+t[13],W[2]=f[n+2]+t[14];const e=(n+3)%f.length;if(B[0]=f[e]+t[12],B[1]=f[e+1]+t[13],B[2]=f[e+2]+t[14],(0,p.jH)(se,W)<0&&(0,p.jH)(se,B)<0||(0,p.jH)(ae,W)<0&&(0,p.jH)(ae,B)<0||(0,p.jH)(le,W)<0&&(0,p.jH)(le,B)<0||(0,p.jH)(de,W)<0&&(0,p.jH)(de,B)<0)continue;if(v.projectToRenderScreen(W,Y),v.projectToRenderScreen(B,K),Y[2]<0&&K[2]>0){(0,l.f)(k,W,B);const e=v.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],W)/(0,l.m)(k,(0,p.st)(e[h.Nu.NEAR]));(0,l.j)(k,k,t),(0,l.g)(W,W,k),v.projectToRenderScreen(W,Y)}else if(Y[2]>0&&K[2]<0){(0,l.f)(k,B,W);const e=v.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],B)/(0,l.m)(k,(0,p.st)(e[h.Nu.NEAR]));(0,l.j)(k,k,t),(0,l.g)(B,B,k),v.projectToRenderScreen(B,K)}else if(Y[2]<0&&K[2]<0)continue;Y[2]=0,K[2]=0;const r=(0,u.Jk)((0,u.zk)(Y,K,$),m);r<C&&(C=r,(0,l.c)(X,W),(0,l.c)(Q,B),x=n/3)}const b=r.rayBegin,S=r.rayEnd;if(C<_*_){let e=Number.MAX_VALUE;if((0,u.AR)((0,u.zk)(X,Q,$),(0,u.zk)(b,S,ee),q)){(0,l.f)(q,q,b);const t=(0,l.l)(q);(0,l.j)(q,q,1/t),e=t/(0,l.p)(b,S)}d(e,q,x,!1)}}get _layout(){const e=(0,f.U$)().vec3f(w.T.POSITION).vec3f(w.T.PREVPOSITION).vec3f(w.T.NEXTPOSITION).f32(w.T.SUBDIVISIONFACTOR).vec2f(w.T.UV0);return this.parameters.vvSize?e.f32(w.T.SIZEFEATUREATTRIBUTE):e.f32(w.T.SIZE),this.parameters.vvColor?e.f32(w.T.COLORFEATUREATTRIBUTE):e.vec4f(w.T.COLOR),this.parameters.vvOpacity&&e.f32(w.T.OPACITYFEATUREATTRIBUTE),(0,i.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(w.T.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new V(this._layout,this.parameters)}createGLMaterial(e){return new j(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class j extends v.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===g.H_.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(P,e)}}class z extends C.n{constructor(){super(...arguments),this.width=0,this.color=c.hq,this.join="miter",this.cap=F.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class V{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=T.r+r}}_isClosed(e){return G(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(w.T.POSITION).indices.length/2+1,r=this._isClosed(e);let i=r?2:4;return i+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,r,n,o){var s,a,d,c,h;const u=te,p=re,f=ie,g=r.attributes.get(w.T.POSITION),v=g.indices,m=g.data.length/3,_=null===(s=r.attributes.get(w.T.DISTANCETOSTART))||void 0===s?void 0:s.data;v&&v.length!==2*(m-1)&&console.warn("RibbonLineMaterial does not support indices");const y=null!==(a=null!==(d=null===(c=r.attributes.get(w.T.SIZEFEATUREATTRIBUTE))||void 0===c?void 0:c.data[0])&&void 0!==d?d:null===(h=r.attributes.get(w.T.SIZE))||void 0===h?void 0:h.data[0])&&void 0!==a?a:1;let C=[1,1,1,1],x=0;const T=this.vertexBufferLayout.fields.has(w.T.COLORFEATUREATTRIBUTE);T?x=r.attributes.get(w.T.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(w.T.COLOR)&&(C=r.attributes.get(w.T.COLOR).data);const b=(0,i.Z)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null,S=this.vertexBufferLayout.fields.has(w.T.OPACITYFEATUREATTRIBUTE),R=S?r.attributes.get(w.T.OPACITYFEATUREATTRIBUTE).data[0]:0,O=new Float32Array(n.buffer),A=(0,i.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,D=this.vertexBufferLayout.stride/4;let E=o*D;const M=E;let I=0;const P=_?(e,t,r)=>I=_[r]:(e,t,r)=>I+=(0,l.p)(e,t),L=(0,i.Z)("enable-feature:objectAndLayerId-rendering"),U=(e,t,r,i,n,o,s)=>{if(O[E++]=t[0],O[E++]=t[1],O[E++]=t[2],O[E++]=e[0],O[E++]=e[1],O[E++]=e[2],O[E++]=r[0],O[E++]=r[1],O[E++]=r[2],O[E++]=i,O[E++]=s,O[E++]=n,O[E++]=y,T)O[E++]=x;else{const e=Math.min(4*o,C.length-4);O[E++]=C[e],O[E++]=C[e+1],O[E++]=C[e+2],O[E++]=C[e+3]}S&&(O[E++]=R),L&&(null!=b&&(A[4*E]=b[0],A[4*E+1]=b[1],A[4*E+2]=b[2],A[4*E+3]=b[3]),E++)};E+=D,(0,l.s)(p,g.data[0],g.data[1],g.data[2]),e&&(0,l.h)(p,p,e);const F=this._isClosed(r);if(F){const t=g.data.length-3;(0,l.s)(u,g.data[t],g.data[t+1],g.data[t+2]),e&&(0,l.h)(u,u,e)}else(0,l.s)(f,g.data[3],g.data[4],g.data[5]),e&&(0,l.h)(f,f,e),U(p,p,f,1,N.LEFT_CAP_START,0,0),U(p,p,f,1,N.RIGHT_CAP_START,0,0),(0,l.c)(u,p),(0,l.c)(p,f);const H=F?0:1,j=F?m:m-1;for(let i=H;i<j;i++){const t=(i+1)%m*3;(0,l.s)(f,g.data[t],g.data[t+1],g.data[t+2]),e&&(0,l.h)(f,f,e),P(u,p,i),U(u,p,f,0,N.LEFT_JOIN_END,i,I),U(u,p,f,0,N.RIGHT_JOIN_END,i,I);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const t=(e+1)/(r+1);U(u,p,f,t,N.LEFT_JOIN_END,i,I),U(u,p,f,t,N.RIGHT_JOIN_END,i,I)}U(u,p,f,1,N.LEFT_JOIN_START,i,I),U(u,p,f,1,N.RIGHT_JOIN_START,i,I),(0,l.c)(u,p),(0,l.c)(p,f)}F?((0,l.s)(f,g.data[3],g.data[4],g.data[5]),e&&(0,l.h)(f,f,e),I=P(u,p,j),U(u,p,f,0,N.LEFT_JOIN_END,H,I),U(u,p,f,0,N.RIGHT_JOIN_END,H,I)):(I=P(u,p,j),U(u,p,p,0,N.LEFT_CAP_END,j,I),U(u,p,p,0,N.RIGHT_CAP_END,j,I)),Z(O,M+D,O,M,D),E=Z(O,E-D,O,E,D),this._parameters.wireframe&&this._addWireframeVertices(n,M,E,D)}_addWireframeVertices(e,t,r,i){const n=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let s=0;const a=e=>s=Z(o,e,n,s,i);for(let l=0;l<o.length-1;l+=2*i)a(l),a(l+2*i),a(l+1*i),a(l+2*i),a(l+1*i),a(l+3*i)}}function Z(e,t,r,i,n){for(let o=0;o<n;o++)r[i++]=e[t++];return i}function G(e,t){return!!e.isClosed&&t.get(w.T.POSITION).indices.length>2}const W=(0,d.Ue)(),B=(0,d.Ue)(),k=(0,d.Ue)(),q=(0,d.Ue)(),J=(0,d.Ue)(),Y=(0,s.J$)(),K=(0,s.J$)(),X=(0,d.Ue)(),Q=(0,d.Ue)(),$=(0,u.Ue)(),ee=(0,u.Ue)(),te=(0,d.Ue)(),re=(0,d.Ue)(),ie=(0,d.Ue)(),ne=[(0,s.J$)(),(0,s.J$)(),(0,s.J$)(),(0,s.J$)()],oe=[(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)(),(0,d.Ue)()],se=(0,p.Ue)(),ae=(0,p.Ue)(),le=(0,p.Ue)(),de=(0,p.Ue)()},41139:(e,t,r)=>{r.d(t,{A:()=>N});var i=r(27366),n=r(63780),o=(r(93169),r(77427)),s=r(16889),a=r(92026),l=r(59447),d=r(27546),c=r(49861),h=(r(32718),r(69912)),u=r(29134),p=r(7025),f=r(50256),g=r(37081),v=r(70374),m=r(94425),_=r(78289),y=r(93822),w=r(97731),C=r(73059);class x{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function T(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;){r=!1;for(let i=0;i<e.length;++i){const n=e.data[i],o=t.get(n.to);if(!o)return;n.to=o.to,t.delete(o.from),e.removeUnordered(o),r=!0}}}class b extends x{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class S{constructor(){this.first=0,this.count=0}}class R{constructor(){this._numElements=0,this._instances=new Map,this.holes=new d.Z({allocator:e=>e||new x,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=O(),this.drawCommandsHighlight=O(),this.drawCommandsOccludees=O(),this.drawCommandsShadowHighlightRest=O()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return null!=this.vao&&1===this.holes.length&&r.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const r of t)r.isVisible&&(A(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),A(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function O(){return new d.Z({allocator:e=>e||new S,deallocator:e=>e})}function A(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class D{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var E=r(76861),M=r(80658),I=r(44070),P=r(8548);class L{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=new E.N(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let r=this._cache.pop(t);return r||(r=new M.U(this._rctx,this._locations,{geometry:this._layout},{geometry:I.f.createVertex(this._rctx,P.l1.STATIC_DRAW)}),r.vertexBuffers.geometry.setSize(e),r)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e)}}let N=class extends v.He{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._produces=new Map,this.drapedPriority=0}destroy(){this._glMaterials=(0,a.M2)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,a.M2)(this._vaoCache)}initialize(){this.material.produces.forEach(((e,t)=>{this._produces.set(t,(t=>!(0===this._dataByOrigin.size||!(t!==g.H_.Highlight&&t!==g.H_.ShadowHighlight||this._hasHighlights))&&e(t)))}))}get produces(){return this._produces}initializeRenderContext(e,t){const{rctx:r}=e.renderContext;this._glMaterials=new m.p(this.material,null!==t&&void 0!==t?t:e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new L(r,this.material.vertexAttributeLocations,(0,f.K)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get hasOccludees(){return this._hasOccludees}get isDecoration(){return this.material.parameters.isDecoration}queryRenderOccludedState(e){return this.material.queryRenderOccludedState(e)}get materialReference(){return this.material}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),o=null===n||void 0===n?void 0:n.findBuffer(e.id);if(null==o)return;const s=o.instances.get(e.id);if(i.updateType&(_.$.GEOMETRY|_.$.TRANSFORMATION)){const i=J(t.elementCount(s.geometry.geometry)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),o.vao.vertexBuffers.geometry.setSubData(i,s.from*r,0,s.numElements*r)}i.updateType&(_.$.HIGHLIGHT|_.$.OCCLUDEE|_.$.VISIBILITY)&&(o.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new l.r;for(const i of e){const e=i.localOrigin;if(null==e)continue;let t=r.get(e.id,null);null==t&&(t=new U(e.vec3),r.set(e.id,null,t)),t.changes.push(i)}for(const i of t){const e=i.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=null===t||void 0===t?void 0:t.findBuffer(i.id);if(null==n)continue;let o=r.get(e.id,n);null==o&&(o=new U(e.vec3),r.set(e.id,n,o)),o.changes.push(i)}return r}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:r,_dataByOrigin:i}=this,o=r.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const a=e.get(null),l=null!=a?a.changes:[];s.delete(t,null);let d=i.get(t);if(e.forEach(((e,a)=>{if(s.delete(t,a),null==a)return void(0,w.hu)(!1,"No VAO for removed geometries");if(a.instances.size===e.changes.length)return this._vaoCache.deleteVao(a.vao),(0,n.e$)(d.buffers,a),void(0===d.buffers.length&&0===l.length&&i.delete(t));const c=a.numElements,h=a.vao.byteSize/4,u=l.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),f=Math.min((c+u-p)*o,k),g=f>h;f>Z&&f<h/2?(e.changes.forEach((e=>{let{id:t}=e;return a.deleteInstance(t)})),a.instances.forEach((e=>{let{geometry:t}=e;return l.push(t)})),this._vaoCache.deleteVao(a.vao),(0,n.e$)(d.buffers,a)):g?this._applyAndRebuild(a,l,e):this._applyRemoves(a,e)})),l.length>0)for(null==d&&(d=new D(a.origin),i.set(t,d)),d.buffers.forEach((e=>this._applyAdds(e,l)));l.length>0;)d.buffers.push(this._applyAndRebuild(new R,l,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,o.oE)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if(null!=r)for(const p of r.changes)e.deleteInstance(p.id);const i=this._bufferWriter,n=i.vertexBufferLayout.stride,o=n/4,s=Math.floor(k/o);let a=e.numElements;for(;t.length>0;){const r=t.pop(),n=i.elementCount(r.geometry);if(a+n>s&&a>0){t.push(r);break}a+=n;const o=new b(r,0,0);(0,w.hu)(null==e.instances.get(r.id)),e.addInstance(r.id,o)}const l=a*o,d=J(l),c=i.vertexBufferLayout.createView(d.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,c,h);const n=h;h+=i.elementCount(t.geometry.geometry),e.updateInstance(r,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Y(l)),e.vao.vertexBuffers.geometry.setSubData(d,0,0,h*o),e.holes.clear();const u=e.holes.pushNew();return u.from=h,u.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const s of t.changes){const t=s.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const i=V.back();if(i){if(i.to===r.from){i.to=r.to;continue}if(i.from===r.to){i.from=r.from;continue}}const n=V.pushNew();n.from=r.from,n.to=r.to}T(V);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=V.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,n=J(i);n.fill(0,0,i);const o=e.vao.vertexBuffers.geometry;V.forAll((e=>o.setSubData(n,e.from*r,0,e.numElements*r))),e.holes.pushArray(V.data,V.length),V.forAll(((e,t)=>V.data[t]=null)),V.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,o=e.numElements,s=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),a=Math.min((o+s)*i,k),l=4*a;if(e.vao.byteSize<Y(k-Z)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);T(e.holes);const d=new Array;for(const n of t){const t=r.elementCount(n.geometry),i=F(e.holes,t);d.push(i)}const c=e.vao.vertexBuffers.geometry;let h=0,u=0,p=0;const f=J(a),g=r.vertexBufferLayout.createView(f.buffer);t.forEach(((t,n)=>{const o=d[n];if(null==o)return;if(p!==o){const e=p-u;e>0&&c.setSubData(f,u*i,0,e*i),u=o,h=0}const s=r.elementCount(t.geometry);this._writeGeometry(t,g,h),h+=s,p=o+s;const a=new b(t,o,o+s);(0,w.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const v=p-u;v>0&&c.setSubData(f,u*i,0,v*i),(0,n.hv)(t,((e,t)=>null==d[t]))}_writeGeometry(e,t,r){if(null===this._bufferWriter)return;const i=e.localOrigin.vec3;(0,w.u_)(H,-i[0],-i[1],-i[2]);const n=(0,u.Jp)(j,H,e.transformation);(0,u.U_)(z,n),(0,u.p4)(z,z),this._bufferWriter.write(n,z,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:r}=e,i=this.material.produces.get(r.slot);if(null===i||void 0===i||!i(t))return null;const n=t===g.H_.Highlight||t===g.H_.ShadowHighlight;if(n&&!this._hasHighlights)return null;const o=t===g.H_.ShadowExcludeHighlight,s=!(n||o);for(const a of this._dataByOrigin.values())for(const i of a.buffers){if(n&&!i.hasHighlights)continue;const a=(n?i.drawCommandsHighlight:o&&i.needsMultipleCommands()?i.drawCommandsShadowHighlightRest:i.drawCommandsDefault)||null,l=s&&i.drawCommandsOccludees||null;if(null!==a&&void 0!==a&&a.length||null!==l&&void 0!==l&&l.length){const i=this._glMaterials.load(e.rctx,r.slot,t),n=null!=i?i.beginSlot(r):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:r,bindParameters:i}=e,n=r===g.H_.Highlight||r===g.H_.ShadowHighlight,o=r===g.H_.ShadowExcludeHighlight,s=!(n||o),a=i.slot===y.r.OCCLUDER_MATERIAL,l=i.slot===y.r.TRANSPARENT_OCCLUDER_MATERIAL,d=e.rctx;d.runAppleAmdDriverHelper(),d.bindTechnique(t,i,this.material.parameters);for(const c of this._dataByOrigin.values())for(const e of c.buffers){if(n&&!e.hasHighlights)continue;const r=(n?e.drawCommandsHighlight:o&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=s&&e.drawCommandsOccludees||null;(null!==r&&void 0!==r&&r.length||null!==h&&void 0!==h&&h.length)&&(t.program.bindDraw(new C.w(c.origin),i,this.material.parameters),t.ensureAttributeLocations(e.vao),d.bindVAO(e.vao),null!==r&&void 0!==r&&r.length&&(d.setPipelineState(t.getPipeline(!1,a,l)),r.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count)))),(null===h||void 0===h?void 0:h.length)&&(d.setPipelineState(t.getPipeline(!0,a,l)),h.forAll((e=>d.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){}};(0,i._)([(0,c.Cb)({constructOnly:!0})],N.prototype,"material",void 0),N=(0,i._)([(0,h.j)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],N);class U{constructor(e){this.origin=e,this.changes=new Array}}function F(e,t){let r;if(!e.some((e=>!(e.numElements<t)&&(r=e,!0))))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const H=(0,p.Ue)(),j=(0,p.Ue)(),z=(0,p.Ue)(),V=new d.Z({allocator:e=>e||new x,deallocator:null}),Z=65536,G=4*Z,W=1024,B=16777216,k=B/4;let q=new Float32Array(Z);function J(e){return q.length<e&&(q=new Float32Array(e)),q}function Y(e){const t=4*e;return t<=W?W:t<G?(0,s.Sf)(t):Math.max(Math.min(Math.ceil(1.5*t/G)*G,B),t)}},5921:(e,t,r)=>{r.d(t,{$A:()=>h,kW:()=>l,kj:()=>u});var i=r(46228),n=r(91398),o=r(8548),s=r(57808),a=r(52311);function l(e,t){return new n.t((t=>{const{encodedData:r,textureSize:i}=d(t),n=new a.X;return n.internalFormat=o.VI.RGBA,n.width=i,n.height=1,n.wrapMode=o.e8.REPEAT,new s.x(e,n,r)}),(e=>"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)),t)}function d(e){const t=c(e),r=1/e.pixelRatio,n=h(e),o=u(e),s=(Math.floor(.5*(o-1))+.5)*r,a=[];let l=1;for(const i of t){for(let e=0;e<i;e++){const t=l*(Math.min(e,i-1-e)+.5)*r/s*.5+.5;a.push(t)}l=-l}const d=Math.round(t[0]/2),p=[...a.slice(d),...a.slice(0,d)],f=new Uint8Array(4*n);let g=0;for(const c of p)(0,i.I)(c,f,g),g+=4;return{encodedData:f,textureSize:n}}function c(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=c(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function u(e){return c(e).reduce(((e,t)=>Math.max(e,t)))}},33720:(e,t,r)=>{r.d(t,{I9:()=>i,PI:()=>h,i5:()=>n});var i,n,o,s=r(27366),a=r(37081),l=r(33559),d=r(25920),c=r(8883);(o=i||(i={}))[o.Draped=0]="Draped",o[o.Screen=1]="Screen",o[o.World=2]="World",o[o.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class h extends c.W{constructor(){super(...arguments),this.output=a.H_.Color,this.transparencyPassType=d.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===i.Draped}}(0,s._)([(0,l.o)({count:a.H_.COUNT})],h.prototype,"output",void 0),(0,s._)([(0,l.o)({count:d.A.COUNT})],h.prototype,"transparencyPassType",void 0),(0,s._)([(0,l.o)()],h.prototype,"occluder",void 0),(0,s._)([(0,l.o)()],h.prototype,"hasSlicePlane",void 0),(0,s._)([(0,l.o)()],h.prototype,"writeDepth",void 0),(0,s._)([(0,l.o)({count:i.COUNT})],h.prototype,"space",void 0),(0,s._)([(0,l.o)()],h.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,l.o)()],h.prototype,"hasCap",void 0),(0,s._)([(0,l.o)({count:n.COUNT})],h.prototype,"anchor",void 0),(0,s._)([(0,l.o)()],h.prototype,"hasTip",void 0),(0,s._)([(0,l.o)()],h.prototype,"vvSize",void 0),(0,s._)([(0,l.o)()],h.prototype,"vvColor",void 0),(0,s._)([(0,l.o)()],h.prototype,"vvOpacity",void 0),(0,s._)([(0,l.o)()],h.prototype,"hasOccludees",void 0),(0,s._)([(0,l.o)()],h.prototype,"multipassEnabled",void 0),(0,s._)([(0,l.o)()],h.prototype,"cullAboveGround",void 0),(0,s._)([(0,l.o)({constValue:!1})],h.prototype,"occlusionPass",void 0),(0,s._)([(0,l.o)({constValue:!0})],h.prototype,"hasVvInstancing",void 0),(0,s._)([(0,l.o)({constValue:!0})],h.prototype,"hasSliceTranslatedView",void 0)},737:(e,t,r)=>{r.d(t,{G:()=>c,R:()=>i});var i,n,o=r(27366),s=r(37081),a=r(33559),l=r(25920),d=r(8883);(n=i||(i={}))[n.BUTT=0]="BUTT",n[n.SQUARE=1]="SQUARE",n[n.ROUND=2]="ROUND",n[n.COUNT=3]="COUNT";class c extends d.W{constructor(){super(...arguments),this.output=s.H_.Color,this.capType=i.BUTT,this.transparencyPassType=l.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,o._)([(0,a.o)({count:s.H_.COUNT})],c.prototype,"output",void 0),(0,o._)([(0,a.o)({count:i.COUNT})],c.prototype,"capType",void 0),(0,o._)([(0,a.o)({count:l.A.COUNT})],c.prototype,"transparencyPassType",void 0),(0,o._)([(0,a.o)()],c.prototype,"occluder",void 0),(0,o._)([(0,a.o)()],c.prototype,"hasSlicePlane",void 0),(0,o._)([(0,a.o)()],c.prototype,"hasPolygonOffset",void 0),(0,o._)([(0,a.o)()],c.prototype,"writeDepth",void 0),(0,o._)([(0,a.o)()],c.prototype,"draped",void 0),(0,o._)([(0,a.o)()],c.prototype,"stippleEnabled",void 0),(0,o._)([(0,a.o)()],c.prototype,"stippleOffColorEnabled",void 0),(0,o._)([(0,a.o)()],c.prototype,"stipplePreferContinuous",void 0),(0,o._)([(0,a.o)()],c.prototype,"roundJoins",void 0),(0,o._)([(0,a.o)()],c.prototype,"applyMarkerOffset",void 0),(0,o._)([(0,a.o)()],c.prototype,"vvSize",void 0),(0,o._)([(0,a.o)()],c.prototype,"vvColor",void 0),(0,o._)([(0,a.o)()],c.prototype,"vvOpacity",void 0),(0,o._)([(0,a.o)()],c.prototype,"falloffEnabled",void 0),(0,o._)([(0,a.o)()],c.prototype,"innerColorEnabled",void 0),(0,o._)([(0,a.o)()],c.prototype,"hasOccludees",void 0),(0,o._)([(0,a.o)()],c.prototype,"multipassEnabled",void 0),(0,o._)([(0,a.o)()],c.prototype,"cullAboveGround",void 0),(0,o._)([(0,a.o)()],c.prototype,"wireframe",void 0),(0,o._)([(0,a.o)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,o._)([(0,a.o)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,o._)([(0,a.o)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,o._)([(0,a.o)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},81296:(e,t,r)=>{r.d(t,{Z:()=>S});var i=r(27366),n=r(7138),o=r(32718),s=r(16889),a=r(17842),l=r(49861),d=(r(93169),r(84936),r(69912)),c=r(29134),h=r(7025),u=r(13611),p=r(6644),f=r(32035),g=r(12400),v=r(19093),m=r(86361),_=r(95773),y=r(40885),w=r(40927),C=r(50951);var x,T=r(41947);let b=x=class extends n.default{constructor(e){super(e),this._ray=(0,y.Ue)(),this._viewport=(0,m.al)(0,0,1,1),this._padding=(0,m.al)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,p.al)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.Ue)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.Ue)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.Ue)(),this._frustumDirty=!0,this._frustum=(0,_.Ue)(),this._fullViewport=(0,m.Ue)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.Ue)(),this._up=(0,g.Ue)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,f.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,c.JG)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,f.s)((0,g.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,f.s)((0,g.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,f.s)((0,g.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,v.b)((0,m.Ue)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,v.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,v.b)((0,m.Ue)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,v.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[T.Np.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[T.Np.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]}set fullWidth(e){this.width=e-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[T.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[T.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,v.a)(this._padding,e)||(this._viewport[0]+=e[T.Np.LEFT]-this._padding[T.Np.LEFT],this._viewport[1]+=e[T.Np.BOTTOM]-this._padding[T.Np.BOTTOM],this._viewport[2]-=e[T.Np.RIGHT]+e[T.Np.LEFT]-(this._padding[T.Np.RIGHT]+this._padding[T.Np.LEFT]),this._viewport[3]-=e[T.Np.TOP]+e[T.Np.BOTTOM]-(this._padding[T.Np.TOP]+this._padding[T.Np.BOTTOM]),(0,v.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,c.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,c.U_)((0,h.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,h.Ue)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,f.p)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,c.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,c.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,n=r/this.rows,o=i/this.columns,s=-i/2+this.column*o,a=s+o,l=-r/2+this.row*n,d=l+n,u=(0,c.oy)((0,h.Ue)(),s*(1+2*this._padding[T.Np.LEFT]/e),a*(1+2*this._padding[T.Np.RIGHT]/e),l*(1+2*this._padding[T.Np.BOTTOM]/t),d*(1+2*this._padding[T.Np.TOP]/t),this.near,this.far),p=this._get("projectionMatrix");return p&&(0,c.fS)(p,u)?p:u}copyFrom(e){(0,f.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,v.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,v.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,u.JG)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,c.JG)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,_.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,c.JG)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new x).copyFrom(this)}equals(e){return(0,f.e)(this.eye,e.eye)&&(0,f.e)(this.center,e.center)&&(0,f.e)(this.up,e.up)&&(0,v.a)(this._viewport,e.viewport)&&(0,v.a)(this._padding,e.padding)&&(0,u.I6)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,v.d)(e.screenPadding,this.screenPadding)>=t||(0,v.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,f.z)(A,e.eye,e.center),(0,f.z)(D,this.eye,this.center);const r=(0,f.m)(A,D),i=(0,f.x)(A),n=(0,f.x)(D),o=5e-4;return r*r>=(1-1e-10)*i*n&&(0,f.w)(e.eye,this.eye)<Math.max(i,n)*o*o}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,w.SR)(this.viewForward,(0,f.f)(A,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.s1)();return e[0]=(this.padding[T.Np.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[T.Np.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[T.Np.LEFT]+this.width*t,e[1]=this.padding[T.Np.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==R&&(0,f.c)(R,e),R[3]=1,(0,v.t)(R,R,this.projectionMatrix);const r=Math.abs(R[3]);(0,f.j)(R,R,1/r);const i=this.fullViewport;t[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*R[0]),t[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*R[1]),t[2]=.5*(R[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;R[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],R[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],R[2]=(2*e[2]-1)*e[3],R[3]=e[3],null!=this.inverseProjectionMatrix&&((0,v.t)(R,R,this.inverseProjectionMatrix),t[0]=R[0],t[1]=R[1],t[2]=R[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,E),this.renderToScreen(E,t),t}projectToRenderScreen(e,t){if(R[0]=e[0],R[1]=e[1],R[2]=e[2],R[3]=1,(0,v.t)(R,R,this.viewProjectionMatrix),0===R[3])return null;const r=R;(0,f.j)(r,r,1/Math.abs(R[3]));const i=this.fullViewport,n=(0,s.t7)(0,i[0]+i[2],.5+.5*r[0]),o=(0,s.t7)(0,i[1]+i[3],.5+.5*r[1]);return"x"in t?(t.x=n,t.y=o):(t[0]=n,t[1]=o,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,E),t)}unprojectFromRenderScreen(e,t){if((0,c.Jp)(O,this.projectionMatrix,this.viewMatrix),!(0,c.U_)(O,O))return null;const r=this.fullViewport;return R[0]=2*(e[0]-r[0])/r[2]-1,R[1]=2*(e[1]-r[1])/r[3]-1,R[2]=2*e[2]-1,R[3]=1,(0,v.t)(R,R,O),0===R[3]?null:(t[0]=R[0]/R[3],t[1]=R[1]/R[3],t[2]=R[2]/R[3],t)}constrainWindowSize(e,t,r,i){const n=e*this.pixelRatio,o=t*this.pixelRatio,s=Math.max(n-r/2,0),a=Math.max(this.fullHeight-o-i/2,0),l=-Math.min(n-r/2,0),d=-Math.min(this.fullHeight-o-i/2,0),c=r-l- -Math.min(this.fullWidth-n-r/2,0),h=i-d- -Math.min(o-i/2,0);return[Math.round(s),Math.round(a),Math.round(c),Math.round(h)]}computeUp(e){e===C.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,f.f)(A,this.center,this.eye);const e=(0,f.l)(this.center);e<1?((0,f.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,f.m)(A,this.center))>.9999*(0,f.l)(A)*e||((0,f.b)(this._up,A,this.center),(0,f.b)(this._up,this._up,A),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,f.E)(A,this.eye,this.center),Math.abs(A[2])<=.9999&&((0,f.j)(A,A,A[2]),(0,f.s)(this._up,-A[0],-A[1],1-A[2]),(0,f.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.e)(e,t)||((0,f.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):o.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,_.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,c.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,i._)([(0,l.Cb)()],b.prototype,"_viewport",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_padding",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_fov",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_nearFar",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_viewDirty",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_viewMatrix",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_pixelRatio",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"pixelRatio",null),(0,i._)([(0,l.Cb)()],b.prototype,"row",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"column",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"_rows",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"rows",null),(0,i._)([(0,l.Cb)()],b.prototype,"_columns",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"columns",null),(0,i._)([(0,l.Cb)()],b.prototype,"eye",null),(0,i._)([(0,l.Cb)()],b.prototype,"center",null),(0,i._)([(0,l.Cb)()],b.prototype,"_center",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"up",null),(0,i._)([(0,l.Cb)()],b.prototype,"_up",void 0),(0,i._)([(0,l.Cb)()],b.prototype,"viewMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"viewForward",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"viewUp",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"viewRight",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"nearFar",null),(0,i._)([(0,l.Cb)()],b.prototype,"near",null),(0,i._)([(0,l.Cb)()],b.prototype,"far",null),(0,i._)([(0,l.Cb)()],b.prototype,"viewport",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"screenViewport",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"screenPadding",null),(0,i._)([(0,l.Cb)()],b.prototype,"x",null),(0,i._)([(0,l.Cb)()],b.prototype,"y",null),(0,i._)([(0,l.Cb)()],b.prototype,"width",null),(0,i._)([(0,l.Cb)()],b.prototype,"height",null),(0,i._)([(0,l.Cb)()],b.prototype,"fullWidth",null),(0,i._)([(0,l.Cb)()],b.prototype,"fullHeight",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"_aspect",null),(0,i._)([(0,l.Cb)()],b.prototype,"padding",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"projectionMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"inverseProjectionMatrix",null),(0,i._)([(0,l.Cb)()],b.prototype,"fov",null),(0,i._)([(0,l.Cb)()],b.prototype,"fovX",null),(0,i._)([(0,l.Cb)()],b.prototype,"fovY",null),(0,i._)([(0,l.Cb)()],b.prototype,"viewInverseTransposeMatrix",null),(0,i._)([(0,l.Cb)({readOnly:!0})],b.prototype,"_projectionMatrixInternal",null),(0,i._)([(0,l.Cb)()],b.prototype,"relativeElevation",void 0),b=x=(0,i._)([(0,d.j)("esri.views.3d.webgl.RenderCamera")],b);const S=b,R=(0,m.Ue)(),O=(0,h.Ue)(),A=(0,g.Ue)(),D=(0,g.Ue)(),E=(0,a.J$)()},45412:(e,t,r)=>{r.d(t,{U:()=>d});var i=r(32718),n=r(92026),o=r(18722),s=r(8548),a=r(3384);const l=()=>i.Z.getLogger("esri.views.webgl.VertexArrayObject");let d=class{constructor(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=r,this._buffers=i,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].usedMemory),null!=this._indexBuffer?this._indexBuffer.usedMemory:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*o.ru}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers){var e;null!==(e=this._buffers[t])&&void 0!==e&&e.dispose(),delete this._buffers[t]}this._indexBuffer=(0,n.M2)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(s._g.VertexArrayObject,this)),this._context=null}initialize(){if(this._initialized)return;const{gl:e}=this._context,t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(s._g.VertexArrayObject,this),this._initialized=!0}bind(){this.initialize(),this._context.gl.bindVertexArray(this.glName)}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:r}=this;e||l().error("Vertex buffer dictionary is empty!");const i=this._context.gl;for(const n in e){const r=e[n];r||l().error("Vertex buffer is uninitialized!");const i=t[n];i||l().error("Vertex element descriptor is empty!"),(0,a.XP)(this._context,this._locations,r,i)}null!=r&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.glName)}unbind(){this.initialize(),this._context.gl.bindVertexArray(null)}}}}]);
//# sourceMappingURL=11219.0ad3330b.chunk.js.map