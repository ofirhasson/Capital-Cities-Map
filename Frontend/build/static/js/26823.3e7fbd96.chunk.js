"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[26823],{97942:(t,e,n)=>{function i(t){let e,n,i=[],o=!1;return function(){for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return o&&e===this&&function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(r,i)||(n=t.apply(this,r),e=this,i=r,o=!0),n}}n.d(e,{H:()=>i})},36700:(t,e,n)=>{n.d(e,{x:()=>r});var i=n(44179),o=n(75691),a=n(61309);class r extends o.a{constructor(t){super({...t,constraint:new i.Hk(t.targetPoint)})}get hints(){return[new a.n(this.targetPoint,this.isDraped,this.domain)]}}},26823:(t,e,n)=>{n.r(e),n.d(e,{FeatureCollectionSnappingSource:()=>f});var i=n(27366),o=n(7138),a=n(97942),r=n(66978),s=n(94172),c=n(49861),l=(n(93169),n(32718),n(84936),n(69912)),u=n(74509),d=n(64674),h=n(52824),p=n(59877),g=n(53580),y=n(48817);let f=class extends o.default{get availability(){return 1}get updating(){return this.layerSource.updating}get _snappingElevationAligner(){const{view:t}=this,{layer:e}=this.layerSource,n=null!=t&&"3d"===t.type;if(!n||"subtype-group"===e.type)return(0,p.p)();return(0,p.p)(n,{elevationInfo:e.elevationInfo,alignPointsInFeatures:async(n,i)=>(await(0,r.Hl)(t.whenLayerView(e),i)).elevationAlignPointsInFeatures(n,i)})}get _snappingElevationFilter(){const{view:t}=this,e=null!=t&&"3d"===t.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.c)(e)}get _symbologySnappingFetcher(){const{view:t}=this,{layer:e}=this.layerSource;return null!=t&&"3d"===t.type&&"subtype-group"!==e.type?(0,y.k)(this._symbologySnappingSupported,(async(n,i)=>{const o=await t.whenLayerView(e);return(0,r.k_)(i),o.queryForSymbologySnapping({candidates:n,spatialReference:t.spatialReference},i)})):(0,y.k)()}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:t}=this,{layer:e}=this.layerSource;null!=t&&"3d"===t.type&&"subtype-group"!==e.type&&(t.whenLayerView(e).then((t=>this._layerView3D=t)),this.addHandles([t.elevationProvider.on("elevation-change",(t=>{let{context:n}=t;const{elevationInfo:i}=e;(0,u.W_)(n,i)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,s.watch)((()=>e.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),s.initial),(0,s.watch)((()=>{var t;return null!=this._layerView3D?null===(t=this._layerView3D.layer)||void 0===t?void 0:t.renderer:null}),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),s.initial),(0,s.on)((()=>{var t;return null===(t=this._layerView3D)||void 0===t?void 0:t.layer}),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))]))}constructor(t){super(t),this.view=null,this._layerView3D=null,this._memoizedMakeGetGroundElevation=(0,a.H)(h.g)}refresh(){}async fetchCandidates(t,e){var n,i;const{layer:o}=this.layerSource,a=o.source;if(null===a||void 0===a||!a.querySnapping)return[];const s=(0,d.ML)(o),c=(0,d.rh)(t,null!==(n=null===(i=this.view)||void 0===i?void 0:i.type)&&void 0!==n?n:"2d",s),l=await a.querySnapping(c,{signal:e});(0,r.k_)(e);const u=t.coordinateHelper.spatialReference,p=await this._snappingElevationAligner.alignCandidates(l.candidates,u,e);(0,r.k_)(e);const g=await this._symbologySnappingFetcher.fetch(p,e);(0,r.k_)(e);const y=0===g.length?p:[...p,...g],f=this._snappingElevationFilter.filter(c,y),v=this._memoizedMakeGetGroundElevation(this.view,u);return f.map((t=>(0,h.X)(t,v)))}};(0,i._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,i._)([(0,c.Cb)({constructOnly:!0})],f.prototype,"view",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"_snappingElevationAligner",null),(0,i._)([(0,c.Cb)()],f.prototype,"_snappingElevationFilter",null),(0,i._)([(0,c.Cb)()],f.prototype,"_symbologySnappingFetcher",null),(0,i._)([(0,c.Cb)()],f.prototype,"_layerView3D",void 0),(0,i._)([(0,c.Cb)()],f.prototype,"_symbologySnappingSupported",null),f=(0,i._)([(0,l.j)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},52824:(t,e,n)=>{n.d(e,{X:()=>c,g:()=>l});var i=n(38054),o=n(97760),a=n(95905),r=n(36700);function s(t){let{x:e,y:n,z:o}=t;return(0,i.al)(e,n,null!==o&&void 0!==o?o:0)}function c(t,e){switch(t.type){case"edge":return t.draped?new o.k({edgeStart:s(t.start),edgeEnd:s(t.end),targetPoint:(0,i.s)(s(t.target)),objectId:t.objectId,getGroundElevation:e}):new a.L({edgeStart:s(t.start),edgeEnd:s(t.end),targetPoint:(0,i.s)(s(t.target)),objectId:t.objectId,isDraped:!1});case"vertex":return new r.x({targetPoint:(0,i.s)(s(t.target)),objectId:t.objectId,isDraped:!1})}}function l(t,e){return null!=t&&"3d"===t.type?(n,i)=>t.elevationProvider.getElevation(n,i,0,e,"ground"):()=>null}},59877:(t,e,n)=>{n.d(e,{p:()=>c});n(93169);var i=n(16054),o=n(77427),a=n(66978),r=n(68860),s=n(88152);function c(){let t=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:e,alignPointsInFeatures:n}=t;return new u(e,n)}return new l}class l{async alignCandidates(t,e,n){return t}notifyElevationSourceChange(){}}class u{constructor(t,e){this._elevationInfo=t,this._alignPointsInFeatures=e,this._alignmentsCache=new i.z(1024),this._cacheVersion=0}async alignCandidates(t,e,n){const i=this._elevationInfo;return null==i||"absolute-height"!==i.mode||i.featureExpressionInfo?this._alignComputedElevationCandidates(t,e,n):(function(t,e,n){const{offset:i,unit:o}=n;if(null==i)return;const a=(0,r._R)(e),c=i*((0,s.Z7)(null!==o&&void 0!==o?o:"meters")/a);for(const r of t)switch(r.type){case"edge":r.start.z+=c,r.end.z+=c;continue;case"vertex":r.target.z+=c;continue}}(t,e,i),t)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(t,e,n){const i=new Map;for(const a of t)(0,o.s1)(i,a.objectId,p).push(a);const[r,s,c]=this._prepareQuery(i,e),l=await this._alignPointsInFeatures(r,n);if((0,a.k_)(n),c!==this._cacheVersion)return this._alignComputedElevationCandidates(t,e,n);this._applyCacheAndResponse(r,l,s);const{drapedObjectIds:u,failedObjectIds:d}=l,h=[];for(const o of t){const{objectId:t}=o;u.has(t)&&"edge"===o.type&&(o.draped=!0),d.has(t)||h.push(o)}return h}_prepareQuery(t,e){const n=[],i=[];for(const[o,a]of t){const t=[];for(const e of a)this._addToQueriesOrCachedResult(o,e.target,t,i),"edge"===e.type&&(this._addToQueriesOrCachedResult(o,e.start,t,i),this._addToQueriesOrCachedResult(o,e.end,t,i));0!==t.length&&n.push({objectId:o,points:t})}return[{spatialReference:e.toJSON(),pointsInFeatures:n},i,this._cacheVersion]}_addToQueriesOrCachedResult(t,e,n,i){const o=h(t,e),a=this._alignmentsCache.get(o);null==a?n.push(e):i.push(new d(e,a))}_applyCacheAndResponse(t,e,n){let{elevations:i,drapedObjectIds:o,failedObjectIds:a}=e;for(const c of n)c.apply();let r=0;const s=this._alignmentsCache;for(const{objectId:c,points:l}of t.pointsInFeatures){if(a.has(c)){r+=l.length;continue}const t=!o.has(c);for(const e of l){const n=h(c,e),o=i[r++];e.z=o,t&&s.put(n,o,1)}}}}class d{constructor(t,e){this.point=t,this.z=e}apply(){this.point.z=this.z}}function h(t,e){let{x:n,y:i,z:o,spatialReference:a}=e;return"".concat(t,"-").concat(n,"-").concat(i,"-").concat(null!==o&&void 0!==o?o:0,"}-wkid:").concat(null===a||void 0===a?void 0:a.wkid)}function p(){return[]}},53580:(t,e,n)=>{n.d(e,{c:()=>r});n(93169);class i{filter(t,e){return e}notifyElevationSourceChange(){}}class o{filter(t,e){const{point:n,distance:i}=t,{z:o}=n;if(null==o)return e;if(0===e.length)return e;const r=function(t){return"number"==typeof t?{x:t,y:t,z:t}:t}(i),s=this._updateCandidatesTo3D(e,n,r).filter(a);return s.sort(l),s}_updateCandidatesTo3D(t,e,n){for(const i of t)switch(i.type){case"edge":s(i,e,n);continue;case"vertex":c(i,e,n);continue}return t}}function a(t){return t.distance<=1}function r(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new o:new i}function s(t,e,n){let{x:i,y:o,z:a}=n;const{start:r,end:s,target:c}=t;t.draped||function(t,e,n,i){const o=i.x-n.x,a=i.y-n.y,r=i.z-n.z,s=o*o+a*a+r*r,c=(e.x-n.x)*o+(e.y-n.y)*a+r*(e.z-n.z),l=Math.min(1,Math.max(0,c/s)),u=n.x+o*l,d=n.y+a*l,h=n.z+r*l;t.x=u,t.y=d,t.z=h}(c,e,r,s);const l=(e.x-c.x)/i,u=(e.y-c.y)/o,d=(e.z-c.z)/a;t.distance=Math.sqrt(l*l+u*u+d*d)}function c(t,e,n){let{x:i,y:o,z:a}=n;const{target:r}=t,s=(e.x-r.x)/i,c=(e.y-r.y)/o,l=(e.z-r.z)/a,u=Math.sqrt(s*s+c*c+l*l);t.distance=u}function l(t,e){return t.distance-e.distance}},48817:(t,e,n)=>{n.d(e,{k:()=>s});n(93169);var i=n(84652),o=n(16054),a=n(66978),r=n(643);function s(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new l(arguments.length>1?arguments[1]:void 0):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}class l{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new o.z(1024),this._cacheVersion=0}async fetch(t,e){if(0===t.length)return[];const n=[],o=[],r=this._candidatesCache;for(const a of t){const t=u(a),e=r.get(t);if(e)for(const n of e)o.push((0,i.d9)(n));else n.push(a),r.put(t,[],1)}if(0===n.length)return o;const s=this._cacheVersion,{candidates:c,sourceCandidateIndices:l}=await this._getSymbologyCandidates(n,e);if((0,a.k_)(e),s!==this._cacheVersion)return this.fetch(t,e);const d=[],{length:h}=c;for(let a=0;a<h;++a){const t=c[a],e=u(n[l[a]]),o=r.get(e);o.push(t),r.put(e,o,o.length),d.push((0,i.d9)(t))}return o.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function u(t){switch(t.type){case"vertex":{var e;const{objectId:n,target:i}=t,o="".concat(n,"-vertex-").concat(i.x,"-").concat(i.y,"-").concat(null!==(e=i.z)&&void 0!==e?e:0);return(0,r.hP)(o).toString()}case"edge":{var n,i;const{objectId:e,start:o,end:a}=t,s="".concat(e,"-edge-").concat(o.x,"-").concat(o.y,"-").concat(null!==(n=o.z)&&void 0!==n?n:0,"-to-").concat(a.x,"-").concat(a.y,"-").concat(null!==(i=a.z)&&void 0!==i?i:0);return(0,r.hP)(s).toString()}default:return""}}},61309:(t,e,n)=>{n.d(e,{n:()=>a});var i=n(32035),o=n(55054);class a extends o.r{constructor(t,e,n){super(e,n),this.point=t}equals(t){return t instanceof a&&(0,i.e)(this.point,t.point)}}}}]);
//# sourceMappingURL=26823.3e7fbd96.chunk.js.map