"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[7180],{78084:(t,e,i)=>{i.d(e,{Z:()=>c});var s,r,n=i(93169),a=i(13005);(r=s||(s={}))[r.varint=0]="varint",r[r.fixed64=1]="fixed64",r[r.delimited=2]="delimited",r[r.fixed32=5]="fixed32",r[r.unknown=99]="unknown";const h=4294967296,o=new TextDecoder("utf-8"),l=(0,n.Z)("safari")||(0,n.Z)("ios")?6:(0,n.Z)("ff")?12:32;class c{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t?t.byteLength:0;this._tag=0,this._dataType=s.unknown,this._init(t,e,i,r)}_init(t,e,i,s){this._data=t,this._dataView=e,this._pos=i,this._end=s}asUnsafe(){return this}clone(){return new c(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;if(t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128)return t;if(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128)return t;throw new Error("Varint overflow")}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)}getSInt64(){return this._decodeSVarint()}getBool(){const t=0!==this._data[this._pos];return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getUint32(e+4,!0)*h;return this._skip(8),i}getSFixed64(){const t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getInt32(e+4,!0)*h;return this._skip(8),i}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),e=this._pos,i=this._toString(this._data,e,e+t);return this._skip(t),i}getBytes(){const t=this._getLength(),e=this._pos,i=this._toBytes(this._data,e,e+t);return this._skip(t),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,e,i,s){const r=this.getMessage(),n=t(r,e,i,s);return r.release(),n}processMessage(t){const e=this.getMessage(),i=t(e);return e.release(),i}getMessage(){const t=this._getLength(),e=c.pool.acquire();return e._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),e}release(){c.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case s.varint:this._decodeVarint();break;case s.fixed64:this._skip(8);break;case s.delimited:this._skip(this._getLength());break;case s.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let e=this._pos,i=0,s=0;if(this._end-e>=10)do{if(s=t[e++],i|=127&s,!(128&s))break;if(s=t[e++],i|=(127&s)<<7,!(128&s))break;if(s=t[e++],i|=(127&s)<<14,!(128&s))break;if(s=t[e++],i|=(127&s)<<21,!(128&s))break;if(s=t[e++],i+=268435456*(127&s),!(128&s))break;if(s=t[e++],i+=34359738368*(127&s),!(128&s))break;if(s=t[e++],i+=4398046511104*(127&s),!(128&s))break;if(s=t[e++],i+=562949953421312*(127&s),!(128&s))break;if(s=t[e++],i+=72057594037927940*(127&s),!(128&s))break;if(s=t[e++],i+=0x8000000000000000*(127&s),!(128&s))break;throw new Error("Varint too long!")}while(0);else{let r=1;for(;e!==this._end&&(s=t[e],128&s);)++e,i+=(127&s)*r,r*=128;if(e===this._end)throw new Error("Varint overrun!");++e,i+=s*r}return this._pos=e,i}_decodeSVarint(){const t=this._data;let e,i=0,s=0;const r=1&t[this._pos];if(s=t[this._pos++],i|=127&s,!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i|=(127&s)<<7,!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i|=(127&s)<<14,!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i|=(127&s)<<21,!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i+=268435456*(127&s),!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i+=34359738368*(127&s),!(128&s))return r?-(i+1)/2:i/2;if(s=t[this._pos++],i+=4398046511104*(127&s),!(128&s))return r?-(i+1)/2:i/2;if(e=BigInt(i),s=t[this._pos++],e+=0x2000000000000n*BigInt(127&s),!(128&s))return Number(r?-(e+1n)/2n:e/2n);if(s=t[this._pos++],e+=0x100000000000000n*BigInt(127&s),!(128&s))return Number(r?-(e+1n)/2n:e/2n);if(s=t[this._pos++],e+=0x8000000000000000n*BigInt(127&s),!(128&s))return Number(r?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}_getLength(){if(this._dataType!==s.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,e,i){if((i=Math.min(this._end,i))-e>l){const s=t.subarray(e,i);return o.decode(s)}let s="",r="";for(let n=e;n<i;++n){const e=t[n];128&e?r+="%"+e.toString(16):(s+=decodeURIComponent(r)+String.fromCharCode(e),r="")}return r.length&&(s+=decodeURIComponent(r)),s}_toBytes(t,e,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,e,i-e)}}c.pool=new a.Z(c,void 0,(t=>{t._data=null,t._dataView=null}))},51750:(t,e,i)=>{i.d(e,{L:()=>r,v:()=>s});const s=15.5,r=1024},26554:(t,e,i)=>{i.d(e,{Y:()=>h,m:()=>o});var s=i(46228),r=i(16889),n=i(51750);const a=t=>"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t;function h(t,e,i){const s=e.style,n=(0,r.fp)(Math.ceil(i)),h=a(s)?8*n:16*n,o=2*n;t.width=h,t.height=h;const l=t.getContext("2d");l.strokeStyle="#FFFFFF",l.lineWidth=n,l.beginPath(),"vertical"!==s&&"cross"!==s&&"esriSFSCross"!==s&&"esriSFSVertical"!==s||(l.moveTo(h/2,-o),l.lineTo(h/2,h+o)),"horizontal"!==s&&"cross"!==s&&"esriSFSCross"!==s&&"esriSFSHorizontal"!==s||(l.moveTo(-o,h/2),l.lineTo(h+o,h/2)),"backward-diagonal"!==s&&"diagonal-cross"!==s&&"esriSFSDiagonalCross"!==s&&"esriSFSBackwardDiagonal"!==s||(l.moveTo(-o,-o),l.lineTo(h+o,h+o),l.moveTo(h-o,-o),l.lineTo(h+o,o),l.moveTo(-o,h-o),l.lineTo(o,h+o)),"forward-diagonal"!==s&&"diagonal-cross"!==s&&"esriSFSForwardDiagonal"!==s&&"esriSFSDiagonalCross"!==s||(l.moveTo(h+o,-o),l.lineTo(-o,h+o),l.moveTo(o,-o),l.lineTo(-o,o),l.moveTo(h+o,h-o),l.lineTo(h-o,h+o)),l.stroke();const c=l.getImageData(0,0,t.width,t.height),u=new Uint8Array(c.data);let _;for(let r=0;r<u.length;r+=4)_=u[r+3]/255,u[r]=u[r]*_,u[r+1]=u[r+1]*_,u[r+2]=u[r+2]*_;return[u,t.width,t.height,n]}function o(t,e){null==t&&(t=[]);const i="Butt"===e,r="Square"===e,a=!i&&!r;t.length%2==1&&(t=[...t,...t]);const h=n.v,o=2*h;let l=0;for(const s of t)l+=s;const c=Math.round(l*h),u=new Float32Array(c*o),_=.5*h;let d=0,g=0,p=.5,f=!0;for(const s of t){for(d=g,g+=s*h;p<=g;){let t=.5;for(;t<o;){const e=(t-.5)*c+p-.5,s=a?(t-h)*(t-h):Math.abs(t-h);u[e]=f?i?Math.max(Math.max(d+_-p,s),Math.max(p-g+_,s)):s:a?Math.min((p-d)*(p-d)+s,(p-g)*(p-g)+s):r?Math.min(Math.max(p-d,s),Math.max(g-p,s)):Math.min(Math.max(p-d+_,s),Math.max(g+_-p,s)),t++}p++}f=!f}const y=u.length,v=new Uint8Array(4*y);for(let n=0;n<y;++n){const t=(a?Math.sqrt(u[n]):u[n])/h;(0,s.I)(t,v,4*n)}return[v,c,o]}},98067:(t,e,i)=>{i.d(e,{m:()=>S});var s=i(92026),r=i(66978),n=i(35995),a=i(70431),h=i(12233);class o{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new h.Z(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new h.Z;let i=null,s=-1;for(let r=0;r<this._free.length;++r){const n=this._free[r];t<=n.width&&e<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,s=r)}return null===i?new h.Z:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new h.Z(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new h.Z(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new h.Z(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new h.Z(i.x,i.y+e,t,i.height-e))),new h.Z(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var l=i(8548),c=i(57808),u=i(52311);class _{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=i,this._binPack=new o(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(t,e){const i=[],s=this._glyphSource,r=new Set;for(const a of e){const t=Math.floor(.00390625*a);r.add(t)}const n=[];return r.forEach((e=>{const i=t+e;if(this._rangePromises.has(i))n.push(this._rangePromises.get(i));else{const r=s.getRange(t,e).then((()=>{this._rangePromises.delete(i)}),(()=>{this._rangePromises.delete(i)}));this._rangePromises.set(i,r),n.push(r)}})),Promise.all(n).then((()=>{let r=this._glyphIndex[t];r||(r={},this._glyphIndex[t]=r);for(const n of e){const e=r[n];if(e){i[n]={sdf:!0,rect:e.rect,metrics:e.metrics,page:e.page,code:n};continue}const a=s.getGlyph(t,n);if(null===a||void 0===a||!a.metrics)continue;const l=a.metrics;let c;if(0===l.width)c=new h.Z(0,0,0,0);else{const t=3,e=l.width+2*t,i=l.height+2*t;let s=e%4?4-e%4:4,r=i%4?4-i%4:4;1===s&&(s=5),1===r&&(r=5),c=this._binPack.allocate(e+s,i+r),c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new o(this.width-4,this.height-4),c=this._binPack.allocate(e+s,i+r));const n=this._glyphData[this._currentPage],h=a.bitmap;let u,_;if(h)for(let a=0;a<i;a++){u=e*a,_=this.width*(c.y+a+1)+c.x;for(let t=0;t<e;t++)n[_+t+1]=h.at(u+t)}}r[n]={rect:c,metrics:l,tileIDs:null,page:this._currentPage},i[n]={sdf:!0,rect:c,metrics:l,page:this._currentPage,code:n},this._dirties[this._currentPage]=!0}return i}))}removeGlyphs(t){for(const e in this._glyphIndex){const i=this._glyphIndex[e];if(!i)continue;let s;for(const e in i)if(s=i[e],s.tileIDs.delete(t),0===s.tileIDs.size){const t=this._glyphData[s.page],r=s.rect;let n,a;for(let e=0;e<r.height;e++)for(n=this.width*(r.y+e)+r.x,a=0;a<r.width;a++)t[n+a]=0;delete i[e],this._dirties[s.page]=!0}}}bind(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._textures[i]){const e=new u.X;e.pixelFormat=l.VI.ALPHA,e.wrapMode=l.e8.CLAMP_TO_EDGE,e.width=this.width,e.height=this.height,this._textures[i]=new c.x(t,e,new Uint8Array(this.width*this.height))}const r=this._textures[i];r.setSamplingMode(e),this._dirties[i]&&r.setData(this._glyphData[i]),t.bindTexture(r,s),this._dirties[i]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0}}var d=i(76200),g=i(78084);class p{constructor(t){if(this._metrics=[],!t)return void(this._allBitmaps=null);const e=new Map;let i=0;for(;t.next();)switch(t.tag()){case 1:{const n=t.getMessage();for(;n.next();)switch(n.tag()){case 3:{const t=n.getMessage();let a,h,o,l,c,u,_;for(;t.next();)switch(t.tag()){case 1:a=t.getUInt32();break;case 2:h=t.getBytes();break;case 3:o=t.getUInt32();break;case 4:l=t.getUInt32();break;case 5:c=t.getSInt32();break;case 6:u=t.getSInt32();break;case 7:_=t.getUInt32();break;default:t.skip()}if(t.release(),a){var s,r;const t=null!==(s=null===(r=h)||void 0===r?void 0:r.length)&&void 0!==s?s:0;this._metrics[a]={width:o,height:l,left:c,top:u,advance:_,startOffset:i,length:t},e.set(a,h),i+=t}break}default:n.skip()}n.release();break}default:t.skip()}const n=new Uint8Array(i),a=this._metrics;for(const[h,o]of e){const{startOffset:t,length:e}=a[h];if(o)for(let i=0;i<e;++i)n[t+i]=o[i]}this._allBitmaps=n}getMetrics(t){return this._metrics[t]}getBitmap(t){if(!this._allBitmaps)return;const e=this._metrics[t];if(void 0===e)return;const{startOffset:i,length:s}=e;return 0!==s?new v(this._allBitmaps,i,s):void 0}}class f{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class y{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e){const i=this._getFontStack(t);if(i.getRange(e))return Promise.resolve();const s=256*e,r=s+255;if(this._baseURL){const n=this._baseURL.replace("{fontstack}",t).replace("{range}",s+"-"+r);return(0,d.Z)(n,{responseType:"array-buffer"}).then((t=>{i.addRange(e,new p(new g.Z(new Uint8Array(t.data),new DataView(t.data))))})).catch((()=>{i.addRange(e,new p)}))}return i.addRange(e,new p),Promise.resolve()}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const s=Math.floor(e/256),r=i.getRange(s);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new f),e}}class v{constructor(t,e,i){this._array=t,this._start=e,this.length=i}at(t){return 0<=t&&t<this.length?this._array[this._start+t]:void 0}}i(93169);var w=i(26554);class m{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,e<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=e,i>0&&(this._maxItemSize=i),this._binPack=new o(t-4,e-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new o(this._pageWidth-4,this._pageHeight-4);const t=Math.floor(this._pageWidth),e=Math.floor(this._pageHeight),i=new Uint32Array(t*e);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t){var e;let i,s,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._mosaicRects[t];if(n)return n;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(t&&t.startsWith("dasharray-")?([i,s]=this._rasterizeDash(t),r=!0):i=this._sprites.getSpriteInfo(t),null===(e=i)||void 0===e||!e.width||!i.height||i.width<0||i.height<0)return null;const a=i.width,h=i.height,[o,l,c]=this._allocateImage(a,h);return o.width<=0?null:(this._copy(o,i,l,c,r,s),n={type:"sprite",rect:o,width:a,height:h,sdf:i.sdf,simplePattern:!1,rasterizationScale:i.pixelRatio,page:l},this._mosaicRects[t]=n,n)}getSpriteItems(t){const e={};for(const i of t)e[i.name]=this.getSpriteItem(i.name,i.repeat);return e}getMosaicItemPosition(t,e){const i=this.getSpriteItem(t,e),s=null===i||void 0===i?void 0:i.rect;if(!s)return null;s.width=i.width,s.height=i.height;const r=i.width,n=i.height;return{tl:[s.x+2,s.y+2],br:[s.x+2+r,s.y+2+n],page:i.page}}bind(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(i>=this._size.length||i>=this._mosaicsData.length)return;if(!this._textures[i]){const e=new u.X;e.wrapMode=l.e8.CLAMP_TO_EDGE,e.width=this._size[i][0],e.height=this._size[i][1],this._textures[i]=new c.x(t,e,new Uint8Array(this._mosaicsData[i].buffer))}const r=this._textures[i];r.setSamplingMode(e),this._dirties[i]&&r.setData(new Uint8Array(this._mosaicsData[i].buffer)),t.bindTexture(r,s),this._dirties[i]=!1}static _copyBits(t,e,i,s,r,n,a,h,o,l,c){let u=s*e+i,_=h*n+a;if(c){_-=n;for(let a=-1;a<=l;a++,u=((a+l)%l+s)*e+i,_+=n)for(let e=-1;e<=o;e++)r[_+e]=t[u+(e+o)%o]}else for(let d=0;d<l;d++){for(let e=0;e<o;e++)r[_+e]=t[u+e];u+=e,_+=n}}_copy(t,e,i,s,r,n){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const a=new Uint32Array(n?n.buffer:this._sprites.image.buffer),h=this._mosaicsData[i],o=n?e.width:this._sprites.width;m._copyBits(a,o,e.x,e.y,h,s[0],t.x+2,t.y+2,e.width,e.height,r),this._dirties[i]=!0}_allocateImage(t,e){t+=2,e+=2;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=new h.Z(0,0,t,e);return this._mosaicsData.push(new Uint32Array(t*e)),this._dirties.push(!0),this._size.push([t,e]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[t,e]]}let s=t%4?4-t%4:4,r=e%4?4-e%4:4;1===s&&(s=5),1===r&&(r=5);const n=this._binPack.allocate(t+s,e+r);return n.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new o(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,e)):[n,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(t){const e=t.match(/\[(.*?)\]/);if(!e)return null;const i=e[1].split(",").map(Number),s=t.slice(t.lastIndexOf("-")+1),[r,n,a]=(0,w.m)(i,s);return[{x:0,y:0,width:n,height:a,sdf:!0,pixelRatio:1},new Uint8Array(r.buffer)]}}var b=i(73828);class S{constructor(t,e,i,s){this._layer=t,this._styleRepository=e,this.devicePixelRatio=i,this._sourceDataMaxLOD=s,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){var t,e,i;null!==(t=this._connection)&&void 0!==t&&t.close(),this._connection=null,this._styleRepository=null,this._layer=null,null!==(e=this._spriteMosaic)&&void 0!==e&&e.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,s.IM)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}async start(t){this._requestSprite(t);const e=this._layer.currentStyleInfo.glyphsUrl,i=new y(e?(0,n.fl)(e,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new _(1024,1024,i),this._broadcastPromise=(0,a.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((e=>{var i;if(this._layer&&(null!==(i=this._connection)&&void 0!==i&&i.close(),this._connection=e,this._layer&&!this._connection.closed)){const i=e.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},t);Promise.all(i).catch((t=>(0,r.H9)(t)))}}))}_requestSprite(t){var e,i;null===(e=this._spriteSourceAbortController)||void 0===e||e.abort();const s=new AbortController;this._spriteSourceAbortController=s;const n=null===t||void 0===t?void 0:t.signal;this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,n&&(this._inputSignalEventListener=function(t){return()=>t.abort()}(s),n.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:a}=s,h={...t,signal:a};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,h),this._spriteSourcePromise.then((t=>{(0,r.r9)(a),this._spriteMosaic=new m(1024,1024,250),this._spriteMosaic.setSpriteSource(t)}))}async updateStyle(t){return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),this._broadcastPromise}setSpriteSource(t){const e=new m(1024,1024,250);return e.setSpriteSource(t),this._spriteMosaic=e,this._spriteSourcePromise=Promise.resolve(t),this._spriteSourceAbortController=null,e}async setStyle(t,e,i){await this._broadcastPromise,this._styleRepository=t,this._sourceDataMaxLOD=i,this._requestSprite();const s=new y(this._layer.currentStyleInfo.glyphsUrl?(0,n.fl)(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new _(1024,1024,s),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:e,sourceDataMaxLOD:this._sourceDataMaxLOD})),this._broadcastPromise}async fetchTileData(t,e){const i=await this._getRefKeys(t,e);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),i,e)}async fetchTilePBFs(t){const e=Object.keys(this._layer.sourceNameToSource),i={},s=await this._getRefKeys(t,i),r=[],n=[];for(let a=0;a<s.length;a++)if(null==s[a].value||null==e[a])n.push(null);else{const t=s[a].value,h=this._getTilePayload(t,e[a],i);h.then((e=>{r.push({...e,key:t})})),n.push(h)}return Promise.all(n).then((()=>r))}async parseTileData(t,e){const i=t&&t.data;if(!i)return null;const{sourceName2DataAndRefKey:s,transferList:r}=i;return 0===Object.keys(s).length?null:this._broadcastPromise.then((()=>this._connection.invoke("createTileAndParse",{key:t.key.id,sourceName2DataAndRefKey:s,styleLayerUIDs:t.styleLayerUIDs},{...e,transferList:r})))}async getSprites(t){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(t)}getGlyphs(t){return this._glyphMosaic.getGlyphItems(t.font,t.codePoints)}async _getTilePayload(t,e,i){const s=b.Z.pool.acquire(t.id),n=this._layer.sourceNameToSource[e],{level:a,row:h,col:o}=s;b.Z.pool.release(s);try{return{protobuff:await n.requestTile(a,h,o,i),sourceName:e}}catch(l){if((0,r.D_)(l))throw l;return{protobuff:null,sourceName:e}}}async _getRefKeys(t,e){const i=this._layer.sourceNameToSource,s=new Array;for(const r in i){const n=i[r].getRefKey(t,e);s.push(n)}return(0,r.as)(s)}_getSourcesData(t,e,i){const s=[];for(let r=0;r<e.length;r++)if(null==e[r].value||null==t[r])s.push(null);else{const n=e[r].value,a=this._getTilePayload(n,t[r],i);s.push(a)}return(0,r.as)(s).then((t=>{const i={},s=[];for(let r=0;r<t.length;r++){const n=t[r].value;if(n&&n.protobuff&&n.protobuff.byteLength>0){const t=e[r].value.id;i[n.sourceName]={refKey:t,protobuff:n.protobuff},s.push(n.protobuff)}}return{sourceName2DataAndRefKey:i,transferList:s}}))}}},75572:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(22824),r=i(37995),n=i(73828);class a extends r.Z{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(t){const e=n.Z.pool.acquire(t),i=0===e.level?null:n.Z.getId(e.level-1,e.row>>1,e.col>>1,e.world);return n.Z.pool.release(e),i}getTileCoverage(t,e){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3?arguments[3]:void 0;const r=super.getTileCoverage(t,e,i,s);if(!r)return r;const n=1<<r.lodInfo.level;return r.spans=r.spans.filter((t=>t.row>=0&&t.row<n)),r}scaleToLevel(t){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[t])return this._levelByScale[t];{const e=this._fullCacheLodInfos;if(t>e[0].scale)return e[0].level;let i,s;for(let r=0;r<e.length-1;r++)if(s=e[r+1],t>s.scale)return i=e[r],i.level+(i.scale-t)/(i.scale-s.scale);return e[e.length-1].level}}_initializeFullCacheLODs(t){let e;if(0===t[0].level)e=t.map((t=>({level:t.level,resolution:t.resolution,scale:t.scale})));else{const t=this.tileInfo.size[0],i=this.tileInfo.spatialReference;e=s.Z.create({size:t,spatialReference:i}).lods.map((t=>({level:t.level,resolution:t.resolution,scale:t.scale})))}for(let i=0;i<e.length;i++)this._levelByScale[e[i].scale]=e[i].level;this._fullCacheLodInfos=e}}},67581:(t,e,i)=>{i.d(e,{Z:()=>p});var s=i(27366),r=i(7138),n=i(91505),a=i(79056),h=i(32718),o=i(92026),l=i(67426),c=i(49861),u=(i(93169),i(84936),i(69912)),_=i(46634),d=i(69787);let g=class extends((0,a.IG)((0,l.v)(n.Z.EventedMixin(r.default)))){constructor(t){super(t),this._updatingHandles=new _.R,this.layer=null,this.parent=null}initialize(){this.when().catch((t=>{if("layerview:create-error"!==t.name){var e;const i=this.layer&&this.layer.id||"no id",s=(null===(e=this.layer)||void 0===e?void 0:e.title)||"no title";h.Z.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(s,"', id: '").concat(i,"')"),t)}}))}destroy(){this._updatingHandles=(0,o.SC)(this._updatingHandles)}get fullOpacity(){var t,e,i,s;return(null!==(t=null===(e=this.layer)||void 0===e?void 0:e.opacity)&&void 0!==t?t:1)*(null!==(i=null===(s=this.parent)||void 0===s?void 0:s.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var t;return!this.suspended&&!0===(null===(t=this.layer)||void 0===t?void 0:t.legendEnabled)}get updating(){var t;return!((null===(t=this._updatingHandles)||void 0===t||!t.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var t;return!0===(null===(t=this.layer)||void 0===t?void 0:t.visible)}set visible(t){this._overrideIfSome("visible",t)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var t;const e=this.view.timeExtent,i=null===(t=this.layer)||void 0===t?void 0:t.visibilityTimeExtent;return!e||!i||!e.intersection(i).isEmpty}canResume(){var t,e,i;const s=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(t=this.layer)||void 0===t?void 0:t.loaded)&&!(null!==(e=this.parent)&&void 0!==e&&e.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)&&(0,d.Cy)(s)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var t,e;const i=null!==(t=this.parent)&&void 0!==t&&t.suspended?this.parent.suspendInfo:{};null!==(e=this.view)&&void 0!==e&&e.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const s=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,d.Cy)(s)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,s._)([(0,c.Cb)()],g.prototype,"view",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"fullOpacity",null),(0,s._)([(0,c.Cb)()],g.prototype,"layer",void 0),(0,s._)([(0,c.Cb)()],g.prototype,"parent",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,s._)([(0,c.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,s._)([(0,c.Cb)()],g.prototype,"updateSuspended",null),(0,s._)([(0,c.Cb)()],g.prototype,"visible",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,s._)([(0,c.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null),g=(0,s._)([(0,u.j)("esri.views.layers.LayerView")],g);const p=g}}]);
//# sourceMappingURL=7180.063826f5.chunk.js.map