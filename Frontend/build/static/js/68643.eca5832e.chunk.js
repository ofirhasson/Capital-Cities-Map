"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[68643,93655],{93655:(e,t,i)=>{i.r(t),i.d(t,{default:()=>u});var s=i(27366),r=i(49861),n=(i(93169),i(32718),i(84936),i(69912)),o=i(68748),a=i(30651),d=i(6693),h=i(56811),l=i(78983),p=i(64575);let c=class extends((0,d.h7)((0,h.M)(a.Z))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new l.J,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};(0,s._)([(0,r.Cb)({type:p.Z})],c.prototype,"elevationInfo",void 0),(0,s._)([(0,r.Cb)((0,o.z)(l.J,"graphics"))],c.prototype,"graphics",void 0),(0,s._)([(0,r.Cb)({type:["show","hide"]})],c.prototype,"listMode",void 0),(0,s._)([(0,r.Cb)()],c.prototype,"screenSizePerspectiveEnabled",void 0),(0,s._)([(0,r.Cb)({readOnly:!0})],c.prototype,"type",void 0),(0,s._)([(0,r.Cb)({constructOnly:!0})],c.prototype,"internal",void 0),c=(0,s._)([(0,n.j)("esri.layers.GraphicsLayer")],c);const u=c},70178:(e,t,i)=>{i.d(t,{Fz:()=>d,fS:()=>l,kg:()=>a});i(93169);var s=i(16889),r=i(92975);function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const s=e[i],r=t[i];if(s.length!==r.length)return!1;for(let e=0;e<s.length;e++)if(s[e]!==r[e])return!1}return!0}function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function a(e,t){return e===t||null!=e&&null!=t&&(0,r.fS)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function d(e,t,i){var n,o,a,d;return e===t||null!=e&&null!=t&&(0,r.fS)(e.spatialReference,t.spatialReference)&&(0,s.W8)(e.x,t.x,i)&&(0,s.W8)(e.y,t.y,i)&&(0,s.W8)(null!==(n=e.z)&&void 0!==n?n:0,null!==(o=t.z)&&void 0!==o?o:0,i)&&(0,s.W8)(null!==(a=e.m)&&void 0!==a?a:0,null!==(d=t.m)&&void 0!==d?d:0,i)}function h(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return a(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&o(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&o(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.fS)(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function l(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!h(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(const r of i)if(e[r]!==t[r])return!1;return!0}(e.attributes,t.attributes)}},37818:(e,t,i)=>{i.d(t,{D:()=>m,Ou:()=>h,WG:()=>g,kB:()=>c,mW:()=>p});i(59486);var s=i(52639),r=(i(93169),i(84652)),n=i(18722),o=i(77981),a=i(55946),d=i(78952);function h(e){return"declaredClass"in e}function l(e){return"declaredClass"in e}function p(e,t){return e?"declaredClass"in e?e:new s.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,r.d9)(e.symbol),attributes:(0,r.d9)(e.attributes),geometry:c(e.geometry)}):null}function c(e){return null==e?null:h(e)?e:(0,o.im)(function(e){const{wkid:t,wkt:i,wkt2:s,latestWkid:r}=e.spatialReference,n={wkid:t,wkt:i,wkt2:s,latestWkid:r};switch(e.type){case"point":{const{x:t,y:i,z:s,m:r}=e;return{x:t,y:i,z:s,m:r,spatialReference:n}}case"polygon":{const{rings:t,hasZ:i,hasM:s}=e;return{rings:u(t),hasZ:i,hasM:s,spatialReference:n}}case"polyline":{const{paths:t,hasZ:i,hasM:s}=e;return{paths:u(t),hasZ:i,hasM:s,spatialReference:n}}case"extent":{const{xmin:t,xmax:i,ymin:s,ymax:r,zmin:o,zmax:a,mmin:d,mmax:h,hasZ:l,hasM:p}=e;return{xmin:t,xmax:i,ymin:s,ymax:r,zmin:o,zmax:a,mmin:d,mmax:h,hasZ:l,hasM:p,spatialReference:n}}case"multipoint":{const{points:t,hasZ:i,hasM:s}=e;return{points:v(t)?_(t):t,hasZ:i,hasM:s,spatialReference:n}}default:return}}(e))}function u(e){return function(e){for(const t of e)if(0!==t.length)return v(t);return!1}(e)?e.map((e=>_(e))):e}function _(e){return e.map((e=>Array.from(e)))}function v(e){return e.length>0&&((0,n.xZ)(e[0])||(0,n.fS)(e[0]))}function g(e,t){if(!e)return null;let i;if(l(e)){if(null==t)return e.clone();if(l(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=void 0,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,a.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function m(e){const{wkid:t,wkt:i,wkt2:s,latestWkid:r}=e,n={wkid:t,wkt:i,wkt2:s,latestWkid:r};return d.Z.fromJSON(n)}},41388:(e,t,i)=>{i.d(t,{b:()=>o});var s=i(66978),r=i(76432),n=i(73553);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,r.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return++this._runningTasks.value,new Promise(((s,r)=>this._tasks.push(new a(s,r,e,t,i)))).finally((()=>--this._runningTasks.value))}unshift(e,t,i){return++this._runningTasks.value,new Promise(((s,r)=>this._tasks.unshift(new a(s,r,e,t,i)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const r=(0,s.Hc)(t.signal);if(r&&!t.abortCallback)t.reject((0,s.zE)());else{var i;const n=r?null===(i=t.abortCallback)||void 0===i?void 0:i.call(t,(0,s.zE)()):t.callback(e);(0,s.y8)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(o){t.reject(o)}return!0}cancelAll(){const e=(0,s.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=i,this.signal=s,this.abortCallback=r}}},9843:(e,t,i)=>{i.d(t,{Z:()=>q});var s,r=i(27366),n=i(7138),o=(i(93169),i(49861)),a=(i(32718),i(84936),i(69912)),d=(i(59486),i(10064),i(91505)),h=i(84652),l=i(92026),p=i(66978),c=i(17842),u=i(93655),_=i(55946),v=i(50951),g=i(85577),m=i(14813),w=i(84954),T=i(17877),y=i(34019),f=i(71040);let O=s=class extends d.Z.EventedAccessor{constructor(e){var t;super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=(0,m.Y6)(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new T.c(new w.XE(null!==(t=e.editGeometryType)&&void 0!==t?t:"polygon",this._coordinateHelper),v.JY.Local),this._snappingGraphicsLayer=new u.default({id:s.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new y.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new g.r(this._snappingGraphicsLayer)}),this._activeComponent=new w.wA(e.view.spatialReference,v.JY.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,delete t.snappingManager,t}initialize(){this._snappingOperation=new f.y({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,l.SC)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(e){this._snappingOperation.stagedPoint=(0,h.d9)(e)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){var i;const s=null!==(i=this.elevationInfo)&&void 0!==i?i:x;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.s1)(e.x,e.y),s,this._getGeometryZValue())}else{var s;const i=null!==(s=this.elevationInfo)&&void 0!==s?s:E;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,c.s1)(e.x,e.y),i,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const i=(0,_.T)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=i;const s=this._snappingManager;if(null==s)return this._stagedVertex=i,void t();(0,p.R8)(this._snappingOperation.snap({point:i},s,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){var t;const i=null===(t=this._editGeometryOperations.data.components[0].getLastVertex())||void 0===t?void 0:t.pos;if(i&&e[0]===i[0]&&e[1]===i[1])return!0;const{x:s,y:r}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&s===this._lastVertexUnsnapped.x&&r===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};O.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,r._)([(0,o.Cb)({readOnly:!0})],O.prototype,"vertices",null),(0,r._)([(0,o.Cb)({type:Boolean,nonNullable:!0})],O.prototype,"interactiveUndoDisabled",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],O.prototype,"history",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],O.prototype,"redoHistory",void 0),(0,r._)([(0,o.Cb)()],O.prototype,"snapToScene",void 0),(0,r._)([(0,o.Cb)()],O.prototype,"view",void 0),(0,r._)([(0,o.Cb)()],O.prototype,"elevationInfo",void 0),(0,r._)([(0,o.Cb)({nonNullable:!0})],O.prototype,"defaultZ",void 0),(0,r._)([(0,o.Cb)()],O.prototype,"hasZ",null),(0,r._)([(0,o.Cb)()],O.prototype,"_snappingOperation",void 0),(0,r._)([(0,o.Cb)()],O.prototype,"_stagedVertex",null),O=s=(0,r._)([(0,a.j)("esri.views.draw.DrawAction")],O);const x={mode:"absolute-height",offset:0},E={mode:"on-the-ground",offset:0};const C=O;class P{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class b{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class S{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.view=e,this.vertexIndex=t,this.vertices=i,this.mapPoint=s,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===i.length?i[0]:null}preventDefault(){this.defaultPrevented=!0}}class I{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===e.length?e[0]:null}preventDefault(){this.defaultPrevented=!0}}var A=i(1614),V=i(87888),L=i(72612),k=i(848);const R=Symbol("view-handles"),H=Symbol("undo-redo-handles");let U=class extends C{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,L.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===V.Sn.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==V.Sn.complete||i?t!==V.Sn.undo||this.interactiveUndoDisabled||i?t!==V.Sn.redo||this.interactiveUndoDisabled||i?t!==V.Sn.pan||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===V.Sn.pan&&e.stopPropagation()}),A.f.TOOL)],R)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new b(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new P(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new P(this.view,e.vertices[0].index,t))}}))],H)}_removeViewHandles(){this.removeHandles(R)}_removeUndoRedoHandles(){this.removeHandles(H)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||this._editGeometryOperations.appendVertex(t)}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new S(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new k.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new I(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this._removeViewHandles()}};U=(0,r._)([(0,a.j)("esri.views.draw.MultipointDrawAction")],U);var D=i(74509),N=i(66038),M=i(46640),G=i(45900);let Z=class extends(d.Z.EventedMixin(G.m)){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,t=(0,D.mF)(this.hasZ,this.elevationInfo);this.drawOperation=new N.wW({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===e.type?new M.iW(e,t):null,elevationDrawSurface:"3d"===e.type?new M.aL(t,this.defaultZ,e):null,hasM:!1,elevationInfo:t}),this.addHandles([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,l.SC)(this.drawOperation),this._set("view",null)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){var e,t;return null!==(e=null===(t=this.drawOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.geometryIncludingUncommittedVertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}canRedo(){return this.drawOperation.canRedo}canUndo(){return this.drawOperation.canUndo}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Z.prototype,"defaultZ",void 0),(0,r._)([(0,o.Cb)()],Z.prototype,"drawOperation",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],Z.prototype,"elevationInfo",void 0),(0,r._)([(0,o.Cb)({value:!0})],Z.prototype,"enabled",null),(0,r._)([(0,o.Cb)({constructOnly:!0})],Z.prototype,"geometryType",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],Z.prototype,"hasZ",void 0),(0,r._)([(0,o.Cb)({constructOnly:!0})],Z.prototype,"mode",void 0),(0,r._)([(0,o.Cb)()],Z.prototype,"snapToScene",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],Z.prototype,"type",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],Z.prototype,"updating",null),(0,r._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Z.prototype,"view",void 0),Z=(0,r._)([(0,a.j)("esri.views.draw.DrawTool")],Z);let F=class extends C{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{e.key===V.Sn.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(e)))}),A.f.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&this.addHandles([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,L.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL)])}_addDrawTool(){const e=new Z({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new S(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new I(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new S(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new k.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new I(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};F=(0,r._)([(0,a.j)("esri.views.draw.PointDrawAction")],F);var z=i(78005);let Q=class extends C{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=z.n}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canUndo())&&void 0!==e?e:super.canUndo()}canRedo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canRedo())&&void 0!==e?e:super.canRedo()}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles(this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==V.Sn.vertexAdd||i?t!==V.Sn.complete||i?t!==V.Sn.undo||this.interactiveUndoDisabled||i?t!==V.Sn.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),A.f.TOOL))}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,L.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,L.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==V.Sn.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===V.Sn.pan&&(e.stopPropagation(),this._panEnabled=!1)}),A.f.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new b(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new P(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new P(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new Z({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),e.on("vertex-add",(t=>{if(1===t.vertices.length){const{view:i}=this,s=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-add",new P(i,s,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new P(i,s,r))}})),e.on("vertex-remove",(t=>{if(1===t.vertices.length){const{view:i}=this,s=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-remove",new b(i,s,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new b(i,s,r))}})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new S(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new I(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new S(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new k.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new I(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,r._)([(0,o.Cb)()],Q.prototype,"_dragEnabled",null),(0,r._)([(0,o.Cb)()],Q.prototype,"_clickEnabled",null),(0,r._)([(0,o.Cb)({type:z.A})],Q.prototype,"mode",void 0),Q=(0,r._)([(0,a.j)("esri.views.draw.PolygonDrawAction")],Q);let Y=class extends C{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=z.n}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canUndo())&&void 0!==e?e:super.canUndo()}canRedo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canRedo())&&void 0!==e?e:super.canRedo()}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==V.Sn.vertexAdd||i?t!==V.Sn.complete||i?t!==V.Sn.undo||this.interactiveUndoDisabled||i?t!==V.Sn.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),A.f.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,L.vT)(e),"touch"===e.pointerType&&this._updateCursor())}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),A.f.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),A.f.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),A.f.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==V.Sn.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===V.Sn.pan&&(e.stopPropagation(),this._panEnabled=!1)}),A.f.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new b(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new P(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new P(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new Z({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,s=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-add",new P(i,s,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new P(i,s,r))})),e.on("vertex-remove",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,s=t.vertices[0].vertexIndex,r=e.getVertexCoords();this.emit("vertex-remove",new b(i,s,r)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new b(i,s,r))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new S(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new I(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new S(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new k.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new I(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,r._)([(0,o.Cb)()],Y.prototype,"_clickEnabled",null),(0,r._)([(0,o.Cb)()],Y.prototype,"_dragEnabled",null),(0,r._)([(0,o.Cb)({type:z.A})],Y.prototype,"mode",void 0),Y=(0,r._)([(0,a.j)("esri.views.draw.PolylineDrawAction")],Y);var j=i(3826);let W=class extends C{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){"click"===this.mode?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,L.vT)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),A.f.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,L.vT)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()))}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,L.vT)(e),this._updateCursor())}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,L.vT)(e),this._updateCursor())}),A.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),A.f.TOOL),this.view.on("key-down",(e=>{e.key===V.Sn.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===V.Sn.pan&&(this._panEnabled=!0)}),A.f.TOOL),this.view.on("key-up",(e=>{e.key===V.Sn.pan&&(this._panEnabled=!1)}),A.f.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),A.f.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),A.f.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,L.vT)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor()}),A.f.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),A.f.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),A.f.TOOL),this.view.on("key-down",(e=>{e.key===V.Sn.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===V.Sn.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),A.f.TOOL)]}_addDrawTool(){const e=new Z({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new P(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new S(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new I(e.getVertexCoords())),this._removeDrawTool()})),this.view.on("key-down",(t=>{t.key!==V.Sn.vertexAdd||t.repeat||"click"!==this.mode?t.key!==V.Sn.complete||t.repeat||e.completeCreateOperation():e.drawOperation.numCommittedVertices>0?e.completeCreateOperation():e.drawOperation.commitStagedVertex()}),A.f.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(t))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=(0,j.Gn)(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,s=new P(this.view,i,this.vertices);this.emit("vertex-add",s)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=e&&this._pushCursorVertex(e.vertex,(()=>this.emit("cursor-update",new S(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new k.Z(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new I(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new T.c(new w.XE("polygon",this._coordinateHelper),v.JY.Local),this._activeComponent=new w.wA(this._coordinateHelper.spatialReference,v.JY.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,r._)([(0,o.Cb)({type:["freehand","click"]})],W.prototype,"mode",void 0),W=(0,r._)([(0,a.j)("esri.views.draw.SegmentDrawAction")],W);let B=class extends n.default{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i={view:this.view,...t};switch(e){case"point":i.editGeometryType="point",this.activeAction=new F(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new Y(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new U(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new Q(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new W(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,r._)([(0,o.Cb)()],B.prototype,"activeAction",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],B.prototype,"type",void 0),(0,r._)([(0,o.Cb)()],B.prototype,"view",void 0),B=(0,r._)([(0,a.j)("esri.views.draw.Draw")],B);const q=B},52349:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(27366),r=i(7138),n=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends r.default{constructor(e){super(e),this.enabled=!1}};(0,s._)([(0,n.Cb)({type:Boolean,nonNullable:!0})],a.prototype,"enabled",void 0),a=(0,s._)([(0,o.j)("esri.views.interactive.sketch.SketchLabelOptions")],a);const d=a},75248:(e,t,i)=>{var s;i.d(t,{n:()=>s}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(s||(s={}))},93463:(e,t,i)=>{i.d(t,{G5:()=>S,T8:()=>s,sq:()=>I,z4:()=>w});var s,r,n=i(100),o=(i(93169),i(32718)),a=i(92026),d=i(90941),h=i(27546),l=i(66978),p=i(94172),c=i(76432),u=i(38499),_=i(41388),v=i(32609),g=i(75248),m=i(73553);function w(){return new P.Scheduler}(r=s||(s={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",r.RESOURCE_CONTROLLER="schedule",r.SLIDE="slide",r.STREAM_DATA_LOADER="stream loader",r.ELEVATION_QUERY="elevation query",r.TERRAIN_SURFACE="terrain",r.SURFACE_GEOMETRY_UPDATES="surface geometry updates",r.LOD_RENDERER="LoD renderer",r.GRAPHICS_CORE="Graphics3D",r.I3S_CONTROLLER="I3S",r.POINT_CLOUD_LAYER="point cloud",r.FEATURE_TILE_FETCHER="feature fetcher",r.OVERLAY="overlay",r.STAGE="stage",r.GRAPHICS_DECONFLICTOR="graphics deconflictor",r.FILTER_VISIBILITY="Graphics3D filter visibility",r.SCALE_VISIBILITY="Graphics3D scale visibility",r.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",r.POINT_OF_INTEREST_FREQUENT="POI frequent",r.POINT_OF_INTEREST_INFREQUENT="POI infrequent",r.LABELER="labeler",r.FEATURE_QUERY_ENGINE="feature query",r.FEATURE_TILE_TREE="feature tile tree",r.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",r.ELEVATION_ALIGNMENT="elevation alignment",r.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",r.TEXT_TEXTURE_ATLAS="text texture atlas",r.TEXTURE_UNLOAD="texture unload",r.LINE_OF_SIGHT_TOOL="line of sight tool",r.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",r.ELEVATION_PROFILE="elevation profile",r.SNAPPING="snapping",r.SHADOW_ACCUMULATOR="shadow accumulator",r.CLOUDS_GENERATOR="clouds generator",r[r.NONE=0]="NONE",r[r.TEST_PRIO=1]="TEST_PRIO";const T=new Map([[s.RESOURCE_CONTROLLER_IMMEDIATE,0],[s.RESOURCE_CONTROLLER,4],[s.SLIDE,0],[s.STREAM_DATA_LOADER,0],[s.ELEVATION_QUERY,0],[s.TERRAIN_SURFACE,1],[s.SURFACE_GEOMETRY_UPDATES,1],[s.LOD_RENDERER,2],[s.GRAPHICS_CORE,2],[s.I3S_CONTROLLER,2],[s.POINT_CLOUD_LAYER,2],[s.FEATURE_TILE_FETCHER,2],[s.OVERLAY,4],[s.STAGE,4],[s.GRAPHICS_DECONFLICTOR,4],[s.FILTER_VISIBILITY,4],[s.SCALE_VISIBILITY,4],[s.FRUSTUM_VISIBILITY,4],[s.CLOUDS_GENERATOR,4],[s.POINT_OF_INTEREST_FREQUENT,6],[s.POINT_OF_INTEREST_INFREQUENT,30],[s.LABELER,8],[s.FEATURE_QUERY_ENGINE,8],[s.FEATURE_TILE_TREE,16],[s.FEATURE_TILE_TREE_ACTIVE,0],[s.ELEVATION_ALIGNMENT,12],[s.ELEVATION_ALIGNMENT_SCENE,14],[s.TEXT_TEXTURE_ATLAS,12],[s.TEXTURE_UNLOAD,12],[s.LINE_OF_SIGHT_TOOL,16],[s.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[s.SNAPPING,0],[s.SHADOW_ACCUMULATOR,30]]);function y(e){return T.has(e)?T.get(e):"number"==typeof e?e:1}const f=(0,u.HA)(6.5),O=(0,u.HA)(1),x=(0,u.HA)(30),E=(0,u.HA)(1e3/30),C=(0,u.HA)(100);var P,b;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,c.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new d.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=g.n.INTERACTING,this._tasks=new h.Z,this._runQueue=new h.Z,this._load=0,this._idleStateCallbacks=new h.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,p.watch)((()=>v.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),p.initial);for(const e of Object.keys(s))this.performanceInfo.tasks.set(s[e],new d.Z(s[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,i){const s=new t(this,e,i);return this._tasks.push(s),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new d.Z(e)),s}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===g.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){s._idleUpdatesStartFired&&(i.idleEnd(),s._state===g.n.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=f,i=e.frameDuration,s=O;switch(this.state){case g.n.IDLE:t=(0,u.HA)(0),i=(0,u.HA)(Math.max(C,e.frameDuration)),s=x;break;case g.n.INTERACTING:i=(0,u.HA)(Math.max(E,e.frameDuration));case g.n.ANIMATING:}return i=(0,u.HA)(i-e.elapsedFrameTime-t),this.state!==g.n.IDLE&&i<O&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,u.HA)(Math.max(i,s)),this._budget.reset(i,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,u.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return b.SCHEDULED;let t=b.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=b.READY:t!==b.READY&&(t=b.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?" ".concat(e,"x ").concat(i):" ".concat(i)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===m.J&&(r.blockFrame=this._frameNumber)}catch(t){o.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(r.name,'"'),t),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,s.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const n=this._budget.now()-i;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(s))this._frameTaskTimes.set(s[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new _.b,this._handles=new n.Z,this._basePriority=y(t),this.schedulePriority=this._basePriority,this._task=(0,c.t)(null!=i?i:this._queue),this._handles.add((0,p.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(S),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){return this._queue.runTask(e)}}class i{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i}(P||(P={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(b||(b={}));const S=(()=>{const e=new P.Budget;return e.enabled=!1,e})();const I=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,l.Hc)(t)){const e=(0,l.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,l.gx)(e(S))}catch(s){return Promise.reject(s)}}reschedule(e,t,i){return this.schedule(e,t,i)}}},73553:(e,t,i)=>{i.d(t,{J:()=>s});const s=Symbol("Yield")},32609:(e,t,i)=>{i.d(t,{Z:()=>d});var s=i(27366),r=i(7138),n=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends r.default{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,s._)([(0,n.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,s._)([(0,n.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,s._)([(0,o.j)("esri.views.support.debugFlags")],a);const d=new a}}]);
//# sourceMappingURL=68643.eca5832e.chunk.js.map