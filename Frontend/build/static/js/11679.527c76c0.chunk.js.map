{"version":3,"file":"static/js/11679.527c76c0.chunk.js","mappings":"oJAIiG,MAA6BA,EAAE,qBAA2B,MAAMC,EAAEC,WAAAA,CAAYC,EAAEC,EAAEJ,EAAEK,GAAQ,IAANJ,EAACK,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,IAAKG,KAAKC,uBAAuB,IAAIC,IAAIF,KAAKG,WAAW,EAAEH,KAAKI,WAAWC,YAAYC,MAAMN,KAAKO,cAAc,IAAIL,IAAIF,KAAKQ,SAAS,GAAGR,KAAKS,QAAQ,EAAET,KAAKU,UAAUnB,EAAES,KAAKW,cAAcf,EAAEI,KAAKY,MAAMlB,EAAEM,KAAKa,cAAclB,EAAEK,KAAKc,cAActB,EAAEQ,KAAKe,iBAA1U,uBAA2Vf,KAAKa,aAAiB,CAACG,UAAAA,CAAWtB,GAAGM,KAAKQ,SAASS,KAAKvB,EAAE,CAACwB,eAAAA,CAAgBxB,GAAG,MAAMC,EAAEK,KAAKC,uBAAuBkB,IAAIzB,GAAG,GAAGC,EAAE,IAAI,MAAMyB,KAAKzB,EAAE0B,QAAQrB,KAAKQ,SAASS,KAAKG,EAAE,CAACE,GAAAA,CAAIF,GAAG,GAAGpB,KAAKe,iBAAiB,CAAC,MAAMrB,EAAEM,KAAKuB,UAAUH,EAAEI,WAAWxB,KAAKa,eAAenB,EAAE0B,EAAEK,SAAS/B,CAAC,MAAM0B,EAAEK,SAASL,EAAEI,WAAWxB,KAAKa,eAAe,MAAMtB,EAAE6B,EAAEK,SAAS,GAAGzB,KAAKO,cAAcmB,IAAInC,EAAE6B,GAAGpB,KAAKS,QAAQkB,KAAKC,IAAI5B,KAAKS,QAAQW,EAAEI,WAAWxB,KAAKU,UAAUmB,kBAAkB7B,KAAKU,UAAUoB,aAAa,OAAO,MAAM9B,KAAK+B,2BAA2B/B,KAAK+B,yBAAyB,IAAIrC,EAAAA,EAAE,WAAWM,KAAK+B,yBAAyBC,QAAQzC,GAAG,MAAMC,EAAE4B,EAAEI,WAAWxB,KAAKU,UAAUoB,cAAc,IAAI9B,KAAKC,uBAAuBgC,IAAIzC,GAAG,KAAA0C,EAAC,MAAMd,EAAE,OAAwB,QAApBc,EAAElC,KAAKW,qBAAa,IAAAuB,OAAA,EAAlBA,EAAoBC,iBAAgBnC,KAAKW,cAAcwB,gBAAtjC,IAAwkC5C,GAAEI,EAAAA,EAAAA,IAAEyB,EAAE,EAA9kC,KAAmlCpB,KAAKC,uBAAuByB,IAAIlC,EAAE,IAAIE,EAAAA,EAAEH,GAAG,CAAC,MAAM6C,EAAEpC,KAAKC,uBAAuBkB,IAAI3B,GAAG6C,EAAG,OAADD,QAAC,IAADA,OAAC,EAADA,EAAGJ,QAAQzC,GAAG,MAAM8C,IAAIrC,KAAKO,cAAc0B,IAAII,GAAGrC,KAAKO,cAAc+B,OAAOD,GAAGrC,KAAKQ,SAASS,KAAKoB,GAAG,CAACE,eAAAA,GAAkB,MAAM7C,EAAEM,KAAKwC,YAAY7C,EAAEK,KAAKyC,eAAerB,EAAEf,YAAYC,MAAMc,EAAEpB,KAAKI,YAAYJ,KAAKc,gBAAgBd,KAAK0C,OAAOtB,GAAGpB,KAAKI,WAAWgB,GAAG,MAAMxB,EAAE,GAAG,GAAG,MAAMD,EAAE,IAAI,MAAMJ,KAAKI,EAAE,CAAC,MAAMD,EAAEM,KAAKY,MAAMI,WAAWzB,GAAG,MAAMG,GAAGE,EAAEqB,KAAKvB,EAAE,CAAC,MAAMF,EAAE,GAAG,GAAG,MAAME,EAAE,CAAC,MAAME,EAAE,IAAI+C,IAAK,OAADhD,QAAC,IAADA,EAAAA,EAAG,IAAI,IAAI,MAAMA,KAAKD,EAAEE,EAAEqC,IAAItC,EAAE8B,YAAY9B,EAAE6B,WAAWjC,GAAG6B,EAAEpB,KAAKY,MAAMU,IAAI3B,GAAGH,EAAEyB,KAAKtB,GAAG,CAAC,SAASH,EAAEM,SAAU,OAADF,QAAC,IAADA,IAAAA,EAAGE,WAAUE,KAAKY,MAAMgC,OAAOpD,EAAEI,IAAG,EAAG,CAAC4C,SAAAA,GAAY,IAAIxC,KAAKO,cAAcsC,KAAK,OAAO,KAAK,MAAMnD,EAAE,IAAIoD,MAAM9C,KAAKO,cAAcsC,MAAM,IAAIlD,EAAE,EAAE,OAAOK,KAAKO,cAAcwC,SAAS3B,GAAG1B,EAAEC,KAAKyB,IAAIpB,KAAKO,cAAcyC,QAAQtD,CAAC,CAAC+C,YAAAA,GAAe,MAAM/C,EAAEM,KAAKQ,SAAS,OAAOR,KAAKQ,SAASV,QAAQE,KAAKQ,SAAS,GAAGd,GAAG,IAAI,CAAC6B,OAAAA,GAAU,MAAM7B,EAAEM,KAAKG,WAAW,OAAOH,KAAKG,YAAYH,KAAKG,WAAW,GAAG,WAAW,EAAET,CAAC,CAACgD,MAAAA,CAAOhD,GAAG,MAAMC,EAAEK,KAAKW,cAAc,MAAMhB,IAAIK,KAAKiD,yBAAyBtD,GAAGK,KAAKkD,YAAYvD,GAAGK,KAAKmD,oBAAoBzD,EAAEC,GAAGK,KAAKoD,eAAe,CAACH,wBAAAA,CAAyBvD,GAAG,IAAIA,EAAE2D,aAAa,OAAO,IAAI1D,EAAEK,KAAKY,MAAMiC,KAAK,GAAGlD,EAAED,EAAE2D,aAAa,CAAC,GAAGrD,KAAKU,UAAUoB,aAAa,IAAI,MAAMV,KAAKpB,KAAKC,uBAAuBqD,SAAS,GAAG3D,EAAED,EAAE2D,cAAcjC,EAAEyB,KAAK,CAAC,MAAMnD,EAAE0B,EAAEmC,UAAUvD,KAAKQ,SAASS,KAAKvB,GAAGC,GAAG,CAAC,GAAG,MAAMK,KAAK+B,yBAAyB,CAAC,IAAIX,EAAEzB,EAAED,EAAE2D,aAAa,KAAKjC,KAAK,GAAG,CAAC,MAAM1B,EAAEM,KAAK+B,yBAAyBwB,UAAU,MAAM7D,GAAGM,KAAKQ,SAASS,KAAKvB,EAAE,CAAC,CAAC,CAAC,CAACwD,WAAAA,CAAYxD,GAAE,IAAA8D,EAAC,MAAM7D,EAAgB,QAAf6D,EAACxD,KAAKU,iBAAS,IAAA8C,OAAA,EAAdA,EAAgB3B,eAAe,IAAInC,EAAE+D,MAAM9D,EAAE,OAAO,MAAMyB,EAAE,GAAG1B,EAAE+D,IAAI,IAAIlE,EAAES,KAAKS,QAAQW,EAAEpB,KAAKY,MAAMmC,SAASrD,IAAIA,EAAE8B,WAAW7B,GAAGJ,GAAGS,KAAKQ,SAASS,KAAKvB,EAAE+B,SAAS,GAAG,CAAC0B,mBAAAA,CAAoBzD,EAAEC,GAAG,IAAIA,EAAE+D,YAAY,OAAO,MAAMtC,EAAE1B,EAAE,GAAGC,EAAE+D,YAAY,IAAI1D,KAAKY,MAAMmC,SAASrD,IAAIA,EAAE8B,WAAWjC,GAAG6B,GAAGpB,KAAKQ,SAASS,KAAKvB,EAAE+B,SAAS,GAAG,CAAC2B,YAAAA,GAAepD,KAAKC,uBAAuB8C,SAAS,CAACrD,EAAEC,KAAK,IAAID,EAAEmD,MAAM7C,KAAKC,uBAAuBqC,OAAO3C,EAAE,GAAG,E,0MCAx2F,IAAIgE,EAAE,cAAcnE,EAAAA,EAAEoE,gBAAgBC,OAAAA,GAAU7D,KAAK8D,KAAK,UAAU,CAAC,mBAAIC,GAAkB,OAAO/D,KAAKgE,YAAY,IAAIrE,EAAAA,EAAE,oBAAoBK,KAAKgE,aAAa,IAAI,CAACC,SAAAA,CAAUrE,GAAGI,KAAK8D,KAAK,gBAAgBlE,EAAE,CAACsE,SAAAA,CAAUtE,GAAGI,KAAK8D,KAAK,mBAAmBlE,EAAE,IAAGA,EAAAA,EAAAA,GAAE,EAACF,EAAAA,EAAAA,IAAE,CAACyE,UAAS,KAAMR,EAAES,UAAU,kBAAkB,MAAMT,GAAE/D,EAAAA,EAAAA,GAAE,EAACwB,EAAAA,EAAAA,GAAE,yCAAyCuC,GAAG,MAAMU,EAAEV,ECAtF,IAAIW,EAAY3E,KAAsG2E,IAAIA,EAAE,CAAC,IAAxG3E,EAAE4E,WAAW,GAAG,aAAa5E,EAAEA,EAAE6E,KAAK,GAAG,OAAO7E,EAAEA,EAAE8E,QAAQ,GAAG,UAAU9E,EAAEA,EAAE+E,OAAO,GAAG,SAAqB,IAAItC,EAAE,cAAcuC,EAAElF,WAAAA,CAAYE,GAAGiF,MAAM,CAAC,GAAG5E,KAAK6E,qBAAqB,GAAG7E,KAAKgE,YAAY,KAAK,MAAMc,aAAapF,EAAEqF,iBAAiBvF,EAAEwF,uBAAuB5D,GAAGzB,EAAEK,KAAKiF,QAAQtF,EAAEK,KAAKkF,iBAAgB7C,EAAAA,EAAAA,GAAE3C,EAAE0B,EAAE5B,GAAGQ,KAAKmF,OAAO,CAACC,iBAAAA,GAAoB,MAAM,CAAC,CAAC,CAAC,WAAMD,SAAcnF,KAAKqF,sBAAsBrF,KAAKsF,iBAAiBtF,KAAKuF,YAAY,CAAC1B,OAAAA,GAAUe,MAAMf,UAAU,MAAM7D,KAAKwF,aAAaxF,KAAKwF,WAAWC,OAAO,KAAKzF,KAAKwF,WAAWE,QAAQ,KAAK1F,KAAKwF,WAAWG,QAAQ,KAAK3F,KAAKwF,WAAWI,UAAU,KAAK5F,KAAKwF,WAAWK,SAAS7F,KAAKwF,WAAW,IAAI,CAAC,oBAAIM,GAAmB,GAAG,MAAM9F,KAAKwF,WAAW,MAAM,eAAe,OAAOxF,KAAKwF,WAAWO,YAAY,KAAKzB,EAAEC,WAAW,KAAKD,EAAEE,KAAK,MAAM,YAAY,KAAKF,EAAEG,QAAQ,KAAKH,EAAEI,OAAO,MAAM,eAAe,CAACsB,mBAAAA,CAAoBrG,GAAG,MAAMK,KAAKwF,WAAWxF,KAAKwF,WAAWS,KAAKC,KAAKC,UAAUxG,IAAIK,KAAK6E,qBAAqB5D,KAAKtB,EAAE,CAACyG,mBAAAA,CAAoBzG,GAAGK,KAAKqG,WAAW1G,EAAE,CAAC2G,sBAAAA,CAAuB3G,GAAGK,KAAKiF,QAAQsB,iBAAiB5G,EAAE,MAAMK,KAAKwF,YAAYxF,KAAKwF,WAAWK,OAAO,CAAC,yBAAMR,GAAyD,IAArC1F,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAACG,KAAKiF,QAAQuB,OAAOC,KAAK7G,EAACC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,IAAIN,EAACM,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,EAAG,IAAG,IAAA6G,EAAC,GAAG1G,KAAKsF,UAAU,OAAO,MAAM5F,GAAE2E,EAAAA,EAAAA,IAAE1E,EAA+B,QAA9B+G,EAAC1G,KAAKiF,QAAQsB,wBAAgB,IAAAG,EAAAA,EAAE,CAAC,GAAG1G,KAAKwF,iBAAiBxF,KAAK2G,iBAAiBjH,GAAGM,KAAK4G,aAAa,mBAAmB,CAAC,MAAMjD,GAAG,MAAMU,EAAEzE,EAAE,IAAI,OAAOI,KAAKiF,QAAQ4B,yBAAyBtH,GAAGS,KAAKiF,QAAQ4B,yBAAyBrH,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,qFAAqFM,KAAK6D,YAAYrE,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAsB,iDAAAsH,OAAkD3C,EAAC,KAAIV,UAAUvC,EAAAA,EAAAA,IAAExB,GAAGI,KAAKqF,oBAAoB1F,EAAEgC,KAAKsF,IAAI,IAAIrH,EAAE,IAAII,KAAKiF,QAAQiC,yBAAyB3H,EAAE,GAAG,CAAC,CAAC4H,6BAAAA,CAA8BxH,GAAGA,EAAEiG,UAAUjG,IAAI,IAAI,MAAMD,EAAEwG,KAAKkB,MAAMzH,EAAE0H,MAAMrH,KAAKqG,WAAW3G,EAAE,CAAC,MAAM0B,GAAG,YAAY5B,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,wCAAwC,CAACqH,MAAM3F,IAAI,EAAE,CAACuF,gBAAAA,CAAiBhH,GAAG,OAAO,IAAI2H,SAAS,CAAC5H,EAAEF,KAAK,MAAM4B,EAAE,IAAImG,UAAU5H,GAAGyB,EAAEqE,OAAO,KAAK,GAAGrE,EAAEqE,OAAO,KAAKzF,KAAKsF,UAAU,OAAOlE,EAAEsE,QAAQ,UAAUtE,EAAEyE,QAAQzE,EAAEsE,QAAQ/F,GAAGK,KAAKwH,SAAS7H,GAAGyB,EAAEuE,QAAQhG,GAAGK,KAAKyH,SAAS9H,GAAGK,KAAKmH,8BAA8B/F,GAAG1B,EAAE0B,EAAE,EAAEA,EAAEsE,QAAQ/F,IAAIyB,EAAEqE,OAAOrE,EAAEsE,QAAQ,KAAKlG,EAAEG,EAAE,CAAC,GAAG,CAAC,gBAAM4F,GAAiB,IAAN5F,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,IAAK,MAAMuB,EAAEpB,KAAKwF,WAAW,GAAG,MAAMpE,EAAE,OAAO,MAAMiD,GAAEzE,EAAAA,EAAAA,MAAIL,EAAE6B,EAAEwE,WAAW8B,OAAO/D,EAAEgE,UAAUtF,EAAE0C,iBAAiBJ,GAAG3E,KAAKiF,QAAQ,OAAOZ,EAAEuD,QAAQjI,GAAGyB,EAAEwE,UAAUjG,IAAG,IAAAkI,EAAC,IAAIjI,EAAE,KAAK,IAAIA,EAAEsG,KAAKkB,MAAMzH,EAAE0H,KAAK,CAAC,MAAM/C,GAAG,CAAC1E,GAAG,iBAAiBA,IAAIJ,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,2DAA2DC,EAAE0H,OAAOhD,EAAEyD,SAAS9H,KAAK6D,YAA6B,QAAlBgE,EAAAjI,EAAEmF,wBAAgB,IAAA8C,OAAA,EAAlBA,EAAoBE,SAAQ,OAADpD,QAAC,IAADA,OAAC,EAADA,EAAGoD,QAAOvI,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAsB,2DAAAsH,OAA4DrC,EAAEoD,MAAOpI,EAAE0H,OAAOhD,EAAEyD,SAAS9H,KAAK6D,WAAW,SAASjE,EAAEoI,SAASxI,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,2DAA2DC,EAAE0H,OAAOhD,EAAEyD,SAAS9H,KAAK6D,WAAWF,GAAG/D,EAAE8H,SAAS/D,GAAGnE,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,uDAAuD2C,GAAGzC,EAAE+H,YAAYtF,GAAG7C,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,IAAIrH,EAAAA,EAAE,uBAAuB,0DAA0D0B,EAAEwE,UAAUrG,EAAE,IAAI,MAAMG,KAAKM,KAAK6E,qBAAqBzD,EAAE6E,KAAKC,KAAKC,UAAUzG,IAAIM,KAAK6E,qBAAqB,GAAGR,EAAE4D,SAAS,EAAE7G,EAAE6E,KAAKC,KAAKC,UAAU,CAACuB,OAAO/D,EAAEgE,UAAUtF,EAAE2F,OAAO,OAAOjD,iBAAiB,CAACgD,KAAKpD,EAAEoD,SAAS1D,EAAE6D,OAAO,CAAC7B,UAAAA,CAAW1G,GAAG,GAAGK,KAAKkE,UAAUvE,GAAG,SAASA,EAAE,OAAOA,EAAEwI,MAAM,IAAI,WAAW,IAAI,gBAAgB,IAAI,MAAMzI,KAAKC,EAAEyI,SAAS,MAAMpI,KAAKkF,iBAAiBlF,KAAKkF,gBAAgBxF,EAAE2I,UAAUrI,KAAKiE,UAAUvE,GAAG,CAAC+H,QAAAA,CAAS9H,GAAG,MAAMD,EAAE,iDAAiDM,KAAKsI,KAAK,cAAc5I,GAAGF,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,uBAAuBrH,EAAE,CAAC8H,QAAAA,CAAS7H,GAAGK,KAAKwF,WAAW,KAAKxF,KAAK4G,aAAa,oBAAoB,MAAMjH,EAAE4I,MAAM/I,EAAAA,EAAEsH,UAAU9G,MAAM+G,MAAM,uBAAsB,iDAAAC,OAAkDrH,EAAE4I,OAAQvI,KAAKsF,WAAWtF,KAAKmF,OAAO,IAAGxF,EAAAA,EAAAA,GAAE,EAACJ,EAAAA,EAAAA,OAAK6C,EAAEgC,UAAU,mBAAmB,OAAMzE,EAAAA,EAAAA,GAAE,EAACJ,EAAAA,EAAAA,OAAK6C,EAAEgC,UAAU,mBAAc,GAAQhC,GAAEzC,EAAAA,EAAAA,GAAE,EAACgE,EAAAA,EAAAA,GAAE,iEAAiEvB,G,+CCAzmI,MAAYA,EAAE,CAACoG,cAAc,EAAEC,qBAAqB,GAAG,IAAIC,EAAE,cAAcrG,EAAE5C,WAAAA,CAAYE,GAAGiF,MAAM,IAAIxC,KAAKzC,IAAIK,KAAK2I,oBAAoB,KAAK3I,KAAK4I,iBAAiB,IAAI,CAAC,WAAMzD,GAAQ,MAAMxF,QAAQK,KAAK6I,wBAAwB7I,KAAKiF,QAAQuB,QAAQ7G,EAAEmJ,SAAShH,cAAcvC,EAAAA,EAAEuH,UAAU9G,MAAM+I,KAAK,mLAAmL,MAAMrJ,EAAEM,KAAKgJ,mBAAmBrJ,EAAEsJ,WAAWjJ,KAAKiF,QAAQF,kBAAkB/E,KAAK2I,sBAAsB3I,KAAK2I,oBAAoB3I,KAAKkJ,6BAA6BlJ,KAAK2I,0BAA0B3I,KAAKqF,oBAAoB3F,GAAG,MAAMgI,OAAO9H,EAAE+H,UAAUnI,GAAGQ,KAAKiF,QAAQjF,KAAKsF,WAAWtF,KAAKmJ,WAAWvJ,EAAEJ,EAAE,CAAC6G,UAAAA,CAAW1G,GAAG,GAAG,eAAeA,EAAE,CAAC,IAAIH,EAAE,IAAIA,EAAEQ,KAAKoJ,QAAQzJ,GAAG,MAAMK,KAAKkF,iBAAiBlF,KAAKkF,gBAAgB1F,EAAE6I,SAAS,CAAC,MAAM3I,GAAG,YAAYH,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,0BAA0BF,GAAG,CAACM,KAAKiE,UAAUzE,EAAE,MAAMQ,KAAKkE,UAAUvE,EAAE,CAAC,6BAAMkJ,CAAwBlJ,GAAG,MAAMC,EAAE,CAACyJ,EAAE,UAAUrJ,KAAKiF,QAAQsB,kBAAkBhH,GAAEG,EAAAA,EAAAA,GAAEC,EAAE8G,KAAK,CAAC6C,MAAM1J,EAAE2J,aAAa,SAAS/J,SAASD,GAAG8H,KAAK,OAAOrH,KAAKwJ,mBAAmBhK,EAAEA,CAAC,CAACwJ,kBAAAA,CAAmBrJ,EAAED,GAAG,MAAME,EAAED,EAAE,IAAI8J,KAAKlK,EAAEmK,MAAMlK,GAAGI,EAAEyE,EAAErE,KAAK2J,uBAAuBpK,GAAG,OAAO6B,EAAAA,EAAAA,IAAE,GAAD4F,OAAI3C,EAAC,cAAa,CAACuF,MAAM,GAAGlK,EAAEqI,KAAK2B,MAAMlK,GAAG,CAACmK,sBAAAA,CAAuBhK,GAAG,GAAG,IAAIA,EAAEG,OAAO,OAAOH,EAAE,GAAG,IAAI,MAAMD,KAAKC,EAAE,GAAGD,EAAEmK,SAAS,OAAO,OAAOnK,EAAE,OAAOH,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,gCAAgCD,IAAI,IAAI,CAAC,gBAAMwJ,CAAWxJ,EAAED,GAAG,MAAM0B,EAAEpB,KAAKwF,WAAW,GAAG,MAAMpE,GAAG,MAAMzB,GAAG,MAAMD,EAAE,OAAO,MAAM2E,EAAE6B,KAAKC,UAAU,CAACuB,OAAO1H,KAAK8J,iBAAiBnK,EAAED,KAAK,IAAI2C,GAAE,EAAG,MAAMsB,GAAEnE,EAAAA,EAAAA,MAAkc,OAAO4B,EAAEwE,UAA3SjG,IAAI,MAAMD,EAAEwG,KAAKkB,MAAMzH,EAAE0H,MAAM3H,EAAEgI,SAAShI,EAAEqH,QAAQxH,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,+BAA+BF,EAAEqH,QAAQ/G,KAAKsI,KAAK,cAAa,kCAAAtB,OAAmCtH,EAAEqH,QAASpD,EAAEmE,OAAOpI,EAAEqH,QAAQ/G,KAAKmH,8BAA8B/F,GAAGiB,GAAE,EAAGsB,EAAEsE,UAAU,EAAuB7G,EAAE6E,KAAK5B,GAAG0F,YAA3dC,KAAK3H,IAAIrC,KAAKsF,WAAWtF,KAAKwF,aAAapE,GAAG7B,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,yCAAyC+D,EAAEmE,SAAS,GAA70D,KAAkqEnE,EAAEuE,OAAO,CAAC4B,gBAAAA,CAAiBnK,EAAED,GAAG,MAAMF,EAAE,CAAC,EAAE,GAAG,MAAMG,GAAG,MAAMD,EAAE,OAAOF,EAAE,GAAI,OAADG,QAAC,IAADA,GAAAA,EAAG0I,SAAS,IAAI,MAAM3I,GAAEiF,EAAAA,EAAAA,IAAEhF,EAAE0I,UAAU,GAAG,WAAW3I,EAAEyI,KAAK,MAAM,IAAIvI,EAAAA,EAAE,kCAADoH,OAAmCtH,EAAEyI,OAAQ3I,EAAE6I,SAASnC,KAAKC,UAAUzG,EAAEuK,uBAAuB,CAAC,MAAM7I,GAAG7B,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,kEAAkEwB,GAAG,CAAC,OAAQ,OAADzB,QAAC,IAADA,GAAAA,EAAGuK,OAAO,UAAUvK,EAAEuK,OAAO,QAAQvK,EAAEuK,QAAQ1K,EAAE0K,MAAMvK,EAAEuK,OAAO,MAAMxK,IAAIF,EAAEmI,UAAUjI,EAAEyK,KAAK,MAAM3K,CAAC,CAAC4J,OAAAA,CAAQzJ,GAAG,IAAIK,KAAK4I,iBAAiB,OAAOjJ,EAAE,MAAMD,EAAEM,KAAKwJ,mBAAmBY,gBAAgBC,UAAU7K,EAAEG,EAAE6B,WAAW9B,GAAG0B,EAAEpB,KAAK4I,iBAAiBzH,IAAI3B,GAAG,IAAI4B,EAAE,OAAO7B,EAAAA,EAAEuH,UAAU9G,MAAM+I,KAAK,sBAAsB,+DAA+DpJ,GAAGA,EAAE,MAAM6B,WAAW6C,EAAEgE,SAAShG,GAAGjB,EAAE,IAAI,MAAMxB,KAAKyE,EAAE1E,EAAE6B,WAAW5B,GAAGyE,EAAEzE,GAAG,OAAOyC,IAAI1C,EAAE0I,SAAShG,GAAG1C,EAAE0I,UAAU1I,EAAE2K,UAAU/K,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,8CAA8CD,IAAIA,CAAC,CAAC,yBAAMuJ,GAAsB,IAAI,MAAMkB,gBAAgBzK,EAAE4K,kBAAkB7K,GAAGM,KAAKwJ,mBAAmB5J,EAAEI,KAAKwK,sBAAsB7K,GAAGJ,EAAES,KAAKyK,cAAc/K,SAASE,EAAE,MAAMJ,QAAQD,EAAE,IAAIC,EAAE,OAAO,IAAI,MAAM4B,KAAK5B,EAAE4I,SAASpI,KAAKiE,UAAUjE,KAAKoJ,QAAQhI,GAAG,CAAC,MAAMzB,GAAGJ,EAAAA,EAAEuH,UAAU9G,MAAM+G,MAAM,IAAInH,EAAAA,EAAE,sBAAsB,oDAAoD,CAACmH,MAAMpH,IAAI,CAAC,CAAC,2BAAM6K,CAAsB7K,GAAG,IAAIA,EAAE,OAAO,MAAMD,QAAQM,KAAK0K,YAAY/K,EAAEgL,aAAa3K,KAAK4K,oBAAoBlL,EAAE,CAAC,mBAAM+K,CAAc9K,GAAG,GAAGA,EAAE,OAAOK,KAAK0K,YAAY/K,EAAEgL,YAAY,CAAC,iBAAMD,CAAY/K,GAAE,IAAAkL,EAAAC,EAAAC,EAAC,MAAMrL,EAAE,WAAW,yCAAoCsL,SAAS,CAACC,IAAItL,KAAKuL,aAAatL,SAASF,EAAEyL,OAAO5L,EAAEK,EAAE0J,MAAM8B,6BAA6B5L,EAAEI,EAAE0J,MAAM+B,mBAAmBjK,EAAExB,EAAE0J,MAAMgC,iBAAiBjH,EAAErE,KAAKiF,QAAQwD,qBAAqBpG,EAAE3C,EAAEwL,aAAa5B,MAAMiC,eAAe5G,EAAEpF,EAAE8C,EAAEgC,EAAEhC,EAAEiC,EAAE,IAAI0F,EAAAA,EAAE,GAAG1F,EAAEqD,UAAgC,QAAvBkD,EAAC7K,KAAKiF,QAAQ0C,iBAAS,IAAAkD,EAAAA,EAAE,CAAC,KAAKvG,EAAE4F,MAAgC,QAA3BY,EAAoB,QAApBC,EAAC/K,KAAKiF,QAAQyC,cAAM,IAAAqD,OAAA,EAAnBA,EAAqBb,aAAK,IAAAY,EAAAA,EAAE,MAAMxG,EAAEkH,gBAAe,EAAGlH,EAAEmH,6BAA4B,EAAGnH,EAAEoH,oBAAoBrC,EAAAA,EAAEsC,SAAS3L,KAAKiF,QAAQF,kBAAkB3D,IAAIkD,EAAEsH,gBAAe,GAAIrM,IAAI+E,EAAEmE,qBAAqBpE,GAAG7E,EAAE,OAAO8E,EAAEuH,IAAIlH,EAAEjF,EAAEmE,UAAU7D,KAAK8L,YAAYnM,EAAE2E,GAAG,MAAMlC,QAAQuB,EAAAA,EAAAA,IAAEhE,EAAE2E,EAAEtE,KAAKiF,QAAQD,wBAAwB,OAAOtF,EAAEmE,UAAUzB,EAAEiF,IAAI,CAAC,iBAAMyE,CAAYnM,EAAED,GAAW,IAAAqM,EAAA,IAATnM,EAACC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,GAAGN,EAACM,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,EAAGH,EAAEsM,MAAM,MAAMtM,EAAEmM,IAAItM,EAAEG,EAAEmM,IAAI,KAAK,MAAMxE,KAAK7H,SAASmE,EAAAA,EAAAA,IAAEhE,EAAED,EAAEM,KAAKiF,QAAQD,wBAAwB,OAAOxF,EAAEyM,uBAAuB1M,GAA6B,QAA5BwM,EAAE/L,KAAKiF,QAAQuD,qBAAa,IAAAuD,EAAAA,EAAE,IAAIvM,EAAE4I,SAASrF,SAASpD,GAAGC,EAAEqB,KAAKtB,KAAKK,KAAK8L,YAAYnM,EAAED,EAAEE,EAAEL,EAAE,KAAKK,EAAEmD,SAASpD,GAAGH,EAAE4I,SAASnH,KAAKtB,KAAKH,EAAE,CAACoL,mBAAAA,CAAoBjL,GAAG,MAAMD,EAAE,IAAIQ,IAAIN,EAAED,EAAEyI,SAAS7I,EAAES,KAAKwJ,mBAAmBY,gBAAgBC,UAAU,IAAI,MAAM7K,KAAKI,EAAE,CAAC,MAAMD,EAAEH,EAAEgC,WAAWjC,GAAGG,EAAEgC,IAAI/B,EAAEH,EAAE,CAACQ,KAAK4I,iBAAiBlJ,CAAC,GAAGgJ,GAAE/I,EAAAA,EAAAA,GAAE,EAAC0E,EAAAA,EAAAA,GAAE,gEAAgEqE,GAAG,MAAMwD,EAAExD,ECAj0K,IAAIrG,EAAE,cAAcjB,EAAE3B,WAAAA,CAAYE,GAAGiF,MAAM,CAAC,GAAG5E,KAAK8F,iBAAiB,YAAY9F,KAAKgE,YAAY,KAAK,MAAMc,aAAalF,EAAEmF,iBAAiBrF,EAAEsF,uBAAuB5D,GAAGzB,EAAEK,KAAKkF,iBAAgB1F,EAAAA,EAAAA,GAAEI,EAAEwB,EAAE1B,EAAE,CAAC0F,iBAAAA,GAAoB,MAAM,CAAC,CAAC,CAACkB,sBAAAA,CAAuB3G,GAAG,CAACqG,mBAAAA,CAAoBrG,GAAG,CAACyG,mBAAAA,CAAoBzG,GAAG,GAAG,SAASA,EAAE,OAAOA,EAAEwI,MAAM,IAAI,WAAW,IAAI,gBAAgB,IAAI,MAAMvI,KAAKD,EAAEyI,SAAS,MAAMpI,KAAKkF,iBAAiBlF,KAAKkF,gBAAgBtF,EAAEyI,UAAUrI,KAAKiE,UAAUrE,GAAGI,KAAKkE,UAAUvE,EAAE,GCA9rB,SAASH,EAAEG,EAAED,GAAG,GAAG,MAAMC,GAAG,MAAMD,EAAE,OAAO,KAAK,MAAM2E,EAAE,CAAC,EAAE,OAAO,MAAM3E,IAAI2E,EAAEgE,SAAS3I,GAAG,MAAMC,IAAI0E,EAAE6F,MAAMvK,GAAG0E,CAAC,CAAC,SAASzE,EAAEA,EAAEL,EAAE6B,EAAEuC,EAAEgB,EAAEqF,EAAE3H,EAAE8J,EAAEC,GAAG,MAAM/C,EAAE,CAAC7C,OAAO5G,EAAEoF,uBAAuBzF,EAAEwF,iBAAiB3D,EAAE0D,aAAanB,EAAE+D,OAAOlI,EAAEmF,EAAEqF,GAAGnD,wBAAwBxE,EAAE6E,wBAAwBiF,EAAE5F,iBAAiB6F,GAAG,OAAIxM,EAAyBA,EAAE6G,KAAK4F,WAAW,WAAWzM,EAAE6G,KAAK4F,WAAW,SAAS,IAAI3M,EAAE2J,GAAG,IAAI1J,EAAE0J,GAAvF,IAAIhF,EAAEgF,EAAmF,EDAyS1J,EAAAA,EAAAA,GAAE,EAACC,EAAAA,EAAAA,OAAKyC,EAAE+B,UAAU,wBAAmB,IAAQzE,EAAAA,EAAAA,GAAE,EAACC,EAAAA,EAAAA,OAAKyC,EAAE+B,UAAU,mBAAc,GAAQ/B,GAAE1C,EAAAA,EAAAA,GAAE,EAACD,EAAAA,EAAAA,GAAE,6CAA6C2C,E","sources":["../node_modules/@arcgis/core/layers/graphics/data/StreamFeatureManager.js","../node_modules/@arcgis/core/layers/support/StreamConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/WebSocketConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/GeoEventConnection.js","../node_modules/@arcgis/core/layers/support/ClientSideConnection.js","../node_modules/@arcgis/core/layers/graphics/sources/connections/createConnection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport t from\"../../../core/CircularArray.js\";import{clamp as e}from\"../../../core/mathUtils.js\";const s=\"__esri_stream_id__\",i=\"__esri_timestamp__\",r=1e3;class o{constructor(t,e,i,r,o=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=r,this.store=t,this.objectIdField=e,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===s}removeById(t){this._removed.push(t)}removeByTrackId(t){const e=this._trackIdToObservations.get(t);if(e)for(const s of e.entries)this._removed.push(s)}add(s){if(this._useGeneratedIds){const t=this._nextId();s.attributes[this.objectIdField]=t,s.objectId=t}else s.objectId=s.attributes[this.objectIdField];const i=s.objectId;if(this._addOrUpdated.set(i,s),this._maxAge=Math.max(this._maxAge,s.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new t(1e5)),void this._trackIdLessObservations.enqueue(i);const o=s.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(o)){const s=null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:r,i=e(s,0,r);this._trackIdToObservations.set(o,new t(i))}const d=this._trackIdToObservations.get(o),a=d?.enqueue(i);null!=a&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}checkForUpdates(){const t=this._getToAdd(),e=this._getToRemove(),s=performance.now();s-this._lastPurge>=this.purgeInterval&&(this._purge(s),this._lastPurge=s);const r=[];if(null!=e)for(const i of e){const t=this.store.removeById(i);null!=t&&r.push(t)}const o=[];if(null!=t){const r=new Set(e??[]);for(const e of t)r.has(e.objectId)||(e.attributes[i]=s,this.store.add(e),o.push(e))}return!(!o.length&&!r?.length)&&(this.store.update(o,r),!0)}_getToAdd(){if(!this._addOrUpdated.size)return null;const t=new Array(this._addOrUpdated.size);let e=0;return this._addOrUpdated.forEach((s=>t[e++]=s)),this._addOrUpdated.clear(),t}_getToRemove(){const t=this._removed;return this._removed.length?(this._removed=[],t):null}_nextId(){const t=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,t}_purge(t){const e=this._purgeOptions;null!=e&&(this._purgeSomeByDisplayCount(e),this._purgeByAge(e),this._purgeByAgeReceived(t,e),this._purgeTracks())}_purgeSomeByDisplayCount(t){if(!t.displayCount)return;let e=this.store.size;if(e>t.displayCount){if(this._timeInfo.trackIdField)for(const s of this._trackIdToObservations.values())if(e>t.displayCount&&s.size){const t=s.dequeue();this._removed.push(t),e--}if(null!=this._trackIdLessObservations){let s=e-t.displayCount;for(;s-- >0;){const t=this._trackIdLessObservations.dequeue();null!=t&&this._removed.push(t)}}}}_purgeByAge(t){const e=this._timeInfo?.startTimeField;if(!t.age||!e)return;const s=60*t.age*1e3,i=this._maxAge-s;this.store.forEach((t=>{t.attributes[e]<i&&this._removed.push(t.objectId)}))}_purgeByAgeReceived(t,e){if(!e.ageReceived)return;const s=t-60*e.ageReceived*1e3;this.store.forEach((t=>{t.attributes[i]<s&&this._removed.push(t.objectId)}))}_purgeTracks(){this._trackIdToObservations.forEach(((t,e)=>{0===t.size&&this._trackIdToObservations.delete(e)}))}}export{o as StreamFeatureManager,s as defaultStreamIdField,i as esriTimestamp};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Error.js\";import o from\"../../core/Evented.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";let c=class extends o.EventedAccessor{destroy(){this.emit(\"destroy\")}get connectionError(){return this.errorString?new e(\"stream-connection\",this.errorString):null}onFeature(r){this.emit(\"data-received\",r)}onMessage(r){this.emit(\"message-received\",r)}};r([t({readOnly:!0})],c.prototype,\"connectionError\",null),c=r([s(\"esri.layers.support.StreamConnection\")],c);const n=c;export{n as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Error.js\";import o from\"../../../../core/Logger.js\";import{after as s,createResolver as r}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as n}from\"../../../../core/urlUtils.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import{subclass as c}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as a}from\"../../../../geometry/support/zscale.js\";import l from\"../../../support/StreamConnection.js\";var h;!function(e){e[e.CONNECTING=0]=\"CONNECTING\",e[e.OPEN=1]=\"OPEN\",e[e.CLOSING=2]=\"CLOSING\",e[e.CLOSED=3]=\"CLOSED\"}(h||(h={}));let d=class extends l{constructor(e){super({}),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:o,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=a(t,s,o),this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return\"disconnected\";switch(this._websocket.readyState){case h.CONNECTING:case h.OPEN:return\"connected\";case h.CLOSING:case h.CLOSED:return\"disconnected\"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,r=1e3,i=0){try{if(this.destroyed)return;const t=n(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange(\"connectionStatus\")}catch(c){const n=r/1e3;return this._config.maxReconnectionAttempts&&i>=this._config.maxReconnectionAttempts?(o.getLogger(this).error(new t(\"websocket-connection\",\"Exceeded maxReconnectionAttempts attempts. No further attempts will be made\")),void this.destroy()):(o.getLogger(this).error(new t(\"websocket-connection\",`Failed to connect. Attempting to reconnect in ${n}s`,c)),await s(r),this._tryCreateWebSocket(e,Math.min(1.5*r,1e3*this._config.maxReconnectionInterval),i+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(s){return void o.getLogger(this).error(new t(\"websocket-connection\",\"Failed to parse message, invalid JSON\",{error:s}))}}}_createWebSocket(e){return new Promise(((t,o)=>{const s=new WebSocket(e);s.onopen=()=>{if(s.onopen=null,this.destroyed)return s.onclose=null,void s.close();s.onclose=e=>this._onClose(e),s.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(s),t(s)},s.onclose=e=>{s.onopen=s.onclose=null,o(e)}}))}async _handshake(e=1e4){const s=this._websocket;if(null==s)return;const n=r(),i=s.onmessage,{filter:c,outFields:a,spatialReference:l}=this._config;return n.timeout(e),s.onmessage=e=>{let r=null;try{r=JSON.parse(e.data)}catch(h){}r&&\"object\"==typeof r||(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - malformed message\",e.data)),n.reject(),this.destroy()),r.spatialReference?.wkid!==l?.wkid&&(o.getLogger(this).error(new t(\"websocket-connection\",`Protocol violation. Handshake failed - expected wkid of ${l.wkid}`,e.data)),n.reject(),this.destroy()),\"json\"!==r.format&&(o.getLogger(this).error(new t(\"websocket-connection\",\"Protocol violation. Handshake failed - format is not set\",e.data)),n.reject(),this.destroy()),c&&r.filter!==c&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set filter, but server doesn't support it\")),a&&r.outFields!==a&&o.getLogger(this).error(new t(\"websocket-connection\",\"Tried to set outFields, but server doesn't support it\")),s.onmessage=i;for(const t of this._outstandingMessages)s.send(JSON.stringify(t));this._outstandingMessages=[],n.resolve()},s.send(JSON.stringify({filter:c,outFields:a,format:\"json\",spatialReference:{wkid:l.wkid}})),n.promise}_onMessage(e){if(this.onMessage(e),\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t=\"Encountered an error over WebSocket connection\";this._set(\"errorString\",t),o.getLogger(this).error(\"websocket-connection\",t)}_onClose(e){this._websocket=null,this.notifyChange(\"connectionStatus\"),1e3!==e.code&&o.getLogger(this).error(\"websocket-connection\",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}};e([i()],d.prototype,\"connectionStatus\",null),e([i()],d.prototype,\"errorString\",void 0),d=e([c(\"esri.layers.graphics.sources.connections.WebSocketConnection\")],d);export{d as WebSocketConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import t from\"../../../../request.js\";import r from\"../../../../core/Error.js\";import i from\"../../../../core/Logger.js\";import{createResolver as o}from\"../../../../core/promiseUtils.js\";import{addQueryParameters as s}from\"../../../../core/urlUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/RandomLCG.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WebSocketConnection as a}from\"./WebSocketConnection.js\";import{executeQuery as c}from\"../../../../rest/query/operations/query.js\";import u from\"../../../../rest/support/Query.js\";import{fromJSON as l}from\"../../../../geometry/support/jsonUtils.js\";import f from\"../../../../geometry/SpatialReference.js\";const h=1e4,d={maxQueryDepth:5,maxRecordCountFactor:3};let g=class extends a{constructor(e){super({...d,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||i.getLogger(this).warn(\"GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.\");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:o}=this._config;this.destroyed||this._setFilter(r,o)}_onMessage(e){if(\"attributes\"in e){let o;try{o=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(o.geometry)}catch(t){return void i.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to parse message\",t))}this.onFeature(o)}else this.onMessage(e)}async _fetchServiceDefinition(e){const r={f:\"json\",...this._config.customParameters},i=t(e.path,{query:r,responseType:\"json\"}),o=(await i).data;return this._serviceDefinition=o,o}_fetchWebSocketUrl(e,t){const r=e[0],{urls:i,token:o}=r,n=this._inferWebSocketBaseUrl(i);return s(`${n}/subscribe`,{outSR:\"\"+t.wkid,token:o})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes(\"wss\"))return t;return i.getLogger(this).error(new r(\"geoevent-connection\",\"Unable to infer WebSocket url\",e)),null}async _setFilter(e,t){const s=this._websocket;if(null==s||null==e&&null==t)return;const n=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const c=o(),u=()=>{a||(this.destroyed||this._websocket!==s||i.getLogger(this).error(new r(\"geoevent-connection\",\"Server timed out when setting filter\")),c.reject())},l=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(i.getLogger(this).error(new r(\"geoevent-connection\",\"Failed to set service filter\",t.error)),this._set(\"errorString\",`Could not set service filter - ${t.error}`),c.reject(t.error)),this._setWebSocketJSONParseHandler(s),a=!0,c.resolve())};return s.onmessage=l,s.send(n),setTimeout(u,h),c.promise}_serializeFilter(e,t){const o={};if(null==e&&null==t)return o;if(e?.geometry)try{const t=l(e.geometry);if(\"extent\"!==t.type)throw new r(`Expected extent but found type ${t.type}`);o.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(s){i.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when setting connection geometryDefinition\",s))}return e?.where&&\"1 = 1\"!==e.where&&\"1=1\"!==e.where&&(o.where=e.where),null!=t&&(o.outFields=t.join(\",\")),o}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,o=e.attributes[t],s=this._relatedFeatures.get(o);if(!s)return i.getLogger(this).warn(\"geoevent-connection\",\"Feature join failed. Is the join field configured correctly?\",e),e;const{attributes:n,geometry:a}=s;for(const r in n)e.attributes[r]=n[r];return a&&(e.geometry=a),e.geometry||e.centroid||i.getLogger(this).error(new r(\"geoevent-connection\",\"Found malformed feature - no geometry found\",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),i=this._queryArchive(t);await r;const o=await i;if(!o)return;for(const s of o.features)this.onFeature(this._enrich(s))}catch(e){i.getLogger(this).error(new r(\"geoevent-connection\",\"Encountered an error when querying buddy services\",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(e){const t=new((await import(\"../../../FeatureLayer.js\")).default)({url:e}),{capabilities:r}=await t.load(),i=r.query.supportsMaxRecordCountFactor,o=r.query.supportsPagination,s=r.query.supportsCentroid,n=this._config.maxRecordCountFactor,a=t.capabilities.query.maxRecordCount,l=i?a*n:a,h=new u;if(h.outFields=this._config.outFields??[\"*\"],h.where=this._config.filter?.where??\"1=1\",h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=f.fromJSON(this._config.spatialReference),s&&(h.returnCentroid=!0),i&&(h.maxRecordCountFactor=n),o)return h.num=l,t.destroy(),this._queryPages(e,h);const d=await c(e,h,this._config.sourceSpatialReference);return t.destroy(),d.data}async _queryPages(e,t,r=[],i=0){t.start=null!=t.num?i*t.num:null;const{data:o}=await c(e,t,this._config.sourceSpatialReference);return o.exceededTransferLimit&&i<(this._config.maxQueryDepth??0)?(o.features.forEach((e=>r.push(e))),this._queryPages(e,t,r,i+1)):(r.forEach((e=>o.features.push(e))),o)}_addRelatedFeatures(e){const t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField;for(const o of r){const e=o.attributes[i];t.set(e,o)}this._relatedFeatures=t}};g=e([n(\"esri.layers.graphics.sources.connections.GeoEventConnection\")],g);const y=g;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import{getGeometryZScaler as o}from\"../../geometry/support/zscale.js\";import s from\"./StreamConnection.js\";let a=class extends s{constructor(e){super({}),this.connectionStatus=\"connected\",this.errorString=null;const{geometryType:r,spatialReference:t,sourceSpatialReference:s}=e;this._featureZScaler=o(r,s,t)}normalizeCtorArgs(){return{}}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if(\"type\"in e)switch(e.type){case\"features\":case\"featureResult\":for(const r of e.features)null!=this._featureZScaler&&this._featureZScaler(r.geometry),this.onFeature(r)}this.onMessage(e)}};e([r()],a.prototype,\"connectionStatus\",void 0),e([r()],a.prototype,\"errorString\",void 0),a=e([t(\"esri.layers.support.ClientSideConnection\")],a);export{a as ClientSideConnection};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport e from\"./GeoEventConnection.js\";import{WebSocketConnection as t}from\"./WebSocketConnection.js\";import{ClientSideConnection as n}from\"../../../support/ClientSideConnection.js\";function o(e,t){if(null==e&&null==t)return null;const n={};return null!=t&&(n.geometry=t),null!=e&&(n.where=e),n}function r(r,i,s,c,l,u,a,m,p){const f={source:r,sourceSpatialReference:i,spatialReference:s,geometryType:c,filter:o(l,u),maxReconnectionAttempts:a,maxReconnectionInterval:m,customParameters:p};if(!r)return new n(f);return r.path.startsWith(\"wss://\")||r.path.startsWith(\"ws://\")?new t(f):new e(f)}export{r as createConnection};\n"],"names":["i","o","constructor","t","e","r","arguments","length","undefined","this","_trackIdToObservations","Map","_idCounter","_lastPurge","performance","now","_addOrUpdated","_removed","_maxAge","_timeInfo","_purgeOptions","store","objectIdField","purgeInterval","_useGeneratedIds","removeById","push","removeByTrackId","get","s","entries","add","_nextId","attributes","objectId","set","Math","max","startTimeField","trackIdField","_trackIdLessObservations","enqueue","has","_this$_purgeOptions","maxObservations","d","a","delete","checkForUpdates","_getToAdd","_getToRemove","_purge","Set","update","size","Array","forEach","clear","_purgeSomeByDisplayCount","_purgeByAge","_purgeByAgeReceived","_purgeTracks","displayCount","values","dequeue","_this$_timeInfo","age","ageReceived","c","EventedAccessor","destroy","emit","connectionError","errorString","onFeature","onMessage","readOnly","prototype","n","h","CONNECTING","OPEN","CLOSING","CLOSED","l","super","_outstandingMessages","geometryType","spatialReference","sourceSpatialReference","_config","_featureZScaler","_open","normalizeCtorArgs","_tryCreateWebSocket","destroyed","_handshake","_websocket","onopen","onclose","onerror","onmessage","close","connectionStatus","readyState","sendMessageToSocket","send","JSON","stringify","sendMessageToClient","_onMessage","updateCustomParameters","customParameters","source","path","_this$_config$customP","_createWebSocket","notifyChange","maxReconnectionAttempts","getLogger","error","concat","min","maxReconnectionInterval","_setWebSocketJSONParseHandler","parse","data","Promise","WebSocket","_onClose","_onError","filter","outFields","timeout","_r$spatialReference","reject","wkid","format","resolve","promise","type","features","geometry","_set","code","maxQueryDepth","maxRecordCountFactor","g","_buddyServicesQuery","_relatedFeatures","_fetchServiceDefinition","timeInfo","warn","_fetchWebSocketUrl","streamUrls","_queryBuddyServices","_setFilter","_enrich","f","query","responseType","_serviceDefinition","urls","token","_inferWebSocketBaseUrl","outSR","includes","_serializeFilter","setTimeout","u","shiftCentralMeridian","where","join","relatedFeatures","joinField","centroid","keepLatestArchive","_queryRelatedFeatures","_queryArchive","_queryBuddy","featuresUrl","_addRelatedFeatures","_this$_config$outFiel","_this$_config$filter$","_this$_config$filter","default","url","capabilities","load","supportsMaxRecordCountFactor","supportsPagination","supportsCentroid","maxRecordCount","returnGeometry","returnExceededLimitFeatures","outSpatialReference","fromJSON","returnCentroid","num","_queryPages","_this$_config$maxQuer","start","exceededTransferLimit","y","m","p","startsWith"],"sourceRoot":""}