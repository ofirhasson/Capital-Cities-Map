"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[10676,45739],{43244:(e,t,i)=>{i.d(t,{Z:()=>n});class n{constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}}},50863:(e,t,i)=>{i.d(t,{h:()=>s});var n=i(45739);function s(e,t,i){if(null==(null===e||void 0===e?void 0:e.timeInfo))return null;const{datesInUnknownTimezone:s=!1,timeOffset:r,useViewTime:o}=e;let l=e.timeExtent;s&&(l=(0,n.Jb)(l));let a=o?t&&l?t.intersection(l):t||l:l;return!a||a.isEmpty||a.isAllTime?a:(r&&(a=a.offset(-r.value,r.unit)),s&&(a=(0,n.b3)(a)),a.equals(i)?i:a)}},83217:(e,t,i)=>{i.d(t,{x:()=>n});const n=Symbol("WebScene")},45739:(e,t,i)=>{i.d(t,{getTimeSliderSettingsFromWebDocument:()=>p,Jb:()=>y,b3:()=>v});var n=i(62044),s=i(63780),r=(i(44927),i(84652)),o=(i(32718),i(86710)),l=i(38675),a=i(83217);function u(e){return void 0!==e.timeInfo}async function d(e,t){var i,r;return null!==(i=null===(r=e.widgets)||void 0===r||null===(r=r.timeSlider)||void 0===r?void 0:r.fullTimeExtent)&&void 0!==i?i:async function(e,t){if(0===e.length)return n.Z.allTime;await Promise.all(e.map((e=>e.load({signal:t}))));const i=e.filter(u),r=e.filter((e=>!u(e)&&null!=e.visibilityTimeExtent));if(0===i.length&&0===r.length)return n.Z.allTime;const o=[],l=[];for(const n of i){var a;"feature"!==(null===n||void 0===n?void 0:n.type)&&"map-image"!==(null===n||void 0===n?void 0:n.type)||null===(a=n.timeInfo)||void 0===a||!a.hasLiveData?l.push(n):o.push(n)}const d=e=>null==e||e.isAllTime,c=[...l.map((e=>{var t,i;const n=null===(t=e.timeInfo)||void 0===t?void 0:t.fullTimeExtent,{visibilityTimeExtent:s}=e;return null!==(i=null===n||void 0===n?void 0:n.intersection(s))&&void 0!==i?i:s})),...r.map((e=>e.visibilityTimeExtent))];if(c.some(d))return n.Z.allTime;const h=o.map((async e=>{var i,n,s,r;const o=null!==(i=null===(n=await e.fetchRecomputedExtents({signal:t}))||void 0===n?void 0:n.timeExtent)&&void 0!==i?i:null===(s=e.timeInfo)||void 0===s?void 0:s.fullTimeExtent,{visibilityTimeExtent:l}=e;return null!==(r=null===o||void 0===o?void 0:o.intersection(l))&&void 0!==r?r:l})),p=(await Promise.allSettled(h)).map((e=>"fulfilled"===e.status?e.value:null));if(p.some(d))return n.Z.allTime;const v=[...p,...c].filter(s.pC);return 0===v.length?n.Z.allTime:v.reduce(((e,t)=>e.union(t)))}(e.allLayers,t)}function c(e){const{numStops:t,stopInterval:i,stops:n}=e;return n?{dates:(0,r.d9)(n)}:i?{interval:i.clone()}:{count:null!==t&&void 0!==t?t:5}}function h(e,t){var i;const s=e.currentTimeExtent;if(!s)return null;const{start:r,end:o}=s,l=null!==(i=null!==r&&void 0!==r?r:o)&&void 0!==i?i:null;switch(t){case"time-window":return new n.Z({start:r,end:o});case"cumulative-from-start":return new n.Z({start:null,end:l});case"cumulative-from-end":return new n.Z({start:l,end:null});case"instant":return new n.Z({start:l,end:l})}}async function p(e,t){var i,n;if(!(0,l.s)(e)&&!function(e){return null!=e&&"object"==typeof e&&a.x in e}(e))return null;await e.load({signal:t});const s=null===e||void 0===e||null===(i=e.widgets)||void 0===i?void 0:i.timeSlider;if(!s)return null;const r=await d(e,t),o=s.loop,u=function(e){var t;const i=null!==(t=e.numThumbs)&&void 0!==t?t:2,n=e.currentTimeExtent;if(n){const{start:e,end:t}=n;return null!=e&&null!=t&&e.getTime()===t.getTime()?"instant":2===i?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===i?"time-window":"cumulative-from-start"}(s);return{fullTimeExtent:r,loop:o,mode:u,playRate:null!==(n=s.stopDelay)&&void 0!==n?n:2e3,stops:c(s),timeExtent:h(s,u)}}function v(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:null!=t?(0,o.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,o.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}function y(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:null!=t?(0,o.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,o.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}},21643:(e,t,i)=>{i.r(t),i.d(t,{default:()=>P});var n=i(27366),s=i(10064),r=i(94172),o=i(49861),l=(i(93169),i(32718),i(84936),i(69912)),a=(i(59486),i(52639)),u=i(7138),d=i(92026),c=i(67426),h=i(76151),p=i(97463),v=i(5198),y=i(27823);let m=class extends a.Z{constructor(e){super(e)}getObjectId(){return this.objectId}};(0,n._)([(0,o.Cb)({type:Number,json:{read:!0}})],m.prototype,"objectId",void 0),m=(0,n._)([(0,l.j)("esri.layers.graphics.controllers.StreamController.StreamGraphic")],m);class f{constructor(e){this.onUpdate=e,this._idToGraphic=new Map}destroy(){this._idToGraphic.clear()}add(e){this._idToGraphic.set(e.objectId,e)}get(e){return this._idToGraphic.get(e)}forEach(e){this._idToGraphic.forEach(e)}removeById(e){const t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._idToGraphic.size}}let _=class extends((0,c.v)(u.default)){constructor(){super(...arguments),this.isPaused=!1,this.graphics=new v.g,this._updateInfo={websocket:0,client:0},this._updateIntervalId=null,this._outSpatialReference=null}initialize(){this.addResolvingPromise(this.layer.when((()=>this._startup())))}destroy(){this.clear()}_clearInterval(){null!==this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=null)}clear(){this._shutdown(),this.graphics.clear()}get updating(){return!this.connection||"connected"===this.connection.connectionStatus}_shutdown(){this._clearInterval(),this.connection=(0,d.SC)(this.connection),this.store=(0,d.SC)(this.store),this.removeAllHandles()}_startup(){const{layer:e,layerView:t}=this,{spatialReference:i,definitionExpression:n,geometryDefinition:s,objectIdField:o,timeInfo:l,purgeOptions:a,maxReconnectionAttempts:u,maxReconnectionInterval:d,customParameters:c}=e,v=e.geometryType?y.M.toJSON(e.geometryType):null,m=i,_=t.view.spatialReference;this.clear(),this._set("connection",(0,p.createConnection)(e.parsedUrl,m,_,v,n,s,u,d,null!==c&&void 0!==c?c:void 0)),this._outSpatialReference=_.toJSON(),this.store=new f(this._onUpdate.bind(this)),this.featuresManager=new h.Qo(this.store,o,l.toJSON(),a);const g="startup-watches";this.removeHandles(g),this.addHandles([e.on("send-message-to-socket",(e=>this.connection.sendMessageToSocket(e))),e.on("send-message-to-client",(e=>this.connection.sendMessageToClient(e))),this.connection.on("data-received",(e=>this._onFeature(e))),this.connection.on("message-received",(e=>this._onWebSocketMessage(e))),(0,r.watch)((()=>[e.definitionExpression,e.geometryDefinition,e.purgeOptions]),(()=>this._startup()))],g),this.isPaused||this._initUpdateInterval()}_onWebSocketMessage(e){if(this.layerView.emit("message-received",e),"type"in e)switch(e.type){case"delete":if(e.objectIds)for(const t of e.objectIds)this.featuresManager.removeById(t);if(e.trackIds)for(const t of e.trackIds)this.featuresManager.removeByTrackId(t);break;case"clear":this.store.forEach((e=>this.featuresManager.removeById(e.objectId)))}}_onFeature(e){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{null==e.geometry||e.geometry.spatialReference||(e.geometry.spatialReference=this._outSpatialReference);const t=m.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch{}}_onUpdate(e,t){null!=t&&this.graphics.removeMany(t),null!=e&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}_initUpdateInterval(){this._clearInterval();const{updateInterval:e}=this.layer;let t=performance.now();this._updateIntervalId=setInterval((()=>{const e=performance.now(),i=e-t;if(i>2500){t=e;const n=Math.round(this._updateInfo.client/(i/1e3)),s=Math.round(this._updateInfo.websocket/(i/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.layerView.emit("update-rate",{client:n,websocket:s})}this.featuresManager.checkForUpdates()}),e)}pauseStream(){this.isPaused=!0,this._clearInterval()}resumeStream(){this.isPaused=!1,this._initUpdateInterval()}disconnect(){this._shutdown()}connect(){null==this.connection&&this._startup()}clearGraphics(){this.graphics.clear()}};(0,n._)([(0,o.Cb)()],_.prototype,"isPaused",void 0),(0,n._)([(0,o.Cb)({constructOnly:!0})],_.prototype,"layer",void 0),(0,n._)([(0,o.Cb)({constructOnly:!0})],_.prototype,"layerView",void 0),(0,n._)([(0,o.Cb)()],_.prototype,"connection",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],_.prototype,"updating",null),_=(0,n._)([(0,l.j)("esri.layers.graphics.controllers.StreamController")],_);var g=i(21149),b=i(7303),w=i(42069),C=i(22380);let S=class extends C.Q{constructor(e){super(e),this.suspendResumeExtentMode="computed"}get connection(){var e;return null===(e=this.controller)||void 0===e?void 0:e.connection}createController(){return new _({layer:this.layer,layerView:this.layerView})}beforeSetController(){}pause(){var e;null===(e=this.controller)||void 0===e||e.pauseStream()}resume(){var e;null===(e=this.controller)||void 0===e||e.resumeStream()}disconnect(){var e;null===(e=this.controller)||void 0===e||e.disconnect()}connect(){var e;null===(e=this.controller)||void 0===e||e.connect()}clear(){var e;null===(e=this.controller)||void 0===e||e.clearGraphics()}};(0,n._)([(0,o.Cb)()],S.prototype,"controller",void 0),(0,n._)([(0,o.Cb)()],S.prototype,"connection",null),(0,n._)([(0,o.Cb)()],S.prototype,"suspendResumeExtentMode",void 0),S=(0,n._)([(0,l.j)("esri.views.3d.layers.graphics.StreamGraphics3DGraphicsPipeline")],S);var I=i(78485),T=i(67581),x=i(27499);let E=class extends((0,x.Z)((0,b.R)((0,w.A)(T.Z)))){constructor(){super(...arguments),this.type="stream-3d",this.updatePolicy=I.j.ASYNC,this.hasZ=!0,this.hasM=!1}initialize(){this.addHandles((0,r.watch)((()=>this.suspended),(e=>{this.graphicsPipeline&&this._onSuspendedChange(e)})))}get connectionError(){var e;const t=null===(e=this.graphicsPipeline)||void 0===e||null===(e=e.connection)||void 0===e?void 0:e.errorString;return t?new s.Z("stream-controller",t):null}createQuery(){return new g.Z({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}queryLatestObservations(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}get _streamConnectionStatus(){var e,t;return null!==(e=null===(t=this.graphicsPipeline)||void 0===t||null===(t=t.connection)||void 0===t?void 0:t.connectionStatus)&&void 0!==e?e:"disconnected"}createGraphicsPipeline(){return new S({layerView:this})}createController(){return new _({layer:this.layer,layerView:this})}beforeSetController(){}_doPause(){var e;null===(e=this.graphicsPipeline)||void 0===e||e.pause()}_doResume(){var e;null===(e=this.graphicsPipeline)||void 0===e||e.resume()}_doDisconnect(){var e;null!==(e=this.graphicsPipeline)&&void 0!==e&&e.disconnect(),this._doPause()}_doConnect(){var e;null!==(e=this.graphicsPipeline)&&void 0!==e&&e.connect(),this.resume()}_doClear(){var e;null===(e=this.graphicsPipeline)||void 0===e||e.clear()}};(0,n._)([(0,o.Cb)({readOnly:!0})],E.prototype,"updatePolicy",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],E.prototype,"connectionError",null),(0,n._)([(0,o.Cb)()],E.prototype,"graphicsPipeline",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],E.prototype,"hasZ",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],E.prototype,"hasM",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],E.prototype,"_streamConnectionStatus",null),E=(0,n._)([(0,l.j)("esri.views.3d.layers.StreamLayerView3D")],E);const P=E},67581:(e,t,i)=>{i.d(t,{Z:()=>y});var n=i(27366),s=i(7138),r=i(91505),o=i(79056),l=i(32718),a=i(92026),u=i(67426),d=i(49861),c=(i(93169),i(84936),i(69912)),h=i(46634),p=i(69787);let v=class extends((0,o.IG)((0,u.v)(r.Z.EventedMixin(s.default)))){constructor(e){super(e),this._updatingHandles=new h.R,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",n=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";l.Z.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(i,"')"),e)}}))}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles)}get fullOpacity(){var e,t,i,n;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(n=this.parent)||void 0===n?void 0:n.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t,i;const n=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)&&(0,p.Cy)(n)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const n=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,p.Cy)(n)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,n._)([(0,d.Cb)()],v.prototype,"view",void 0),(0,n._)([(0,d.Cb)()],v.prototype,"fullOpacity",null),(0,n._)([(0,d.Cb)()],v.prototype,"layer",void 0),(0,n._)([(0,d.Cb)()],v.prototype,"parent",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"suspended",null),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,n._)([(0,d.Cb)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,n._)([(0,d.Cb)()],v.prototype,"updateSuspended",null),(0,n._)([(0,d.Cb)()],v.prototype,"visible",null),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null),(0,n._)([(0,d.Cb)({readOnly:!0})],v.prototype,"visibleAtCurrentTimeExtent",null),v=(0,n._)([(0,c.j)("esri.views.layers.LayerView")],v);const y=v},27499:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(27366),s=i(49861),r=(i(93169),i(32718),i(84936),i(69912)),o=i(18661);const l=e=>{let t=class extends e{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(){super(...arguments),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&"connected"===this._streamConnectionStatus?"paused":this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return(0,n._)([(0,s.Cb)()],t.prototype,"_isUserPaused",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"connectionStatus",null),(0,n._)([(0,s.Cb)({type:o.Z})],t.prototype,"filter",void 0),t=(0,n._)([(0,r.j)("esri.views.layers.StreamLayerView")],t),t}}}]);
//# sourceMappingURL=10676.5412e7a5.chunk.js.map