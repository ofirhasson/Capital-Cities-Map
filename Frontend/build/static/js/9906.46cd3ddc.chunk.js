"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[9906],{57858:(t,e,i)=>{i.d(e,{Q:()=>n,q:()=>r});var o=i(19545),s=i(76200);async function r(t,e,i){var r;if(!(null===o.id||void 0===o.id?void 0:o.id.findCredential(t.restUrl)))return null;if("loaded"===t.loadStatus&&""===e&&null!==(r=t.user)&&void 0!==r&&r.sourceJSON&&!1===i)return t.user.sourceJSON;const n={responseType:"json",query:{f:"json"}};if(i&&(n.query.returnUserLicenseTypeExtensions=!0),""===e){const e=await(0,s.Z)(t.restUrl+"/community/self",n);if(e.data){const t=e.data;if(null!==t&&void 0!==t&&t.username)return t}return null}const a=await(0,s.Z)(t.restUrl+"/community/users/"+e,n);if(a.data){const t=a.data;return t.error?null:t}return null}async function n(t,e,i){var o,s;const n=await r(t,e,!0);return null!==(o=null===n||void 0===n||null===(s=n.userLicenseTypeExtensions)||void 0===s?void 0:s.includes(i))&&void 0!==o&&o}},9906:(t,e,i)=>{i.r(e),i.d(e,{default:()=>L});var o=i(27366),s=i(49861),r=(i(93169),i(32718)),n=(i(84936),i(69912)),a=i(33565),l=i(8905),c=(i(80975),i(80532)),d=i(67005),u=(i(59166),i(7138)),h=i(80987),v=i(10064),y=i(94172),p=i(46634),g=i(37933),w=i(7575),_=i(57858),k=i(36257),m=i(41201);const E=-2147208940,b=-2147217146,x=-2147220947;let C=class extends u.default{constructor(t){super(t),this._activeOperationDidSucceed=!1,this._initialValidationsFinished=!1,this._dirtyAreasLayer=null,this._serverVersion=null,this._updatingHandles=new p.R,this._validConstructProperties=!1,this.executionError="",this.extentToValidate="current",this.loadErrors=new h.Z}initialize(){const t=async()=>{this.messages||(this.messages=await(0,m.ME)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology"))};t().then((()=>{this.view||(this.view=null),this.utilityNetwork||(this.utilityNetwork=null),this.addHandles([(0,y.watch)((()=>[this.view,this.utilityNetwork]),(async()=>{var t,e;const{loadErrors:i,messages:{info:{noUtilityNetwork:o,noView:s}}}=this;this._initialValidationsFinished=!1,i.removeAll(),this._validConstructProperties=!0,this._dirtyAreasLayer=null,this._serverVersion=null,"utility"!==(null===(t=this.utilityNetwork)||void 0===t?void 0:t.type)&&(this.loadErrors.push(o),r.Z.getLogger(this).error(new v.Z("utilityNetworkValidateTopology:missing-property",o)),this._validConstructProperties=!1),"2d"!==(null===(e=this.view)||void 0===e?void 0:e.type)&&(this.loadErrors.push(s),r.Z.getLogger(this).error(new v.Z("utilityNetworkValidateTopology:missing-property",s)),this._validConstructProperties=!1),this._validConstructProperties&&(this.utilityNetwork.loaded||await this.utilityNetwork.load().catch((t=>{r.Z.getLogger(this).error(t),this._validConstructProperties=!1})),await this._setDirtyAreasLayer()),this._validConstructProperties&&await this._validateNetworkExtension()}),y.initial),(0,y.on)((()=>{var t;return null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t?void 0:t.layers}),"change",(async()=>{const{loadErrors:t,messages:{info:{noUtilityNetwork:e}}}=this,i=t.find((t=>t===e));this._initialValidationsFinished=!1,i||(t.removeAll(),await this._validateNetworkExtension(),await this._setDirtyAreasLayer()),this._initialValidationsFinished=!0})),(0,k.qe)(t)])}))}destroy(){this._updatingHandles.destroy()}get state(){return this.loadErrors.length||!this._validConstructProperties?"disabled":this.executionError?"failed":this._updatingHandles.updating?"executing":this._activeOperationDidSucceed?"success":this._initialValidationsFinished?"ready":"loading"}set utilityNetwork(t){this._get("utilityNetwork")!==t&&this._set("utilityNetwork",t)}set view(t){this._get("view")!==t&&this._set("view",t)}async validateTopology(){var t;const{messages:{info:{cannotAcquireVersionLock:e,noDirtyAreasInExtent:i}},utilityNetwork:o,view:s}=this;this.loadErrors.length||(this._activeOperationDidSucceed=!1,this._set("executionError",""),this._updatingHandles.addPromise(null===o||void 0===o?void 0:o.validateTopology({validateArea:"current"===this.extentToValidate?s.extent.clone():o.fullExtent.clone(),outSpatialReference:(null===(t=s.spatialReference)||void 0===t?void 0:t.clone())||null}).then((()=>{this._activeOperationDidSucceed=!0}),(t=>{var o;let s="Error: "+t;if(t instanceof v.Z&&null!==(o=t.details)&&void 0!==o&&o.raw)switch(t.details.raw.extendedCode){case E:s=i;break;case b:case x:s=e;break;default:s=t.details.message}this._set("executionError",s)}))))}async _setDirtyAreasLayer(){var t,e;const{messages:{info:{noDirtyAreasLayer:i}}}=this,o=null===(t=this.view)||void 0===t?void 0:t.map.allLayers.items.filter((t=>(0,g.Te)(t))).find((t=>{var e,i;return(null===(e=t.parsedUrl)||void 0===e?void 0:e.path)===(null===(i=this.utilityNetwork)||void 0===i?void 0:i.networkSystemLayers.dirtyAreasLayerUrl)}));o?(this._dirtyAreasLayer=o,await this._dirtyAreasLayer.load(),this._serverVersion=null!==(e=this._dirtyAreasLayer.version)&&void 0!==e?e:0,this._validConstructProperties=!0):(this.loadErrors.push(i),r.Z.getLogger(this).error(new v.Z("utilityNetworkValidateTopology:missing-layer",i)),this._validConstructProperties=!1)}async _validateNetworkExtension(){var t,e;const{messages:{info:{noAdvancedEditingUserTypeExtension:i,noUtilityNetworkServiceUserTypeExtension:o}}}=this,s=await(0,g.oP)(this.utilityNetwork.layerUrl),n=new w.Z({url:s});await n.load();const a=null!==(t=null===(e=n.user)||void 0===e?void 0:e.username)&&void 0!==t?t:"",l=Number(this._serverVersion)<=11.1?"utilityNetwork":"advediting";if(!await(0,_.Q)(n,a,l)){const t=Number(this._serverVersion)<=11.1?o:i;this.loadErrors.push(t),r.Z.getLogger(this).error(new v.Z("utilityNetworkValidateTopology:no-user-type-extension",t)),this._validConstructProperties=!1}this._initialValidationsFinished=!0}};(0,o._)([(0,s.Cb)()],C.prototype,"_initialValidationsFinished",void 0),(0,o._)([(0,s.Cb)()],C.prototype,"_dirtyAreasLayer",void 0),(0,o._)([(0,s.Cb)()],C.prototype,"_validConstructProperties",void 0),(0,o._)([(0,s.Cb)({readOnly:!0})],C.prototype,"executionError",void 0),(0,o._)([(0,s.Cb)()],C.prototype,"extentToValidate",void 0),(0,o._)([(0,s.Cb)()],C.prototype,"loadErrors",void 0),(0,o._)([(0,s.Cb)()],C.prototype,"messages",void 0),(0,o._)([(0,s.Cb)({readOnly:!0})],C.prototype,"state",null),(0,o._)([(0,s.Cb)()],C.prototype,"utilityNetwork",null),(0,o._)([(0,s.Cb)()],C.prototype,"view",null),C=(0,o._)([(0,n.j)("esri.widgets.UtilityNetworkValidateTopology.UtilityNetworkValidateTopologyViewModel")],C);const N=C,f="esri-un-validate-topology",V={container:"".concat(f,"__container"),content:"".concat(f,"__content"),controlsContainer:"".concat(f,"__controls-container"),statusIconError:"".concat(f,"__status-icon-error"),statusIconSuccess:"".concat(f,"__status-icon-success"),statusIconContainer:"".concat(f,"__status-icon-container")};let T=class extends a.Z{constructor(t,e){super(t,e),this.messages=null,this.viewModel=new N}loadDependencies(){return(0,l.h)({action:()=>Promise.all([i.e(92358),i.e(46895),i.e(65138),i.e(91741)]).then(i.bind(i,6814)),block:()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(4758)]).then(i.bind(i,4758)),icon:()=>Promise.all([i.e(92358),i.e(87474)]).then(i.bind(i,87474)),notice:()=>Promise.all([i.e(92358),i.e(46895),i.e(15669)]).then(i.bind(i,15669)),option:()=>i.e(19790).then(i.bind(i,19790)),select:()=>Promise.all([i.e(92358),i.e(54438),i.e(26369)]).then(i.bind(i,26369)),tooltip:()=>Promise.all([i.e(92358),i.e(89219),i.e(94730)]).then(i.bind(i,94730))})}get extentToValidate(){return this.viewModel.extentToValidate}set extentToValidate(t){this.viewModel.extentToValidate=t}get icon(){return"check-circle"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t,e;return null!==(t=null===(e=this.messages)||void 0===e?void 0:e.label)&&void 0!==t?t:""}set label(t){this._overrideIfSome("label",t)}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{viewModel:t}=this;return"disabled"===t.state?(0,d.u)("div",{class:V.container},(0,d.u)("calcite-block",{class:V.content,collapsible:!1,heading:this.label,open:!0},this._renderLoadErrorStatusIcon(),this._renderLoadErrorsNotices())):(0,d.u)("div",{class:V.container},(0,d.u)("calcite-block",{class:V.content,collapsible:!0,heading:this.label,open:!1},this._renderStatusIcon(),this._renderValidateTopologyAction(),this._renderControls()))}_extentOptionSelectChange(t){this.extentToValidate=t.target.value}_getLoadErrorMessagesAsNotices(t,e){return(0,d.u)("calcite-notice",{closable:!1,key:"error-notice-"+e,kind:"warning",open:!0,scale:"s"},(0,d.u)("div",{slot:"message"},t))}_handleValidateTopologyAction(){this.viewModel.validateTopology().catch((()=>{}))}_renderControls(){const{viewModel:t}=this;return"failed"===t.state?(0,d.u)("div",{class:V.controlsContainer},this._renderExtentOptionSelect(),this._renderStatusNotice()):this._renderExtentOptionSelect()}_renderExtentOptionSelect(){const{messages:t,viewModel:e}=this;return(0,d.u)("div",{key:"selectExtentDiv"},(0,d.u)("calcite-select",{bind:this,disabled:"loading"===e.state||"executing"===e.state,label:t.input.extentToValidate,onCalciteSelectChange:this._extentOptionSelectChange},(0,d.u)("calcite-option",{value:"current"},t.input.currentExtent),(0,d.u)("calcite-option",{value:"entire"},t.input.entireExtent)))}_renderLoadErrorsNotices(){const{viewModel:t}=this;return(0,d.u)("div",{class:V.controlsContainer,key:"loadErrorsDiv"},t.loadErrors.items.map(this._getLoadErrorMessagesAsNotices))}_renderLoadErrorStatusIcon(){return(0,d.u)("div",{class:V.statusIconContainer,key:"statusDiv",slot:"control"},(0,d.u)("calcite-icon",{class:V.statusIconError,icon:"exclamation-mark-triangle",scale:"s"}))}_renderStatusIcon(){const{messages:t,viewModel:e}=this,i="".concat(this.id,"-validation-status-action"),o="".concat(this.id,"-error-status-icon"),s="".concat(this.id,"-success-status-icon");return"executing"===e.state?(0,d.u)("div",{key:"statusDivExecuting",slot:"control"},(0,d.u)("calcite-action",{id:i,loading:!0,text:t.status.executing}),(0,d.u)("calcite-tooltip",{referenceElement:i},(0,d.u)("span",null,t.status.executing))):"success"===e.state?(0,d.u)("div",{afterCreate:t=>{setTimeout((()=>{t.innerHTML=""}),3500)},class:V.statusIconContainer,key:"statusDivSuccess",slot:"control"},(0,d.u)("calcite-icon",{class:V.statusIconSuccess,icon:"check-circle",id:s,scale:"s"}),(0,d.u)("calcite-tooltip",{referenceElement:s},(0,d.u)("span",null,t.status.success))):"failed"===e.state?(0,d.u)("div",{class:V.statusIconContainer,key:"statusDivFailed",slot:"control"},(0,d.u)("calcite-icon",{class:V.statusIconError,icon:"exclamation-mark-triangle",id:o,scale:"s"}),(0,d.u)("calcite-tooltip",{referenceElement:o},(0,d.u)("span",null,e.executionError))):(0,d.u)("div",{class:V.statusIconContainer,key:"statusDiv",slot:"control"})}_renderStatusNotice(){const{viewModel:t}=this;return(0,d.u)("div",{key:"executionErrorDiv"},(0,d.u)("calcite-notice",{closable:!0,kind:"warning",open:!0,scale:"s"},(0,d.u)("div",{slot:"message"},t.executionError)))}_renderValidateTopologyAction(){const{messages:t,viewModel:e}=this,i="".concat(this.id,"-validation-action");return(0,d.u)("div",{key:"actionDiv",slot:"control"},(0,d.u)("calcite-action",{bind:this,disabled:"executing"===e.state,icon:"play-f",id:i,loading:"loading"===e.state,onclick:this._handleValidateTopologyAction,text:t.input.validateTopology}),(0,d.u)("calcite-tooltip",{referenceElement:i},(0,d.u)("span",null,"loading"===e.state?t.status.loading:t.input.validateTopology)))}};(0,o._)([(0,s.Cb)()],T.prototype,"extentToValidate",null),(0,o._)([(0,s.Cb)()],T.prototype,"icon",null),(0,o._)([(0,s.Cb)()],T.prototype,"label",null),(0,o._)([(0,s.Cb)(),(0,c.H)("esri/widgets/UtilityNetworkValidateTopology/t9n/UtilityNetworkValidateTopology")],T.prototype,"messages",void 0),(0,o._)([(0,s.Cb)()],T.prototype,"utilityNetwork",null),(0,o._)([(0,s.Cb)()],T.prototype,"view",null),(0,o._)([(0,s.Cb)({type:N})],T.prototype,"viewModel",void 0),T=(0,o._)([(0,n.j)("esri.widgets.UtilityNetworkValidateTopology")],T);const L=T}}]);
//# sourceMappingURL=9906.46cd3ddc.chunk.js.map