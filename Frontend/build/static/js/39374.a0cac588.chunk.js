"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[39374,62078],{39374:(e,t,i)=>{i.r(t),i.d(t,{default:()=>st});var r=i(27366),s=i(19545),n=i(60762),o=i(62044),a=i(36721),l=i(80987),d=i(10064),p=i(84652),u=i(54472),c=i(93002),h=i(32718),y=i(92026),v=i(97642),m=i(67426),g=i(66978),_=i(94172),w=i(35995),b=i(49861),f=(i(93169),i(38511)),E=i(69912),T=i(31201),S=i(15909),I=i(92562),C=i(53866),A=i(90724),L=i(79803),R=i(78952),O=i(5354),N=i(77981),P=i(92975),U=i(7575),k=i(98995),j=i(32698),Z=i(73117),x=i(23037),F=i(1674),M=i(83217);function V(){return new d.Z("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")}function D(e){return new d.Z("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})}var G,q=i(50951),B=i(92028),H=i(84933),W=i(15946),J=i(40739),Q=i(76926),Y=i(9634),z=i(41537),K=i(46784),$=(i(84936),i(48193));let X=G=class extends K.wq{constructor(e){super(e),this.viewing=null}clone(){var e,t;return new G({viewing:null!==(e=null===(t=this.viewing)||void 0===t?void 0:t.clone())&&void 0!==e?e:null})}};(0,r._)([(0,b.Cb)({type:$.Z,json:{write:!0}})],X.prototype,"viewing",void 0),X=G=(0,r._)([(0,E.j)("esri.webscene.ApplicationProperties")],X);const ee=X;var te,ie=i(21147),re=i(39328);let se=te=class extends K.wq{constructor(e){super(e),this.environment=new ie.Z,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}clone(){var e,t,i,r,s,n;return new te({environment:this.environment.clone(),spatialReference:null!==(e=null===(t=this.spatialReference)||void 0===t?void 0:t.clone())&&void 0!==e?e:null,viewingMode:this.viewingMode,viewpoint:null!==(i=null===(r=this.viewpoint)||void 0===r?void 0:r.clone())&&void 0!==i?i:null,timeExtent:null!==(s=null===(n=this.timeExtent)||void 0===n?void 0:n.clone())&&void 0!==s?s:null})}};(0,r._)([(0,b.Cb)({type:ie.Z,json:{write:{isRequired:!0}}})],se.prototype,"environment",void 0),(0,r._)([(0,b.Cb)({type:R.Z})],se.prototype,"spatialReference",void 0),(0,r._)([(0,b.Cb)({type:["local","global"]})],se.prototype,"viewingMode",null),(0,r._)([(0,b.Cb)({type:a.Z,json:{write:{isRequired:!0}}})],se.prototype,"viewpoint",void 0),(0,r._)([(0,b.Cb)(re.v)],se.prototype,"timeExtent",void 0),se=te=(0,r._)([(0,E.j)("esri.webscene.InitialViewProperties")],se);const ne=se;var oe,ae=i(60354),le=i(89125),de=i(54557),pe=i(14921),ue=i(16889),ce=i(25243),he=i(32035),ye=i(12400),ve=i(30651),me=i(93463),ge=i(26838),_e=i(18814),we=i(67808);let be=oe=class extends K.wq{constructor(){super(...arguments),this.text=""}clone(){return new oe({text:this.text})}};(0,r._)([(0,b.Cb)({type:String,json:{write:!0}})],be.prototype,"text",void 0),be=oe=(0,r._)([(0,E.j)("esri.webscene.support.Description")],be);const fe=be;var Ee,Te=i(3389),Se=i(50902),Ie=i(23548);let Ce=Ee=class extends K.wq{constructor(){super(...arguments),this.lighting=new _e.Z,this.weather=new Te.Z}clone(){return new Ee({lighting:(0,p.d9)(this.lighting),weather:(0,p.d9)(this.weather)})}};(0,r._)([(0,b.Cb)({types:Ie.j,json:{write:!0}})],Ce.prototype,"lighting",void 0),(0,r._)([(0,b.Cb)({types:Se.Hr,json:{write:!0}})],Ce.prototype,"weather",void 0),Ce=Ee=(0,r._)([(0,E.j)("esri.webscene.Environment")],Ce);var Ae,Le=i(62565),Re=i(81219);let Oe=Ae=class extends K.wq{constructor(){super(...arguments),this.opacity=null}clone(){return new Ae({opacity:this.opacity})}cloneAndApplyTo(e){var t,i;return null==this.opacity||((e=null!==(t=null===(i=e)||void 0===i?void 0:i.clone())&&void 0!==t?t:new Le.Z).opacity=this.opacity),e}static fromGround(e){return new Ae({opacity:e.opacity})}};(0,r._)([(0,b.Cb)({type:Number,json:{type:ce.z8,read:{reader:Re.b,source:"transparency"},write:{writer:(e,t)=>{t.transparency=(0,Re.a)(e)},target:"transparency"}}})],Oe.prototype,"opacity",void 0),Oe=Ae=(0,r._)([(0,E.j)("esri.webscene.support.SlideGround")],Oe);const Ne=Oe;var Pe;let Ue=Pe=class extends K.wq{constructor(e){super(e),this.id="",this.sublayerIds=null}clone(){return new Pe({id:this.id,sublayerIds:(0,p.d9)(this.sublayerIds)})}};var ke;(0,r._)([(0,b.Cb)({type:String,json:{write:!0}})],Ue.prototype,"id",void 0),(0,r._)([(0,b.Cb)({type:[ce.z8],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],Ue.prototype,"sublayerIds",void 0),Ue=Pe=(0,r._)([(0,E.j)("esri.webscene.support.SlideVisibleLayer")],Ue);let je=ke=class extends K.wq{constructor(){super(...arguments),this.text=""}clone(){return new ke({text:this.text})}};(0,r._)([(0,b.Cb)({type:String,json:{write:{isRequired:!0}}})],je.prototype,"text",void 0),je=ke=(0,r._)([(0,E.j)("esri.webscene.support.Title")],je);const Ze=je;let xe=0;const Fe=l.Z.ofType(Ue);let Me=class extends K.wq{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+xe++,this.title=new Ze,this.description=new fe,this.hidden=!1,this.thumbnail=new ge.A,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new Ce,this.timeExtent=null,this.visibleLayers=new Fe}destroy(){this.visibleLayers.removeAll(),this.basemap=null,this.thumbnail=(0,y.SC)(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return"string"==typeof e?new Ze({text:e}):(0,ce.se)(Ze,e)}castDescription(e){return"string"==typeof e?new fe({text:e}):(0,ce.se)(fe,e)}castThumbnail(e){return"string"==typeof e?new ge.A({url:e}):(0,ce.se)(ge.A,e)}castBasemap(e){return(0,x.se)(e)}set visibleLayers(e){this._set("visibleLayers",(0,ae.Z)(e,this._get("visibleLayers"),Fe))}castVisibleLayers(e){return e&&"function"==typeof e.map?e.map((e=>{if("string"==typeof e)return{id:e};if(e instanceof ve.Z){const t=Ge(e);return{id:e.id,sublayerIds:t}}return e.id?{id:e.id,sublayerIds:"sublayerIds"in e?e.sublayerIds:void 0}:(h.Z.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),e)})):null}clone(){var e,t,i,r;return new(0,this.constructor)({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:(null===(e=this.basemap)||void 0===e?void 0:e.clone())||null,ground:(null===(t=this.ground)||void 0===t?void 0:t.clone())||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null,hidden:this.hidden,timeExtent:null!==(i=null===(r=this.timeExtent)||void 0===r?void 0:r.clone())&&void 0!==i?i:null})}async _updateVisibleLayersFrom(e){const t=[];await Promise.allSettled(this._getLayers(e.map).map((i=>e.whenLayerView(i).then((e=>{if(e.visible){const r=Ge(i);t.push(new Ue({id:e.layer.id,sublayerIds:r}))}})))).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)}updateFrom(e,t){const i={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...null===t||void 0===t?void 0:t.screenshot};return e.when((()=>{var t,i;return this.viewpoint=e.viewpoint.clone(),this.environment.lighting="virtual"===e.environment.lighting.type?we.Z.prototype.clone.apply(e.environment.lighting):_e.Z.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?Ne.fromGround(e.map.ground):null,this.timeExtent=null!==(t=null===(i=e.timeExtent)||void 0===i?void 0:i.clone())&&void 0!==t?t:null,this._updateVisibleLayersFrom(e)})).then((()=>e.takeScreenshot(i))).then((e=>(this.thumbnail=new ge.A({url:e.dataUrl}),this)))}async applyTo(e,t){null!=this._applyToController&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const r=(0,g.$F)(t,(()=>{var e;return null===(e=i)||void 0===e?void 0:e.abort()})),s=()=>{this._applyToController===i&&(this._applyToController=null),i=null,null===r||void 0===r||r.remove()};try{await(0,_.whenOnce)((()=>e.ready),i.signal)}catch(Je){throw s(),Je}if(i.signal.aborted)throw s(),(0,g.zE)();const n=e.resourceController.scheduler.registerTask(me.T8.SLIDE);let o=!1;const a={animate:!0,...t,signal:this._applyToController.signal},l=await(0,pe.q6)(e.addUpdatingPromise((async()=>{await Promise.all([n.schedule((async()=>o=await this._setViewpointOfInterest(e,a))),n.schedule((()=>this._applyBasemap(e,a)),a.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([n.schedule((()=>this._applyLayerVisibility(e)),a.signal),n.schedule((()=>this._applyGround(e)),a.signal),n.schedule((()=>this._applyViewpoint(e,a)),a.signal),n.schedule((()=>{var t,i;return e.timeExtent=null!==(t=null===(i=this.timeExtent)||void 0===i?void 0:i.clone())&&void 0!==t?t:null}),a.signal)]),await n.schedule((()=>e.environment.weather=this.environment.weather.clone()))})()));if(o&&(e.contentCamera=null),n.remove(),s(),!1===l.ok)throw l.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(G){if((0,g.D_)(G))throw G}e.map.basemap=(0,x.Py)(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const t=new l.Z;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach((e=>{e.persistenceEnabled&&(t.add(e),"layers"in e&&this._collectLayers(e,t))}))}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map((e=>{var t;return(null===(t=this.visibleLayers.find((t=>t.id===e.id)))||void 0===t?void 0:t.sublayerIds)?e.load():null})))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach((e=>{const t=this.visibleLayers.find((t=>t.id===e.id));e.visible=null!=t;const i=null===t||void 0===t?void 0:t.sublayerIds,r=De(e);i&&r&&r.forEach((e=>e.visible=i.includes(e.id)))}))}async _setViewpointOfInterest(e,t){if(e.state.fixedContentCamera||!this.viewpoint||null!==t&&void 0!==t&&t.ignoreViewpoint||null===t||void 0===t||!t.useDestinationCamera)return!1;const{toCameraAsync:r}=await Promise.all([i.e(34470),i.e(89414),i.e(46316),i.e(90647),i.e(5508)]).then(i.bind(i,90647)),s=await r(e,this.viewpoint);return e.contentCamera=s,null!=s}async _applyViewpoint(e,t){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!t.ignoreViewpoint){null!=this.viewpoint.camera&&(this.viewpoint.camera.fov=e.camera.fov);const i=this.environment.lighting;if(t.animate&&"sun"===i.type&&i.date)return this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(i.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let i=null;return"virtual"!==e.environment.lighting.type&&"virtual"!==this.environment.lighting.type&&("global"===e.viewingMode&&(i=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,"virtual"===this.environment.lighting.type||"virtual"===e.environment.lighting.type?(e.environment.applyLighting(this.environment.lighting.clone()),"virtual"!==e.environment.lighting.type&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then((()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())})).catch((t=>{throw null==e.animation&&this._applyCachedCameraTrackingEnabled(e),t})).finally((()=>{(0,y.hw)(i)}))}_applyCachedCameraTrackingEnabled(e){null!=e.environment.cachedCameraTrackingEnabled&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,t,i){return e.setTime(t),e.setUTCHours(i/3600),e.setUTCMinutes(i%3600/60),e.setUTCSeconds(i%3600%60),e}_animateLightingWithCamera(e,t,i){const r=new Date(t.date.toString()),[s,n]=this._getTime(r),[o,a]=this._getTime(i.date),l=function(e,t){let i=t-e;return i>Be&&(i-=qe),i<-Be&&(i+=qe),i}(n,a),d=e.renderCoordsHelper,p=(0,ye.Ue)();d.toRenderCoords(e.camera.position,p);const u=(0,ye.Ue)(),c=(0,ye.Ue)();null!=this.viewpoint.camera&&d.toRenderCoords(this.viewpoint.camera.position,u);const h=new Date;return(0,_.when)((()=>e.camera),(e=>{d.toRenderCoords(e.position,c);const i=(0,he.a)(p,c),r=(0,he.a)(u,c);let a=0;i+r!==0&&(a=i/(i+r));const y=s+(o-s)*a,v=function(e,t){return(0,ue.HS)(e+t,qe)}(n,l*a);t.date=this._setTime(h,y,v)}))}static createFrom(e,t){return(new this).updateFrom(e,t)}};(0,r._)([(0,b.Cb)({type:String,json:{write:{isRequired:!0}}})],Me.prototype,"id",void 0),(0,r._)([(0,b.Cb)({type:Ze,json:{default:()=>new Ze({text:""}),write:{isRequired:!0}}})],Me.prototype,"title",void 0),(0,r._)([(0,le.p)("title")],Me.prototype,"castTitle",null),(0,r._)([(0,b.Cb)({type:fe,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],Me.prototype,"description",void 0),(0,r._)([(0,le.p)("description")],Me.prototype,"castDescription",null),(0,r._)([(0,b.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],Me.prototype,"hidden",void 0),(0,r._)([(0,b.Cb)({type:ge.A,json:{default:()=>new ge.A({url:""}),write:{isRequired:!0}}})],Me.prototype,"thumbnail",void 0),(0,r._)([(0,le.p)("thumbnail")],Me.prototype,"castThumbnail",null),(0,r._)([(0,b.Cb)({type:a.Z,nonNullable:!0,json:{write:{isRequired:!0}}})],Me.prototype,"viewpoint",void 0),(0,r._)([(0,b.Cb)({type:de.default,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Me.prototype,"basemap",void 0),(0,r._)([(0,le.p)("basemap")],Me.prototype,"castBasemap",null),(0,r._)([(0,b.Cb)({type:Ne,json:{write:!0}})],Me.prototype,"ground",void 0),(0,r._)([(0,b.Cb)({type:Fe,json:{write:{isRequired:!0}}})],Me.prototype,"visibleLayers",null),(0,r._)([(0,le.p)("visibleLayers")],Me.prototype,"castVisibleLayers",null),(0,r._)([(0,b.Cb)({type:Ce,json:{write:!0}})],Me.prototype,"environment",void 0),(0,r._)([(0,b.Cb)(re.v)],Me.prototype,"timeExtent",void 0),Me=(0,r._)([(0,E.j)("esri.webscene.Slide")],Me);const Ve=Me;function De(e){if("building-scene"===e.type||"map-image"===e.type)return e.allSublayers.toArray()}function Ge(e){const t=De(e);if(t)return t.filter((e=>e.visible)).map((e=>e.id))}const qe=86400,Be=43200;const He=l.Z.ofType(Ve);let We=class extends K.wq{constructor(e){super(e),this.slides=new He}destroy(){this.slides.forEach((e=>e.destroy())),this.slides.removeAll()}set slides(e){e&&(e=e.filter((e=>!!e.viewpoint))),this._set("slides",(0,ae.Z)(e,this._get("slides"),He))}clone(){return new(0,this.constructor)({slides:this.slides.clone()})}};(0,r._)([(0,b.Cb)({type:He,nonNullable:!0,json:{write:!0}}),(0,le.p)(ae.R)],We.prototype,"slides",null),We=(0,r._)([(0,E.j)("esri.webscene.Presentation")],We);const Je=We;var Qe;let Ye=Qe=class extends K.wq{constructor(e){super(e)}clone(){return new Qe({name:this.name,path:this.path,title:this.title})}};(0,r._)([(0,b.Cb)({type:String,json:{write:!0}})],Ye.prototype,"name",void 0),(0,r._)([(0,b.Cb)({type:String,json:{write:!0}})],Ye.prototype,"path",void 0),(0,r._)([(0,b.Cb)({type:String,json:{write:!0}})],Ye.prototype,"title",void 0),Ye=Qe=(0,r._)([(0,E.j)("esri.webscene.TransportationNetwork")],Ye);const ze=Ye;var Ke=i(49901);class $e extends Ke.G{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}let Xe=null;var et;const tt=new $e(1,34),it="Web Scene";let rt=class extends(u.Z.LoadableMixin((0,m.v)((0,v.R)(n.Z)))){constructor(e){super(e),this[et]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new Je,this.initialViewProperties=new ne,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=(0,g.Ds)((async(e,t,i)=>{switch(e){case H.x.SAVE:return this._saveImpl(t);case H.x.SAVE_AS:return this._saveAsImpl(i,t)}})),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch((e=>{h.Z.getLogger(this).error("#load()","Failed to load web scene",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(oe){return void this.addResolvingPromise(Promise.reject(oe))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles((0,_.on)((()=>this.allLayers),"change",(()=>this._scheduleLayersIdGC())))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=(0,y.SC)(this.portalItem)}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,i,r){t[i]=this._layersToJSON(e,"operational-layers",r)}readSourceVersion(e,t){const[i,r]=t.version.split(".");return new $e(parseInt(i,10),parseInt(r,10))}writeSourceVersion(e,t,i){t[i]="".concat(tt.major,".").concat(tt.minor)}writeTables(e,t,i,r){const s=this._layersToJSON(e,"tables",r);s.length&&(t[i]=s)}get thumbnailUrl(){var e,t;return null!==(e=null===(t=this.portalItem)||void 0===t?void 0:t.thumbnailUrl)&&void 0!==e?e:null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=s.i8}writeGround(e,t,i,r){t[i]=e?e.write({},r):{transparency:0,layers:[]}}readInitialViewProperties(e,t){var i,r,s,n;const l={};null!==(i=t.initialState)&&void 0!==i&&i.environment&&(l.environment=ie.Z.fromJSON(t.initialState.environment)),l.spatialReference=t.spatialReference?R.Z.fromJSON(t.spatialReference):R.Z.WebMercator,l.viewingMode=null!==(r=t.viewingMode)&&void 0!==r?r:"global",(null===(s=t.initialState)||void 0===s?void 0:s.viewpoint)&&(l.viewpoint=a.Z.fromJSON(t.initialState.viewpoint));const d=null===(n=t.initialState)||void 0===n?void 0:n.timeExtent;return null!=d&&(l.timeExtent=o.Z.fromArray(d)),new ne(l)}get spatialReference(){var e,t;return null!==(e=null===(t=this.initialViewProperties)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:R.Z.WebMercator}get viewingMode(){var e,t;return null!==(e=null===(t=this.initialViewProperties)||void 0===t?void 0:t.viewingMode)&&void 0!==e?e:"global"}load(e){const t=this.ground;return this.addResolvingPromise(this._loadFromSource().then((()=>{t&&t!==this.ground&&t.destroy()}))),Promise.resolve(this)}loadAll(){return(0,c.G)(this,(e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map((e=>e.basemap)),this.tables)}))}read(e,t){var i;t={...t,origin:"web-scene"};const r=this._isAuthoringAppVersionSetByUser,s=this._isAuthoringAppSetByUser;if((0,I.$)(this,e,(t=>super.read(e,t)),t),s||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&null!==(i=this.sourceVersion)&&void 0!==i&&i.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map((e=>({id:e.id}))),i=this.presentation.slides,r=(e,t)=>e.visibleLayers.some((e=>e.id===t)),s=t.filter((e=>!i.some((t=>r(t,e.id)))));i.forEach((e=>{e.visibleLayers.addMany(s)}))}}_writeBasemapElevationLayers(e){var t;const i=null===(t=e.ground)||void 0===t?void 0:t.layers;!e.baseMap&&null!==i&&void 0!==i&&i.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=(0,p.d9)(i))}_layersToJSON(e,t,i){const r={...i,layerContainerType:t};return e.map((e=>this._verifyWritableLayer(e,i)?e.write({},r):null)).filter((e=>!!e)).toArray()}_verifyWritableLayer(e,t){return!!e.persistenceEnabled&&("write"in e||(null!==t&&void 0!==t&&t.messages&&t.messages.push(new d.Z("layer:unsupported","Layers (".concat(e.title,", ").concat(e.id,") of type '").concat(e.declaredClass,"' cannot be persisted in web scenes"),{layer:e})),!1))}write(e,t){var i;if("loaded"!==this.loadStatus){const e=new d.Z("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw h.Z.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const r=!(null!==(i=t)&&void 0!==i&&i.messages);t={messages:[],...t,origin:"web-scene"};const s=super.write(e,t);if(r){var n,o;const e=null!==(n=null===(o=t.messages)||void 0===o?void 0:o.filter((e=>"web-document-write:property-required"===e.name)))&&void 0!==n?n:[];if(e.length){const t=new d.Z("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw h.Z.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(s),s}async save(e){return this._debouncedSaveOperations(H.x.SAVE,e)}async _saveImpl(e){var t;if(!this.portalItem)throw new d.Z("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if((0,Q.w)(this.portalItem),(null===(t=this.portalItem)||void 0===t?void 0:t.type)!==it)throw new d.Z("webscene:portal-item-wrong-type",'Portal item needs to have type "'.concat(it,'"'));const i=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls((0,j.Y)(this.portalItem,"web-scene",!0)),s=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(s,r,e),this._updateTypeKeywords(this.portalItem),await(0,J.b)(this.portalItem,s,this._resourceReferences,r),(0,S.D)(r),i&&await i,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(H.x.SAVE_AS,t,e)}async _saveAsImpl(e,t){let i=k.default.from(e);if(!i)throw new d.Z("webscene:portal-item-required","saveAs requires a portal item to save to");(0,Q.w)(i),i.id&&(i=i.clone(),i.id=null);const r=i.portal||U.Z.getDefault();await this._ensureLoadBeforeSave(),i.type=it,i.portal=r;const s=this._enableVerifyItemRelativeUrls((0,j.Y)(i,"web-scene",!0)),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const o=this.thumbnailUrl,a=!this._isOverridden("thumbnailUrl");if(this._updateTypeKeywords(i),await r.signIn(),!r.user)throw new d.Z("webscene:user-not-signed-in","saveAs requires a user to be signed in to the portal");return await r.user.addItem({item:i,folder:null===t||void 0===t?void 0:t.folder,data:n}),await(0,J.H)(this._resourceReferences,s),this.portalItem=i,v.w.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl?(0,w.mN)(i.itemUrl):void 0}),(0,S.D)(s),o&&(this.thumbnailUrl=a?(0,w.ZN)(o,"w","8192"):o),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await(null===(e=this.portalItem)||void 0===e?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(0,P.N$)(this.spatialReference))throw new d.Z("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:n,strictSchemaValidationEnabled:o}=i||{};(0,Y.z)(t,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:n});const a=Xe;if(o&&a){const t=(await a()).validate(e);if(!t.length)return;const i="webscene did not validate:\n".concat(t.join("\n"));h.Z.getLogger(this).error("".concat(r?"saveAs":"save","(): ").concat(i));const s=t.map((e=>new d.Z("webscene:schema-validation",e)));throw D(s)}}_verifySaveAs(e,t,i){return this.canNotSaveAs(t)?Promise.reject(V()):this._verifySave(e,t,i,!0)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},t);return this._verifySaveAs(i,t,e)}canNotSaveAs(e){var t,i;return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(null!==(t=null===(i=e.verifyItemRelativeUrls)||void 0===i||null===(i=i.writtenUrls)||void 0===i?void 0:i.length)&&void 0!==t?t:0)>0}async updateFrom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this._updateFrom(e,t);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(e){var t,i,r;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(await e.whenReady(),!s.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=ie.Z.prototype.clone.apply(e.environment)),!s.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=null!==(t=null===(i=e.timeExtent)||void 0===i?void 0:i.clone())&&void 0!==t?t:null,null!=e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const n of e.allLayerViews){const e="visible";e in n&&e in n.layer&&n._isOverridden(e)&&(n.layer[e]=n[e])}if(!s.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this);(!1===s.thumbnailExcluded||null==s.thumbnailExcluded&&!s.viewpointExcluded)&&await this._updateFromThumbnail(e,null!==(r=s.thumbnailSize)&&void 0!==r?r:void 0)}async _updateFromThumbnail(e,t){const i=(0,z.w)(e,t),r=await e.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=r.dataUrl}_loadFromSource(){var e;return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):null!==(e=this.portalItem)&&void 0!==e&&e.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,t){const i=this._validateJSON(e);return this.read(i,t),this._loadFromJSON(i,t)}_extractOperationalLayers(e){var t;const i=[];if((null===(t=this.sourceVersion)||void 0===t||!t.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const n of e.baseMap.elevationLayers)i.push(n);const r=[],s=e=>{var t;return e.layers&&(e.layers=e.layers.filter(s)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(null!==(t=this.sourceVersion)&&void 0!==t&&t.supportsGround||r.push(e),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(s):[],operationalElevationLayers:r,basemapElevationLayers:i}}async _loadFromJSON(e,t){var r;const s=new l.Z;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:n}=await Promise.all([i.e(43139),i.e(20519)]).then(i.bind(i,20519)),{operationalLayers:o,operationalElevationLayers:a,basemapElevationLayers:d}=this._extractOperationalLayers(e),p=[],u={context:{...t,layerContainerType:"operational-layers"}};if(this.portalItem&&(u.context.portal=this.portalItem.portal||U.Z.getDefault()),d.length>0){const e={...u,context:{...u.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(n(this.ground.layers,d,e))}if(a.length>0){const e={...u,context:{...u.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",p.push(n(s,a,e))}o&&o.length>0&&p.push(n(this.layers,o,u)),null!==(r=e.tables)&&void 0!==r&&r.length&&p.push(n(this.tables,e.tables,{...u,context:{...u.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(p),await this._loadObjectsWithLayers(),this.ground.layers.addMany(s.filter((e=>"base-elevation"===e.type||"elevation"===e.type)))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],t=[...this.allLayers.items];for(const{basemap:i}of this.presentation.slides.items)i&&(t.push(...i.baseLayers.items),t.push(...i.referenceLayers.items));for(const i of t)if("beforeSave"in i&&"function"==typeof i.beforeSave){const t=i.beforeSave();t&&e.push(t)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach((t=>{t.basemap&&e.push(t.basemap.load())})),await Promise.allSettled(e)}async _loadFromItem(e){var t;if(await e.load().catch((e=>{throw new d.Z("webscene:load-portal-item","Failed to load portal item",{error:e})})),"Web Scene"!==e.type)throw new d.Z("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const i=await e.fetchData();this.resourceInfo=i;const r={origin:"web-scene",url:(0,w.mN)(e.itemUrl),portal:e.portal||U.Z.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(i,r),this._resourceReferences={portalItem:e,paths:null!==(t=r.readResourcePaths)&&void 0!==t?t:[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let i;if("local"!==e.viewingMode){if(!(0,B.D)(t,q.JY.Global))return Promise.reject(new d.Z("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=e=>!e||(0,L.canProjectWithoutEngine)(e,t)}else{if(!(0,B.D)(t,q.JY.Local))return Promise.reject(new d.Z("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));i=e=>!e||e.equals(t)}const r=e=>{var t,i,r;return null!==(t=null===e||void 0===e||null===(i=e.camera)||void 0===i?void 0:i.position.spatialReference)&&void 0!==t?t:null===e||void 0===e||null===(r=e.targetGeometry)||void 0===r?void 0:r.spatialReference},s=e.viewpoint,n=r(s);if(n&&!i(n))return Promise.reject(new d.Z("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const o=this.presentation.slides.find((e=>!i(r(e.viewpoint))));if(o){const i=r(o.viewpoint);return Promise.reject(new d.Z("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:i,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=(0,O.vu)(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateJSON(e){const t=$e.parse(e.version||"","webscene");return tt.validate(t),e.version="".concat(t.major,".").concat(t.minor),1===t.major&&t.minor<=2&&(e.spatialReference=R.Z.WebMercator.toJSON()),e}_updateTypeKeywords(e){(0,Z.IW)(e,Z.hz.LOCAL_SCENE,"local"===this.initialViewProperties.viewingMode),(0,Z.IW)(e,Z.hz.DEVELOPER_BASEMAP,(0,x.zb)(this.basemap)||this.presentation.slides.some((e=>{let{basemap:t}=e;return!!t&&(0,x.zb)(t)}))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,i)=>i.indexOf(e)===t)))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||R.Z.WebMercator}get _verifyItemRelativeRootPath(){var e;return null!==(e=this.portalItem)&&void 0!==e&&e.itemUrl?(0,w.mN)(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout((()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()}),3e3)}_runLayersIdGC(){var e;this._unscheduleLayersIdGC();const t=null===(e=this.applicationProperties)||void 0===e||null===(e=e.viewing)||void 0===e?void 0:e.search,i=e=>this.allLayers.some((t=>t.id===e&&t.persistenceEnabled));(null===t||void 0===t?void 0:t.layers)&&(t.layers=t.layers.filter((e=>i(e.id))));const r=this.presentation&&this.presentation.slides;r&&r.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>i(e.id))))}))}static fromJSON(e){if(!e)throw new d.Z("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};et=M.x,rt.version="".concat(tt.major,".").concat(tt.minor),(0,r._)([(0,b.Cb)({type:ee,json:{write:!0}})],rt.prototype,"applicationProperties",void 0),(0,r._)([(0,b.Cb)({type:C.Z,json:{read:{source:"clippingArea.geometry",reader:N.im},write:{target:"clippingArea.geometry"}}})],rt.prototype,"clippingArea",void 0),(0,r._)([(0,T.c)("clippingArea")],rt.prototype,"writeClippingArea",null),(0,r._)([(0,b.Cb)({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],rt.prototype,"clippingEnabled",void 0),(0,r._)([(0,f.r)("clippingEnabled",["clippingArea"])],rt.prototype,"readClippingEnabled",null),(0,r._)([(0,T.c)("clippingEnabled")],rt.prototype,"writeClippingEnabled",null),(0,r._)([(0,b.Cb)({type:F.Z,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],rt.prototype,"floorInfo",void 0),(0,r._)([(0,b.Cb)({type:A.Z,json:{write:!0}})],rt.prototype,"heightModelInfo",void 0),(0,r._)([(0,b.Cb)({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],rt.prototype,"layers",void 0),(0,r._)([(0,T.c)("layers")],rt.prototype,"writeLayers",null),(0,r._)([(0,b.Cb)({readOnly:!0,type:$e,json:{type:(()=>{const e=[],t=tt.major;for(let i=8;i<=tt.minor;i++)e.push("".concat(t,".").concat(i));return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],rt.prototype,"sourceVersion",void 0),(0,r._)([(0,f.r)("sourceVersion",["version"])],rt.prototype,"readSourceVersion",null),(0,r._)([(0,T.c)("sourceVersion")],rt.prototype,"writeSourceVersion",null),(0,r._)([(0,b.Cb)({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],rt.prototype,"tables",void 0),(0,r._)([(0,T.c)("tables")],rt.prototype,"writeTables",null),(0,r._)([(0,b.Cb)()],rt.prototype,"thumbnailUrl",null),(0,r._)([(0,b.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],rt.prototype,"authoringApp",null),(0,r._)([(0,T.c)("authoringApp")],rt.prototype,"writeAuthoringApp",null),(0,r._)([(0,b.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],rt.prototype,"authoringAppVersion",null),(0,r._)([(0,T.c)("authoringAppVersion")],rt.prototype,"writeAuthoringAppVersion",null),(0,r._)([(0,b.Cb)({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],rt.prototype,"ground",void 0),(0,r._)([(0,T.c)("ground")],rt.prototype,"writeGround",null),(0,r._)([(0,b.Cb)({type:l.Z.ofType(ze),json:{write:!0}})],rt.prototype,"transportationNetworks",void 0),(0,r._)([(0,b.Cb)({type:Je,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,i,r)=>{if(e.slides&&e.slides.length>0){const i={...r,isPresentation:!0};t.presentation=e.write({},i)}}}}})],rt.prototype,"presentation",void 0),(0,r._)([(0,b.Cb)({type:ne,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new ne({viewingMode:"global",spatialReference:R.Z.WebMercator})}})],rt.prototype,"initialViewProperties",void 0),(0,r._)([(0,f.r)("initialViewProperties",["initialState.timeExtent","initialState.environment","initialState.viewpoint","spatialReference","viewingMode"])],rt.prototype,"readInitialViewProperties",null),(0,r._)([(0,b.Cb)({type:R.Z,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],rt.prototype,"spatialReference",null),(0,r._)([(0,b.Cb)({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],rt.prototype,"viewingMode",null),(0,r._)([(0,b.Cb)({type:k.default})],rt.prototype,"portalItem",void 0),(0,r._)([(0,b.Cb)()],rt.prototype,"resourceInfo",void 0),(0,r._)([(0,b.Cb)({type:W.Z,json:{write:!0}})],rt.prototype,"widgets",void 0),rt=(0,r._)([(0,E.j)("esri.WebScene")],rt);const st=rt},15909:(e,t,i)=>{i.d(t,{D:()=>s});var r=i(80292);function s(e){(null===e||void 0===e?void 0:e.writtenProperties)&&e.writtenProperties.forEach((e=>{let{target:t,propName:i,newOrigin:s}=e;(0,r.l)(t)&&s&&t.originOf(i)!==s&&t.updateOrigin(i,s)}))}},80292:(e,t,i)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>r})},41388:(e,t,i)=>{i.d(t,{b:()=>o});var r=i(66978),s=i(76432),n=i(73553);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,s.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return++this._runningTasks.value,new Promise(((r,s)=>this._tasks.push(new a(r,s,e,t,i)))).finally((()=>--this._runningTasks.value))}unshift(e,t,i){return++this._runningTasks.value,new Promise(((r,s)=>this._tasks.unshift(new a(r,s,e,t,i)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const s=(0,r.Hc)(t.signal);if(s&&!t.abortCallback)t.reject((0,r.zE)());else{var i;const n=s?null===(i=t.abortCallback)||void 0===i?void 0:i.call(t,(0,r.zE)()):t.callback(e);(0,r.y8)(n)?n.then(t.resolve,t.reject):t.resolve(n)}}catch(o){t.reject(o)}return!0}cancelAll(){const e=(0,r.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=s}}},62078:(e,t,i)=>{i.d(t,{FO:()=>c,W7:()=>h,addOrUpdateResources:()=>a,fetchResources:()=>o,removeAllResources:()=>d,removeResource:()=>l});var r=i(76200),s=i(10064),n=i(35995);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;await e.load(i);const r=(0,n.v_)(e.itemUrl,"resources"),{start:s=1,num:o=10,sortOrder:a="asc",sortField:l="resource"}=t,d={query:{start:s,num:o,sortOrder:a,sortField:l,token:e.apiKey},signal:null===i||void 0===i?void 0:i.signal},p=await e.portal.request(r,d);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((t=>{let{created:i,size:r,resource:s}=t;return{created:new Date(i),size:r,resource:e.resourceFromPath(s)}}))}}async function a(e,t,i,r){const o=new Map;for(const{resource:n,content:l,compress:d,access:u}of t){if(!n.hasPath())throw new s.Z("portal-item-resource-".concat(i,":invalid-path"),"Resource does not have a valid path");const[e,t]=p(n.path),r="".concat(e,"/").concat(null!==d&&void 0!==d?d:"","/").concat(null!==u&&void 0!==u?u:"");o.has(r)||o.set(r,{prefix:e,compress:d,access:u,files:[]}),o.get(r).files.push({fileName:t,content:l})}await e.load(r);const a=(0,n.v_)(e.userItemUrl,"add"===i?"addResources":"updateResources");for(const{prefix:s,compress:n,access:l,files:d}of o.values()){const t=25;for(let i=0;i<d.length;i+=t){const o=d.slice(i,i+t),p=new FormData;s&&"."!==s&&p.append("resourcesPrefix",s),n&&p.append("compress","true"),l&&p.append("access",l);let u=0;for(const{fileName:e,content:t}of o)p.append("file"+ ++u,t,e);p.append("f","json"),await e.portal.request(a,{method:"post",body:p,signal:null===r||void 0===r?void 0:r.signal})}}}async function l(e,t,i){if(!t.hasPath())throw new s.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=(0,n.v_)(e.userItemUrl,"removeResources");await e.portal.request(r,{method:"post",query:{resource:t.path},signal:null===i||void 0===i?void 0:i.signal}),t.portalItem=null}async function d(e,t){await e.load(t);const i=(0,n.v_)(e.userItemUrl,"removeResources");return e.portal.request(i,{method:"post",query:{deleteAll:!0},signal:null===t||void 0===t?void 0:t.signal})}function p(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function u(e){const[t,i]=function(e){const t=(0,n.Ml)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),".".concat(t)]}(e),[r,s]=p(t);return[r,s,i]}async function c(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,r.Z)(e.url,{responseType:"blob"})).data}function h(e,t){if(!e.hasPath())return null;const[i,,r]=u(e.path);return e.portalItem.resourceFromPath((0,n.v_)(i,t+r))}},83217:(e,t,i)=>{i.d(t,{x:()=>r});const r=Symbol("WebScene")},90868:(e,t,i)=>{i.d(t,{Z:()=>p});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912);let d=r=class extends n.wq{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,s._)([(0,a.J)({cloudy:"cloudy"})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=r=(0,s._)([(0,l.j)("esri.views.3d.environment.CloudyWeather")],d);const p=d},89110:(e,t,i)=>{i.d(t,{Z:()=>p});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912);let d=r=class extends n.wq{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new r({fogStrength:this.fogStrength})}};(0,s._)([(0,a.J)({foggy:"foggy"})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"fogStrength",void 0),d=r=(0,s._)([(0,l.j)("esri.views.3d.environment.FoggyWeather")],d);const p=d},61052:(e,t,i)=>{i.d(t,{Z:()=>p});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912);let d=r=class extends n.wq{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new r({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,s._)([(0,a.J)({rainy:"rainy"})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),d=r=(0,s._)([(0,l.j)("esri.views.3d.environment.RainyWeather")],d);const p=d},37063:(e,t,i)=>{i.d(t,{Z:()=>p});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912);let d=r=class extends n.wq{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new r({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,s._)([(0,a.J)({snowy:"snowy"})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"precipitation",void 0),(0,s._)([(0,o.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],d.prototype,"snowCover",void 0),d=r=(0,s._)([(0,l.j)("esri.views.3d.environment.SnowyWeather")],d);const p=d},3389:(e,t,i)=>{i.d(t,{Z:()=>p});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912);let d=r=class extends n.wq{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,s._)([(0,a.J)({sunny:"sunny"})],d.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d.prototype,"cloudCover",void 0),d=r=(0,s._)([(0,l.j)("esri.views.3d.environment.SunnyWeather")],d);const p=d},50902:(e,t,i)=>{i.d(t,{$T:()=>c,Hr:()=>l,T$:()=>d,b8:()=>p,nq:()=>u});var r=i(90868),s=i(89110),n=i(61052),o=i(37063),a=i(3389);const l={key:"type",base:a.Z,typeMap:{sunny:a.Z,cloudy:r.Z,rainy:n.Z,snowy:o.Z,foggy:s.Z}},d=Object.keys(l.typeMap);function p(e,t){return!!d.includes(e)||(t.error('"'.concat(e,'" is not a valid weather type')),!1)}const u=1e4,c=1e5},75248:(e,t,i)=>{var r;i.d(t,{n:()=>r}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(r||(r={}))},93463:(e,t,i)=>{i.d(t,{G5:()=>L,T8:()=>r,sq:()=>R,z4:()=>_});var r,s,n=i(100),o=(i(93169),i(32718)),a=i(92026),l=i(90941),d=i(27546),p=i(66978),u=i(94172),c=i(76432),h=i(38499),y=i(41388),v=i(32609),m=i(75248),g=i(73553);function _(){return new C.Scheduler}(s=r||(r={})).RESOURCE_CONTROLLER_IMMEDIATE="immediate",s.RESOURCE_CONTROLLER="schedule",s.SLIDE="slide",s.STREAM_DATA_LOADER="stream loader",s.ELEVATION_QUERY="elevation query",s.TERRAIN_SURFACE="terrain",s.SURFACE_GEOMETRY_UPDATES="surface geometry updates",s.LOD_RENDERER="LoD renderer",s.GRAPHICS_CORE="Graphics3D",s.I3S_CONTROLLER="I3S",s.POINT_CLOUD_LAYER="point cloud",s.FEATURE_TILE_FETCHER="feature fetcher",s.OVERLAY="overlay",s.STAGE="stage",s.GRAPHICS_DECONFLICTOR="graphics deconflictor",s.FILTER_VISIBILITY="Graphics3D filter visibility",s.SCALE_VISIBILITY="Graphics3D scale visibility",s.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",s.POINT_OF_INTEREST_FREQUENT="POI frequent",s.POINT_OF_INTEREST_INFREQUENT="POI infrequent",s.LABELER="labeler",s.FEATURE_QUERY_ENGINE="feature query",s.FEATURE_TILE_TREE="feature tile tree",s.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",s.ELEVATION_ALIGNMENT="elevation alignment",s.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",s.TEXT_TEXTURE_ATLAS="text texture atlas",s.TEXTURE_UNLOAD="texture unload",s.LINE_OF_SIGHT_TOOL="line of sight tool",s.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",s.ELEVATION_PROFILE="elevation profile",s.SNAPPING="snapping",s.SHADOW_ACCUMULATOR="shadow accumulator",s.CLOUDS_GENERATOR="clouds generator",s[s.NONE=0]="NONE",s[s.TEST_PRIO=1]="TEST_PRIO";const w=new Map([[r.RESOURCE_CONTROLLER_IMMEDIATE,0],[r.RESOURCE_CONTROLLER,4],[r.SLIDE,0],[r.STREAM_DATA_LOADER,0],[r.ELEVATION_QUERY,0],[r.TERRAIN_SURFACE,1],[r.SURFACE_GEOMETRY_UPDATES,1],[r.LOD_RENDERER,2],[r.GRAPHICS_CORE,2],[r.I3S_CONTROLLER,2],[r.POINT_CLOUD_LAYER,2],[r.FEATURE_TILE_FETCHER,2],[r.OVERLAY,4],[r.STAGE,4],[r.GRAPHICS_DECONFLICTOR,4],[r.FILTER_VISIBILITY,4],[r.SCALE_VISIBILITY,4],[r.FRUSTUM_VISIBILITY,4],[r.CLOUDS_GENERATOR,4],[r.POINT_OF_INTEREST_FREQUENT,6],[r.POINT_OF_INTEREST_INFREQUENT,30],[r.LABELER,8],[r.FEATURE_QUERY_ENGINE,8],[r.FEATURE_TILE_TREE,16],[r.FEATURE_TILE_TREE_ACTIVE,0],[r.ELEVATION_ALIGNMENT,12],[r.ELEVATION_ALIGNMENT_SCENE,14],[r.TEXT_TEXTURE_ATLAS,12],[r.TEXTURE_UNLOAD,12],[r.LINE_OF_SIGHT_TOOL,16],[r.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[r.SNAPPING,0],[r.SHADOW_ACCUMULATOR,30]]);function b(e){return w.has(e)?w.get(e):"number"==typeof e?e:1}const f=(0,h.HA)(6.5),E=(0,h.HA)(1),T=(0,h.HA)(30),S=(0,h.HA)(1e3/30),I=(0,h.HA)(100);var C,A;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,c.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new l.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=m.n.INTERACTING,this._tasks=new d.Z,this._runQueue=new d.Z,this._load=0,this._idleStateCallbacks=new d.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.watch)((()=>v.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.initial);for(const e of Object.keys(r))this.performanceInfo.tasks.set(r[e],new l.Z(r[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,i){const r=new t(this,e,i);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.Z(e)),r}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===m.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===m.n.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==m.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=f,i=e.frameDuration,r=E;switch(this.state){case m.n.IDLE:t=(0,h.HA)(0),i=(0,h.HA)(Math.max(I,e.frameDuration)),r=T;break;case m.n.INTERACTING:i=(0,h.HA)(Math.max(S,e.frameDuration));case m.n.ANIMATING:}return i=(0,h.HA)(i-e.elapsedFrameTime-t),this.state!==m.n.IDLE&&i<E&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,h.HA)(Math.max(i,r)),this._budget.reset(i,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case m.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case m.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,h.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return A.SCHEDULED;let t=A.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=A.READY:t!==A.READY&&(t=A.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?" ".concat(e,"x ").concat(i):" ".concat(i)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),s=this._runQueue.pop();this._budget.resetProgress();try{s.task.runTask(this._budget)===g.J&&(s.blockFrame=this._frameNumber)}catch(t){o.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(s.name,'"'),t),s.blockFrame=this._frameNumber}!this._budget.hasProgressed&&s.blockFrame!==this._frameNumber&&s.needsUpdate&&(s.name,r.I3S_CONTROLLER,s.blockFrame=this._frameNumber),s.schedulePriority=s.basePriority;const n=this._budget.now()-i;if(s.runtime+=n,this._frameTaskTimes.set(s.priority,this._frameTaskTimes.get(s.priority)+n),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(r))this._frameTaskTimes.set(r[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new y.b,this._handles=new n.Z,this._basePriority=b(t),this.schedulePriority=this._basePriority,this._task=(0,c.t)(null!=i?i:this._queue),this._handles.add((0,u.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(L),this._scheduler.removeTask(this),this.schedule=R.schedule,this.reschedule=R.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){return this._queue.runTask(e)}}class i{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=m.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i}(C||(C={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(A||(A={}));const L=(()=>{const e=new C.Budget;return e.enabled=!1,e})();const R=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,p.Hc)(t)){const e=(0,p.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,p.gx)(e(L))}catch(r){return Promise.reject(r)}}reschedule(e,t,i){return this.schedule(e,t,i)}}},73553:(e,t,i)=>{i.d(t,{J:()=>r});const r=Symbol("Yield")},32609:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(27366),s=i(7138),n=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends s.default{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r._)([(0,n.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r._)([(0,n.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,r._)([(0,o.j)("esri.views.support.debugFlags")],a);const l=new a},40739:(e,t,i)=>{i.d(t,{H:()=>a,b:()=>l});var r=i(10064),s=i(66978),n=i(71907),o=i(62078);async function a(e,t,i){const r=await d(e,t,i);await p(r,t,i)}async function l(e,t,i,r,s){const n=await d(i,r,s);await e.update({data:t}),await p(n,r,s)}async function d(e,t,a){if(null===t||void 0===t||!t.resources)return;const l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const d=new Set(t.resources.toKeep.map((e=>e.resource.path))),p=new Set,u=[];d.forEach((t=>{l.delete(t),e.paths.push(t)}));const c=[],h=[],y=[];for(const i of t.resources.toUpdate)if(l.delete(i.resource.path),d.has(i.resource.path)||p.has(i.resource.path)){const{resource:t,content:r,finish:s}=i,a=(0,o.W7)(t,(0,n.DO)());e.paths.push(a.path),c.push({resource:a,content:await(0,o.FO)(r),compress:i.compress}),s&&y.push((()=>s(a)))}else{e.paths.push(i.resource.path),h.push({resource:i.resource,content:await(0,o.FO)(i.content),compress:i.compress});const t=i.finish;t&&y.push((()=>t(i.resource))),p.add(i.resource.path)}for(const i of t.resources.toAdd)if(e.paths.push(i.resource.path),l.has(i.resource.path))l.delete(i.resource.path);else{c.push({resource:i.resource,content:await(0,o.FO)(i.content),compress:i.compress});const e=i.finish;e&&y.push((()=>e(i.resource)))}if(c.length||h.length){const{addOrUpdateResources:e}=await Promise.resolve().then(i.bind(i,62078));await e(t.portalItem,c,"add",a),await e(t.portalItem,h,"update",a)}if(y.forEach((e=>e())),0===u.length)return l;const v=await(0,s.UO)(u);if((0,s.k_)(a),v.length>0)throw new r.Z("save:resources","Failed to save one or more resources",{errors:v});return l}async function p(e,t,i){if(!e||!t.portalItem)return;const r=[];for(const s of e){const e=t.portalItem.resourceFromPath(s);r.push(e.portalItem.removeResource(e,i))}await(0,s.as)(r)}},76926:(e,t,i)=>{i.d(t,{w:()=>o});var r=i(42265),s=i(10064),n=i(66660);function o(e){if(r.default.apiKey&&(0,n.r)(e.portal.url))throw new s.Z("save-api-key-utils:api-key-not-supported","Saving is not supported on ".concat(e.portal.url," when using an api key"))}},9634:(e,t,i)=>{i.d(t,{P:()=>s,z:()=>o});var r=i(10064);async function s(e){const t=[];for(const i of e.allLayers)if("beforeSave"in i&&"function"==typeof i.beforeSave){const e=i.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function o(e,t,i){var s;let o=(null!==(s=e.messages)&&void 0!==s?s:[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:i,details:s}=e;return new r.Z(t,i,s)}));if(e.blockedRelativeUrls&&(o=o.concat(e.blockedRelativeUrls.map((e=>new r.Z("url:unsupported","Relative url '".concat(e,"' is not supported")))))),i){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=i;e&&(o=o.filter((e=>{let{name:i}=e;return!(n.has(i)||t.includes(i))}))),r&&(o=o.filter((e=>"web-document-write:property-required"!==e.name)))}if(o.length>0)throw new r.Z(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:o})}},21147:(e,t,i)=>{i.d(t,{Z:()=>E});var r=i(27366),s=i(46784),n=i(84652),o=i(32718),a=i(49861),l=(i(93169),i(69912)),d=i(3389),p=i(50902),u=i(23548),c=i(18814),h=i(67808),y=i(2581),v=i(13910);const m={base:y.Z,key:"type",typeMap:{color:v.Z}};const g={types:m,json:{read:(_=m,(e,t,i)=>{if(!e)return e;for(const r in _.typeMap)if(e.type===r){const t=new _.typeMap[r];return t.read(e,i),t}}),write:{overridePolicy:(e,t,i)=>({enabled:!(null!==i&&void 0!==i&&i.isPresentation)})}}};var _,w;const b=(e,t,i)=>({enabled:!(null!==i&&void 0!==i&&i.isPresentation)});let f=w=class extends s.wq{constructor(e){super(e),this.lighting=new c.Z,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){(0,p.b8)(null===e||void 0===e?void 0:e.type,o.Z.getLogger(this))&&this._set("weather",e)}clone(){return new w(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?h.Z.prototype.clone.call(this.lighting):c.Z.prototype.clone.call(this.lighting),background:(0,n.d9)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,r._)([(0,a.Cb)({types:u.j,nonNullable:!0,json:{write:!0}})],f.prototype,"lighting",void 0),(0,r._)([(0,a.Cb)(g)],f.prototype,"background",void 0),(0,r._)([(0,a.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],f.prototype,"atmosphereEnabled",void 0),(0,r._)([(0,a.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:b}}})],f.prototype,"starsEnabled",void 0),(0,r._)([(0,a.Cb)({types:p.Hr,nonNullable:!0,json:{write:!0},value:new d.Z})],f.prototype,"weather",null),f=w=(0,r._)([(0,l.j)("esri.webscene.Environment")],f);const E=f},18814:(e,t,i)=>{i.d(t,{Z:()=>u});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(38511)),l=i(69912),d=i(31201);let p=r=class extends n.wq{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new r(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};(0,s._)([(0,o.Cb)({readOnly:!0,type:["sun"],json:{write:!0}})],p.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Date,json:{type:Number,write:{target:"datetime"}}})],p.prototype,"date",void 0),(0,s._)([(0,a.r)("date",["datetime"])],p.prototype,"readDate",null),(0,s._)([(0,d.c)("date")],p.prototype,"writeDate",null),(0,s._)([(0,o.Cb)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],p.prototype,"directShadowsEnabled",void 0),(0,s._)([(0,a.r)("directShadowsEnabled",["directShadows"])],p.prototype,"readDirectShadowsEnabled",null),(0,s._)([(0,d.c)("directShadowsEnabled")],p.prototype,"writedirectShadowsEnabled",null),(0,s._)([(0,o.Cb)({type:Number,json:{write:!0}})],p.prototype,"displayUTCOffset",void 0),(0,s._)([(0,d.c)("displayUTCOffset")],p.prototype,"writeDisplayUTCOffset",null),p=r=(0,s._)([(0,l.j)("esri.webscene.SunLighting")],p);const u=p},67808:(e,t,i)=>{i.d(t,{Z:()=>d});var r,s=i(27366),n=i(46784),o=i(49861),a=(i(93169),i(32718),i(84936),i(69912));let l=r=class extends n.wq{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new r(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,s._)([(0,o.Cb)({readOnly:!0,type:["virtual"],json:{write:!0}})],l.prototype,"type",void 0),(0,s._)([(0,o.Cb)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],l.prototype,"directShadowsEnabled",void 0),l=r=(0,s._)([(0,a.j)("esri.webscene.VirtualLighting")],l);const d=l},2581:(e,t,i)=>{i.d(t,{Z:()=>l});var r=i(27366),s=i(46784),n=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends s.wq{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};(0,r._)([(0,n.Cb)({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0),a=(0,r._)([(0,o.j)("esri.webscene.background.Background")],a);const l=a},13910:(e,t,i)=>{i.d(t,{Z:()=>h});var r,s=i(27366),n=i(51995),o=i(49861),a=(i(93169),i(32718),i(84936),i(27135)),l=i(69912),d=i(70271),p=i(2581);const u={...d.a,nonNullable:!0};let c=r=class extends p.Z{constructor(e){super(e),this.type="color",this.color=new n.Z([0,0,0,1])}clone(){return new r(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,s._)([(0,a.J)({color:"color"},{readOnly:!0})],c.prototype,"type",void 0),(0,s._)([(0,o.Cb)(u)],c.prototype,"color",void 0),c=r=(0,s._)([(0,l.j)("esri.webscene.background.ColorBackground")],c);const h=c},23548:(e,t,i)=>{i.d(t,{j:()=>n});var r=i(18814),s=i(67808);const n={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:r.Z,virtual:s.Z}}}}]);
//# sourceMappingURL=39374.a0cac588.chunk.js.map