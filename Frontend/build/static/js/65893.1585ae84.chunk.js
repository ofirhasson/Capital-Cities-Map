"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[65893,45739],{42388:(t,e,i)=>{i.d(e,{j:()=>l});var r=i(27366),n=i(7138),s=i(49861),a=(i(93169),i(32718),i(84936),i(69912));const o={visible:"visibleSublayers"};let l=class extends n.default{constructor(t){super(t),this.scale=0}set layer(t){this._get("layer")!==t&&(this._set("layer",t),this.removeHandles("layer"),t&&this.addHandles([t.sublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),t.on("wms-sublayer-update",(t=>this.notifyChange(o[t.propertyName])))],"layer"))}get layers(){return this.visibleSublayers.filter((t=>{let{name:e}=t;return e})).map((t=>{let{name:e}=t;return e})).join()}get version(){this.commitProperty("layers");const t=this.layer;return t&&t.commitProperty("imageTransparency"),(this._get("version")||0)+1}get visibleSublayers(){const{layer:t,scale:e}=this,i=null===t||void 0===t?void 0:t.sublayers,r=[],n=t=>{const{minScale:i,maxScale:s,sublayers:a,visible:o}=t;o&&(0===e||(0===i||e<=i)&&(0===s||e>=s))&&(a?a.forEach(n):r.push(t))};return null!==i&&void 0!==i&&i.forEach(n),r}toJSON(){const{layer:t,layers:e}=this,{imageFormat:i,imageTransparency:r,version:n}=t;return{format:i,request:"GetMap",service:"WMS",styles:"",transparent:r?"TRUE":"FALSE",version:n,layers:e}}};(0,r._)([(0,s.Cb)()],l.prototype,"layer",null),(0,r._)([(0,s.Cb)({readOnly:!0})],l.prototype,"layers",null),(0,r._)([(0,s.Cb)({type:Number})],l.prototype,"scale",void 0),(0,r._)([(0,s.Cb)({readOnly:!0})],l.prototype,"version",null),(0,r._)([(0,s.Cb)({readOnly:!0})],l.prototype,"visibleSublayers",null),l=(0,r._)([(0,a.j)("esri.layers.support.ExportWMSImageParameters")],l)},50863:(t,e,i)=>{i.d(e,{h:()=>n});var r=i(45739);function n(t,e,i){if(null==(null===t||void 0===t?void 0:t.timeInfo))return null;const{datesInUnknownTimezone:n=!1,timeOffset:s,useViewTime:a}=t;let o=t.timeExtent;n&&(o=(0,r.Jb)(o));let l=a?e&&o?e.intersection(o):e||o:o;return!l||l.isEmpty||l.isAllTime?l:(s&&(l=l.offset(-s.value,s.unit)),n&&(l=(0,r.b3)(l)),l.equals(i)?i:l)}},83217:(t,e,i)=>{i.d(e,{x:()=>r});const r=Symbol("WebScene")},45739:(t,e,i)=>{i.d(e,{getTimeSliderSettingsFromWebDocument:()=>m,Jb:()=>f,b3:()=>p});var r=i(62044),n=i(63780),s=(i(44927),i(84652)),a=(i(32718),i(86710)),o=i(38675),l=i(83217);function h(t){return void 0!==t.timeInfo}async function u(t,e){var i,s;return null!==(i=null===(s=t.widgets)||void 0===s||null===(s=s.timeSlider)||void 0===s?void 0:s.fullTimeExtent)&&void 0!==i?i:async function(t,e){if(0===t.length)return r.Z.allTime;await Promise.all(t.map((t=>t.load({signal:e}))));const i=t.filter(h),s=t.filter((t=>!h(t)&&null!=t.visibilityTimeExtent));if(0===i.length&&0===s.length)return r.Z.allTime;const a=[],o=[];for(const r of i){var l;"feature"!==(null===r||void 0===r?void 0:r.type)&&"map-image"!==(null===r||void 0===r?void 0:r.type)||null===(l=r.timeInfo)||void 0===l||!l.hasLiveData?o.push(r):a.push(r)}const u=t=>null==t||t.isAllTime,d=[...o.map((t=>{var e,i;const r=null===(e=t.timeInfo)||void 0===e?void 0:e.fullTimeExtent,{visibilityTimeExtent:n}=t;return null!==(i=null===r||void 0===r?void 0:r.intersection(n))&&void 0!==i?i:n})),...s.map((t=>t.visibilityTimeExtent))];if(d.some(u))return r.Z.allTime;const c=a.map((async t=>{var i,r,n,s;const a=null!==(i=null===(r=await t.fetchRecomputedExtents({signal:e}))||void 0===r?void 0:r.timeExtent)&&void 0!==i?i:null===(n=t.timeInfo)||void 0===n?void 0:n.fullTimeExtent,{visibilityTimeExtent:o}=t;return null!==(s=null===a||void 0===a?void 0:a.intersection(o))&&void 0!==s?s:o})),m=(await Promise.allSettled(c)).map((t=>"fulfilled"===t.status?t.value:null));if(m.some(u))return r.Z.allTime;const p=[...m,...d].filter(n.pC);return 0===p.length?r.Z.allTime:p.reduce(((t,e)=>t.union(e)))}(t.allLayers,e)}function d(t){const{numStops:e,stopInterval:i,stops:r}=t;return r?{dates:(0,s.d9)(r)}:i?{interval:i.clone()}:{count:null!==e&&void 0!==e?e:5}}function c(t,e){var i;const n=t.currentTimeExtent;if(!n)return null;const{start:s,end:a}=n,o=null!==(i=null!==s&&void 0!==s?s:a)&&void 0!==i?i:null;switch(e){case"time-window":return new r.Z({start:s,end:a});case"cumulative-from-start":return new r.Z({start:null,end:o});case"cumulative-from-end":return new r.Z({start:o,end:null});case"instant":return new r.Z({start:o,end:o})}}async function m(t,e){var i,r;if(!(0,o.s)(t)&&!function(t){return null!=t&&"object"==typeof t&&l.x in t}(t))return null;await t.load({signal:e});const n=null===t||void 0===t||null===(i=t.widgets)||void 0===i?void 0:i.timeSlider;if(!n)return null;const s=await u(t,e),a=n.loop,h=function(t){var e;const i=null!==(e=t.numThumbs)&&void 0!==e?e:2,r=t.currentTimeExtent;if(r){const{start:t,end:e}=r;return null!=t&&null!=e&&t.getTime()===e.getTime()?"instant":2===i?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===i?"time-window":"cumulative-from-start"}(n);return{fullTimeExtent:s,loop:a,mode:h,playRate:null!==(r=n.stopDelay)&&void 0!==r?r:2e3,stops:d(n),timeExtent:c(n,h)}}function p(t){if(!t)return t;const{start:e,end:i}=t;return new r.Z({start:null!=e?(0,a.Nm)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,a.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}function f(t){if(!t)return t;const{start:e,end:i}=t;return new r.Z({start:null!=e?(0,a.Nm)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=i?(0,a.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}},90110:(t,e,i)=>{i.d(e,{c:()=>a});var r=i(34702),n=i(80613),s=i(64510);class a extends s.Z{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(t){super.beforeRender(t),this._manageFade()}prepareRenderPasses(t){const e=t.registerRenderPass({name:"bitmap",brushes:[r.U.bitmap],target:()=>this.children,drawPhase:n.jx.MAP});return[...super.prepareRenderPasses(t),e]}_manageFade(){this.children.reduce(((t,e)=>t+(e.inFadeTransition?1:0)),0)>=2?(this.children.forEach((t=>t.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((t=>t.blendFunction="standard")),this._hasCrossfade=!1)}}},28289:(t,e,i)=>{i.d(e,{Z:()=>n});var r=i(30932);class n{constructor(t,e,i,n){this.computedX=0,this.computedY=0,this.center=(0,r.al)(t,e),this.centerT=(0,r.Ue)(),this.halfWidth=i/2,this.halfHeight=n/2,this.width=i,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(t){this.center[0]=t}set y(t){this.center[1]=t}clone(){return new n(this.x,this.y,this.width,this.height)}serialize(t){return t.writeF32(this.center[0]),t.writeF32(this.center[1]),t.push(this.width),t.push(this.height),t}findCollisionDelta(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;const i=Math.abs(t.centerT[0]-this.centerT[0]),r=Math.abs(t.centerT[1]-this.centerT[1]),n=(t.halfWidth+this.halfWidth+e)/i,s=(t.halfHeight+this.halfHeight+e)/r,a=Math.min(n,s);return Math.log2(a)}extend(t){const e=Math.min(this.xmin,t.xmin),i=Math.min(this.ymin,t.ymin),r=Math.max(this.xmax,t.xmax)-e,n=Math.max(this.ymax,t.ymax)-i,s=e+r/2,a=i+n/2;this.width=r,this.height=n,this.halfWidth=r/2,this.halfHeight=n/2,this.x=s,this.y=a}static deserialize(t){const e=t.readF32(),i=t.readF32(),r=t.readInt32(),s=t.readInt32();return new n(e,i,r,s)}}},39332:(t,e,i)=>{i.r(e),i.d(e,{default:()=>v});var r=i(27366),n=i(32718),s=i(92026),a=i(66978),o=i(94172),l=i(49861),h=(i(93169),i(84936),i(69912)),u=i(53866),d=i(90110),c=i(65457),m=i(9229),p=i(67581),f=i(13107),y=i(29431);let g=class extends((0,y.Z)((0,f.Z)((0,c.y)(p.Z)))){constructor(){super(...arguments),this.bitmapContainer=new d.c}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}update(t){this.strategy.update(t).catch((t=>{(0,a.D_)(t)||n.Z.getLogger(this).error(t)}))}attach(){const{layer:t}=this,{imageMaxHeight:e,imageMaxWidth:i}=t;this.bitmapContainer=new d.c,this.container.addChild(this.bitmapContainer),this.strategy=new m.Z({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:e,imageMaxWidth:i,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,o.watch)((()=>this.exportImageVersion),(()=>this.requestUpdate())))}detach(){this.strategy=(0,s.SC)(this.strategy),this.container.removeAllChildren()}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(t){const{view:e,bitmapContainer:i}=this,{x:r,y:n}=t,{spatialReference:s}=e;let a,o=0,l=0;if(i.children.some((t=>{const{width:e,height:i,resolution:h,x:d,y:c}=t,m=d+h*e,p=c-h*i;return r>=d&&r<=m&&n<=c&&n>=p&&(a=new u.Z({xmin:d,ymin:p,xmax:m,ymax:c,spatialReference:s}),o=e,l=i,!0)})),!a)return null;const h=a.width/o,d=Math.round((r-a.xmin)/h),c=Math.round((a.ymax-n)/h);return{extent:a,width:o,height:l,x:d,y:c}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,...r})}};(0,r._)([(0,l.Cb)()],g.prototype,"strategy",void 0),(0,r._)([(0,l.Cb)()],g.prototype,"updating",void 0),g=(0,r._)([(0,h.j)("esri.views.2d.layers.WMSLayerView2D")],g);const v=g},9229:(t,e,i)=>{i.d(e,{Z:()=>E});var r=i(27366),n=i(7138),s=(i(93169),i(66978)),a=i(49861),o=(i(32718),i(84936),i(69912)),l=i(65156),h=i(92975),u=i(22824);const d=Math.PI/180;function c(t){return t*d}function m(t,e){const i=c(e.rotation),r=Math.abs(Math.cos(i)),n=Math.abs(Math.sin(i)),[s,a]=e.size;return t[0]=Math.round(a*n+s*r),t[1]=Math.round(a*r+s*n),t}var p=i(45956),f=i(37995),y=i(73828);const g=(0,l.Ue)(),v=[0,0],x=new y.Z(0,0,0,0),w=2048,b=2048,_=!1,S=!1,C=!1;let M=class extends n.default{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=C,this.imageMaxWidth=w,this.imageMaxHeight=b,this.imageRotationSupported=_,this.imageNormalizationSupported=S,this.update=(0,s.Ds)((async(t,e)=>{var i,r;if((0,s.k_)(e),!t.stationary||this.destroyed)return;const n=t.state,a=(0,h.C5)(n.spatialReference),o=this.hidpi?t.pixelRatio:1,l=n.worldScreenWidth>0,u=l&&this.imageNormalizationSupported&&n.worldScreenWidth<n.size[0],d=Math.round((null!==(i=this.imageMaxWidth)&&void 0!==i?i:0)/o),c=Math.round((null!==(r=this.imageMaxHeight)&&void 0!==r?r:0)/o);u?(v[0]=n.worldScreenWidth,v[1]=n.size[1]):this.imageRotationSupported?(v[0]=n.size[0],v[1]=n.size[1]):m(v,n);const p=Math.floor(v[0])>d||Math.floor(v[1])>c,f=a&&(n.extent.xmin<a.valid[0]||n.extent.xmax>a.valid[1]),y=!this.imageNormalizationSupported&&f,g=!p&&!y,x=this.imageRotationSupported?n.rotation:0,w=this.container.children.slice();if(g){const t=u?n.paddedViewState.center:n.center;this._imagePromise=this._singleExport(n,v,t,n.resolution,x,o,e)}else{let t=Math.min(d,c);l&&(t=Math.min(n.worldScreenWidth,t),t=Math.round(n.worldScreenWidth/Math.ceil(n.worldScreenWidth/t))),this._imagePromise=this._tiledExport(n,t,o,e)}try{var b;const t=null!==(b=await this._imagePromise)&&void 0!==b?b:[];(0,s.k_)(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t;for(const e of w)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(_){this._imagePromise=null,(0,s.r9)(_)}}),5e3),this.updateExports=(0,s.Ds)((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,s.as)(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,r,n,a){const o=await this.fetchSource(t,Math.floor(e*n),Math.floor(i*n),{rotation:r,pixelRatio:n,signal:a});(0,s.k_)(a);const l=new p.eY(null,!0);return l.x=t.xmin,l.y=t.ymax,l.resolution=t.width/e,l.rotation=r,l.pixelRatio=n,l.opacity=0,this.container.addChild(l),await l.setSourceAsync(o,a),(0,s.k_)(a),l}async _singleExport(t,e,i,r,n,s,a){!function(t,e,i,r){const[n,s]=e,[a,o]=r,l=.5*i;t[0]=n-l*a,t[1]=s-l*o,t[2]=n+l*a,t[3]=s+l*o}(g,i,r,e);const o=(0,l.HH)(g,t.spatialReference);return[await this._export(o,e[0],e[1],n,s,a)]}_tiledExport(t,e,i,r){const n=u.Z.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),s=new f.Z(n),a=s.getTileCoverage(t);if(!a)return null;const o=[];return a.forEach(((n,a,h,u)=>{x.set(n,a,h,0),s.getTileBounds(g,x);const d=(0,l.HH)(g,t.spatialReference);o.push(this._export(d,e,e,0,i,r).then((t=>(0!==u&&(x.set(n,a,h,u),s.getTileBounds(g,x),t.x=g[0],t.y=g[3]),t))))})),Promise.all(o)}};(0,r._)([(0,a.Cb)()],M.prototype,"_imagePromise",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"bitmaps",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"container",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"fetchSource",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"hidpi",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"imageMaxWidth",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"imageMaxHeight",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"imageRotationSupported",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"imageNormalizationSupported",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"requestUpdate",void 0),(0,r._)([(0,a.Cb)()],M.prototype,"updating",null),M=(0,r._)([(0,o.j)("esri.views.2d.layers.support.ExportStrategy")],M);const E=M},13107:(t,e,i)=>{i.d(e,{Z:()=>l});var r=i(27366),n=i(32718),s=i(66978),a=i(94172),o=(i(93169),i(84936),i(10064),i(69912));const l=t=>{let e=class extends t{initialize(){this.addHandles((0,a.on)((()=>this.layer),"refresh",(t=>{this.doRefresh(t.dataChanged).catch((t=>{(0,s.D_)(t)||n.Z.getLogger(this).error(t)}))})),"RefreshableLayerView")}};return e=(0,r._)([(0,o.j)("esri.views.layers.RefreshableLayerView")],e),e}},29431:(t,e,i)=>{i.d(e,{Z:()=>d});var r=i(27366),n=i(10064),s=i(92026),a=i(66978),o=i(49861),l=(i(93169),i(32718),i(84936),i(69912)),h=i(42388),u=i(50863);const d=t=>{let e=class extends t{initialize(){this.exportImageParameters=new h.j({layer:this.layer})}destroy(){this.exportImageParameters=(0,s.SC)(this.exportImageParameters)}get exportImageVersion(){var t;return null!==(t=this.exportImageParameters)&&void 0!==t&&t.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var t;return(0,u.h)(this.layer,null===(t=this.view)||void 0===t?void 0:t.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(t,e){const{layer:i}=this;if(!t)throw new n.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i});const{popupEnabled:r}=i;if(!r)throw new n.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r});const s=this.createFetchPopupFeaturesQuery(t);if(!s)return[];const{extent:o,width:l,height:h,x:u,y:d}=s;if(!(o&&l&&h))throw new n.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:o,width:l,height:h});const c=await i.fetchFeatureInfo(o,l,h,u,d);return(0,a.k_)(e),c}};return(0,r._)([(0,o.Cb)()],e.prototype,"exportImageParameters",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,r._)([(0,o.Cb)()],e.prototype,"layer",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],e.prototype,"timeExtent",null),e=(0,r._)([(0,l.j)("esri.views.layers.WMSLayerView")],e),e}}}]);
//# sourceMappingURL=65893.1585ae84.chunk.js.map