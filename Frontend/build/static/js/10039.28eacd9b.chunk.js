"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[10039],{72511:(e,t,i)=>{i.d(t,{S:()=>F,b:()=>R});var n,s,r,o,a,c,l,h,d,u,_=i(30168),g=i(86361),p=i(43505),f=i(37081),v=i(33280),m=i(94951),b=i(15226),y=i(26461),S=i(116),w=i(41012),T=i(49450),E=i(95276),O=i(98634),L=i(64201),A=i(25920),j=i(4760);function R(e){const t=new L.kG,i=e.multipassEnabled&&e.output===f.H_.Color;t.include(m.w,e),t.include(p.A,e),t.include(v.f5,e);const{vertex:g,fragment:R}=t;return R.include(S.Y),(0,w.Sv)(g,e),R.uniforms.add(new E.N("uColor",(e=>e.color))),t.attributes.add(j.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(j.T.OFFSET,"vec3"),e.shadingEnabled&&((0,w._8)(g),t.attributes.add(j.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),g.code.add((0,O.H)(n||(n=(0,_.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&g.code.add((0,O.H)(s||(s=(0,_.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),g.code.add((0,O.H)(r||(r=(0,_.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),i&&t.include(b.l,e),R.code.add((0,O.H)(o||(o=(0,_.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),i?"terrainDepthTest(depth);":"")),e.shadingEnabled?(R.uniforms.add(new T.J("shadingDirection",(e=>e.shadingDirection))),R.uniforms.add(new E.N("shadedColor",(e=>P(e.shadingTint,e.color)))),R.code.add((0,O.H)(a||(a=(0,_.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(uColor, shadedColor, shadingFactor);"]))))):R.code.add((0,O.H)(c||(c=(0,_.Z)(["vec4 finalColor = uColor;"])))),e.transparencyPassType===A.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),R.code.add((0,O.H)(l||(l=(0,_.Z)(["\n      ","\n      if (finalColor.a < ",") {\n        discard;\n      }\n\n      ","\n    }\n    "])),e.output===f.H_.ObjectAndLayerIdColor?(0,O.H)(h||(h=(0,_.Z)(["finalColor.a = 1.0;"]))):"",O.H.float(y.b),e.output===f.H_.Color?(0,O.H)(d||(d=(0,_.Z)(["fragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.transparencyPassType===A.A.ColorAlpha?(0,O.H)(u||(u=(0,_.Z)(["\n                    fragColor = premultiplyAlpha(fragColor);\n                    fragAlpha = fragColor.a;"]))):""):"")),t}function P(e,t){const i=1-e[3],n=e[3]+t[3]*i;return 0===n?(z[3]=n,z):(z[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,z[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,z[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,z[3]=t[3],z)}const z=(0,g.Ue)(),F=Object.freeze(Object.defineProperty({__proto__:null,build:R},Symbol.toStringTag,{value:"Module"}))},35284:(e,t,i)=>{i.d(t,{Z:()=>M});i(59486);var n=i(41644),s=i(91505),r=i(42537),o=(i(93169),i(16889)),a=i(92026),c=i(17842),l=i(29303),h=i(21389),d=i(29134),u=i(7025),_=i(13611),g=i(32035),p=i(12400),f=i(83448),v=i(79803),m=i(73680),b=i(96334),y=i(65156),S=i(85981),w=i(55652),T=i(40885),E=i(51378),O=i(37818),L=i(74509),A=i(77648),j=i(81703),R=i(81296),P=i(66327),z=i(78485),F=i(97882),D=i(99034),C=i(848);class M{constructor(e){var t;this.metadata=void 0,this._camera=new R.Z,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,u.Ue)(),this._worldFrame=null,this._renderLocation=(0,p.Ue)(),this._renderLocationDirty=!0,this._location=new C.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new C.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=D.jg.None,this._focused=!1,this.events=new s.Z.EventEmitter,this._screenLocation={screenPointArray:(0,c.s1)(),renderScreenPointArray:(0,c.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const i=null===(t=this.view.state)||void 0===t?void 0:t.camera;i&&this._camera.copyFrom(i)}destroy(){this._applyObjectTransform=Y,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return null===(e=this.view)||void 0===e?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,r.kB)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){x(e)&&(this._screenLocationDirty=!0),(0,d.JG)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,u.Ue)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,d.yR)(i),!0;case"global":{const n=(0,f.Iu)(e.renderCoordsHelper.spatialReference);(0,b.PR)(t,0,Z,0,n.radius),(0,m.y)((0,o.Vl)(Z[0]),(0,o.Vl)(Z[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,O.WG)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,O.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,O.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,x(this._modelTransform)){const t=this._calculateModelTransformOffset(q);e=(0,g.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,c.md)(e,N),s=this._getCollisionRadius(t),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,_.bI)(this.screenLocation.screenPointArray,i)<s*s)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,H),o=s*this.screenLocation.pixelSize,a=(0,j.u4)(this._camera,i,W);if(null==a)return null;for(const i of e){if(0===i.length)continue;const e=(0,g.h)(Z,i[0],n);for(let t=1;t<i.length;t++){const s=(0,g.h)(G,i[t],n),l=(0,S.Gr)((0,S.zk)(e,s,I),a);if(null!=l&&l<o*o){const t=(0,g.g)(E.WM.get(),e,s);(0,g.j)(t,t,.5);const i=(0,c.So)(E.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+r}(0,g.c)(e,s)}}break}case"disc":{var o;const e=this.collisionType.direction,t=null!==(o=this.collisionType.offset)&&void 0!==o?o:p.AG,n=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(n,H),c=s*this.screenLocation.pixelSize,h=(0,j.u4)(this._camera,i,W);if(null==h)return null;const d=(0,l.xO)(U,a),u=(0,g.t)(Q,e,d),_=(0,g.h)(J,t,a);(0,w.Yq)(_,u,B);const f=V;if((0,w.BR)(B,h,f)&&(0,g.a)(f,_)<c*c)return this.screenLocation.renderScreenPointArray[2]+r;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,n=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(n,H),a=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),h=(0,j.u4)(this._camera,i,W);if(null==h)return null;const d=(0,l.xO)(U,o),u=(0,g.t)(Q,t,d),_=this._calculateModelTransformPosition(J);(0,w.Yq)(_,u,B);const p=V;if(!(0,w.BR)(B,h,p))break;for(const i of e){if(0===i.length)continue;const e=(0,g.h)(Z,i[0],o);for(let t=1;t<i.length;t++){const n=(0,g.h)(G,i[t],o),s=(0,S.Jk)((0,S.zk)(e,n,I),p);if(null!=s&&s<a*a){const t=(0,g.g)(E.WM.get(),e,n);(0,g.j)(t,t,.5);const i=(0,c.So)(E.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+r}(0,g.c)(e,n)}}break}default:(0,n.Bg)(this.collisionType)}return null}attach(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new F.F(t,{pickable:!1,updatePolicy:z.j.SYNC}),i.engineLayerId=this._engineLayer.id):(null===t||void 0===t?void 0:t.getObject)&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,v.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new C.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}}).manipulator3D;e.engineLayerReferences--;const t=0===e.engineLayerReferences;this._removeResourcesFromStage(),t&&(e.engineLayerId=null,(0,a.SC)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,v.projectPoint)(this.location,K,e.spatialReference)&&(0,y.Qn)(e.extent,K)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){var e,t,i,n;if(null==this.elevationInfo)return;let s=null,r=0;const o=(0,L.ap)(this.elevationInfo,null!==(e=this.location.spatialReference)&&void 0!==e?e:this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case"on-the-ground":s=null!==(t=(0,A.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==t?t:0;break;case"relative-to-ground":r=(null!==(i=(0,A.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==i?i:0)+o;break;case"relative-to-scene":r=(null!==(n=(0,A.KO)(this.view.elevationProvider,this.location,"scene"))&&void 0!==n?n:0)+o;break;case"absolute-height":r=o}return r!==this._elevation.offset||s!==this._elevation.override?(this._elevation.offset=r,void(this._elevation.override=s)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=H;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),n=(this.focused?D.Q9.Focused:D.Q9.Unfocused)|(this.selected?D.Q9.Selected:D.Q9.Unselected),s=this._noDisplayCount>0;for(const{stateMask:r,objects:o}of i){if(s){for(const e of o)e.visible=!1;continue}const e=(r&D.Q9.All)!==D.Q9.None,i=(r&D.jg.All)!==D.jg.None,a=!e||(n&r)==(r&D.Q9.All),c=!i||(this.state&r)==(r&D.jg.All);if(a&&c)for(const n of o)n.visible=!0,n.transformation=t;else for(const t of o)t.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((e=>{let{geometry:{material:n}}=e;i.has(n)||(t.push(n),i.add(n))}));const n=new Map;this._renderObjects.forEach((e=>{const t=new P.T({castShadow:!1,geometries:[e.geometry]}),i=n.get(e.stateMask)||[];i.push(t),n.set(e.stateMask,i)}));const s=[];n.forEach(((e,t)=>s.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:s,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id)||0;0===n&&e.add(t),i.set(t.id,n+1)})),t.forEach((t=>{let{objects:n}=t;i.addMany(n),e.addMany(n)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:n}=this._engineResources;t.forEach((t=>{let{objects:n}=t;i.removeMany(n),e.removeMany(n)})),n.forEach((t=>{const i=this._materialIdReferences,n=i.get(t.id);1===n?(e.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,k);return(0,g.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,g.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,d.t8)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,d.Jp)(t,t,this._worldFrame),(0,d.Jp)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){}}function x(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const N=(0,c.s1)(),I=(0,S.Ue)(),W=(0,T.Ue)(),U=(0,h.Ue)(),k=(0,u.Ue)(),H=(0,u.Ue)(),B=(0,w.Ue)(),Z=(0,p.Ue)(),G=(0,p.Ue)(),V=(0,p.Ue)(),Q=(0,p.Ue)(),J=(0,p.Ue)(),q=(0,p.Ue)(),K=new C.Z({x:0,y:0,z:0,spatialReference:null}),Y=()=>{}},40508:(e,t,i)=>{i.d(t,{r:()=>s});var n=i(99034);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Q9.None;this.geometry=e,this.stateMask=t}}},666:(e,t,i)=>{function n(e){var t;return null===e||void 0===e||null===(t=e.operations)||void 0===t?void 0:t.data.geometry}i.d(t,{$:()=>n})},83639:(e,t,i)=>{i.d(t,{Aq:()=>b,EA:()=>g,Gd:()=>m,X9:()=>v,du:()=>y,gm:()=>S,qJ:()=>p,rotateManipulatorDefaults:()=>f});var n=i(86950),s=i(29134),r=i(32035),o=i(51378),a=i(37818),c=i(666),l=i(96387),h=i(68401),d=i(56529),u=i(66832),_=i(11606);function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.yD.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const s=(0,n.gp)(e),r=!(e[3]<1);return i?new _.Q({color:s,writeDepth:r,cullFace:h.Vr.Back,renderOccluded:t,isDecoration:!0}):new u.E({color:s,writeDepth:r,cullFace:h.Vr.Back,renderOccluded:t,isDecoration:!0})}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.yD.OccludeAndTransparent;const i=(0,n.gp)(e);return new u.E({color:i,writeDepth:!0,cullFace:h.Vr.Front,renderOccluded:t,isDecoration:!0})}const f=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),v=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function m(e,t,i,n){const a=(0,r.f)(o.WM.get(),e,i),c=b(a,(0,r.b)(o.WM.get(),n,a),i,o.MP.get());(0,s.U_)(c,c);const l=(0,r.h)(o.WM.get(),t,c);return Math.atan2(l[1],l[0])}function b(e,t,i,n){const s=(0,r.n)(o.WM.get(),e),a=(0,r.n)(o.WM.get(),t),c=(0,r.b)(o.WM.get(),s,a);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=0,n[4]=a[0],n[5]=a[1],n[6]=a[2],n[7]=0,n[8]=c[0],n[9]=c[1],n[10]=c[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function y(e,t){const i=e.getViewForGraphic(t);return null!=i&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function S(e,t){const i=t.origin;null==i?function(e,t){if(null==t)return;const i="mesh"===t.type?t.anchor:(0,l.zE)(t);null!=i&&(e.location=(0,a.kB)(i))}(e,(0,c.$)(t)):e.elevationAlignedLocation=i}},52168:(e,t,i)=>{i.d(t,{_:()=>l});var n=i(29134),s=i(7025),r=i(86244),o=i(66327),a=i(78485),c=i(97882);class l extends r.l{constructor(e){super(e),this._resources=null,this._transform=(0,s.Ue)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,n.JG)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new c.F(e,{pickable:!1,updatePolicy:a.j.SYNC}),i=new o.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}},43505:(e,t,i)=>{i.d(t,{A:()=>c});var n,s=i(30168),r=i(41012),o=i(58406),a=i(98634);function c(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,r.hY)(i,t),i.uniforms.add(new o.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new o.p("screenSizeScale",(e=>e.screenSizeScale))),i.code.add((0,a.H)(n||(n=(0,s.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));\nreturn viewDirectionDistance * perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}},11606:(e,t,i)=>{i.d(t,{Q:()=>F});var n=i(32035),s=i(12400),r=i(86361),o=i(41414),a=i(25158),c=i(55158),l=i(37081),h=i(68401),d=i(23620),u=i(56529),_=i(42235),g=i(93822),p=i(97731),f=i(4760),v=i(33236),m=i(27366),b=i(82144),y=i(31132),S=i(33559),w=i(78041),T=i(27627),E=i(25920),O=i(8883),L=i(72511),A=i(8548),j=i(36207);class R extends y.A{initializeProgram(e){return new T.$(e.rctx,R.shader.get().build(this.configuration),z)}_setPipelineState(e){const t=this.configuration,i=e===E.A.NONE,n=e===E.A.FrontFace;return(0,j.sm)({blending:t.output===l.H_.Color&&t.transparent?i?w.wu:(0,w.j7)(e):null,culling:(0,j.zp)(t.cullFace),depthTest:{func:n?A.wb.LESS:t.shadingEnabled?A.wb.LEQUAL:A.wb.LESS},depthWrite:i?t.writeDepth?j.LZ:null:(0,w.K5)(e),drawBuffers:(0,w.V7)(e),colorWrite:j.BK,polygonOffset:i||n?null:w.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}R.shader=new b.J(L.S,(()=>i.e(36556).then(i.bind(i,36556))));class P extends O.W{constructor(){super(...arguments),this.output=l.H_.Color,this.cullFace=h.Vr.None,this.transparencyPassType=E.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,m._)([(0,S.o)({count:l.H_.COUNT})],P.prototype,"output",void 0),(0,m._)([(0,S.o)({count:h.Vr.COUNT})],P.prototype,"cullFace",void 0),(0,m._)([(0,S.o)({count:E.A.COUNT})],P.prototype,"transparencyPassType",void 0),(0,m._)([(0,S.o)()],P.prototype,"hasSlicePlane",void 0),(0,m._)([(0,S.o)()],P.prototype,"transparent",void 0),(0,m._)([(0,S.o)()],P.prototype,"writeDepth",void 0),(0,m._)([(0,S.o)()],P.prototype,"screenSizeEnabled",void 0),(0,m._)([(0,S.o)()],P.prototype,"shadingEnabled",void 0),(0,m._)([(0,S.o)()],P.prototype,"multipassEnabled",void 0),(0,m._)([(0,S.o)()],P.prototype,"cullAboveGround",void 0),(0,m._)([(0,S.o)({constValue:!1})],P.prototype,"occlusionPass",void 0);const z=new Map([[f.T.POSITION,0],[f.T.NORMAL,1],[f.T.OFFSET,2]]);class F extends u.F5{constructor(e){super(e,new C),this.supportsEdges=!0,this.produces=new Map([[g.r.OPAQUE_MATERIAL,e=>e===l.H_.Highlight||(0,l.CQ)(e)&&!this._isTransparent],[g.r.TRANSPARENT_MATERIAL,e=>(0,l.CQ)(e)&&this._isTransparent&&this.parameters.writeDepth],[g.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(0,l.CQ)(e)&&this._isTransparent&&!this.parameters.writeDepth]]),this._configuration=new P,this._vertexAttributeLocations=z}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,s,r,a){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(f.T.OFFSET),c={applyToVertex:(e,s,r,o)=>{const a=(0,n.s)(x,t.data[3*o],t.data[3*o+1],t.data[3*o+2]),c=(0,n.s)(N,e,s,r);return(0,n.j)(a,a,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(a)),(0,n.g)(c,c,a),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=(0,o.be)(e,x);return(0,o.bA)(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};(0,_.Bw)(e,i,s,r,c,a)}else(0,_.Bw)(e,i,s,r,void 0,a)}createGLMaterial(e){return new D(e)}createBufferWriter(){return new M(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class D extends d.Z{beginSlot(e){return this.ensureTechnique(R,e)}}class C extends u.Mt{constructor(){super(...arguments),this.color=(0,r.al)(1,1,1,1),this.shadingTint=(0,r.al)(0,0,0,.25),this.shadingDirection=(0,n.n)((0,s.Ue)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=h.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class M{constructor(e){this.screenSizeEnabled=e;const t=(0,c.U$)().vec3f(f.T.POSITION).vec3f(f.T.NORMAL);this.screenSizeEnabled&&t.vec3f(f.T.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(f.T.POSITION).indices.length}write(e,t,i,n,s){if((0,v.NK)(i,this.vertexBufferLayout,e,t,n,s),this.screenSizeEnabled){if(!i.attributes.has(f.T.OFFSET))throw new Error("".concat(f.T.OFFSET," vertex attribute required for screenSizeEnabled ShadedColorMaterial"));{const e=i.attributes.get(f.T.OFFSET);(0,p.hu)(3===e.size);const r=n.getField(f.T.OFFSET,a.ct);if(!r)throw new Error("unable to acquire view for "+f.T.OFFSET);(0,v.ho)(e,t,r,s)}}}}const x=(0,s.Ue)(),N=(0,s.Ue)()}}]);
//# sourceMappingURL=10039.28eacd9b.chunk.js.map