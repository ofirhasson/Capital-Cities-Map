"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[9127,62078],{15909:(e,t,o)=>{o.d(t,{D:()=>r});var a=o(80292);function r(e){(null===e||void 0===e?void 0:e.writtenProperties)&&e.writtenProperties.forEach((e=>{let{target:t,propName:o,newOrigin:r}=e;(0,a.l)(t)&&r&&t.originOf(o)!==r&&t.updateOrigin(o,r)}))}},80292:(e,t,o)=>{function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}o.d(t,{l:()=>a})},62078:(e,t,o)=>{o.d(t,{FO:()=>d,W7:()=>f,addOrUpdateResources:()=>i,fetchResources:()=>s,removeAllResources:()=>c,removeResource:()=>l});var a=o(76200),r=o(10064),n=o(35995);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;await e.load(o);const a=(0,n.v_)(e.itemUrl,"resources"),{start:r=1,num:s=10,sortOrder:i="asc",sortField:l="resource"}=t,c={query:{start:r,num:s,sortOrder:i,sortField:l,token:e.apiKey},signal:null===o||void 0===o?void 0:o.signal},u=await e.portal.request(a,c);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map((t=>{let{created:o,size:a,resource:r}=t;return{created:new Date(o),size:a,resource:e.resourceFromPath(r)}}))}}async function i(e,t,o,a){const s=new Map;for(const{resource:n,content:l,compress:c,access:p}of t){if(!n.hasPath())throw new r.Z("portal-item-resource-".concat(o,":invalid-path"),"Resource does not have a valid path");const[e,t]=u(n.path),a="".concat(e,"/").concat(null!==c&&void 0!==c?c:"","/").concat(null!==p&&void 0!==p?p:"");s.has(a)||s.set(a,{prefix:e,compress:c,access:p,files:[]}),s.get(a).files.push({fileName:t,content:l})}await e.load(a);const i=(0,n.v_)(e.userItemUrl,"add"===o?"addResources":"updateResources");for(const{prefix:r,compress:n,access:l,files:c}of s.values()){const t=25;for(let o=0;o<c.length;o+=t){const s=c.slice(o,o+t),u=new FormData;r&&"."!==r&&u.append("resourcesPrefix",r),n&&u.append("compress","true"),l&&u.append("access",l);let p=0;for(const{fileName:e,content:t}of s)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(i,{method:"post",body:u,signal:null===a||void 0===a?void 0:a.signal})}}}async function l(e,t,o){if(!t.hasPath())throw new r.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(o);const a=(0,n.v_)(e.userItemUrl,"removeResources");await e.portal.request(a,{method:"post",query:{resource:t.path},signal:null===o||void 0===o?void 0:o.signal}),t.portalItem=null}async function c(e,t){await e.load(t);const o=(0,n.v_)(e.userItemUrl,"removeResources");return e.portal.request(o,{method:"post",query:{deleteAll:!0},signal:null===t||void 0===t?void 0:t.signal})}function u(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function p(e){const[t,o]=function(e){const t=(0,n.Ml)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),".".concat(t)]}(e),[a,r]=u(t);return[a,r,o]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,a.Z)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[o,,a]=p(e.path);return e.portalItem.resourceFromPath((0,n.v_)(o,t+a))}},40739:(e,t,o)=>{o.d(t,{H:()=>i,b:()=>l});var a=o(10064),r=o(66978),n=o(71907),s=o(62078);async function i(e,t,o){const a=await c(e,t,o);await u(a,t,o)}async function l(e,t,o,a,r){const n=await c(o,a,r);await e.update({data:t}),await u(n,a,r)}async function c(e,t,i){if(null===t||void 0===t||!t.resources)return;const l=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const c=new Set(t.resources.toKeep.map((e=>e.resource.path))),u=new Set,p=[];c.forEach((t=>{l.delete(t),e.paths.push(t)}));const d=[],f=[],m=[];for(const o of t.resources.toUpdate)if(l.delete(o.resource.path),c.has(o.resource.path)||u.has(o.resource.path)){const{resource:t,content:a,finish:r}=o,i=(0,s.W7)(t,(0,n.DO)());e.paths.push(i.path),d.push({resource:i,content:await(0,s.FO)(a),compress:o.compress}),r&&m.push((()=>r(i)))}else{e.paths.push(o.resource.path),f.push({resource:o.resource,content:await(0,s.FO)(o.content),compress:o.compress});const t=o.finish;t&&m.push((()=>t(o.resource))),u.add(o.resource.path)}for(const o of t.resources.toAdd)if(e.paths.push(o.resource.path),l.has(o.resource.path))l.delete(o.resource.path);else{d.push({resource:o.resource,content:await(0,s.FO)(o.content),compress:o.compress});const e=o.finish;e&&m.push((()=>e(o.resource)))}if(d.length||f.length){const{addOrUpdateResources:e}=await Promise.resolve().then(o.bind(o,62078));await e(t.portalItem,d,"add",i),await e(t.portalItem,f,"update",i)}if(m.forEach((e=>e())),0===p.length)return l;const w=await(0,r.UO)(p);if((0,r.k_)(i),w.length>0)throw new a.Z("save:resources","Failed to save one or more resources",{errors:w});return l}async function u(e,t,o){if(!e||!t.portalItem)return;const a=[];for(const r of e){const e=t.portalItem.resourceFromPath(r);a.push(e.portalItem.removeResource(e,o))}await(0,r.as)(a)}},76926:(e,t,o)=>{o.d(t,{w:()=>s});var a=o(42265),r=o(10064),n=o(66660);function s(e){if(a.default.apiKey&&(0,n.r)(e.portal.url))throw new r.Z("save-api-key-utils:api-key-not-supported","Saving is not supported on ".concat(e.portal.url," when using an api key"))}},9634:(e,t,o)=>{o.d(t,{P:()=>r,z:()=>s});var a=o(10064);async function r(e){const t=[];for(const o of e.allLayers)if("beforeSave"in o&&"function"==typeof o.beforeSave){const e=o.beforeSave();e&&t.push(e)}await Promise.allSettled(t)}const n=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);function s(e,t,o){var r;let s=(null!==(r=e.messages)&&void 0!==r?r:[]).filter((e=>{let{type:t}=e;return"error"===t})).map((e=>{let{name:t,message:o,details:r}=e;return new a.Z(t,o,r)}));if(e.blockedRelativeUrls&&(s=s.concat(e.blockedRelativeUrls.map((e=>new a.Z("url:unsupported","Relative url '".concat(e,"' is not supported")))))),o){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:a}=o;e&&(s=s.filter((e=>{let{name:o}=e;return!(n.has(o)||t.includes(o))}))),a&&(s=s.filter((e=>"web-document-write:property-required"!==e.name)))}if(s.length>0)throw new a.Z(t.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}},9127:(e,t,o)=>{o.d(t,{save:()=>k,saveAs:()=>O});var a=o(10064),r=o(97642),n=o(94172),s=o(35995),i=o(15909),l=o(78952),c=o(92975),u=o(81753),p=o(25899),d=o(37933),f=o(7575),m=o(98995),w=o(32698),h=o(73117),y=o(45362),v=o(81943),g=o(23037),b=o(40739),_=o(76926),R=o(9634);const P=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map((e=>e.toLowerCase()));async function k(e,t,o){var r;null!==(r=o)&&void 0!==r||(o={}),function(e,t){if(!t.portalItem)throw new a.Z("".concat(e.name,":portal-item-not-set"),"Portal item to save to has not been set on the WebMap");(0,_.w)(t.portalItem),S(e,t.portalItem)}(e,t),await(0,n.whenOnce)((()=>!t.updatingFromView)),await t.load(),await A(t),await(0,R.P)(t),await W(e,t);const s=t.portalItem,{json:i,jsonContext:l}=await I(t,s);return(0,R.z)(l,{errorName:"".concat(e.name,":save")},o),await j(t,s),await async function(e,t,o,a,r){await o.update({data:a}),K(e,t,o,a,r)}(e,t,s,i,l),await Promise.all([t.updateItemThumbnail(),(0,b.H)(t.resourceReferences,l)]),s}async function I(e,t){const o=(0,w.Y)(t,"web-map",!0),a=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:a,jsonContext:o}}async function O(e,t,o,r){var i;null!==(i=r)&&void 0!==i||(r={});const l=function(e,t){let o=m.default.from(t);return o.id&&(o=o.clone(),o.id=null),o.type||(o.type=e.itemType),o.portal||(o.portal=f.Z.getDefault()),(0,_.w)(o),S(e,o),o}(e,o);await(0,n.whenOnce)((()=>!t.updatingFromView)),await t.load(),await A(t),await(0,R.P)(t),await W(e,t);const{json:c,jsonContext:u}=await I(t,l);(0,R.z)(u,{errorName:"".concat(e.name,":save")},r),await async function(e,t){(0,h.ck)(t,q),(0,h.ck)(t,N),(0,h.ck)(t,h.hz.METADATA),(0,h.ck)(t,Z),(0,h.ck)(t,M),(0,h.ck)(t,E),(0,h.ck)(t,F),(0,h.ck)(t,x),await j(e,t)}(t,l);const p=t.getThumbnailState();return await async function(e,t,o,r,n,i){const l=t.portalItem,c={item:l,authenticated:!(null===l||void 0===l||!l.id||!l.portal.user)},u=o.portal;await u.signIn();const{copyAllowed:p,itemReloaded:d}=await async function(e,t){var o;const{item:a,authenticated:r}=e;return null!==a&&void 0!==a&&a.id&&null!==(o=a.typeKeywords)&&void 0!==o&&o.includes("useOnly")?a.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await a.reload(),{copyAllowed:"admin"===a.itemControl||"update"===a.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}(c,u);if(c.authenticated||(c.authenticated=d),!p)throw new a.Z("".concat(e.name,":save-as-copy-not-allowed"),"Owner of this map does not allow others to save a copy");const f=await async function(e,t,o,a){var r;const n=e.portal,{item:i}=t,{folder:l,copyAllResources:c}=a;let u=!1;if(c&&null!==i&&void 0!==i&&i.id&&(0,s.Zo)(i.portal.url,n.url)&&parseInt(i.portal.currentVersion,10)>=2023){const{total:e}=await i.fetchResources();u=!!e}if(u){const t=await i.copy({copyResources:"all",folder:l});e.id=t.id,e.portal=t.portal;const a=e.toJSON();await e.load(),e.read(a),await e.update({data:o})}else await(null===(r=n.user)||void 0===r?void 0:r.addItem({item:e,folder:l,data:o}));return u}(o,c,r,i);return t.portalItem=o,K(e,t,o,r,n),f}(e,t,l,c,u,r)&&(t.resourceReferences.portalItem=l),t.restoreThumbnailFromState(p),await Promise.all([t.updateItemThumbnail(),(0,b.H)(t.resourceReferences,u)]),l}function S(e,t){if(t.type!==e.itemType)throw new a.Z("".concat(e.name,":portal-item-wrong-type"),'Portal item needs to have type "'.concat(e.itemType,'"'))}async function W(e,t){var o;if(null===(o=t.basemap)||void 0===o||!o.baseLayers.length)throw new a.Z("".concat(e.name,":save"),"Map does not have a valid basemap with a base layer.");let r=null;if(await(0,n.whenOnce)((()=>{const e=(0,g.Us)(t.initialViewProperties,t.basemap);return r=e.spatialReference,!e.updating})),!(0,c.fS)(r,t.initialViewProperties.spatialReference))throw new a.Z("".concat(e.name,":save"),"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:r})}function A(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then((()=>{}))}async function j(e,t){t.extent=await async function(e,t){const a=t.clone().normalize();let r;if(a.length>1)for(const o of a)r?o.width>r.width&&(r=o):r=o;else r=a[0];return async function(e,t){const a=t.spatialReference;if(a.isWGS84)return t.clone();if(a.isWebMercator)return(0,u.Sx)(t);const{getGeometryServiceURL:r}=await o.e(67387).then(o.bind(o,67387)),n=await r(e),s=new v.Z({geometries:[t],outSpatialReference:l.Z.WGS84});return(await(0,y.i)(n,s))[0]}(e,r)}(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){(0,h.qj)(t,U),await function(e){const t=G(e).map((e=>e.load())).toArray();return Promise.allSettled(t).then((()=>{}))}(e),function(e,t){(0,h._$)(t,q)||(0,h._$)(t,F)||(0,h._$)(t,x)||(0,h._$)(t,E)||!B(e)?(0,h.ck)(t,D):(0,h.qj)(t,D)}(e,t),function(e,t){B(e)?(0,h.qj)(t,T):(0,h.ck)(t,T)}(e,t),function(e,t){!(0,h._$)(t,Z)&&function(e){return G(e).filter((e=>"group"!==e.type)).every((t=>t.loaded&&function(e,t){return(0,d.fP)(t)&&t.capabilities.operations.supportsSync||function(e){return(0,d.rQ)(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||("tile"===t.type||"vector-tile"===t.type)&&(t.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&(0,p.h3)(e.url)&&P.some((t=>{var o;return null===(o=e.url)||void 0===o?void 0:o.toLowerCase().includes("/"+t+"/")}))}(t)||(0,g.aL)(t))&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t)))}(e)?(0,h.qj)(t,C):(0,h.ck)(t,C)}(e,t),function(e,t){(0,g.zb)(e.basemap)?(0,h.qj)(t,V):(0,h.ck)(t,V)}(e,t),function(e,t){var o;null!==(o=e.utilityNetworks)&&void 0!==o&&o.length?(0,h.qj)(t,z):(0,h.ck)(t,z)}(e,t),function(e,t){e.ipsInfo?(0,h.qj)(t,L):(0,h.ck)(t,L)}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter(((e,t,o)=>o.indexOf(e)===t)))}(e,t)}const U=h.hz.JSAPI,q="CollectorDisabled",D="Collector",T="Data Editing",Z="OfflineDisabled",C="Offline",F="Workforce Project",x="Workforce Worker",E="Workforce Dispatcher",M="Offline Map Areas",N="FieldMapsDisabled",V=h.hz.DEVELOPER_BASEMAP,z="UtilityNetwork",L="IPS";function G(e){return e.allLayers.concat(e.allTables)}function B(e){return G(e).some((e=>e.loaded&&(0,d.fP)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some((e=>e.editingEnabled)))))}function K(e,t,o,a,n){r.w.prototype.read.call(t,{version:a.version,authoringApp:a.authoringApp,authoringAppVersion:a.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:o.itemUrl?(0,s.mN)(o.itemUrl):void 0}),(0,i.D)(n),t.resourceInfo=a}}}]);
//# sourceMappingURL=9127.72a1acd1.chunk.js.map