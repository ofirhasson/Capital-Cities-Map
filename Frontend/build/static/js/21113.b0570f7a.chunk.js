"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[21113],{82218:(t,e,i)=>{i.d(e,{B:()=>m,a:()=>v,b:()=>q,c:()=>y,d:()=>I,e:()=>C,f:()=>x,g:()=>T,h:()=>P,i:()=>S,n:()=>O,r:()=>U,t:()=>L,u:()=>E});i(93169);var n=i(32718),r=i(16889),s=i(21530),a=i(29134),o=i(7025),l=i(32035),c=i(12400),h=i(14320),u=i(85981),d=i(55652),p=i(40885),_=i(40927),g=i(51378);const f=()=>n.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const m=class{constructor(){this.plane=(0,d.Ue)(),this.origin=(0,c.Ue)(),this.basis1=(0,c.Ue)(),this.basis2=(0,c.Ue)()}};function v(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return{plane:(0,d.Ue)(t.plane),origin:(0,c.d9)(t.origin),basis1:(0,c.d9)(t.basis1),basis2:(0,c.d9)(t.basis2)}}function y(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v();return x(t.origin,t.basis1,t.basis2,e)}function x(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v();return(0,l.c)(n.origin,t),(0,l.c)(n.basis1,e),(0,l.c)(n.basis2,i),E(n),function(t,e){Math.abs((0,l.m)(t.basis1,t.basis2)/((0,l.l)(t.basis1)*(0,l.l)(t.basis2)))>1e-6&&f().warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,l.m)(t.basis1,O(t)))>1e-6&&f().warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.m)(O(t),t.origin)-t.plane[3])>1e-6&&f().warn(e,"Plane offset is not consistent with plane origin")}(n,"fromValues()"),n}function E(t){(0,d.my)(t.basis2,t.basis1,t.origin,t.plane)}function b(t,e,i){t!==i&&y(t,i);const n=(0,l.j)(g.WM.get(),O(t),e);return(0,l.g)(i.origin,i.origin,n),i.plane[3]-=e,i}function T(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v();const i=(t[2]-t[0])/2,n=(t[3]-t[1])/2;return(0,l.s)(e.origin,t[0]+i,t[1]+n,0),(0,l.s)(e.basis1,i,0,0),(0,l.s)(e.basis2,0,n,0),(0,d.al)(0,0,1,0,e.plane),e}function S(t,e,i){return!!(0,d.BR)(t.plane,e,i)&&N(t,i)}function R(t,e,i){const n=V.get();H(t,e,n,V.get());let s=Number.POSITIVE_INFINITY;for(const a of B){const o=D(t,a,F.get()),c=g.WM.get();if((0,d.rx)(n,o,c)){const t=(0,l.E)(g.WM.get(),e.origin,c),n=Math.abs((0,r.ZF)((0,l.m)(e.direction,t)));n<s&&(s=n,(0,l.c)(i,c))}}return s===Number.POSITIVE_INFINITY?w(t,e,i):i}function w(t,e,i){if(S(t,e,i))return i;const n=V.get(),r=V.get();H(t,e,n,r);let s=Number.POSITIVE_INFINITY;for(const a of B){const o=D(t,a,F.get()),c=g.WM.get();if((0,d.dZ)(n,o,c)){const t=(0,p.Jk)(e,c);if(!(0,d.Ac)(r,c))continue;t<s&&(s=t,(0,l.c)(i,c))}}return A(t,e.origin)<s&&k(t,e.origin,i),i}function k(t,e,i){const n=(0,d.nF)(t.plane,e,g.WM.get()),r=(0,u.ct)(Z(t,t.basis1),n,-1,1,g.WM.get()),s=(0,u.ct)(Z(t,t.basis2),n,-1,1,g.WM.get());return(0,l.f)(i,(0,l.g)(g.WM.get(),r,s),t.origin),i}function M(t,e,i){const{origin:n,basis1:r,basis2:s}=t,a=(0,l.f)(g.WM.get(),e,n),o=(0,_.SR)(r,a),c=(0,_.SR)(s,a),h=(0,_.SR)(O(t),a);return(0,l.s)(i,o,c,h)}function A(t,e){const i=M(t,e,g.WM.get()),{basis1:n,basis2:r}=t,s=(0,l.l)(n),a=(0,l.l)(r),o=Math.max(Math.abs(i[0])-s,0),c=Math.max(Math.abs(i[1])-a,0),h=i[2];return o*o+c*c+h*h}function P(t,e){return Math.sqrt(A(t,e))}function C(t,e){return(0,d.Ac)(t.plane,e)&&N(t,e)}function G(t,e){const i=-t.plane[3];return(0,_.SR)(O(t),e)-i}function I(t,e){return(0,l.e)(t.basis1,e.basis1)&&(0,l.e)(t.basis2,e.basis2)&&(0,l.e)(t.origin,e.origin)}function L(t,e,i){return t!==i&&y(t,i),(0,a.U_)(Y,e),(0,a.p4)(Y,Y),(0,l.h)(i.basis1,t.basis1,Y),(0,l.h)(i.basis2,t.basis2,Y),(0,l.h)((0,d.st)(i.plane),(0,d.st)(t.plane),Y),(0,l.h)(i.origin,t.origin,e),(0,d.T5)(i.plane,i.plane,i.origin),i}function U(t,e,i,n){return t!==n&&y(t,n),(0,a.Us)(Q,e,i),(0,l.h)(n.basis1,t.basis1,Q),(0,l.h)(n.basis2,t.basis2,Q),E(n),n}function O(t){return(0,d.st)(t.plane)}function N(t,e){const i=(0,l.f)(g.WM.get(),e,t.origin),n=(0,l.q)(t.basis1),r=(0,l.q)(t.basis2),s=(0,l.m)(t.basis1,i),a=(0,l.m)(t.basis2,i);return-s-n<0&&s-n<0&&-a-r<0&&a-r<0}function Z(t,e){const i=F.get();return(0,l.c)(i.origin,t.origin),(0,l.c)(i.vector,e),i}function D(t,e,i){const{basis1:n,basis2:r,origin:s}=t,a=(0,l.j)(g.WM.get(),n,e.origin[0]),o=(0,l.j)(g.WM.get(),r,e.origin[1]);(0,l.g)(i.origin,a,o),(0,l.g)(i.origin,i.origin,s);const c=(0,l.j)(g.WM.get(),n,e.direction[0]),h=(0,l.j)(g.WM.get(),r,e.direction[1]);return(0,l.j)(i.vector,(0,l.g)(c,c,h),2),i}function H(t,e,i,n){const r=O(t);(0,d.my)(r,e.direction,e.origin,i),(0,d.my)((0,d.st)(i),r,e.origin,n)}const z={plane:(0,d.Ue)(),origin:(0,c.al)(0,0,0),basis1:(0,c.al)(1,0,0),basis2:(0,c.al)(0,1,0)},V=new s.x(d.Ue),F=new s.x(u.Ue),W=(0,c.Ue)(),j=new s.x((()=>v())),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Y=(0,o.Ue)(),Q=(0,o.Ue)(),q=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:m,altitudeAt:G,axisAt:function(t,e,i,n){return function(t,e,i){switch(e){case h.R.X:(0,l.c)(i,t.basis1),(0,l.n)(i,i);break;case h.R.Y:(0,l.c)(i,t.basis2),(0,l.n)(i,i);break;case h.R.Z:(0,l.c)(i,O(t))}return i}(t,i,n)},closestPoint:w,closestPointOnSilhouette:R,copy:y,copyWithoutVerify:function(t,e){(0,l.c)(e.origin,t.origin),(0,l.c)(e.basis1,t.basis1),(0,l.c)(e.basis2,t.basis2),(0,d.JG)(e.plane,t.plane)},create:v,distance:P,distance2:A,distanceToSilhouette:function(t,e){let i=Number.NEGATIVE_INFINITY;for(const n of B){const r=D(t,n,F.get()),s=(0,u.Jk)(r,e);s>i&&(i=s)}return Math.sqrt(i)},elevate:b,equals:I,extrusionContainsPoint:C,fromAABoundingRect:T,fromValues:x,intersectRay:S,intersectRayClosestSilhouette:function(t,e,i){if(S(t,e,i))return i;const n=R(t,e,g.WM.get());return(0,l.g)(i,e.origin,(0,l.j)(g.WM.get(),e.direction,(0,l.p)(e.origin,n)/(0,l.l)(e.direction))),i},normal:O,projectPoint:k,projectPointLocal:M,rotate:U,setAltitudeAt:function(t,e,i,n){const r=G(t,e),s=(0,l.j)(W,O(t),i-r);return(0,l.g)(n,e,s),n},setExtent:function(t,e,i){return T(e,i),b(i,G(t,t.origin),i),i},transform:L,up:z,updateUnboundedPlane:E,wrap:function(t,e,i){const n=j.get();return n.origin=t,n.basis1=e,n.basis2=i,n.plane=(0,d.re)(0,0,0,0),E(n),n}},Symbol.toStringTag,{value:"Module"}))},79347:(t,e,i)=>{i.d(e,{e:()=>l});var n,r,s,a=i(84397),o={exports:{}};n=o,r=function(){function t(t,i,r){r=r||2;var s,a,o,c,h,u,d,p=i&&i.length,_=p?i[0]*r:t.length,g=e(t,0,_,r,!0),f=[];if(!g||g.next===g.prev)return f;if(p&&(g=l(t,i,g,r)),t.length>80*r){s=o=t[0],a=c=t[1];for(var m=r;m<_;m+=r)(h=t[m])<s&&(s=h),(u=t[m+1])<a&&(a=u),h>o&&(o=h),u>c&&(c=u);d=0!==(d=Math.max(o-s,c-a))?1/d:0}return n(g,f,r,s,a,d),f}function e(t,e,i,n,r){var s,a;if(r===M(t,e,i,n)>0)for(s=e;s<i;s+=n)a=R(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=R(s,t[s],t[s+1],a);if(a&&y(a,a.next)){var o=a.next;w(a),a=o}return a}function i(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!y(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{var r=n.prev;if(w(n),(n=e=r)===n.next)break;i=!0}}while(i||n!==e);return e}function n(t,e,l,c,h,u,d){if(t){!d&&u&&p(t,c,h,u);for(var _,g,f=t;t.prev!==t.next;)if(_=t.prev,g=t.next,u?s(t,c,h,u):r(t))e.push(_.i/l),e.push(t.i/l),e.push(g.i/l),w(t),t=g.next,f=g.next;else if((t=g)===f){d?1===d?n(t=a(i(t),e,l),e,l,c,h,u,2):2===d&&o(t,e,l,c,h,u):n(i(t),e,l,c,h,u,1);break}}}function r(t){var e=t.prev,i=t,n=t.next;if(v(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(f(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&v(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(t,e,i,n){var r=t.prev,s=t,a=t.next;if(v(r,s,a)>=0)return!1;for(var o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=_(o,l,e,i,n),d=_(c,h,e,i,n),p=t.prevZ,g=t.nextZ;p&&p.z>=u&&g&&g.z<=d;){if(p!==t.prev&&p!==t.next&&f(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==t.prev&&g!==t.next&&f(r.x,r.y,s.x,s.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&f(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=d;){if(g!==t.prev&&g!==t.next&&f(r.x,r.y,s.x,s.y,a.x,a.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function a(t,e,n){var r=t;do{var s=r.prev,a=r.next.next;!y(s,a)&&x(s,r,r.next,a)&&T(s,a)&&T(a,s)&&(e.push(s.i/n),e.push(r.i/n),e.push(a.i/n),w(r),w(r.next),r=t=a),r=r.next}while(r!==t);return i(r)}function o(t,e,r,s,a,o){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var h=S(l,c);return l=i(l,l.next),h=i(h,h.next),n(l,e,r,s,a,o),void n(h,e,r,s,a,o)}c=c.next}l=l.next}while(l!==t)}function l(t,n,r,s){var a,o,l,h=[];for(a=0,o=n.length;a<o;a++)(l=e(t,n[a]*s,a<o-1?n[a+1]*s:t.length,s,!1))===l.next&&(l.steiner=!0),h.push(g(l));for(h.sort(c),a=0;a<h.length;a++)r=i(r=u(h[a],r),r.next);return r}function c(t,e){return t.x-e.x}function h(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function u(t,e){var n=function(t,e){var i,n=e,r=t.x,s=t.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>a){if(a=o,o===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i;var l,c=i,h=i.x,u=i.y,p=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&f(s<u?r:a,s,h,u,s<u?a:r,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(r-n.x),T(n,t)&&(l<p||l===p&&(n.x>i.x||n.x===i.x&&d(i,n)))&&(i=n,p=l)),n=n.next}while(n!==c);return i}(t,e);if(!n)return e;var r=S(n,t),s=i(n,n.next);let a=h(r);return i(a,a.next),s=h(s),h(e===n?s:e)}function d(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function p(t,e,i,n){var r=t;do{null===r.z&&(r.z=_(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<c&&(o++,n=n.nextZ);e++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1)}(r)}function _(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&x(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(T(t,e)&&T(e,t)&&function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||y(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,i,n){var r=b(v(t,e,i)),s=b(v(t,e,n)),a=b(v(i,n,t)),o=b(v(i,n,e));return r!==s&&a!==o||!(0!==r||!E(t,i,e))||!(0!==s||!E(t,n,e))||!(0!==a||!E(i,t,n))||!(0!==o||!E(i,e,n))}function E(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function b(t){return t>0?1:t<0?-1:0}function T(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function S(t,e){var i=new k(t.i,t.x,t.y),n=new k(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function R(t,e,i,n){var r=new k(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function k(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}return t.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,a=Math.abs(M(t,0,s,i));if(r)for(var o=0,l=e.length;o<l;o++){var c=e[o]*i,h=o<l-1?e[o+1]*i:t.length;a-=Math.abs(M(t,c,h,i))}var u=0;for(o=0;o<n.length;o+=3){var d=n[o]*i,p=n[o+1]*i,_=n[o+2]*i;u+=Math.abs((t[d]-t[_])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[_+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},t.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[r][s][a]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i},t},void 0!==(s=r())&&(n.exports=s);const l=(0,a.g)(o.exports)},29691:(t,e,i)=>{i.d(e,{HQ:()=>o,VY:()=>l,rS:()=>h,wY:()=>c});var n=i(83448),r=i(78952),s=i(92975);const a=new r.Z(n.kU),o=new r.Z(n.JL),l=new r.Z(n.mM),c=new r.Z(n.pn);function h(t){const e=u.get(t);if(e)return e;let i=a;if(t)if(t===o)i=o;else if(t===l)i=l;else{const e=t.wkid,r=t.latestWkid;if(null!=e||null!=r)(0,s.o$)(e)||(0,s.o$)(r)?i=o:((0,s.ME)(e)||(0,s.ME)(r))&&(i=l);else{var n;const e=null!==(n=t.wkt2)&&void 0!==n?n:t.wkt;if(e){const t=e.toUpperCase();t===d?i=o:t===p&&(i=l)}}}return u.set(t,i),i}const u=new Map,d=o.wkt.toUpperCase(),p=l.wkt.toUpperCase()},45238:(t,e,i)=>{i.d(e,{EU:()=>m,Ue:()=>h,WH:()=>v,ZZ:()=>f,q_:()=>p,qw:()=>g,uT:()=>u,up:()=>x,zk:()=>d});var n=i(16889),r=i(29134),s=i(68700),a=i(50894),o=i(32035),l=i(12400),c=i(86361);function h(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x;return[t[0],t[1],t[2],t[3]]}function u(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h();return(0,o.c)(i,t),i[3]=e,i}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,c.Ue)();return(0,o.b)(i,t,e),(0,o.n)(i,i),i[3]=-(0,o.d)(t,e),i}function p(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h();const i=(0,r.j6)(E,t);return y(e,(0,n.BV)((0,s.Bh)(e,i))),e}function _(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h();return(0,s.yY)(E,t,v(t)),(0,s.yY)(b,e,v(e)),(0,s.Jp)(E,b,E),y(i,(0,n.BV)((0,s.Bh)(i,E)))}function g(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h();return u(l.E9,t,T),u(l.IO,e,S),u(l.eG,i,R),_(T,S,T),_(T,R,n),n}function f(t){return t}function m(t){return t[3]}function v(t){return(0,n.Vl)(t[3])}function y(t,e){return t[3]=e,t}const x=[0,0,1,0],E=(0,a.Ue)(),b=(0,a.Ue)(),T=(h(),h()),S=h(),R=h()},85981:(t,e,i)=>{i.d(e,{AR:()=>v,Gr:()=>m,JG:()=>h,Jk:()=>p,KU:()=>g,Ue:()=>l,al:()=>u,ct:()=>f,nF:()=>_,re:()=>c,zk:()=>d});var n=i(16889),r=i(21530),s=i(32035),a=i(12400),o=i(51378);function l(t){return t?{origin:(0,a.d9)(t.origin),vector:(0,a.d9)(t.vector)}:{origin:(0,a.Ue)(),vector:(0,a.Ue)()}}function c(t,e){const i=E.get();return i.origin=t,i.vector=e,i}function h(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l();return u(t.origin,t.vector,e)}function u(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(i.origin,t),(0,s.c)(i.vector,e),i}function d(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,s.c)(i.origin,t),(0,s.f)(i.vector,e,t),i}function p(t,e){const i=(0,s.f)(o.WM.get(),e,t.origin),r=(0,s.m)(t.vector,i),a=(0,s.m)(t.vector,t.vector),l=(0,n.uZ)(r/a,0,1),c=(0,s.f)(o.WM.get(),(0,s.j)(o.WM.get(),t.vector,l),i);return(0,s.m)(c,c)}function _(t,e,i){return f(t,e,0,1,i)}function g(t,e,i){return(0,s.g)(i,t.origin,(0,s.j)(i,t.vector,e))}function f(t,e,i,r,a){const{vector:l,origin:c}=t,h=(0,s.f)(o.WM.get(),e,c),u=(0,s.m)(l,h)/(0,s.q)(l);return(0,s.j)(a,l,(0,n.uZ)(u,i,r)),(0,s.g)(a,a,t.origin)}function m(t,e){if(y(t,c(e.origin,e.direction),!1,x)){const{tA:e,pB:i,distance2:n}=x;if(e>=0&&e<=1)return n;if(e<0)return(0,s.a)(t.origin,i);if(e>1)return(0,s.a)((0,s.g)(o.WM.get(),t.origin,t.vector),i)}return null}function v(t,e,i){return!!y(t,e,!0,x)&&((0,s.c)(i,x.pA),!0)}function y(t,e,i,r){const a=1e-6,l=t.origin,c=(0,s.g)(o.WM.get(),l,t.vector),h=e.origin,u=(0,s.g)(o.WM.get(),h,e.vector),d=o.WM.get(),p=o.WM.get();if(d[0]=l[0]-h[0],d[1]=l[1]-h[1],d[2]=l[2]-h[2],p[0]=u[0]-h[0],p[1]=u[1]-h[1],p[2]=u[2]-h[2],Math.abs(p[0])<a&&Math.abs(p[1])<a&&Math.abs(p[2])<a)return!1;const _=o.WM.get();if(_[0]=c[0]-l[0],_[1]=c[1]-l[1],_[2]=c[2]-l[2],Math.abs(_[0])<a&&Math.abs(_[1])<a&&Math.abs(_[2])<a)return!1;const g=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],f=p[0]*_[0]+p[1]*_[1]+p[2]*_[2],m=d[0]*_[0]+d[1]*_[1]+d[2]*_[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],y=(_[0]*_[0]+_[1]*_[1]+_[2]*_[2])*v-f*f;if(Math.abs(y)<a)return!1;let x=(g*f-m*v)/y,E=(g+f*x)/v;i&&(x=(0,n.uZ)(x,0,1),E=(0,n.uZ)(E,0,1));const b=o.WM.get(),T=o.WM.get();return b[0]=l[0]+x*_[0],b[1]=l[1]+x*_[1],b[2]=l[2]+x*_[2],T[0]=h[0]+E*p[0],T[1]=h[1]+E*p[1],T[2]=h[2]+E*p[2],r.tA=x,r.tB=E,r.pA=b,r.pB=T,r.distance2=(0,s.a)(b,T),!0}const x={tA:0,tB:0,pA:(0,a.Ue)(),pB:(0,a.Ue)(),distance2:0},E=new r.x((()=>l()))},74702:(t,e,i)=>{i.d(e,{bE:()=>c,wu:()=>l});var n=i(21530),r=i(32035),s=i(12400),a=i(85981);i(51378);function o(t){return t?{p0:(0,s.d9)(t.p0),p1:(0,s.d9)(t.p1),p2:(0,s.d9)(t.p2)}:{p0:(0,s.Ue)(),p1:(0,s.Ue)(),p2:(0,s.Ue)()}}function l(t,e,i){const n=e[0]-t[0],r=e[1]-t[1],s=i[0]-t[0],a=i[1]-t[1];return.5*Math.abs(n*a-r*s)}function c(t,e,i){return(0,r.f)(h,e,t),(0,r.f)(u,i,t),.5*(0,r.l)((0,r.b)(h,h,u))}new n.x(a.Ue),new n.x((()=>o()));const h=(0,s.Ue)(),u=(0,s.Ue)()},70178:(t,e,i)=>{i.d(e,{Fz:()=>l,fS:()=>h,kg:()=>o});i(93169);var n=i(16889),r=i(92975);function s(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const n=t[i],r=e[i];if(n.length!==r.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==r[t])return!1}return!0}function a(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!s(t[i],e[i]))return!1;return!0}function o(t,e){return t===e||null!=t&&null!=e&&(0,r.fS)(t.spatialReference,e.spatialReference)&&t.x===e.x&&t.y===e.y&&t.z===e.z&&t.m===e.m}function l(t,e,i){var s,a,o,l;return t===e||null!=t&&null!=e&&(0,r.fS)(t.spatialReference,e.spatialReference)&&(0,n.W8)(t.x,e.x,i)&&(0,n.W8)(t.y,e.y,i)&&(0,n.W8)(null!==(s=t.z)&&void 0!==s?s:0,null!==(a=e.z)&&void 0!==a?a:0,i)&&(0,n.W8)(null!==(o=t.m)&&void 0!==o?o:0,null!==(l=e.m)&&void 0!==l?l:0,i)}function c(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.type!==e.type)return!1;switch(t.type){case"point":return o(t,e);case"extent":return function(t,e){return t.hasZ===e.hasZ&&t.hasM===e.hasM&&!!(0,r.fS)(t.spatialReference,e.spatialReference)&&t.xmin===e.xmin&&t.ymin===e.ymin&&t.zmin===e.zmin&&t.xmax===e.xmax&&t.ymax===e.ymax&&t.zmax===e.zmax}(t,e);case"polyline":return function(t,e){return t.hasZ===e.hasZ&&t.hasM===e.hasM&&!!(0,r.fS)(t.spatialReference,e.spatialReference)&&a(t.paths,e.paths)}(t,e);case"polygon":return function(t,e){return t.hasZ===e.hasZ&&t.hasM===e.hasM&&!!(0,r.fS)(t.spatialReference,e.spatialReference)&&a(t.rings,e.rings)}(t,e);case"multipoint":return function(t,e){return t.hasZ===e.hasZ&&t.hasM===e.hasM&&!!(0,r.fS)(t.spatialReference,e.spatialReference)&&s(t.points,e.points)}(t,e);case"mesh":return!1;default:return}}function h(t,e){return t===e||null!=t&&null!=e&&t.objectId===e.objectId&&!!c(t.geometry,e.geometry)&&!!function(t,e){if(t===e)return!0;if(!t||!e)return!1;const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i)if(t[r]!==e[r])return!1;return!0}(t.attributes,e.attributes)}},37818:(t,e,i)=>{i.d(e,{D:()=>m,Ou:()=>c,WG:()=>f,kB:()=>d,mW:()=>u});i(59486);var n=i(52639),r=(i(93169),i(84652)),s=i(18722),a=i(77981),o=i(55946),l=i(78952);function c(t){return"declaredClass"in t}function h(t){return"declaredClass"in t}function u(t,e){return t?function(t){return"declaredClass"in t}(t)?t:new n.Z({layer:e,sourceLayer:e,visible:t.visible,symbol:(0,r.d9)(t.symbol),attributes:(0,r.d9)(t.attributes),geometry:d(t.geometry)}):null}function d(t){return null==t?null:c(t)?t:(0,a.im)(function(t){const{wkid:e,wkt:i,wkt2:n,latestWkid:r}=t.spatialReference,s={wkid:e,wkt:i,wkt2:n,latestWkid:r};switch(t.type){case"point":{const{x:e,y:i,z:n,m:r}=t;return{x:e,y:i,z:n,m:r,spatialReference:s}}case"polygon":{const{rings:e,hasZ:i,hasM:n}=t;return{rings:p(e),hasZ:i,hasM:n,spatialReference:s}}case"polyline":{const{paths:e,hasZ:i,hasM:n}=t;return{paths:p(e),hasZ:i,hasM:n,spatialReference:s}}case"extent":{const{xmin:e,xmax:i,ymin:n,ymax:r,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:h,hasM:u}=t;return{xmin:e,xmax:i,ymin:n,ymax:r,zmin:a,zmax:o,mmin:l,mmax:c,hasZ:h,hasM:u,spatialReference:s}}case"multipoint":{const{points:e,hasZ:i,hasM:n}=t;return{points:g(e)?_(e):e,hasZ:i,hasM:n,spatialReference:s}}default:return}}(t))}function p(t){return function(t){for(const e of t)if(0!==e.length)return g(e);return!1}(t)?t.map((t=>_(t))):t}function _(t){return t.map((t=>Array.from(t)))}function g(t){return t.length>0&&((0,s.xZ)(t[0])||(0,s.fS)(t[0]))}function f(t,e){if(!t)return null;let i;if(h(t)){if(null==e)return t.clone();if(h(e))return e.copy(t)}return null!=e?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=(0,o.T)(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function m(t){const{wkid:e,wkt:i,wkt2:n,latestWkid:r}=t,s={wkid:e,wkt:i,wkt2:n,latestWkid:r};return l.Z.fromJSON(s)}},41388:(t,e,i)=>{i.d(e,{b:()=>a});var n=i(66978),r=i(76432),s=i(73553);class a{constructor(){this._tasks=new Array,this._runningTasks=(0,r.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(t){if(0===this.length)return s.J;for(;!t.done&&this._process(t);)t.madeProgress()}push(t,e,i){return++this._runningTasks.value,new Promise(((n,r)=>this._tasks.push(new o(n,r,t,e,i)))).finally((()=>--this._runningTasks.value))}unshift(t,e,i){return++this._runningTasks.value,new Promise(((n,r)=>this._tasks.unshift(new o(n,r,t,e,i)))).finally((()=>--this._runningTasks.value))}_process(t){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const r=(0,n.Hc)(e.signal);if(r&&!e.abortCallback)e.reject((0,n.zE)());else{var i;const s=r?null===(i=e.abortCallback)||void 0===i?void 0:i.call(e,(0,n.zE)()):e.callback(t);(0,n.y8)(s)?s.then(e.resolve,e.reject):e.resolve(s)}}catch(a){e.reject(a)}return!0}cancelAll(){const t=(0,n.zE)();for(const e of this._tasks)if(e.abortCallback){const i=e.abortCallback(t);e.resolve(i)}else e.reject(t);this._tasks.length=0}}class o{constructor(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=t,this.reject=e,this.callback=i,this.signal=n,this.abortCallback=r}}},10461:(t,e,i)=>{i.r(e),i.d(e,{ControlPointsTransformTool:()=>Y,DrawGraphicTool2D:()=>E,MediaTransformToolsWrapper:()=>St,TransformTool:()=>xt});var n=i(27366),r=(i(59486),i(52639)),s=i(42537),a=i(92026),o=i(94172),l=i(49861),c=(i(93169),i(32718),i(84936),i(69912)),h=i(85577),u=(i(51508),i(75021)),d=i(16072);const p=new u.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),_=new d.default({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),g=new d.default({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var f=i(84827),m=i(66038),v=i(46640),y=i(848),x=i(77577);let E=class extends f.T{constructor(t){var e,i,n;super(t),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:null!==(e=t.activeLineSymbol)&&void 0!==e?e:p,regularVertices:null!==(i=t.regularVerticesSymbol)&&void 0!==i?i:_,activeVertex:null!==(n=t.activeVertexSymbol)&&void 0!==n?n:g,fill:t.activeFillSymbol},t.activeVertexSymbol||this.addHandles((0,o.watch)((()=>{var t;return null===(t=this.view)||void 0===t||null===(t=t.effectiveTheme)||void 0===t?void 0:t.accentColor}),(t=>{var e;if(!t)return;const i=this._visualElementSymbols.activeVertex.clone().set({color:t});null!==(e=this._visualElementGraphics.activeVertex)&&void 0!==e&&e.set("symbol",i),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:i}}),o.initial))}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return null!=this._visualElementSymbols.fill&&(t.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(b),(0,s.kB)()}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:i}=this;return this._createOrUpdateGraphic(null),new m.wW({view:i,manipulators:this.manipulators,geometryType:(0,f.I)(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new v.hP(i,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new h.r(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(t){if("point"===this.geometryType)return(0,s.kB)();const[e,i]=t,n=new y.Z({x:e,y:i,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=n,(0,s.kB)()):(this._visualElementGraphics.activeVertex=new r.Z({geometry:n,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(b),(0,s.kB)((()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,a.SC)(this._visualElementGraphics.activeVertex))})))}onCursorEdgeChanged(t){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=t,(0,s.kB)()):(this._visualElementGraphics.activeEdge=new r.Z({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(b),(0,s.kB)((()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=(0,a.SC)(this._visualElementGraphics.activeEdge))})))}onRegularVerticesChanged(t){const e=new x.Z({points:t,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=e,(0,s.kB)()):(this._visualElementGraphics.regularVertices=new r.Z({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(b),(0,s.kB)((()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,a.SC)(this._visualElementGraphics.regularVertices))})))}};function b(t,e){var i,n,r,s;return(null!==(i=null===(n=t.attributes)||void 0===n?void 0:n.displayOrder)&&void 0!==i?i:-1/0)-(null!==(r=null===(s=e.attributes)||void 0===s?void 0:s.displayOrder)&&void 0!==r?r:-1/0)}(0,n._)([(0,l.Cb)()],E.prototype,"activeFillSymbol",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],E.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],E.prototype,"view",void 0),E=(0,n._)([(0,c.j)("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],E);var T,S=i(51995),R=i(79803),w=i(92975),k=i(93655),M=i(49729),A=i(50951);class P{get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}}!function(t){t[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE"}(T||(T={}));var C=i(74229),G=i(2346),I=i(153),L=i(90297);class U extends P{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(t){t(this._manipulator,T.TRANSLATE_XY)}createDragPipeline(t,e){let i=null,n=null,r=0,s=0,a=0;const{offsetX:o,offsetY:l,size:c}=(0,L.i)(this._graphic.symbol);return(0,C.Xd)(this._manipulator,((h,u)=>{u.next((e=>{if("start"===e.action){const e=t();i=e.editGeometryOperations,n=e.constraints}return e})).next((0,C.Cf)(this._view)).next((t=>{const{x:h,y:u,z:d}=t.mapEnd;if(n&&(h+o<n.xmin||u+l-c<n.ymin||h+o>n.xmax||u+l-c>n.ymax))return t;("start"===t.action||0===r&&0===s&&0===a)&&(r=t.mapStart.x,s=t.mapStart.y,a=t.mapStart.z);const p=h-r,_=u-s,g=d-a;r=h,s=u,a=d;const f="start"===t.action?I.b.NEW_STEP:I.b.ACCUMULATE_STEPS,m=i.move(p,_,g,f);return e(t,m),t}))}))}_createManipulator(){const t=this._view,e=this._graphic;return new G.L({view:t,graphic:e,selectable:!0,cursor:"move"})}}var O=i(67750),N=i(45900),Z=i(17877);const D="ArrowUp",H="ArrowDown",z="ArrowLeft",V="ArrowRight",F="t",W="Shift",j=O.C,B=new S.Z("#009AF2");let Y=class extends N.m{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new k.default({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach((t=>t.destroy())),this._controlPointEditGeometryOperations.forEach((t=>t.destroy())),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,a.SC)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,w.JY)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if(null==t.georeference)return;const e=t.georeference;"control-points"===e.type&&null!=e.coords&&(this._georeference=e,this._georeference.controlPoints.forEach(((t,e)=>{let{mapPoint:i}=t;const n=this._controlPointEditGeometryOperations[e],r=n.data.components[0].vertices[0];n.setVertexPosition(r,n.data.coordinateHelper.pointToVector(i))})),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=t.controlPoints,i=e[0].mapPoint.spatialReference,n=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map(((r,s)=>{const a=r.data.geometry;return this._controlPointGraphics[s].geometry=a,{mapPoint:(0,R.project)(a,i),sourcePoint:n?e[s].sourcePoint:t.toSource(a)}}))}updateActiveHandle(t){if(this.activeHandle===t)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();(0,M.ZB)(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const i=this._controlPointGraphics[t].symbol.clone();(0,M.ZB)(i,B),this._controlPointGraphics[t].symbol=i,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const t=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=t.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,mediaElement:e}=this;if(null==e.georeference)return;const i=e.georeference;"control-points"===i.type&&null!=i.coords&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map((e=>{let{mapPoint:i}=e;return Z.c.fromGeometry((0,R.project)(i,t.spatialReference),A.JY.Local)})),this._controlPointGraphics=this._controlPointEditGeometryOperations.map(((t,e)=>new r.Z({symbol:new u.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:e===this.activeHandle?B.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:t.data.geometry}))),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map((e=>new U({tool:this,view:t,graphic:e}))),this.addHandles([...this._controlPointManipulations.map(((t,e)=>t.createDragPipeline(this._getInfo.bind(this,e),((t,i)=>{"start"===t.action&&(this._undoStack.push(e),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0),this.updateGraphics()})))),(0,o.watch)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null))]),this._controlPointManipulations.forEach(((t,e)=>{t.forEachManipulator((t=>{this.addHandles([t.events.on(["click","grab-changed"],(t=>this.updateActiveHandle(e)))])}))})),this.addHandles([t.on("key-down",(i=>{t.activeTool===this&&(i.key!==W||i.repeat||(this._isModifierActive=!0,i.stopPropagation()),i.key!==F||i.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,i.stopPropagation()),i.key!==j||i.repeat||(this._factor=10,i.stopPropagation()),this._isModifierActive&&(i.key===D&&(this._move(0,this._factor),i.stopPropagation()),i.key===H&&(this._move(0,-this._factor),i.stopPropagation()),i.key===z&&(this._move(-this._factor,0),i.stopPropagation()),i.key===V&&(this._move(this._factor,0),i.stopPropagation())))})),t.on("key-up",(e=>{t.activeTool===this&&(e.key===W&&(this._isModifierActive=!1,e.stopPropagation()),e.key===j&&(this._factor=1,e.stopPropagation()))}))]))}async _loadProjectionEngine(){const t=this._georeference.controlPoints[0].mapPoint;return(0,R.initializeProjection)(t.spatialReference,this.view.spatialReference)}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const i=this._controlPointEditGeometryOperations[this.activeHandle].move(t*this.view.resolution,e*this.view.resolution,0,I.b.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,n._)([(0,l.Cb)()],Y.prototype,"_hasValidSpatialReference",null),(0,n._)([(0,l.Cb)()],Y.prototype,"activeHandle",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Y.prototype,"mediaElement",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),Y=(0,n._)([(0,c.j)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],Y);var Q=i(86950),q=i(68860),X=i(13611),J=i(6644),K=i(32035),$=i(12400),tt=i(82218),et=i(100),it=i(16889);function nt(t,e){"start"===t.action?e.cursor="grabbing":e.cursor="grab"}class rt{constructor(){this._lastDragEvent=null,this.next=new C.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=0!==t.direction[0]&&0!==t.direction[1]?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}}class st{constructor(){this._lastDragEvent=null,this.next=new C.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&null!=this._lastDragEvent){const e={...this._lastDragEvent,action:"update"};t&&this._adjustRotateAngle(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustRotateAngle(t),t)}_adjustRotateAngle(t){const e=(0,it.BV)(t.rotateAngle);t.rotateAngle=(0,it.Vl)(5*Math.round(e/5))}}var at=i(20008),ot=i(34778),lt=i(92583);class ct extends P{constructor(t){super(),this._handles=new et.Z,this._originCache=(0,$.Ue)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>nt(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,T.ROTATE)}createDragPipeline(t,e){let i=null,n=null;return(0,C.Xd)(this._manipulator,((r,s)=>{s.next((e=>{if("start"===e.action){r.cursor="grabbing";const e=t();i=e.plane,n=e.editGeometryOperations}return e})).next((0,C.Cf)(this._view)).next((t=>({...t,rotateAngle:(0,at.cM)(t.mapStart,t.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)}))).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next((t=>{const r=(0,K.c)(this._originCache,i.origin),s="start"===t.action?I.b.NEW_STEP:I.b.ACCUMULATE_STEPS,a=n.rotate(r,t.rotateAngle,s,ot.w.REPLACE);return(0,lt.nn)(a,i),e(t,a),t})).next((t=>("end"===t.action&&(r.cursor="grab"),t)))}))}_createManipulator(){const t=this._view,e=this._graphic;return new G.L({view:t,graphic:e,selectable:!0,cursor:"grab"})}}const ht=1e-6;function ut(t){const e=(0,K.l)(t.basis1),i=(0,K.l)(t.basis2);return.3*Math.min(e,i)}class dt extends P{constructor(t){super(),this._handles=new et.Z,this._planeStart=(0,tt.a)(),this._displayPlaneStart=(0,tt.a)(),this._originCache=(0,$.Ue)(),this._axisCache=(0,J.Ue)(),this._renderStartCache=(0,$.Ue)(),this._renderEndCache=(0,$.Ue)(),this._resizeOriginCache=(0,$.Ue)(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",(t=>nt(t,this._manipulator)))]),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this._handles.destroy(),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,T.SCALE)}createDragPipeline(t,e){let i=null,n=null,r=null,s=0,a=null,o=null;const l=this._planeStart,c=this._displayPlaneStart,h=this._direction;return(0,C.Xd)(this._manipulator,((u,d)=>{d.next((e=>{if("start"===e.action){u.cursor="grabbing";const e=t();i=e.plane,n=e.displayPlane,r=e.editGeometryOperations,s=10*this._view.resolution,(0,tt.c)(i,l),(0,tt.c)(n,c);const o=(0,w.C5)(r.data.spatialReference);a=o?o.valid[1]-o.valid[0]-30*this._view.resolution:null}return e})).next((0,C.Cf)(this._view)).next((t=>{const e=(0,K.c)(this._renderStartCache,[t.mapStart.x,t.mapStart.y,0]),i=(0,K.c)(this._renderEndCache,[t.mapEnd.x,t.mapEnd.y,0]),r=(0,K.c)(this._resizeOriginCache,c.origin);(0,K.r)(r,r,c.basis1,-h[0]),(0,K.r)(r,r,c.basis2,-h[1]),(0,K.f)(i,i,r),(0,K.f)(e,e,r);const a=0!==h[0]&&0!==h[1],o=ut(c),l=ut(n)/o,u=(t,n)=>{if(0===t)return 1;let r=(0,K.l)(n),o=.5*t*(0,K.m)(n,i)/r;const c=o<0?-1:1;a&&(o+=(r-.5*t*(0,K.m)(n,e)/r)*c*l);const h=r<1.5*s?1:ht;return r=Math.max(r-s,ht),c>0&&(o-=10*this._view.resolution),c*Math.max(c*(o/r),h)},d=u(h[0],c.basis1),p=u(h[1],c.basis2);return{...t,direction:h,factor1:d,factor2:p}})).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next((t=>{const n=(0,K.c)(this._originCache,l.origin);(0,K.r)(n,n,l.basis1,-h[0]),(0,K.r)(n,n,l.basis2,-h[1]);const s=(0,X.t8)(this._axisCache,l.basis1[0],l.basis1[1]);(0,X.Fv)(s,s);const c=r.data.allVertices,u="start"===t.action?I.b.NEW_STEP:I.b.ACCUMULATE_STEPS,d=r.scaleVertices(c,n,s,t.factor1,t.factor2,u,ot.w.REPLACE);return a&&a<r.data.geometry.extent.width&&o?r.updateVertices(c,o):((0,tt.c)(l,i),(0,lt.nn)(d,i),o=d.operation,e(t,d)),t})).next((t=>("end"===t.action&&(u.cursor="grab"),t)))}))}_createManipulator(){return new G.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}var pt=i(87888),_t=i(84954),gt=i(74923),ft=i(72612),mt=i(80885),vt=i(61459);O.C;const yt=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let xt=class extends N.m{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,tt.a)(),this._displayPlaneCache=(0,tt.a)(),this._mainAxisCache=(0,J.Ue)(),this._rotationHandleCache=(0,$.Ue)(),this._cornerA=(0,$.Ue)(),this._cornerB=(0,$.Ue)(),this._cornerC=(0,$.Ue)(),this._cornerD=(0,$.Ue)(),this._avgAB=(0,$.Ue)(),this._avgBC=(0,$.Ue)(),this._avgCD=(0,$.Ue)(),this._avgDA=(0,$.Ue)(),this._preserveAspectRatio=new rt,this._snapRotation=new st,this._graphicsLayer=new k.default({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach((t=>t.destroy())),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,a.SC)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(null==t)return null;const e=this._editGeometryOperations.data,i=e.components[0].edges[0],n=(0,X.$X)(this._mainAxisCache,i.leftVertex.pos,i.rightVertex.pos);(0,X.Fv)(n,n);let r=80*this.view.resolution;const s=this.view.spatialReference;return(0,w.fS)(s,t.spatialReference)&&(r*=(0,q.c9)(s)/(0,q.c9)(t.spatialReference)),(0,lt.lv)(n,e,r,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,tt.c)(t,e);const i=10*this.view.resolution;return(0,K.j)(e.basis1,e.basis1,1+i/(0,K.l)(e.basis1)),(0,K.j)(e.basis2,e.basis2,1+i/(0,K.l)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new mt.Z({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,K.n)(e,t.basis1),(0,K.j)(e,e,30*this.view.resolution),(0,K.g)(e,e,t.origin),(0,K.g)(e,e,t.basis1),new y.Z({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:i,_cornerB:n,_cornerC:r,_cornerD:s}=this,a=(0,K.o)(this._avgAB,i,n,.5),o=(0,K.o)(this._avgBC,n,r,.5),l=(0,K.o)(this._avgCD,r,s,.5),c=(0,K.o)(this._avgDA,s,i,.5);return[new y.Z({x:i[0],y:i[1],spatialReference:e}),new y.Z({x:n[0],y:n[1],spatialReference:e}),new y.Z({x:r[0],y:r[1],spatialReference:e}),new y.Z({x:s[0],y:s[1],spatialReference:e}),new y.Z({x:a[0],y:a[1],spatialReference:e}),new y.Z({x:o[0],y:o[1],spatialReference:e}),new y.Z({x:l[0],y:l[1],spatialReference:e}),new y.Z({x:c[0],y:c[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,i="georeference"in e?e.georeference.coords:e.geometry,n=this._editGeometryOperations,r=n.data.components[0].vertices,s=_t.XE.fromGeometry((0,R.project)(i,t.spatialReference),A.JY.Local).components[0].vertices;r.forEach(((t,e)=>{n.setVertexPosition(t,s[e].pos)})),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=t.georeference;"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach(((t,e)=>{this._scaleGraphics[e].geometry=t}))}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}async _initialize(){const{view:t,target:e}=this;if("georeference"in e){const t=e.georeference;this._graphic=new r.Z({geometry:t.coords}),this._initialControlPoints="control-points"===t.type?t.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;t.map.addMany([this._graphicsLayer]),t.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=Z.c.fromGeometry((0,R.project)(this._graphic.geometry,t.spatialReference),A.JY.Local),this._backgroundGraphic=new r.Z({symbol:new vt.default({color:"transparent",outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new r.Z({symbol:new d.default({color:(0,Q.mj)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map((e=>new r.Z({symbol:new d.default({size:6,style:"square",color:(0,Q.mj)(t.effectiveTheme.accentColor),outline:{type:"simple-line",color:t.effectiveTheme.accentColor,width:1}}),geometry:e}))),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new U({tool:this,view:t,graphic:this._graphic}),this._rotateManipulation=new ct({tool:this,view:t,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map(((e,i)=>new dt({tool:this,view:t,graphic:e,direction:yt[i],preserveAspectRatio:this._preserveAspectRatio}))),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map((t=>t.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)))),(0,o.watch)((()=>this.view.scale),(()=>this.active?this.updateGraphics():null)),t.on("click",(async i=>{if(null!=t.activeTool&&t.activeTool!==this)return;const n=(0,ft.vT)(i),r=[];t.map.allLayers.forEach((t=>{"vector-tile"!==t.type&&"imagery"!==t.type||r.push(t)}));const s=await this.view.hitTest(n,{exclude:r}),a=s.results;if(0===a.length)t.activeTool=null;else{const i=(0,gt.qm)(s.results),n="georeference"in e,r=a.map((t=>"media"===t.type?t.element:null)).filter(Boolean),o=new Set([...this._graphicsLayer.graphics,n?null:e].filter(Boolean));n&&r.includes(e)||null!=i&&o.has(i.graphic)?null==t.activeTool&&(t.activeTool=this):t.activeTool=null}}))]);const i=t=>{this.addHandles(t.events.on("grab-changed",(t=>{"georeference"in e&&("start"===t.action?e.opacity*=.5:"end"===t.action&&(e.opacity*=2))})))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach((t=>t.forEachManipulator(i)));const n=new pt.G7;n.addToggle(pt.Lk.preserveAspectRatio,(()=>{null==this.preserveAspectRatio&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)})),n.addToggle(pt.Lk.rotateIncrements,(()=>{null==this.snapRotation&&(this._snapRotation.enabled=!this._snapRotation.enabled)})),n.add(pt.Lk.toggleOpacity,(()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)})),n.addToggle(pt.Lk.factorModifier,(t=>this._factor="key-down"===t.type?10:1)),n.add(pt.Lk.scaleUp,(()=>this._scale(this._factor))),n.add(pt.Lk.scaleDown,(()=>this._scale(-this._factor))),n.add(pt.Lk.moveUp,(()=>this._move(0,this._factor))),n.add(pt.Lk.moveDown,(()=>this._move(0,-this._factor))),n.add(pt.Lk.moveLeft,(()=>this._move(-this._factor,0))),n.add(pt.Lk.moveRight,(()=>this._move(this._factor,0))),this.addHandles([t.on("key-down",(e=>{t.activeTool===this&&n.dispatch(t.inputManager,e)})),t.on("key-up",(e=>{t.activeTool===this&&n.dispatch(t.inputManager,e)}))])}async _loadProjectionEngine(){const t=this._graphic.geometry;return(0,R.initializeProjection)(t.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:i,origin:n}=t,r=this._cornerA;(0,K.g)(r,n,e),(0,K.g)(r,r,i);const s=this._cornerB;(0,K.g)(s,n,e),(0,K.f)(s,s,i);const a=this._cornerC;(0,K.f)(a,n,e),(0,K.f)(a,a,i);const o=this._cornerD;(0,K.f)(o,n,e),(0,K.g)(o,o,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){var e;const i=this._editGeometryOperations,n=null===(e=i.data.geometry.extent)||void 0===e?void 0:e.width,r=(n+t*this.view.resolution)/n,s=i.scale(this._plane.origin,J.E9,r,r,I.b.NEW_STEP,ot.w.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const i=this._editGeometryOperations.move(t*this.view.resolution,e*this.view.resolution,0,I.b.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,n._)([(0,l.Cb)()],xt.prototype,"_plane",null),(0,n._)([(0,l.Cb)()],xt.prototype,"_backgroundGraphicGeometry",null),(0,n._)([(0,l.Cb)()],xt.prototype,"_rotateGraphicGeometry",null),(0,n._)([(0,l.Cb)()],xt.prototype,"_scaleGraphicGeometries",null),(0,n._)([(0,l.Cb)()],xt.prototype,"preserveAspectRatio",void 0),(0,n._)([(0,l.Cb)()],xt.prototype,"snapRotation",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],xt.prototype,"target",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],xt.prototype,"view",void 0),xt=(0,n._)([(0,c.j)("esri.views.2d.interactive.editingTools.TransformTool")],xt);var Et=i(7138);const bt="r",Tt="z";let St=class extends Et.default{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:t,mediaElement:e,preserveAspectRatio:i,snapRotation:n,advancedMode:r}=this;this._originalOpacity=e.opacity,this._transformTool=new xt({target:e,view:t,preserveAspectRatio:i,snapRotation:n}),this._controlPointsTransformTool=new Y({mediaElement:e,view:t}),this._advancedModeTransformTool=new Y({mediaElement:r.mediaElement,view:r.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const s=e.georeference,a=r.mediaElement.georeference;r.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in a&&"controlPoints"in s&&this.addHandles([r.view.on("key-down",(t=>{t.key===Tt&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===bt&&this.canRedo()&&(this.redo(),t.stopPropagation())})),r.view.on("focus",(async t=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()})),(0,o.watch)((()=>a.controlPoints),(t=>{var e;s.controlPoints=t.map(((t,e)=>{let{sourcePoint:i}=t;return{sourcePoint:i,mapPoint:s.controlPoints[e].mapPoint}})),null===(e=this._activeTool)||void 0===e||e.refresh()})),(0,o.watch)((()=>this._controlPointsTransformTool.activeHandle),(t=>{this._advancedModeTransformTool.updateActiveHandle(t),this.activeHandle=t})),(0,o.watch)((()=>this._advancedModeTransformTool.activeHandle),(t=>{this._controlPointsTransformTool.updateActiveHandle(t),this.activeHandle=t}))]),this.addHandles([t.on("key-down",(t=>{t.key===Tt&&this.canUndo()&&(this.undo(),t.stopPropagation()),t.key===bt&&this.canRedo()&&(this.redo(),t.stopPropagation())})),t.on("focus",(async t=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()}))]),t.tools.addMany([this._transformTool,this._controlPointsTransformTool]),t.activeTool=this._transformTool,this._activeTool=this._transformTool,t.focus()}destroy(){var t,e;null!==(t=this._transformTool)&&void 0!==t&&t.destroy(),null!==(e=this._controlPointsTransformTool)&&void 0!==e&&e.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){var t;const{tool:e,operation:i}=this._sharedUndoStack.pop();e!==this._activeTool&&e.refresh(),i.undo(),e.updateGraphics(),this._sharedRedoStack.push({tool:e,operation:i}),this._activeTool!==e&&(null===(t=this._activeTool)||void 0===t||t.refresh())}}redo(){if(this._sharedRedoStack.length>0){var t;const{tool:e,operation:i}=this._sharedRedoStack.pop();e!==this._activeTool&&e.refresh(),i.apply(),e.updateGraphics(),this._sharedUndoStack.push({tool:e,operation:i}),this._activeTool!==e&&(null===(t=this._activeTool)||void 0===t||t.refresh())}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,n._)([(0,l.Cb)()],St.prototype,"activeHandle",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],St.prototype,"advancedMode",void 0),(0,n._)([(0,l.Cb)()],St.prototype,"preserveAspectRatio",void 0),(0,n._)([(0,l.Cb)()],St.prototype,"snapRotation",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],St.prototype,"mediaElement",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],St.prototype,"view",void 0),St=(0,n._)([(0,c.j)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],St)},20008:(t,e,i)=>{i.d(e,{Ru:()=>h,bA:()=>c,cM:()=>u,e7:()=>l});var n=i(16889),r=i(65156),s=i(376),a=i(69662);function o(t,e,i,n){var r,s;if(null==n||t.hasZ||(n=void 0),"point"===t.type)return t.x+=e,t.y+=i,t.hasZ&&null!=n&&(t.z+=n),t;if("multipoint"===t.type){const r=t.points;for(let t=0;t<r.length;t++)r[t]=d(r[t],e,i,n);return t}if("extent"===t.type)return t.xmin+=e,t.xmax+=e,t.ymin+=i,t.ymax+=i,null!=n&&(null!==(r=t.zmin)&&void 0!==r||(t.zmin=0),t.zmin+=n,null!==(s=t.zmax)&&void 0!==s||(t.zmax=0),t.zmax+=n),t;const o=(0,a.nA)(t),l="polyline"===t.type?t.paths:t.rings;for(let a=0;a<o.length;a++){const t=o[a];for(let r=0;r<t.length;r++)t[r]=d(t[r],e,i,n)}return"paths"in t?t.paths=l:t.rings=l,t}function l(t,e,i,n,r){const s=t.clone(),l=n.resolution;if("point"===s.type){if(r)o(s,e*l,-i*l);else{const t=n.state.transform,r=n.state.inverseTransform,a=t[0]*s.x+t[2]*s.y+t[4],o=t[1]*s.x+t[3]*s.y+t[5];s.x=r[0]*(a+e)+r[2]*(o+i)+r[4],s.y=r[1]*(a+e)+r[3]*(o+i)+r[5]}return s}if("multipoint"===s.type){if(r)o(s,e*l,-i*l);else{const t=s.points,r=n.state.transform,a=n.state.inverseTransform;for(let n=0;n<t.length;n++){const s=t[n],o=r[0]*s[0]+r[2]*s[1]+r[4],l=r[1]*s[0]+r[3]*s[1]+r[5],c=a[0]*(o+e)+a[2]*(l+i)+a[4],h=a[1]*(o+e)+a[3]*(l+i)+a[5];t[n]=p(s,c,h,void 0)}}return s}if("extent"===s.type){if(r)o(s,e*l,-i*l);else{const t=n.state.transform,r=n.state.inverseTransform,a=t[0]*s.xmin+t[2]*s.ymin+t[4],o=t[1]*s.xmin+t[3]*s.ymin+t[5],l=t[0]*s.xmax+t[2]*s.ymax+t[4],c=t[1]*s.xmax+t[3]*s.ymax+t[5];s.xmin=r[0]*(a+e)+r[2]*(o+i)+r[4],s.ymin=r[1]*(a+e)+r[3]*(o+i)+r[5],s.xmax=r[0]*(l+e)+r[2]*(c+i)+r[4],s.ymax=r[1]*(l+e)+r[3]*(c+i)+r[5]}return s}if(r)o(s,e*l,-i*l);else{const t=(0,a.nA)(s),r="polyline"===s.type?s.paths:s.rings,o=n.state.transform,l=n.state.inverseTransform;for(let n=0;n<t.length;n++){const r=t[n];for(let t=0;t<r.length;t++){const n=r[t],s=o[0]*n[0]+o[2]*n[1]+o[4],a=o[1]*n[0]+o[3]*n[1]+o[5],c=l[0]*(s+e)+l[2]*(a+i)+l[4],h=l[1]*(s+e)+l[3]*(a+i)+l[5];r[t]=p(n,c,h,void 0)}}"paths"in s?s.paths=r:s.rings=r}return s}function c(t,e,i,n){if("point"===t.type){const{x:r,y:s}=t,a=n?n[0]:r,o=n?n[1]:s,l=t.clone(),c=(r-a)*e+a,h=(s-o)*i+o;return l.x=c,l.y=h,l}if("multipoint"===t.type){const o=(0,a.nA)(t),l=(0,r.Ue)(),[c,h,u,d]=(0,s.C6)(l,[o]),_=n?n[0]:(c+u)/2,g=n?n[1]:(d+h)/2,f=t.clone(),m=f.points;for(let t=0;t<m.length;t++){const n=m[t],[r,s]=n,a=(r-_)*e+_,o=(s-g)*i+g;m[t]=p(n,a,o,void 0)}return f}if("extent"===t.type){const{xmin:r,xmax:s,ymin:a,ymax:o}=t,l=n?n[0]:(r+s)/2,c=n?n[1]:(o+a)/2,h=t.clone();if(h.xmin=(r-l)*e+l,h.ymax=(o-c)*i+c,h.xmax=(s-l)*e+l,h.ymin=(a-c)*i+c,h.xmin>h.xmax){const t=h.xmin,e=h.xmax;h.xmin=e,h.xmax=t}if(h.ymin>h.ymax){const t=h.ymin,e=h.ymax;h.ymin=e,h.ymax=t}return h}const o=(0,a.nA)(t),l=(0,r.Ue)(),[c,h,u,d]=(0,s.C6)(l,o),_=n?n[0]:(c+u)/2,g=n?n[1]:(d+h)/2,f=t.clone(),m="polyline"===f.type?f.paths:f.rings;for(let r=0;r<o.length;r++){const t=o[r];for(let n=0;n<t.length;n++){const s=t[n],[a,o]=s,l=(a-_)*e+_,c=(o-g)*i+g;m[r][n]=p(s,l,c,void 0)}}return"paths"in f?f.paths=m:f.rings=m,f}function h(t,e,i,n,r,s){const a=Math.sqrt((i-t)*(i-t)+(n-e)*(n-e));return Math.sqrt((r-t)*(r-t)+(s-e)*(s-e))/a}function u(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=Math.atan2(e.y-i.y,e.x-i.x)-Math.atan2(t.y-i.y,t.x-i.x),a=Math.atan2(Math.sin(s),Math.cos(s));return r?a:(0,n.BV)(a)}function d(t,e,i,n){return p(t,t[0]+e,t[1]+i,null!=t[2]&&null!=n?t[2]+n:void 0)}function p(t,e,i,n){const r=[e,i];return t.length>2&&r.push(null!=n?n:t[2]),t.length>3&&r.push(t[3]),r}},75248:(t,e,i)=>{var n;i.d(e,{n:()=>n}),function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"}(n||(n={}))},93463:(t,e,i)=>{i.d(e,{G5:()=>k,T8:()=>n,sq:()=>M,z4:()=>m});var n,r=i(100),s=(i(93169),i(32718)),a=i(92026),o=i(90941),l=i(27546),c=i(66978),h=i(94172),u=i(76432),d=i(38499),p=i(41388),_=i(32609),g=i(75248),f=i(73553);function m(){return new R.Scheduler}!function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(n||(n={}));const v=new Map([[n.RESOURCE_CONTROLLER_IMMEDIATE,0],[n.RESOURCE_CONTROLLER,4],[n.SLIDE,0],[n.STREAM_DATA_LOADER,0],[n.ELEVATION_QUERY,0],[n.TERRAIN_SURFACE,1],[n.SURFACE_GEOMETRY_UPDATES,1],[n.LOD_RENDERER,2],[n.GRAPHICS_CORE,2],[n.I3S_CONTROLLER,2],[n.POINT_CLOUD_LAYER,2],[n.FEATURE_TILE_FETCHER,2],[n.OVERLAY,4],[n.STAGE,4],[n.GRAPHICS_DECONFLICTOR,4],[n.FILTER_VISIBILITY,4],[n.SCALE_VISIBILITY,4],[n.FRUSTUM_VISIBILITY,4],[n.CLOUDS_GENERATOR,4],[n.POINT_OF_INTEREST_FREQUENT,6],[n.POINT_OF_INTEREST_INFREQUENT,30],[n.LABELER,8],[n.FEATURE_QUERY_ENGINE,8],[n.FEATURE_TILE_TREE,16],[n.FEATURE_TILE_TREE_ACTIVE,0],[n.ELEVATION_ALIGNMENT,12],[n.ELEVATION_ALIGNMENT_SCENE,14],[n.TEXT_TEXTURE_ATLAS,12],[n.TEXTURE_UNLOAD,12],[n.LINE_OF_SIGHT_TOOL,16],[n.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[n.SNAPPING,0],[n.SHADOW_ACCUMULATOR,30]]);function y(t){return v.has(t)?v.get(t):"number"==typeof t?t:1}const x=(0,d.HA)(6.5),E=(0,d.HA)(1),b=(0,d.HA)(30),T=(0,d.HA)(1e3/30),S=(0,d.HA)(100);var R,w;!function(t){t.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((t=>t.needsUpdate))}constructor(){this._updating=(0,u.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=g.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,h.watch)((()=>_.Z.SCHEDULER_LOG_SLOW_TASKS),(t=>this._debug=t),h.initial);for(const t of Object.keys(n))this.performanceInfo.tasks.set(n[t],new o.Z(n[t]))}destroy(){this._tasks.toArray().forEach((t=>t.remove())),this._tasks.clear(),(0,a.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(t){this._updatingChanged(),t&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(t,i){const n=new e(this,t,i);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(t)||this.performanceInfo.tasks.set(t,new o.Z(t)),n}registerIdleStateCallbacks(t,e){const i={idleBegin:t,idleEnd:e};this._idleStateCallbacks.push(i),this.state===g.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(t){n._idleUpdatesStartFired&&(i.idleEnd(),n._state===g.n.IDLE&&t()),i.idleBegin=t},set idleEnd(t){i.idleEnd=t}}}get load(){return this._load}set state(t){this._state!==t&&(this._state=t,this.state!==g.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((t=>t.idleEnd()))))}get state(){return this._state}updateBudget(t){++this._frameNumber;let e=x,i=t.frameDuration,n=E;switch(this.state){case g.n.IDLE:e=(0,d.HA)(0),i=(0,d.HA)(Math.max(S,t.frameDuration)),n=b;break;case g.n.INTERACTING:i=(0,d.HA)(Math.max(T,t.frameDuration));case g.n.ANIMATING:}return i=(0,d.HA)(i-t.elapsedFrameTime-e),this.state!==g.n.IDLE&&i<E&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,d.HA)(Math.max(i,n)),this._budget.reset(i,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((t=>t.idleBegin()))),this._runIdle();break;case g.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,d.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(t){this._idleUpdatesStartFired&&t.idleEnd(),this._idleStateCallbacks.removeUnordered(t)}removeTask(t){this._tasks.removeUnordered(t),this._runQueue.removeUnordered(t),this._updatingChanged()}_updateTask(t){this._tasks.forAll((e=>{e.name===t&&e.setPriority(t)}))}_getState(t){if(this._runQueue.some((e=>e.name===t)))return w.SCHEDULED;let e=w.IDLE;return this._tasks.forAll((i=>{i.name===t&&i.needsUpdate&&(i.schedulePriority<=1?e=w.READY:e!==w.READY&&(e=w.WAITING))})),e}_getRuntime(t){let e=0;return this._tasks.forAll((i=>{i.name===t&&(e+=i.runtime)})),e}_resetRuntimes(){this._tasks.forAll((t=>t.runtime=0))}_getRunning(){const t=new Map;if(this._tasks.forAll((e=>{e.needsUpdate&&t.set(e.name,(t.get(e.name)||0)+1)})),0===t.size)return null;let e="";return t.forEach(((t,i)=>{e+=t>1?" ".concat(t,"x ").concat(i):" ".concat(i)})),e}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const t=this._tasks.reduce(((t,e)=>e.needsUpdate?++t:t),0);this._load=.9*this._load+t*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((t=>!!t.needsUpdate||(t.schedulePriority=t.basePriority,!1))),this._tasks.forAll((t=>{0===t.basePriority&&t.needsUpdate&&!this._runQueue.includes(t)&&t.blockFrame!==this._frameNumber&&this._runQueue.unshift(t)}));0===this._runQueue.length;){let t=!1,e=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(t=!0,e=Math.max(e,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!t)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const t=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===f.J&&(r.blockFrame=this._frameNumber)}catch(e){s.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(r.name,'"'),e),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,n.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;const a=this._budget.now()-i;if(r.runtime+=a,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+a),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-t)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-t)}_startFrameTaskTimes(){for(const t of Object.keys(n))this._frameTaskTimes.set(n[t],0)}_recordFrameTaskTimes(t){this._frameTaskTimes.forEach(((t,e)=>this.performanceInfo.tasks.get(e).record(t))),this.performanceInfo.total.record(t)}get test(){}};class e{get task(){return this._task.value}get updating(){return this._queue.running}constructor(t,e,i){this._scheduler=t,this.name=e,this.blockFrame=0,this.runtime=0,this._queue=new p.b,this._handles=new r.Z,this._basePriority=y(e),this.schedulePriority=this._basePriority,this._task=(0,u.t)(null!=i?i:this._queue),this._handles.add((0,h.when)((()=>this.task.running),(e=>t.taskRunningChanged(e))))}remove(){this.processQueue(k),this._scheduler.removeTask(this),this.schedule=M.schedule,this.reschedule=M.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(t){if(this.name===t)return;this.name=t;const e=y(t);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=e),this._basePriority=e}get priority(){return this.name}set priority(t){this.setPriority(t)}get needsUpdate(){return this.updating||this.task.running}schedule(t,e,i){return this._queue.push(t,e,i)}reschedule(t,e,i){return this._queue.unshift(t,e,i)}processQueue(t){return this._queue.runTask(t)}}class i{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(t){return!this.done&&(!0===t()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(t){this._enabled=t}reset(t,e){this._begin=this.now(),this._budget=t,this._state=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i}(R||(R={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(w||(w={}));const k=(()=>{const t=new R.Budget;return t.enabled=!1,t})();const M=new class{remove(){}processQueue(){}schedule(t,e,i){try{if((0,c.Hc)(e)){const t=(0,c.zE)();return i?Promise.resolve(i(t)):Promise.reject(t)}return(0,c.gx)(t(k))}catch(n){return Promise.reject(n)}}reschedule(t,e,i){return this.schedule(t,e,i)}}},73553:(t,e,i)=>{i.d(e,{J:()=>n});const n=Symbol("Yield")},32609:(t,e,i)=>{i.d(e,{Z:()=>l});var n=i(27366),r=i(7138),s=i(49861),a=(i(93169),i(32718),i(84936),i(69912));let o=class extends r.default{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,n._)([(0,s.Cb)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,n._)([(0,s.Cb)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=(0,n._)([(0,a.j)("esri.views.support.debugFlags")],o);const l=new o},4914:(t,e,i)=>{i.d(e,{Cr:()=>E,FN:()=>y,KY:()=>v,Sx:()=>u,Uy:()=>p,Z1:()=>_,_e:()=>f,qj:()=>x,un:()=>m,xI:()=>g});var n,r=i(47898),s=i(68860),a=i(32035),o=i(12400),l=i(5986),c=i(92975),h=i(25003);function u(t){return d(t,n.Horizontal)}function d(t,e){const{hasZ:i,spatialReference:a}=t,o=(0,h.m)(a);let l=0;const c=(0,s.j5)(o);if(null==c)return null;const u=e===n.Direct?y:x;for(const n of t.paths){if(n.length<2)continue;const t=n.length-1;for(let e=0;e<t;++e){const t=n[e];T[0]=t[0],T[1]=t[1],T[2]=i?t[2]:0;const r=n[e+1];S[0]=r[0],S[1]=r[1],S[2]=i?r[2]:0;const s=u(T,S,a);if(null==s)return null;l+=s.value}}return(0,r.yG)(l,c)}function p(t,e){const{spatialReference:i}=t;return(0,c.fS)(i,e.spatialReference)?(T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,function(t,e,i){const n=b(t,e,i);return null!=n?{direct:(0,r.yG)(n.direct,n.unit),horizontal:(0,r.yG)(n.horizontal,n.unit),vertical:(0,r.yG)(n.vertical,n.unit)}:null}(T,S,i)):null}function _(t,e){const{spatialReference:i}=t;return(0,c.fS)(i,e.spatialReference)?(T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,y(T,S,i)):null}function g(t,e){const{spatialReference:i}=t;return(0,c.fS)(i,e.spatialReference)?(T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,x(T,S,i)):null}function f(t,e){const{spatialReference:i}=t;return(0,c.fS)(i,e.spatialReference)?(T[0]=t.x,T[1]=t.y,T[2]=t.hasZ?t.z:0,S[0]=e.x,S[1]=e.y,S[2]=e.hasZ?e.z:0,E(T,S,i)):null}function m(t){return null!=t?v(t.hasZ?t.z:0,t.spatialReference):null}function v(t,e){const i=(0,s.y)(e);return null!=i?(0,r.yG)(null!==t&&void 0!==t?t:0,i):null}function y(t,e,i){const s=b(t,e,i,n.Direct);return null!=s?(0,r.yG)(s.direct,s.unit):null}function x(t,e,i){const s=b(t,e,i,n.Horizontal);return null!=s?(0,r.yG)(s.horizontal,s.unit):null}function E(t,e,i){const s=b(t,e,i,n.Vertical);return null!=s?(0,r.yG)(s.verticalSigned,s.unit):null}function b(t,e,i,r){const o=(0,h.m)(i),c=(0,s.j5)(o);if(null==c)return null;const u=e[2]-t[2];if(r===n.Vertical)return{verticalSigned:u,unit:c};if(!(0,l.S)(t,i,R,o)||!(0,l.S)(e,i,w,o))return null;if(r===n.Direct)return{direct:(0,a.p)(w,R),unit:c};if((0,a.s)(k,t[0],t[1],e[2]),!(0,l.S)(k,i,k,o))return null;const d=(0,a.p)(k,w);return r===n.Horizontal?{horizontal:d,unit:c}:{direct:(0,a.p)(w,R),horizontal:d,vertical:Math.abs(u),unit:c}}!function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(n||(n={}));const T=(0,o.Ue)(),S=(0,o.Ue)(),R=(0,o.Ue)(),w=(0,o.Ue)(),k=(0,o.Ue)()},25003:(t,e,i)=>{i.d(e,{m:()=>a});var n=i(83448),r=i(29691),s=i(92975);function a(t){return(0,s.N$)(t)?(0,s.oR)(t)||(0,s.sS)(t)||(0,s.yW)(t)||(0,n.fY)(t)?r.wY:t:(0,r.rS)(t)}}}]);
//# sourceMappingURL=21113.b0570f7a.chunk.js.map