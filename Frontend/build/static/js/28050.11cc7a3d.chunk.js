"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[28050],{97613:(e,t,i)=>{i.d(t,{Z:()=>g});var n=i(27366),r=i(84314),o=i(7138),s=i(11582),a=i(46784),l=i(92026),u=i(49861),d=(i(93169),i(32718),i(84936),i(69912)),c=i(96866),p=i(848),h=i(64575);let v=class extends((0,a.eC)((0,s.J)(o.default))){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return(0,l._W)(this.position,e.position)&&(0,l._W)(this.elevationInfo,e.elevationInfo)&&(0,r.kk)(this.feature,e.feature)}};(0,n._)([(0,u.Cb)({type:p.Z,json:{write:{isRequired:!0}}})],v.prototype,"position",void 0),(0,n._)([(0,u.Cb)({type:h.Z}),(0,c.B)()],v.prototype,"elevationInfo",void 0),(0,n._)([(0,u.Cb)(r.rX)],v.prototype,"feature",void 0),v=(0,n._)([(0,d.j)("esri.analysis.LineOfSightAnalysisObserver")],v);const g=v},33985:(e,t,i)=>{i.d(t,{Z:()=>v});var n=i(27366),r=i(84314),o=i(11582),s=i(46784),a=i(92026),l=i(49861),u=(i(93169),i(32718),i(84936),i(69912)),d=i(96866),c=i(848),p=i(64575);let h=class extends((0,s.eC)(o.j)){constructor(e){super(e),this.position=null,this.elevationInfo=null,this.feature=null}equals(e){return(0,a._W)(this.position,e.position)&&(0,a._W)(this.elevationInfo,e.elevationInfo)&&(0,r.kk)(this.feature,e.feature)}};(0,n._)([(0,l.Cb)({type:c.Z}),(0,d.B)()],h.prototype,"position",void 0),(0,n._)([(0,l.Cb)({type:p.Z}),(0,d.B)()],h.prototype,"elevationInfo",void 0),(0,n._)([(0,l.Cb)(r.rX)],h.prototype,"feature",void 0),h=(0,n._)([(0,u.j)("esri.analysis.LineOfSightAnalysisTarget")],h);const v=h},84314:(e,t,i)=>{function n(e,t){return r(e)===r(t)}function r(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:"";let i=null;return i=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==i?null:"o-".concat(t,"-").concat(i)}i.d(t,{kk:()=>n,pD:()=>r,rX:()=>o});const o={json:{write:{writer:function(e,t){var i;null!=(null===e||void 0===e||null===(i=e.layer)||void 0===i?void 0:i.objectIdField)&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}}},96866:(e,t,i)=>{i.d(t,{B:()=>h});var n=i(10064),r=i(9997),o=i(80292),s=i(35995),a=i(71907),l=i(33397),u=i(25265),d=i(49861),c=i(22892),p=i(53283);function h(e){var t;const i=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return(t,n)=>{const r=function(e,t,i){var n;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,i){const n=(0,l.Oe)(t,i);return{type:String,read:(e,t,i)=>{const r=(0,p.r)(e,t,i);return n.type===String?r:"function"==typeof n.type?new n.type({url:r}):void 0},write:{writer(t,r,a,l){if(null===l||void 0===l||!l.resources)return"string"==typeof t?void(r[a]=(0,p.t)(t,l)):void(r[a]=t.write({},l));const d=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),h=(0,p.t)(d,{...l,verifyItemRelativeUrls:null!==l&&void 0!==l&&l.verifyItemRelativeUrls?{writtenUrls:l.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},p.M.NO),m=n.type!==String&&(!(0,o.l)(this)||(null===l||void 0===l?void 0:l.origin)&&this.originIdOf(i)>(0,u.M9)(l.origin)),y={object:this,propertyName:i,value:t,targetUrl:h,dest:r,targetPropertyName:a,context:l,params:e};null!==l&&void 0!==l&&l.portalItem&&h&&!(0,s.YP)(h)?m&&null!==e&&void 0!==e&&e.contentAddressed?v(y):m?function(e){var t;const{context:i,targetUrl:n,params:r,value:o,dest:a,targetPropertyName:l}=e;if(!i.portalItem)return;const u=i.portalItem.resourceFromPath(n),d=_(o,n,i),p=(0,c.B)(d),h=(0,s.Ml)(u.path),m=null!==(t=null===r||void 0===r?void 0:r.compress)&&void 0!==t&&t;p===h?(i.resources&&g({...e,resource:u,content:d,compress:m,updates:i.resources.toUpdate}),a[l]=n):v(e)}(y):function(e){let{context:t,targetUrl:i,dest:n,targetPropertyName:r}=e;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),n[r]=i)}(y):null!==l&&void 0!==l&&l.portalItem&&(null==h||null!=(0,p.i)(h)||(0,s.jc)(h)||m)?v(y):r[a]=h}}}}(e,t,i);switch(null!==(n=null===e||void 0===e?void 0:e.type)&&void 0!==n?n:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=p.b;return{read:e,write:t}}}}(e,t,n);for(const e of i){const i=(0,d.CJ)(t,e,n);for(const e in r)i[e]=r[e]}}}function v(e){var t,i,o,l;const{targetUrl:u,params:d,value:h,context:v,dest:m,targetPropertyName:y}=e;if(!v.portalItem)return;const f=(0,p.p)(u),b=_(h,u,v);if(null!==d&&void 0!==d&&d.contentAddressed&&"json"!==b.type)return void(null===(t=v.messages)||void 0===t||t.push(new n.Z("persistable:contentAddressingUnsupported",'Property "'.concat(y,'" is trying to serializing a resource with content of type ').concat(b.type," with content addressing. Content addressing is only supported for json resources."),{content:b})));const C=null!==d&&void 0!==d&&d.contentAddressed&&"json"===b.type?(0,r.F)(b.jsonString):null!==(i=null===f||void 0===f?void 0:f.filename)&&void 0!==i?i:(0,a.DO)(),w=(0,s.v_)(null!==(o=null===d||void 0===d?void 0:d.prefix)&&void 0!==o?o:null===f||void 0===f?void 0:f.prefix,C),I="".concat(w,".").concat((0,c.B)(b));if(null!==d&&void 0!==d&&d.contentAddressed&&v.resources&&"json"===b.type){var O;const e=null!==(O=v.resources.toKeep.find((e=>{let{resource:t}=e;return t.path===I})))&&void 0!==O?O:v.resources.toAdd.find((e=>{let{resource:t}=e;return t.path===I}));if(e)return void(m[y]=e.resource.itemRelativeUrl)}const S=v.portalItem.resourceFromPath(I);(0,s.jc)(u)&&v.resources&&v.resources.pendingOperations.push((0,s.gi)(u).then((e=>{S.path="".concat(w,".").concat((0,c.B)({type:"blob",blob:e})),m[y]=S.itemRelativeUrl})).catch((()=>{})));const E=null!==(l=null===d||void 0===d?void 0:d.compress)&&void 0!==l&&l;v.resources&&g({...e,resource:S,content:b,compress:E,updates:v.resources.toAdd}),m[y]=S.itemRelativeUrl}function g(e){let{object:t,propertyName:i,updates:n,resource:r,content:o,compress:s}=e;n.push({resource:r,content:o,compress:s,finish:e=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(t,i,e)}})}function _(e,t,i){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(i))}}},80292:(e,t,i)=>{function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>n})},22892:(e,t,i)=>{i.d(t,{B:()=>r});var n=i(35995);function r(e){return o[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){const t=(0,n.Ml)(e);return l[t]||s}(e.url)}(e)]||a}const o={},s="text/plain",a=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const u in l)o[l[u]]=u},98074:(e,t,i)=>{i.d(t,{p:()=>l});var n=i(27366),r=i(42537),o=i(67426),s=i(49861),a=(i(93169),i(32718),i(84936),i(69912));const l=e=>{let t=class extends((0,o.v)(e)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(e){this._userInteractive=e}get updating(){return!1}get visible(){return null==this.parent||this.parent.visible&&!this.parent.suspended}set visible(e){this._overrideIfSome("visible",e)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,r.kB)((()=>this._interactiveViewModelCount--))}};return(0,n._)([(0,s.Cb)({constructOnly:!0})],t.prototype,"parent",void 0),(0,n._)([(0,s.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,n._)([(0,s.Cb)({type:Boolean})],t.prototype,"interactive",null),(0,n._)([(0,s.Cb)()],t.prototype,"_userInteractive",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,n._)([(0,s.Cb)()],t.prototype,"visible",null),(0,n._)([(0,s.Cb)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,n._)([(0,a.j)("esri.views.3d.analysis.AnalysisView3D")],t),t}},77897:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Ne});var n=i(27366),r=i(7138),o=i(80987),s=i(91505),a=(i(93169),i(92026)),l=i(49861),u=i(32718),d=(i(84936),i(69912)),c=i(12400),p=i(98074),h=(i(59486),i(84314)),v=i(14921),g=i(100),_=i(42537),m=i(66978),y=i(94172),f=i(32035),b=i(46634),C=i(79803),w=i(77258),I=i(65156),O=i(40885),S=i(74509);let E=class extends r.default{constructor(e){super(e),this.target=null,this.intersectedGraphic=null,this.intersectedLocation=null,this.elevationAlignedTargetLocation=null,this.visible=void 0}};(0,n._)([(0,l.Cb)()],E.prototype,"target",void 0),(0,n._)([(0,l.Cb)()],E.prototype,"intersectedGraphic",void 0),(0,n._)([(0,l.Cb)()],E.prototype,"intersectedLocation",void 0),(0,n._)([(0,l.Cb)()],E.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,l.Cb)({type:Boolean})],E.prototype,"visible",void 0),E=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],E);let T=class extends r.default{constructor(e){super(e),this.elevationAlignedTargetLocation=null,this.inputPoints={isValid:!1,observer:(0,c.Ue)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,c.Ue)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,c.Ue)(),targetAdjusted:(0,c.Ue)()},this.computationResult={start:(0,c.Ue)(),end:(0,c.Ue)(),intersection:(0,c.Ue)(),isValid:!1,isTargetVisible:!1},this.result=null}notifyResultChanged(){this.notifyChange("computationResult")}notifyInputPointsChanged(){this.notifyChange("inputPoints")}};(0,n._)([(0,l.Cb)()],T.prototype,"target",void 0),(0,n._)([(0,l.Cb)()],T.prototype,"elevationAlignedTargetLocation",void 0),(0,n._)([(0,l.Cb)()],T.prototype,"inputPoints",void 0),(0,n._)([(0,l.Cb)()],T.prototype,"computationResult",void 0),(0,n._)([(0,l.Cb)()],T.prototype,"result",void 0),T=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],T);var P,R=i(17842),A=i(51378),M=i(65618),L=i(63780),x=i(84652);let V=P=class extends r.default{constructor(e){super(e)}clone(){return new P({type:this.type,id:(0,x.d9)(this.id),mapPoint:(0,x.d9)(this.mapPoint),renderPoint:(0,c.d9)(this.renderPoint),normal:(0,x.d9)(this.normal),ray:(0,x.d9)(this.ray),graphic:this.graphic})}equals(e){return this.type===e.type&&this.id===e.id&&(0,a._W)(this.mapPoint,e.mapPoint)&&(0,f.G)(this.renderPoint,e.renderPoint)&&(0,L.fS)(this.normal,e.normal)&&(0,O.fS)(this.ray,e.ray)&&this.graphic===e.graphic}};(0,n._)([(0,l.Cb)()],V.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"id",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"mapPoint",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"renderPoint",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"normal",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"graphic",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],V.prototype,"ray",void 0),V=P=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],V);var H=i(85312),j=i(81703),D=i(43449),z=i(88153),U=i(54463),F=i(41781),k=i(848);let G=class extends r.default{constructor(e){super(e),this._terrainIntersectionOptionsLayerUids=new Set(["terrain"])}initialize(){this.intersector=(0,z.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=U.eC.MIN}getScreenPointIntersection(e){const t=(0,R.md)(e,A.qW.get()),i=(0,j.u4)(this.view.state.camera,t,q);return this._getRayIntersection(i)}_getRayIntersection(e,t){if(null==e||null==this.view.sceneIntersectionHelper)return null;const{intersector:i}=this;i.options.store=U.eC.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,i,t);const n=i.results.min,r=(0,c.Ue)();if(!n.getIntersectionPoint(r))return null;if(null!=(null===t||void 0===t?void 0:t.maxDistance)&&(0,f.a)(r,e.origin)>t.maxDistance**2)return null;const o=this.view.renderCoordsHelper.fromRenderCoords(r,new k.Z({spatialReference:this.view.spatialReference})),s=(0,c.d9)(n.normal);if((0,H.GS)(n))return new V({type:U.q7.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),mapPoint:o,renderPoint:r,normal:s,ray:(0,O.JG)(e),graphic:null});if((0,H.BF)(n))return new V({type:U.q7.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.graphicUid),mapPoint:o,renderPoint:r,normal:s,ray:(0,O.JG)(e),graphic:null});if((0,D.TX)(n))return new V({type:U.q7.TERRAIN,id:n.target.lij.slice(),mapPoint:o,renderPoint:r,normal:s,ray:(0,O.JG)(e),graphic:null});const a=(0,F.tB)(n,this.view);if(null!=a){const t=a.layer,i=a.sourceLayer;let n;return n=i&&"scene"===i.type?(0,M.MS)(a,i.objectIdField):a.uid,new V({type:U.q7.OBJECT,id:"".concat(null===t||void 0===t?void 0:t.uid,"/").concat(n),mapPoint:o,renderPoint:r,normal:s,ray:(0,O.JG)(e),graphic:a})}return null}updateFromGroundIntersection(e,t,i){const n=Z,r=N,o=B,s=W;(0,f.c)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,f.n)(o,o);const a=this.view.basemapTerrain.visibleElevationBounds,l=(t>=0?1:-1)*((a?Math.abs(a.max-a.min):100)+Math.abs(t));(0,f.j)(s,o,l),(0,f.g)(n,r,s),(0,O.zk)(n,r,q);const u=this._getRayIntersection(q,{include:this._terrainIntersectionOptionsLayerUids,maxDistance:l});if(null!=u){const e=W;return(0,f.j)(e,o,t),(0,f.g)(i,u.renderPoint,e),(0,c.d9)(u.normal)}return(0,f.c)(i,e),null}};(0,n._)([(0,l.Cb)()],G.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],G.prototype,"intersector",void 0),G=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],G);const Z=(0,c.Ue)(),N=(0,c.Ue)(),B=(0,c.Ue)(),W=(0,c.Ue)(),q=(0,O.Ue)();var X=i(33906),J=i(93463);let Y=class extends(s.Z.EventedMixin(r.default)){constructor(e){super(e),this.updateOnCameraChange=!0,this._observerGroundOffsetRenderSpace=0,this._effectiveObserverElevationMode="absolute-height",this._observerFeatureId=null,this._updatingHandles=new b.R,this._frameTask=J.sq,this._computationHandles=new g.Z,this._externalObserverUpdate=!0}initialize(){var e;const t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(J.T8.LINE_OF_SIGHT_TOOL):J.sq,this._intersector=new G({view:this.view}),this.addHandles([this._connectObserver(),this._connectComputations(),this._connectTargets()])}destroy(){this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}get updating(){return this._frameTask.updating||this._updatingHandles.updating}get priority(){return this._frameTask.priority}set priority(e){this._frameTask.priority=e}get _computations(){return this.analysisViewData.computations}get _elevationAlignedObserverPositionRenderSpace(){return this.analysisViewData.observerEngineLocation}set _elevationAlignedObserverPositionRenderSpace(e){this.analysisViewData.observerEngineLocation=e}get _screenPixelSize(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}_computeResult(e){const t=e.computation,{inputPoints:i,computationResult:n}=t,{observerAdjusted:r,targetAdjusted:o}=i,{start:s,end:a}=n;(0,f.c)(s,r),(0,f.c)(a,o),this._canCompute(t)?this._computeIntersection(e):function(e){let{computation:t,interpolationInfo:i}=e;const{computationResult:n,inputPoints:r}=t,{start:o,end:s,intersection:a}=n,{originalIntersection:l,originalObserver:u,originalTarget:d}=i;if((0,f.c)(a,l),r.isValid){const e=ee,t=(0,f.F)(u,l)/(0,f.F)(u,d);(0,f.z)(e,o,u),(0,f.j)(e,e,1-t),(0,f.g)(a,a,e),(0,f.z)(e,s,d),(0,f.j)(e,e,t),(0,f.g)(a,a,e),n.isValid=!0}else t.result=null,n.isValid=!1,n.isTargetVisible=!1}(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}_updateAdjustedPointsFromFeatures(e){const t=this.view,{sceneIntersectionHelper:i}=t,{inputPoints:n}=e,{observerAdjusted:r,observerFeatureId:o,targetFeatureId:s,targetAdjusted:a}=n;if(null==o&&null==s)return;const l=(0,f.p)(r,a),u=this._intersector.intersector,d=(0,O.zk)(n.observer,n.target,te);u.options.store=U.eC.ALL,i.intersectToolIntersectorRay(d,u);let p=null,v=null,g=null,_=null;for(const c of u.results.all){const e=(0,F.tB)(c,this.view);if(null==e||null==c.distanceInRenderSpace)continue;const i=(0,h.pD)(e);null!=i&&(null!=o&&i===o&&(null==p&&(p=$(c,t,l)),c.distanceInRenderSpace<p&&(g=c)),null!=s&&i===s&&(null==v&&(v=$(c,t,l)),null==_&&c.distanceInRenderSpace<l&&l-c.distanceInRenderSpace<v&&(_=c)))}null!=g&&g.getIntersectionPoint(r)&&(n.observerSurfaceNormal=g.getTransformedNormal((0,c.Ue)())),null!=_&&_.getIntersectionPoint(a)&&(n.targetSurfaceNormal=_.getTransformedNormal((0,c.Ue)()))}_adjustStartEndPositions(e){const t=this._screenPixelSize,i=this.view,{inputPoints:n}=e,{observer:r,observerSurfaceNormal:o,target:s,targetSurfaceNormal:a,observerAdjusted:l,targetAdjusted:u}=n,d=ee;(0,f.c)(l,r),(0,f.c)(u,s),this._updateAdjustedPointsFromFeatures(e),null!=o?(0,f.c)(d,o):(0,f.f)(d,u,l);const c=t;(0,f.n)(d,d),(0,f.j)(d,d,Math.min(c,1)),(0,f.g)(l,l,d),null!=a?(0,f.c)(d,a):(0,f.f)(d,l,u);const p=i.state.camera.computeScreenPixelSizeAt(u);(0,f.n)(d,d),(0,f.j)(d,d,Math.min(p,1)),(0,f.g)(u,u,d)}_computeIntersection(e){let{computation:t,interpolationInfo:i}=e;const{view:n}=this,{sceneIntersectionHelper:r,renderCoordsHelper:o}=n;if(null==r)return;const s=this._intersector.intersector,{computationResult:a,inputPoints:l}=t,{observer:u,target:d}=l,{start:c,end:p}=a,h=(0,O.zk)(c,p,te);s.options.store=U.eC.MIN,r.intersectToolIntersectorRay(h,s);const v=s.results.min,g=a.intersection,_=ee;let m=!0;if(null!=v&&v.getIntersectionPoint(g)){(0,f.c)(i.originalIntersection,g),(0,f.c)(i.originalObserver,c),(0,f.c)(i.originalTarget,p),o.fromRenderCoords(g,_,n.spatialReference);const e=1-(0,f.F)(p,d)/(0,f.F)(c,d);m=(0,f.F)(u,g)>=e*(0,f.F)(u,d)}const y=new k.Z(_,n.spatialReference);{const{result:e,target:i}=t;null!=e?(e.target=i,e.intersectedGraphic=m?null:(0,F.tB)(v,n),e.intersectedLocation=m?null:y,e.visible=m):t.result=new E({target:i,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:m?null:(0,F.tB)(v,n),intersectedLocation:m?null:y,visible:m})}a.isValid=l.isValid=!0,a.isTargetVisible=m}_canCompute(e){const t=this.analysisViewData.elevationAlignedObserver,i=this.view.frustum;if(null==t||null==e.elevationAlignedTargetLocation||null==i)return!1;const{observerAdjusted:n,targetAdjusted:r}=e.inputPoints,o=i.intersectsPoint(n),s=i.intersectsPoint(r);return o&&s}_onObserverPositionChange(e,t,i,n,r){if(this._externalObserverUpdate=r,null==e)return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(null==t)return(0,X.e)(this.analysis,e.spatialReference,u.Z.getLogger(this)),void(this.analysisViewData.elevationAlignedObserver=null);const o=K(t,i),{absoluteZ:s,elevation:a}=(0,S.tq)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),l=t.clone();l.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=l;const d=(0,c.Ue)();this.view.renderCoordsHelper.toRenderCoords(l,d),this._elevationAlignedObserverPositionRenderSpace=d,this._observerGroundOffsetRenderSpace=s-a,this._observerFeatureId=(0,h.pD)(n),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onObserverRenderSpacePositionChangeForComputation(e,t,i,n,r){const{inputPoints:o}=e;switch((0,f.c)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,n){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(o.observer,i,o.observer);null==o.observerFeatureId&&(o.observerSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_onTargetPositionChange(e,t,i,n,r){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const s=e.inputPoints;if(o&&(s.isValid=!1),null==i)return null!=t&&(0,X.e)(this.analysis,t.spatialReference,u.Z.getLogger(this)),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();const a=K(i,n),{absoluteZ:l,elevation:d}=(0,S.tq)(i.x,i.y,i.z,this.view.spatialReference,this.view,a),c=i.clone();switch(c.z=l,e.elevationAlignedTargetLocation=c,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,s.target),s.targetFeatureId=(0,h.pD)(r),s.targetSurfaceNormal=null,a.mode){case"on-the-ground":case"relative-to-ground":{const e=this._intersector.updateFromGroundIntersection(s.target,l-d,s.target);null==s.targetFeatureId&&(s.targetSurfaceNormal=e)}}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=J.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}_connectComputationToTarget(e){return(0,_.AL)([this._updatingHandles.add((()=>({computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,C.projectOrLoad)(e.target.position,this.view.spatialReference)})),(e=>{let{computation:t,targetPosition:i,targetElevationInfo:n,targetFeatureInfo:r,projectedTargetPosition:o}=e;null==o.pending?this._onTargetPositionChange(t,i,o.geometry,n,r):this._updatingHandles.addPromise(o.pending)}),y.initial)])}_connectComputationToObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this.analysisViewData.elevationAlignedObserver})),(e=>{let{computation:t}=e;this._externalObserverUpdate&&(t.inputPoints.isValid=!1,t.notifyInputPointsChanged())}),y.initial)}_connectComputationToRenderSpaceObserver(e){return this._updatingHandles.add((()=>({computation:e,observer:this._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:this._observerGroundOffsetRenderSpace,observerElevationMode:this._effectiveObserverElevationMode,observerFeatureId:this._observerFeatureId})),(e=>{let{computation:t,observer:i,observerGroundOffset:n,observerElevationMode:r,observerFeatureId:o}=e;this._onObserverRenderSpacePositionChangeForComputation(t,i,n,r,o)}),y.initial)}_connectComputationToCamera(e){return this._updatingHandles.add((()=>({camera:this.view.state.camera,isDirty:this._isCameraDirty})),(t=>{let{isDirty:i}=t;!this.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}))}_connectComputationToSlicePlane(e){return this._updatingHandles.add((()=>this.view.slicePlane),(()=>{e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}_connectComputationToElevation(e){const t=(i,n)=>{const r=this.analysis.observer,o=e.target;let s=null,a=null,l=null,u=null,d=null,c=null;if(null!=(null===r||void 0===r?void 0:r.position)){const e=(0,C.projectOrLoad)(r.position,this.view.spatialReference);if(null!=e.pending)return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));s=e.geometry,a=r.elevationInfo,l=r.feature}if(null!=o.position){const e=(0,C.projectOrLoad)(o.position,this.view.spatialReference);if(null!=e.pending)return this._updatingHandles.addPromise(e.pending),void e.pending.finally((()=>t(i,n)));u=e.geometry,d=o.elevationInfo,c=o.feature}null==s&&null==u||((0,w.d)(i,n,ie,this.view.spatialReference),null!=s&&(0,I.Qn)(ie,s)&&this._onObserverPositionChange(null!=r?r.position:null,s,a,l,!1),null!=u&&(0,I.Qn)(ie,u)&&this._onTargetPositionChange(e,o.position,u,d,c,!1),null!=s&&null!=u&&(0,I.I7)(ie,s,u)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(e=>{let{extent:i,spatialReference:n}=e;return t(i,n)}))}_connectComputationToTask(e){let t=null;const i={computation:e,interpolationInfo:{originalIntersection:(0,c.Ue)(),originalObserver:(0,c.Ue)(),originalTarget:(0,c.Ue)()}};return(0,_.AL)([this._updatingHandles.add((()=>e.inputPoints),(()=>{t=(0,a.IM)(t),t=(0,v.vr)((async e=>{await(0,m.R8)(this._frameTask.schedule((()=>this._computeResult(i)),e))}))}),{initial:!0,equals:()=>!1}),(0,_.kB)((()=>t=(0,a.IM)(t)))])}_connectComputation(e){const t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_onComputationCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_onTargetCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._removeTarget(n);for(const n of t)this._addTarget(n)}_onCursorTargetChange(e,t){null!=t&&this._removeTarget(t),null!=e&&this._addTarget(e)}_addTarget(e){this._computations.some((t=>t.target===e))||this._computations.add(new T({target:e}))}_removeTarget(e){const t=this._computations.findIndex((t=>t.target===e));this._computations.removeAt(t)}_connectObserver(){return(0,_.AL)([this._updatingHandles.add((()=>({observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,projectedObserverPosition:(0,C.projectOrLoad)(null!=this.analysis.observer?this.analysis.observer.position:null,this.view.spatialReference),observerElevationInfo:null!=this.analysis.observer?this.analysis.observer.elevationInfo:null,observerFeatureInfo:null!=this.analysis.observer?this.analysis.observer.feature:null})),(e=>{let{observerPosition:t,projectedObserverPosition:i,observerElevationInfo:n,observerFeatureInfo:r}=e;null==i.pending?this._onObserverPositionChange(t,i.geometry,n,r,!0):this._updatingHandles.addPromise(i.pending)}),y.initial)])}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this._computations),(e=>this._onComputationCollectionChange(e)),{initial:!0,final:!0})}_connectTargets(){return(0,_.AL)([this._updatingHandles.addOnCollectionChange((()=>this.analysis.targets),(e=>this._onTargetCollectionChange(e)),{initial:!0,final:!0}),this._updatingHandles.add((()=>this.analysisViewData.cursorTarget),((e,t)=>{this._onCursorTargetChange(e,t)}))])}get _isCameraDirty(){const e=this.analysisViewData.elevationAlignedObserver,{view:t}=this,{renderCoordsHelper:i}=t;if(null==e||null==i)return!1;const n=ee;i.toRenderCoords(e,n);const r=t.state.camera.computeScreenPixelSizeAt(n);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>Q}};function $(e,t,i){if((0,F._s)(e)){const n=(0,F.VB)(e,t);if(null!=n)return Math.min(n*ne,i)}return 1e-5*i}function K(e,t){return e.hasZ?null!==t&&void 0!==t?t:{mode:"absolute-height",offset:0}:{mode:"on-the-ground",offset:0}}(0,n._)([(0,l.Cb)({constructOnly:!0})],Y.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Y.prototype,"view",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"updating",null),(0,n._)([(0,l.Cb)()],Y.prototype,"priority",null),(0,n._)([(0,l.Cb)()],Y.prototype,"updateOnCameraChange",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_computations",null),(0,n._)([(0,l.Cb)()],Y.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,n._)([(0,l.Cb)()],Y.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_effectiveObserverElevationMode",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_observerFeatureId",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_screenPixelSize",null),(0,n._)([(0,l.Cb)({readOnly:!0})],Y.prototype,"_updatingHandles",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_frameTask",void 0),(0,n._)([(0,l.Cb)()],Y.prototype,"_isCameraDirty",null),Y=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],Y);const Q=.1,ee=(0,c.Ue)(),te=(0,O.Ue)(),ie=(0,I.cS)(),ne=.05;var re=i(51995),oe=i(97613),se=i(33985),ae=i(85981),le=i(64575),ue=i(86950);const de=new class{constructor(){this.glowWidth=8,this.innerWidth=.75}};const ce=new class{constructor(){this.size=.5}};function pe(e){return(0,ue.Ch)(e.accentColor,.75)}const he=new class{constructor(){this.size=.5,this.visibleColor=new re.Z([3,252,111,.75]),this.occludedColor=new re.Z([252,3,69,.75]),this.undefinedColor=new re.Z([127,127,127,.75])}};const ve=new class{constructor(){this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new re.Z([3,252,111,1]),this.visibleOuterColor=new re.Z([3,252,111,.15]),this.occludedInnerColor=new re.Z([252,3,69,1]),this.occludedOuterColor=new re.Z([252,3,69,.1]),this.undefinedInnerColor=new re.Z([255,255,255,1]),this.undefinedOuterColor=new re.Z([127,127,127,.2])}};var ge=i(35284),_e=i(83639),me=i(40508),ye=i(81655),fe=i(70619),be=i(99034);class Ce extends ge.Z{constructor(e,t){const i=(0,_e.EA)(pe(e.effectiveTheme)),n=(0,fe.PI)(i,ce.size,32,32),r=new me.r(n);super({view:e,renderObjects:[r],metadata:t,elevationInfo:{mode:"absolute-height",offset:0}}),(0,ye.c)(this),this.themeHandle=(0,y.watch)((()=>({color:pe(e.effectiveTheme)})),(e=>{i.setParameters(e)}))}destroy(){this.themeHandle.remove(),super.destroy()}}class we extends ge.Z{constructor(e,t){const{size:i,visibleColor:n,occludedColor:r,undefinedColor:o}=he;super({view:e,renderObjects:[Ie(i,n,be.jg.Custom1),Ie(i,r,be.jg.Custom2),Ie(i,o,be.jg.Custom3)],metadata:t,elevationInfo:{mode:"absolute-height",offset:0}}),(0,ye.c)(this)}}function Ie(e,t,i){return new me.r((0,fe.PI)((0,_e.EA)(re.Z.toUnitRGBA(t)),e,32,32),i)}var Oe,Se=i(96026),Ee=(i(84057),i(86509)),Te=i(74229),Pe=i(72612),Re=i(63920);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Oe||(Oe={}));let Ae=class extends Ee.f{constructor(e){super(e),this.removeIncompleteOnCancel=!1,this.analysisViewData=null,this._latestPointerMovePointerType=null,this._laserlineVisualElement=null,this._grabbedManipulator=null,this._analysisHandles=new g.Z,this._updatingHandles=new b.R,this._manipulatorHandles=new g.Z,this._targetTrackerManipulator=null}initialize(){this._intersector=new G({view:this.view}),this.addHandles((0,y.watch)((()=>this.state),(e=>{e===Oe.Created&&this.finishToolCreation()}),y.syncAndInitial)),this._observerManipulator=this._createObserverManipulator(),this._createLaserLine(),this.addHandles([this._updatingHandles.add((()=>{var e;return null===(e=this.analysisViewData)||void 0===e?void 0:e.elevationAlignedObserver}),(e=>this._onObserverLocationChange(e)),y.initial),this._updatingHandles.add((()=>function(e){const t=e.accentColor;return{glowColor:t,innerColor:(0,ue.mj)(t),globalAlpha:.75*t.a}}(this.view.effectiveTheme)),(e=>{let{glowColor:t,innerColor:i,globalAlpha:n}=e;return this._updateLaserLineStyle(t,i,n)}),y.initial),this._updatingHandles.add((()=>this._laserLineRendererDependencies()),(e=>this._updateLaserLineRenderer(e))),this._connectComputations(),this._updatingHandles.addWhen((()=>!this._shouldRenderTracker),(()=>this._clearCursorTracker()),y.initial)])}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles),this._manipulatorHandles=(0,a.SC)(this._manipulatorHandles),this._analysisHandles=(0,a.SC)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeLaserLine(),this._intersector=null,this._set("analysis",null)}get state(){var e;return this.active?this.hasGrabbedManipulators?Oe.Created:Oe.Creating:null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?Oe.Created:Oe.Ready}get cursor(){return this.active&&this._showTracker?"crosshair":null}get updating(){return null!=this.analysisViewData&&this.analysisViewData.updating||this._updatingHandles.updating}get _showTracker(){return this.active&&"mouse"===this._latestPointerMovePointerType}get _shouldRenderTracker(){var e;return this._showTracker&&null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)&&!this.hasGrabbedManipulators}continue(){this.view.activeTool=this}stop(){this.view.activeTool=null}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}onInputEvent(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}onInputEventAfter(e){"immediate-click"===e.type&&this._clickHandler(e)}onShow(){}onHide(){}onDeactivate(){this._clearCursorTracker()}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_connectComputation(e){if(this.destroyed)return void u.Z.getLogger(this).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");const t=this._analysisHandles;if(t.has(e))return;const i=this._createTargetManipulator(e.target);null==this._targetTrackerManipulator&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),t.add([this._updatingHandles.add((()=>function(e){const{isValid:t,isTargetVisible:i}=e.computationResult;return{isValid:t,isTargetVisible:i}}(e)),(()=>function(e,t){const{isValid:i,isTargetVisible:n}=t.computationResult;e.state=i?n?be.jg.Custom1:be.jg.Custom2:be.jg.Custom3}(i,e)),y.initial),this._updatingHandles.add((()=>e.elevationAlignedTargetLocation),(e=>this._onTargetLocationChange(e,i)),y.initial)],e)}_disconnectComputation(e){if(this.destroyed)return void u.Z.getLogger(this).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");this._analysisHandles.remove(e);const t=this._getTargetManipulator(e.target);null!=t&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),null!=this._targetTrackerManipulator&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}_clearCursorTracker(){this.analysisViewData.cursorTarget=(0,a.SC)(this.analysisViewData.cursorTarget)}_createTargetManipulator(e){const t={target:e,type:"target"},i=new we(this.view,t);return this._manipulatorHandles.add([this._createTargetManipulatorDragPipeline(i),i.events.on("grab-changed",(e=>this._manipulatorGrabChanged(i,e))),i.events.on("immediate-click",(e=>this._manipulatorClick(i,e)))],i),this.manipulators.add(i),null!=e.position?i.elevationAlignedLocation=e.position:i.available=!1,i}_getTargetManipulator(e){let t=null;return this.manipulators.forEach((i=>{const n=i.manipulator;null==t&&"target"===n.metadata.type&&n.metadata.target===e&&(t=n)})),t}_createObserverManipulator(){const e=new Ce(this.view,{type:"observer",intersection:null});return this._manipulatorHandles.add([this._createObserverManipulatorDragPipeline(e),e.events.on("grab-changed",(t=>this._manipulatorGrabChanged(e,t))),e.events.on("immediate-click",(t=>this._manipulatorClick(e,t)))],e),this.manipulators.add(e),e}_screenToIntersection(){return e=>{const t=this._intersector.getScreenPointIntersection(e.screenEnd);return null==t?null:{...e,intersection:t}}}_createTargetManipulatorDragPipeline(e){return(0,Te.Xd)(e,((t,i,n)=>{i.next(this._screenToIntersection()).next(this._updateTargetDragStep(e)).next((()=>this._updateLaserLineRenderer())),n.next(function(e){var t;const i=null===(t=e.position)||void 0===t?void 0:t.clone();return t=>(e.position=i,t)}(e.metadata.target)).next((()=>this._updateLaserLineRenderer()))}))}_createObserverManipulatorDragPipeline(e){return(0,Te.Xd)(e,((e,t,i)=>{t.next(this._screenToIntersection()).next(this._updateObserverDragStep()).next((()=>this._updateLaserLineRenderer())),i.next(this._cancelObserverDragStep()).next((()=>this._updateLaserLineRenderer()))}))}_updateObserverDragStep(){return e=>(null!=e.intersection.mapPoint?(null==this.analysis.observer&&(this.analysis.observer=new oe.Z),this._updateFromIntersection(this.analysis.observer,e.intersection)):this.analysis.observer=null,e)}_cancelObserverDragStep(){var e;const t=null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?this.analysis.observer.clone():null;return e=>(this.analysis.observer=t,e)}_updateTargetDragStep(e){return t=>{this._updateFromIntersection(e.metadata.target,t.intersection);const i=t.intersection.mapPoint;return null!=i&&(e.elevationAlignedLocation=i),t}}_manipulatorGrabChanged(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}_laserLineRendererDependencies(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,visible:this.visible}}_updateLaserLineRenderer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies();const{laserlineVisualElement:t,grabbedManipulator:i,shouldRenderTracker:n,observerPosition:r,visible:o}=e;if(null==t)return;const s=null!=i?i:n&&null!=r?this._targetTrackerManipulator:null;null!=s&&o?(t.visible=!0,t.heightManifoldTarget=s.renderLocation,s!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,ae.zk)(this._observerManipulator.renderLocation,s.renderLocation,Me):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}_createLaserLine(){this._removeLaserLine();const{glowWidth:e,innerWidth:t}=de;this._laserlineVisualElement=new Se.W({view:this.view,attached:!0,visible:this.visible,style:{glowWidth:e,innerWidth:t},isDecoration:!0})}_removeLaserLine(){null!=this._laserlineVisualElement&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}_updateLaserLineStyle(e,t,i){const n=this._laserlineVisualElement;if(null==n)return;const r=n.style;n.style={...r,glowColor:re.Z.toUnitRGB(e),innerColor:re.Z.toUnitRGB(t),globalAlpha:i}}_onObserverLocationChange(e){null!=e?(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e):this._observerManipulator.available=!1}_onTargetLocationChange(e,t){null!=e?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}_addPointFromClickEvent(e){var t;const i=this._intersector.getScreenPointIntersection(e);if(null!=(null===i||void 0===i?void 0:i.mapPoint))if(null!=(null===(t=this.analysis.observer)||void 0===t?void 0:t.position)){this._clearCursorTracker();const e=new se.Z;this._updateFromIntersection(e,i),this.analysis.targets.add(e)}else{const e=new oe.Z;this._updateFromIntersection(e,i),this.analysis.observer=e}}_clickHandler(e){this.active&&e.button!==Re.t.Right&&(this._addPointFromClickEvent((0,Pe.vT)(e)),e.stopPropagation())}_doubleClickHandler(e){this.active&&e.button!==Re.t.Right&&(this.stop(),e.stopPropagation())}_keyDownHandler(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}_pointerMoveHandler(e){var t;if(this.hasGrabbedManipulators)return;if(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),!this._showTracker||null==(null===(t=this.analysis.observer)||void 0===t?void 0:t.position))return;const i=(0,Pe.vT)(e),n=this._intersector.getScreenPointIntersection(i);null!=(null===n||void 0===n?void 0:n.mapPoint)&&(null==this.analysisViewData.cursorTarget&&(this.analysisViewData.cursorTarget=new se.Z),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}_updateFromIntersection(e,t){if(null==t.mapPoint)return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case U.q7.OBJECT:if(null!=t.graphic){const i=t.graphic,n=(0,S.RL)(i);"on-the-ground"===n.mode&&(n.mode="relative-to-ground",n.offset=0),e.elevationInfo=new le.Z(n),e.feature=i}else e.elevationInfo=null,e.feature=null;break;case U.q7.TERRAIN:e.elevationInfo=new le.Z({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}const i=t.mapPoint.clone();i.z=(0,S.vQ)(this.view,i,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=i}_manipulatorClick(e,t){if("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==Re.t.Right||this.analysis.targets.length<=1)return;const{target:i}=e.metadata;this.analysis.targets.remove(i),t.stopPropagation()}get testInfo(){}};(0,n._)([(0,l.Cb)({constructOnly:!0})],Ae.prototype,"view",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ae.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ae.prototype,"state",null),(0,n._)([(0,l.Cb)({readOnly:!0})],Ae.prototype,"cursor",null),(0,n._)([(0,l.Cb)()],Ae.prototype,"removeIncompleteOnCancel",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ae.prototype,"updating",null),(0,n._)([(0,l.Cb)({constructOnly:!0})],Ae.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ae.prototype,"_showTracker",null),(0,n._)([(0,l.Cb)()],Ae.prototype,"_latestPointerMovePointerType",void 0),(0,n._)([(0,l.Cb)()],Ae.prototype,"_shouldRenderTracker",null),(0,n._)([(0,l.Cb)()],Ae.prototype,"_laserlineVisualElement",void 0),(0,n._)([(0,l.Cb)()],Ae.prototype,"_grabbedManipulator",void 0),Ae=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightTool")],Ae);const Me=(0,ae.Ue)();var Le=i(7025);class xe{constructor(e,t,i,n){this.visibleLineVisualElement=e,this.occludedLineVisualElement=t,this.undefinedLineVisualElement=i,this.targetVisualElement=n}destroy(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}var Ve=i(33837),He=i(66730);i(56529);let je=class extends r.default{constructor(e){super(e),this._lineOfSightVisualElements=new Array,this._computationHandles=new g.Z,this._updatingHandles=new b.R}initialize(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}destroy(){this._updatingHandles=(0,a.SC)(this._updatingHandles),this._computationHandles=(0,a.SC)(this._computationHandles),this._observerVisualElement=(0,a.SC)(this._observerVisualElement)}get visible(){return this.analysisViewData.visible}get updating(){return this._updatingHandles.updating}get interactiveAndEditable(){return this.analysisViewData.interactive&&this.analysisViewData.editable}get test(){}_createLineOfSightVisualization(){const e=ve,t=this.view,i=this.isDecoration,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth,isDecoration:i},r=re.Z.toUnitRGBA(e.visibleOuterColor),o=re.Z.toUnitRGBA(e.visibleInnerColor),s=re.Z.toUnitRGBA(e.occludedOuterColor),a=re.Z.toUnitRGBA(e.occludedInnerColor),l=re.Z.toUnitRGBA(e.undefinedOuterColor),u=re.Z.toUnitRGBA(e.undefinedInnerColor),d=new Ve.r({...n,color:r,innerColor:o}),c=new Ve.r({...n,color:s,innerColor:a}),p=new Ve.r({...n,color:l,innerColor:u}),h=new He.L({view:t,attached:!0,...De,size:8,isDecoration:i}),v=new xe(d,c,p,h);return this._lineOfSightVisualElements.push(v),v}_destroyLineOfSightVisualization(e){e.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(e),1)}_updateLineOfSightVisualization(e,t,i){const n=ve,{computationResult:r,inputPoints:o}=e,{start:s,end:a,intersection:l,isValid:u,isTargetVisible:d}=r,{observer:p}=o,h=ke;h[12]=p[0],h[13]=p[1],h[14]=p[2];const v=(0,f.f)(ze,s,p),g=(0,f.f)(Ue,a,p),_=(0,f.f)(Fe,l,p),{visibleLineVisualElement:m,occludedLineVisualElement:y,undefinedLineVisualElement:b,targetVisualElement:C}=t,w=null==this.analysisViewData.elevationAlignedObserver||null==e.elevationAlignedTargetLocation,I=this.visible&&!w;m.visible=I,y.visible=I,b.visible=I,C.visible=I,C.attached=!i.interactiveAndEditable,I&&(m.geometry=null,y.geometry=null,b.geometry=null,C.geometry=e.elevationAlignedTargetLocation,u?d?(m.geometry=[[(0,c.nI)(v),(0,c.nI)(g)]],m.transform=h,m.color=re.Z.toUnitRGBA(n.visibleOuterColor),C.color=re.Z.toUnitRGBA(n.visibleInnerColor)):(m.geometry=[[(0,c.nI)(v),(0,c.nI)(_)]],m.transform=h,m.color=re.Z.toUnitRGBA(n.occludedOuterColor),y.geometry=[[(0,c.nI)(_),(0,c.nI)(g)]],y.transform=h,C.color=re.Z.toUnitRGBA(n.occludedInnerColor)):(b.geometry=[[(0,c.nI)(v),(0,c.nI)(g)]],b.transform=h,C.color=re.Z.toUnitRGBA(n.undefinedInnerColor)))}_getLineOfSightVisualizationDependencies(e){const{computationResult:t}=e,{occludedOuterColor:i,visibleOuterColor:n}=ve;return{computationResult:t,occludedOuterColor:i,visibleOuterColor:n,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}_connectComputation(e){const t=this._computationHandles;if(t.has(e))return;const i=this._createLineOfSightVisualization();t.add([this._updatingHandles.add((()=>this._getLineOfSightVisualizationDependencies(e)),(t=>this._updateLineOfSightVisualization(e,i,t)),{initial:!0,equals:()=>!1}),(0,_.kB)((()=>this._destroyLineOfSightVisualization(i)))],e)}_disconnectComputation(e){this._computationHandles.remove(e)}_connectComputations(){return this._updatingHandles.addOnCollectionChange((()=>this.analysisViewData.computations),(e=>this._onComputationsCollectionChange(e)),{initial:!0,final:!0})}_onComputationsCollectionChange(e){let{added:t,removed:i}=e;for(const n of i)this._disconnectComputation(n);for(const n of t)this._connectComputation(n)}_createObserverVisualization(){const e=re.Z.toUnitRGBA(ve.visibleInnerColor),t=new He.L({view:this.view,color:e,...De,isDecoration:this.isDecoration});this._observerVisualElement=t,this.addHandles(this._updatingHandles.add((()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible})),(e=>{let{observer:i,interactiveAndEditable:n,visible:r}=e;null!=i&&!n&&r?(t.geometry=i,this._observerVisualElement.attached=!0):t.attached=!1}),y.initial))}};(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"analysisViewData",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"view",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],je.prototype,"visible",null),(0,n._)([(0,l.Cb)({constructOnly:!0})],je.prototype,"isDecoration",void 0),(0,n._)([(0,l.Cb)()],je.prototype,"updating",null),(0,n._)([(0,l.Cb)()],je.prototype,"interactiveAndEditable",null),(0,n._)([(0,l.Cb)()],je.prototype,"test",null),je=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],je);const De={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},ze=(0,c.Ue)(),Ue=(0,c.Ue)(),Fe=(0,c.Ue)(),ke=(0,Le.Ue)();var Ge=i(70209);let Ze=class extends((0,p.p)(s.Z.EventedMixin(r.default))){constructor(e){super(e),this.type="line-of-sight-view-3d",this.analysis=null,this.tool=null,this.computations=new o.Z,this.elevationAlignedObserver=null,this.observerEngineLocation=(0,c.Ue)(),this.cursorTarget=null,this.editable=!0}initialize(){const e=this.view,t=this.analysis;this._analysisController=new Y({analysis:t,analysisViewData:this,view:e}),this._analysisVisualization=new je({analysis:t,analysisViewData:this,view:e,isDecoration:!this.parent}),this.addHandles([this._analysisController.on("result-changed",(e=>{e.target!==this.cursorTarget&&this.emit("result-changed",e)})),(0,Ge.Lp)(this,Ae)])}destroy(){(0,Ge.Yq)(this),this._analysisController=(0,a.SC)(this._analysisController),this._analysisVisualization=(0,a.SC)(this._analysisVisualization)}get results(){return this.computations.map((e=>e.result))}get priority(){return this._analysisController.priority}set priority(e){this._analysisController.priority=e}get updating(){return null!=this._analysisController&&this._analysisController.updating||null!=this._analysisVisualization&&this._analysisVisualization.updating}getResultForTarget(e){var t;return null===(t=this.computations.find((t=>t.target===e)))||void 0===t?void 0:t.result}get testInfo(){}};(0,n._)([(0,l.Cb)({readOnly:!0})],Ze.prototype,"type",void 0),(0,n._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],Ze.prototype,"analysis",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"tool",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],Ze.prototype,"results",null),(0,n._)([(0,l.Cb)()],Ze.prototype,"priority",null),(0,n._)([(0,l.Cb)()],Ze.prototype,"computations",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"elevationAlignedObserver",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"observerEngineLocation",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"cursorTarget",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"updating",null),(0,n._)([(0,l.Cb)()],Ze.prototype,"editable",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"_analysisController",void 0),(0,n._)([(0,l.Cb)()],Ze.prototype,"_analysisVisualization",void 0),Ze=(0,n._)([(0,d.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Ze);const Ne=Ze},33906:(e,t,i)=>{i.d(t,{G:()=>o,e:()=>s});var n=i(79803),r=i(77648);function o(e,t,i){var o;let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=(0,n.tryProjectWithZConversion)(e,t);return null==a?null:(a.hasZ&&!s||null==i||(a.z=null!==(o=(0,r.KO)(i,a))&&void 0!==o?o:0),a)}function s(e,t,i){i.warnOnce("Failed to project analysis geometry (id: '".concat(e.id,"'), projection from spatial reference (wkid: '").concat(t.wkid,"') to view spatial reference is not supported. Projection may be possible after calling projection.load()."))}},81655:(e,t,i)=>{i.d(t,{I:()=>o,c:()=>s});var n=i(42537),r=i(74509);function o(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!(0,r.fl)(t)}(null===e||void 0===e?void 0:e.data.coordinateHelper.hasZ(),t)}function s(e,t){let i=null;const r=e.events.on("grab-changed",(n=>{null!=i&&(i.remove(),i=null),"start"===n.action?(i=e.disableDisplay(),t&&t(n)):t&&t(n)}));return(0,n.kB)((()=>{var e;null!==(e=i)&&void 0!==e&&e.remove(),r.remove()}))}},33837:(e,t,i)=>{i.d(t,{r:()=>p});var n=i(29134),r=i(7025),o=i(32035),s=i(12400),a=i(86361),l=i(52168),u=i(79685),d=i(56529),c=i(58901);class p extends l._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._hasExternalMaterial=null!=t,this._material=null!=t?t:new c.U({width:1,color:(0,a.al)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:d.yD.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),this.applyProperties(e)}setGeometryFromRenderSpacePoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}setGeometryFromExtent(e){const t=this.view.spatialReference,i=(0,s.Ue)(),n=(0,s.Ue)(),r=100,a=[];(0,o.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,o.s)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,o.s)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,o.s)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,o.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,o.s)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),this.geometry=[a]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,n=e.basis1,r=e.basis2,o=.5,a=(0,s.Ue)(),l=(0,s.Ue)(),u=(0,s.Ue)(),d=(0,s.Ue)();a[0]=i[0]-n[0]*o-r[0]*o,a[1]=i[1]-n[1]*o-r[1]*o,a[2]=i[2]-n[2]*o-r[2]*o,l[0]=i[0]-n[0]*o+r[0]*o,l[1]=i[1]-n[1]*o+r[1]*o,l[2]=i[2]-n[2]*o+r[2]*o,u[0]=i[0]+n[0]*o+r[0]*o,u[1]=i[1]+n[1]*o+r[1]*o,u[2]=i[2]+n[2]*o+r[2]*o,d[0]=i[0]+n[0]*o-r[0]*o,d[1]=i[1]+n[1]*o-r[1]*o,d[2]=i[2]+n[2]*o-r[2]*o,t.push([a[0],a[1],a[2]]),t.push([l[0],l[1],l[2]]),t.push([u[0],u[1],u[2]]),t.push([d[0],d[1],d[2]]),t.push([a[0],a[1],a[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;this.transform=(0,n.vc)(h,t);const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.AG;this.transform=(0,n.vc)(h,t),this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}getTransformedGeometry(){return null==this._geometry?null:this._geometry.map((e=>e.map((e=>(0,o.h)((0,s.Ue)(),e,this.transform)))))}get renderOccluded(){return this._material.parameters.renderOccluded}set renderOccluded(e){this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._material.parameters.width}set width(e){this._material.setParameters({width:e})}get color(){return this._material.parameters.color}set color(e){const t=1===e[3];this._material.setParameters({color:(0,a.d9)(e),writeDepth:t})}get innerWidth(){return this._material.parameters.innerWidth}set innerWidth(e){this._material.setParameters({innerWidth:e})}get innerColor(){return this._material.parameters.innerColor}set innerColor(e){this._material.setParameters({innerColor:null!=e?(0,a.d9)(e):null})}get stipplePattern(){return this._material.parameters.stipplePattern}set stipplePattern(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}get stippleOffColor(){return this._material.parameters.stippleOffColor}set stippleOffColor(e){this._material.setParameters({stippleOffColor:null!=e?(0,a.d9)(e):null})}get stipplePreferContinuous(){return this._material.parameters.stipplePreferContinuous}set stipplePreferContinuous(e){this._material.setParameters({stipplePreferContinuous:e})}get falloff(){return this._material.parameters.falloff}set falloff(e){this._material.setParameters({falloff:e})}get polygonOffset(){return this._material.parameters.hasPolygonOffset}set polygonOffset(e){this._material.setParameters({hasPolygonOffset:e})}createExternalResources(){}destroyExternalResources(){}createGeometries(e){for(const t of(0,u.c)(this.geometry)){const i=(0,u.Y)(this._material,t);e.addGeometry(i)}}forEachExternalMaterial(e){this._hasExternalMaterial||e(this._material)}}const h=(0,r.Ue)()},66730:(e,t,i)=>{i.d(t,{L:()=>y});var n=i(16889),r=i(32035),o=i(12400),s=i(19093),a=i(86361),l=i(5986),u=i(41414),d=i(51378),c=i(52168),p=i(69691),h=i(78935),v=i(22351),g=i(70619),_=i(4760),m=i(21400);class y extends c._{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,a.al)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,a.al)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,s.a)(e,this._color)||((0,s.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,s.a)(e,this._outlineColor)||((0,s.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(_.T.SIZE).data,n=this._geometrySize;i[0]=n,i[1]=n,e.geometryVertexAttributeUpdated(e.geometries[0],_.T.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,v.Rg)(this._primitive),distanceFieldBoundingBox:b,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null===(e=this._texture)||void 0===e?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/f}createExternalResources(){this._texture=(0,v.cU)(this._primitive,this._preferredTextureSize),this._material=new m.A(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,n.uZ)(2*this._geometrySize,16,128)}calculateMapBounds(e){var t;const i=null===(t=this.object)||void 0===t?void 0:t.geometries[0];if(!i)return!1;const n=i.attributes.get(_.T.POSITION).data;return(0,l.S)(n,this.view.renderCoordsHelper.spatialReference,C,this.view.spatialReference),(0,u.G1)(e,C),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:n}=this.view,o=(0,p.w7)(e,n,h.o.fromElevationInfo(this.elevationInfo),i),s=(0,r.s)(d.WM.get(),e.x,e.y,o),a=d.WM.get();(0,l.S)(s,e.spatialReference,a,i.spatialReference);const u=this._geometrySize;return(0,g.dV)(t,null,a,null,[u,u],[0,0,0,1])}}const f=v.hy,b=[f/2,f/2,1-f/2,1-f/2],C=(0,o.Ue)()},70209:(e,t,i)=>{i.d(t,{Er:()=>a,Lp:()=>l,Yq:()=>u});var n=i(14921),r=i(92026),o=i(66978),s=i(94172);function a(e,t){e.interactive=!0;const{tool:i,view:a}=e;a.activeTool=i;let l=(0,o.fu)(t,(()=>{a.activeTool===i&&(a.activeTool=null)}));return(0,n.vr)((async e=>{await(0,s.whenOnce)((()=>null==i||!i.active),e),l=(0,r.hw)(l)}),t)}function l(e,t){return(0,s.watch)((()=>e.interactive),(()=>function(e,t){e.interactive?function(e,t){u(e);const{view:i,analysis:n}=e,r=new t({view:i,analysis:n,analysisViewData:e});e.tool=r,i.tools.add(r)}(e,t):u(e)}(e,t)),s.syncAndInitial)}function u(e){const{view:t,tool:i}=e;null!=i&&(t.tools.remove(i),e.tool=null)}},86509:(e,t,i)=>{i.d(t,{f:()=>a});var n=i(27366),r=i(94172),o=(i(32718),i(93169),i(84936),i(10064),i(69912)),s=i(45900);let a=class extends s.m{constructor(e){super(e)}initialize(){this.addHandles((0,r.watch)((()=>this.analysisViewData.visible),(e=>this.visible=e),r.syncAndInitial))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};a=(0,n._)([(0,o.j)("esri.views.interactive.AnalysisToolBase")],a)},45900:(e,t,i)=>{i.d(t,{m:()=>d});var n=i(27366),r=i(7138),o=(i(93169),i(32718),i(66978)),s=i(49861),a=(i(84936),i(69912)),l=i(99034),u=i(92853);let d=class extends r.default{constructor(e){super(e),this.manipulators=new u.D,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.bH.MANAGER,!0],[l.bH.USER,!0]]),this._creationFinishedResolver=(0,o.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(l.bH.USER)}set editable(e){this.setEditableFlag(l.bH.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){null!=this.view&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===l.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){var t;return null!==(t=this._editableFlags.get(e))&&void 0!==t&&t}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(l.bH.USER)&&this.getEditableFlag(l.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,n._)([(0,s.Cb)({constructOnly:!0})],d.prototype,"view",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"active",null),(0,n._)([(0,s.Cb)({value:!0})],d.prototype,"visible",null),(0,n._)([(0,s.Cb)({value:!0})],d.prototype,"editable",null),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"manipulators",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"updating",null),(0,n._)([(0,s.Cb)()],d.prototype,"cursor",null),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"automaticManipulatorSelection",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"hasFocusedManipulators",null),(0,n._)([(0,s.Cb)()],d.prototype,"hasGrabbedManipulators",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"hasHoveredManipulators",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"firstGrabbedManipulator",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"created",void 0),(0,n._)([(0,s.Cb)({readOnly:!0})],d.prototype,"removeIncompleteOnCancel",void 0),d=(0,n._)([(0,a.j)("esri.views.interactive.InteractiveToolBase")],d)},92853:(e,t,i)=>{i.d(t,{D:()=>o});var n,r=i(80987);!function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"}(n||(n={}));class o{constructor(){this._isToolEditable=!0,this._manipulators=new r.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;this.addMany([e],t)}addMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;for(const i of e){const e={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((e=>{let{manipulator:t}=e;return t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((r=>{let{manipulator:o,attached:s}=r;if(!s||!o.interactive)return;const a=o.intersectionDistance(e,t);null!=a&&a<n&&(n=a,i=o)})),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===n.Always||(this._isToolEditable?e.visibilityPredicate===n.WhenToolEditable:e.visibilityPredicate===n.WhenToolNotEditable)}}},74229:(e,t,i)=>{i.d(t,{$Q:()=>v,AN:()=>w,BS:()=>T,Cf:()=>m,M2:()=>h,Mz:()=>R,Xd:()=>p,dJ:()=>C,di:()=>f,fW:()=>y,hM:()=>E,kY:()=>O,uI:()=>b,zh:()=>I});var n=i(63780),r=(i(93169),i(84652)),o=i(16889),s=i(17842),a=i(79803),l=i(69048),u=i(37818),d=i(74509),c=i(17877);function p(e,t){return e.events.on("drag",function(e,t){let i=null,n=null;return r=>{if("cancel"===r.action)return void(null!=n&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&null==i&&(i=new E,n=new E,t(e,i,n,r.pointerType,o)),null!=i&&i.execute(o),"end"===r.action&&null!=i&&(i=null,n=null)}}(e,t))}function h(e,t){var i;const n=[e.x,e.y,null!==(i=e.z)&&void 0!==i?i:0],r=t,o=[Math.cos(r),Math.sin(r)],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(0===s)return null;o[0]/=s,o[1]/=s;const a=e=>{const t=(e.x-n[0])*o[0]+(e.y-n[1])*o[1];e.x=n[0]+t*o[0],e.y=n[1]+t*o[1]};return e=>(a(e.mapStart),a(e.mapEnd),{...e,axis:o})}function v(e){let t=null;return i=>{var n,r;if("start"===i.action&&(t=function(e,t){const i=e.operations;if(!i)return null;const n=i.data.geometry,r=(0,u.D)(t);if(n.spatialReference.equals(r))return _(e,i,(()=>{}));if("mesh"!==n.type){const t=g(n,r);if(null==t)return null;const o=n.spatialReference;return _(e,c.c.fromGeometry(t,i.viewingMode),(()=>{const e=(0,a.project)(n,o);i.trySetGeometry(e)}))}if((0,l.QK)(n)){const t=g(n.origin,r);if(!t)return null;const o=n.spatialReference,s=c.c.fromGeometry(t,i.viewingMode);return _(e,i,(()=>{var e,t;const r=(0,a.project)(s.data.geometry,o),l=r.x-n.origin.x,u=r.y-n.origin.y,d=(null!==(e=r.z)&&void 0!==e?e:0)-(null!==(t=n.origin.z)&&void 0!==t?t:0);i.move(l,u,d)}))}return null}(e,i.mapStart.spatialReference)),null==t)return null;const o=i.mapEnd.x-i.mapStart.x,s=i.mapEnd.y-i.mapStart.y,d=(null!==(n=i.mapEnd.z)&&void 0!==n?n:0)-(null!==(r=i.mapStart.z)&&void 0!==r?r:0);return t.move(o,s,d,i.action),{...i,translationX:o,translationY:s,translationZ:d}}}function g(e,t){return null==e?null:e.spatialReference.equals(t)?e.clone():(0,a.project)(e,t)}function _(e,t,i){let n=0,r=0,o=0;return{move:(s,a,l,u)=>{var d;"start"===u&&(n=0,r=0,o=0);const c=s-n,p=a-r,h=l-o;t.move(c,p,h),n+=c,r+=p,o+=h,i(),"end"===u&&(null===(d=e.endInteraction)||void 0===d||d.call(e))}}}function m(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=null;const o=null==i||null!==(t=e.spatialReference)&&void 0!==t&&t.equals(i)?e=>e:e=>null!=e?(0,a.project)(e,i):e,s={exclude:[],...n};return t=>{if("start"===t.action&&(r=o(e.toMap(t.screenStart,s))),null==r)return null;const i=o(e.toMap(t.screenEnd,s));return null!=i?{...t,mapStart:r,mapEnd:i}:null}}function y(e){const t=e.map((e=>v(e))).filter(n.pC);return e=>{const i=e.mapEnd.x-e.mapStart.x,n=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return t.forEach((t=>t(e))),{...e,translationX:i,translationY:n,translationZ:r}}}function f(e,t){const i=new Map;for(const n of t)i.set(n,(0,r.d9)(e[n]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}function b(e){var t;const i=null===(t=e.operations)||void 0===t?void 0:t.createResetState();return e=>(null!==i&&void 0!==i&&i.remove(),e)}function C(e){const t=e.map((e=>b(e))).filter((e=>null!=e));return e=>(t.forEach((t=>t(e))),e)}function w(){let e=0,t=0,i=0;return n=>{"start"===n.action&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const r=n.mapEnd.x-e,o=n.mapEnd.y-t,s=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function I(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,r=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:r}}}function O(e,t){let i=null,n=0,r=0;return a=>{var l;if("start"===a.action&&(i=null===(l=e.toScreen)||void 0===l?void 0:l.call(e,t),null!=i&&(i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=a.screenStart.x-i.x,r=a.screenStart.y-i.y))),null==i)return null;const u=(0,o.uZ)(a.screenEnd.x-n,0,e.width),d=(0,o.uZ)(a.screenEnd.y-r,0,e.height),c=(0,s.vW)(u,d);return a.screenStart=i,a.screenEnd=c,a}}const S=()=>{};class E{constructor(){this.execute=S}next(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E;return null!=e&&(this.execute=i=>{const n=e(i);null!=n&&t.execute(n)}),t}}function T(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===e.type)return e=>e;let n=null;return r=>{"start"===r.action&&(n=e.toMap(r.screenStart,{exclude:i}),null!=n&&(n.z=(0,d.Ou)(n,e,t)));const o=e.toMap(r.screenEnd,{exclude:i});null!=o&&(o.z=(0,d.Ou)(o,e,t));const s=null!=n&&null!=o?{sceneStart:n,sceneEnd:o}:null;return{...r,scenePoints:s}}}function P(e,t,i){var n,r;const o=null!==(n=t.elevationProvider.getElevation(e.x,e.y,null!==(r=e.z)&&void 0!==r?r:0,e.spatialReference,"scene"))&&void 0!==n?n:0,s=(0,u.WG)(e);return s.z=o,s.hasZ=!0,s.z=(0,d.Ou)(s,t,i),s}function R(e,t){if("2d"===e.type)return e=>e;let i=null;return n=>{"start"===n.action&&(i=P(n.mapStart,e,t));const r=P(n.mapEnd,e,t),o=null!=i&&null!=r?{sceneStart:i,sceneEnd:r}:null;return{...n,scenePoints:o}}}},94163:(e,t,i)=>{i.d(t,{SP:()=>n,UG:()=>d,dU:()=>u,k0:()=>a,xO:()=>l});i(16889);var n,r=i(13611),o=i(6644);function s(e,t){return e[0]*t[1]-e[1]*t[0]}function a(e,t,i,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:i;return(0,r.$X)(p,n,i),(0,r.$X)(v,t,o),function(e,t,i){const n=(0,r.AK)(i,t)/(0,r.we)(i);(0,r.bA)(e,i,n)}(g,v,p),(0,r.IH)(e,o,g)}function l(e,t,i,n){(0,r.$X)(p,t,i);const o=n/(0,r.kE)(p);return(0,r.od)(e,i,p,o)}function u(e,t){const i=e.start,o=e.end,a=t.start,l=t.end,u=(0,r.$X)(p,o,i),d=(0,r.$X)(h,l,a),_=s(u,d);if(Math.abs(_)<=c)return[];const m=(0,r.$X)(v,i,a),y=s(d,m)/_,f=s(u,m)/_;if(y>=0){if(f>=0||t.type===n.LINE)return[(0,r.od)(g,i,u,y)]}else if(e.type===n.LINE&&(f>=0||t.type===n.LINE))return[(0,r.od)(g,i,u,y)];return[]}function d(e,t,i){const o=[],s=(0,r.$X)(p,e.end,e.start),a=(0,r.$X)(h,e.start,t),l=(0,r.we)(s),u=2*(0,r.AK)(s,a),d=u*u-4*l*((0,r.we)(a)-i*i);if(0===d){const t=-u/(2*l);(e.type===n.LINE||t>=0)&&o.push((0,r.od)(g,e.start,s,t))}else if(d>0){const t=Math.sqrt(d),i=(-u+t)/(2*l);(e.type===n.LINE||i>=0)&&o.push((0,r.od)(g,e.start,s,i));const a=(-u-t)/(2*l);(e.type===n.LINE||a>=0)&&o.push((0,r.od)(v,e.start,s,a))}return o}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(n||(n={}));const c=1e-6,p=(0,o.Ue)(),h=(0,o.Ue)(),v=(0,o.Ue)(),g=(0,o.Ue)()}}]);
//# sourceMappingURL=28050.11cc7a3d.chunk.js.map