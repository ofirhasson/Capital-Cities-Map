"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[68683],{45028:(e,t,n)=>{n.d(t,{C:()=>x,b:()=>P});var r,i,o,s,a,l,c,u=n(30168),d=n(37081),p=n(33280),h=n(94951),f=n(14801),g=n(48655),v=n(137),_=n(15226),m=n(18607),T=n(26461),E=n(116),O=n(41012),b=n(95276),S=n(98634),A=n(64201),y=n(25920),C=n(4760);function P(e){const t=new A.kG,{vertex:n,fragment:P,attributes:x,varyings:I}=t;(0,O.Sv)(n,e),t.include(h.w,e),t.include(g.c,e),t.include(m.k,e),t.include(f.R,e),x.add(C.T.POSITION,"vec3"),e.vvColor&&x.add(C.T.COLORFEATUREATTRIBUTE,"float"),I.add("vColor","vec4"),I.add("vpos","vec3");const R=e.multipassEnabled&&e.output===d.H_.Color;R&&I.add("depth","float"),n.uniforms.add(new b.N("eColor",(e=>e.color))),n.code.add((0,S.H)(r||(r=(0,u.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n\n      ","\n      ","\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;",R?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(p.f5,e),R&&t.include(_.l,e),P.include(E.Y);const w=e.output===d.H_.Highlight;return w&&t.include(v.bA,e),e.transparencyPassType===y.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),P.code.add((0,S.H)(i||(i=(0,u.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = vColor;\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ",";\n    ","\n  }\n  "])),R?"terrainDepthTest(depth);":"",e.output===d.H_.ObjectAndLayerIdColor?(0,S.H)(o||(o=(0,u.Z)(["fColor.a = 1.0;"]))):"",S.H.float(T.b),e.output===d.H_.Color?(0,S.H)(s||(s=(0,u.Z)(["fragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===y.A.ColorAlpha?(0,S.H)(a||(a=(0,u.Z)(["\n                  fragColor = premultiplyAlpha(fragColor);\n                  fragAlpha = fragColor.a;"]))):""):"",w?(0,S.H)(l||(l=(0,u.Z)(["outputHighlight();"]))):"",e.output===d.H_.ObjectAndLayerIdColor?(0,S.H)(c||(c=(0,u.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const x=Object.freeze(Object.defineProperty({__proto__:null,build:P},Symbol.toStringTag,{value:"Module"}))},83544:(e,t,n)=>{n.d(t,{H:()=>ee,b:()=>X,c:()=>K});var r,i,o,s,a,l,c,u,d,p,h,f,g,v,_,m,T,E,O,b,S,A=n(30168),y=n(13611),C=n(6644),P=n(86361),x=n(37081),I=n(33280),R=n(14801),w=n(28156),N=n(81879),L=n(50913),D=n(55616),U=n(137),z=n(18607),H=n(26461),F=n(116),k=n(78980),j=n(62993),V=n(41012),M=n(82999),G=n(95276),Z=n(58406),B=n(98634),Y=n(64201),Q=n(19253),W=n(25920),q=n(4760);function X(e){const t=new Y.kG,n=e.signedDistanceFieldEnabled;if(t.include(N.R,e),t.include(I.f5,e),e.occlusionPass)return t.include(L.R,e),t;const{vertex:C,fragment:X}=t;t.include(j.cK),X.include(k.n),X.include(F.Y),t.include(z.k,e),t.include(R.R,e),t.include(D.P),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),C.uniforms.add(new G.N("viewport",((e,t)=>t.camera.fullViewport)),new M.A("screenOffset",((e,t)=>(0,y.t8)($,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new M.A("anchorPosition",(e=>K(e))),new G.N("materialColor",(e=>e.color))),(0,V.ZI)(C),n&&(C.uniforms.add(new G.N("outlineColor",(e=>e.outlineColor))),X.uniforms.add(new G.N("outlineColor",(e=>J(e)?e.outlineColor:P.AG)),new Z.p("outlineSize",(e=>J(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&C.include(w.H),e.hasScreenSizePerspective&&((0,j.ww)(C),(0,j.m8)(C)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(q.T.UV0,"vec2"),t.attributes.add(q.T.COLOR,"vec4"),t.attributes.add(q.T.SIZE,"vec2"),t.attributes.add(q.T.FEATUREATTRIBUTE,"vec4"),C.code.add((0,B.H)(r||(r=(0,A.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n      bool visible = testHUDVisibility(posProj);\n      voccluded = visible ? 0.0 : 1.0;\n    "])),e.hasScreenSizePerspective?(0,B.H)(i||(i=(0,A.Z)(["\n            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,B.H)(o||(o=(0,A.Z)(["\n            inputSize = size;\n            vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""));const ee=(0,B.H)(s||(s=(0,A.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),te=e.pixelSnappingEnabled?n?(0,B.H)(a||(a=(0,A.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,B.H)(l||(l=(0,A.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,B.H)(c||(c=(0,A.Z)(["posProj += quadOffset;"])));C.code.add((0,B.H)(u||(u=(0,A.Z)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",ee,e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===x.H_.ObjectAndLayerIdColor?(0,B.H)(d||(d=(0,A.Z)(["vcolor.a = 1.0;"]))):"",B.H.float(H.b),n?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(B.H.float(H.b),";"):"",te,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,B.H)(p||(p=(0,A.Z)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),X.uniforms.add(new Q.A("tex",(e=>e.texture)));const ne=e.debugDrawLabelBorder?(0,B.H)(h||(h=(0,A.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),B.H.float(H.F)):B.H.float(H.F),re=(0,B.H)(f||(f=(0,A.Z)(["\n    ","\n\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,B.H)(g||(g=(0,A.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",e.sampleSignedDistanceFieldTexelCenter?(0,B.H)(v||(v=(0,A.Z)(["\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      float txSize = float(textureSize(tex, 0).x);\n      float texelSize = 1.0 / txSize;\n\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n      "]))):(0,B.H)(_||(_=(0,A.Z)(["\n      vec2 samplePos = vtc;\n      "]))),n?(0,B.H)(m||(m=(0,A.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        fragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        fragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),ne,B.H.float(H.b),ne):(0,B.H)(T||(T=(0,A.Z)(["\n          vec4 texColor = texture(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          fragColor = texColor * premultiplyAlpha(vcolor);\n          "])),ne),e.debugDrawLabelBorder?(0,B.H)(E||(E=(0,A.Z)(["fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");switch(e.output){case x.H_.Color:e.transparencyPassType===W.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),X.code.add((0,B.H)(O||(O=(0,A.Z)(["\n        void main() {\n          ","\n          ","\n          ","\n        }"])),re,e.transparencyPassType===W.A.FrontFace?"fragColor.rgb /= fragColor.a;":"",e.transparencyPassType===W.A.ColorAlpha?"fragAlpha = fragColor.a;":""));break;case x.H_.ObjectAndLayerIdColor:X.code.add((0,B.H)(b||(b=(0,A.Z)(["\n        void main() {\n          ","\n          outputObjectAndLayerIdColor();\n        }"])),re));break;case x.H_.Highlight:X.constants.add("occludedHighlightFlag","vec4",U.Wj),X.constants.add("unoccludedHighlightFlag","vec4",U.ck),X.code.add((0,B.H)(S||(S=(0,A.Z)(["\n        void main() {\n          ","\n          if (voccluded == 1.0) {\n            fragColor = occludedHighlightFlag;\n          } else {\n            fragColor = unoccludedHighlightFlag;\n          }\n        }"])),re))}return t}function J(e){return e.outlineColor[3]>0&&e.outlineSize>0}function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$;return e.textureIsSignedDistanceField?function(e,t,n){null!=t?(0,y.t8)(n,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,y.t8)(n,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,y.JG)(t,e.anchorPosition),t}const $=(0,C.Ue)(),ee=Object.freeze(Object.defineProperty({__proto__:null,build:X,calculateAnchorPosForRendering:K},Symbol.toStringTag,{value:"Module"}))},8623:(e,t,n)=>{n.d(t,{Z:()=>u});var r=n(27366),i=n(11582),o=n(46784),s=n(49861),a=(n(93169),n(32718),n(84936),n(27135)),l=n(69912);let c=class extends((0,i.J)(o.wq)){constructor(e){super(e),this.type="georeferenced",this.origin=null}};(0,r._)([(0,a.J)({georeferenced:"georeferenced"},{readOnly:!0})],c.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:[Number],nonNullable:!1,json:{write:!0}})],c.prototype,"origin",void 0),c=(0,r._)([(0,l.j)("esri.geometry.support.MeshGeoreferencedVertexSpace")],c);const u=c},50250:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(27366),i=n(11582),o=n(46784),s=n(49861),a=(n(93169),n(32718),n(84936),n(27135)),l=n(69912),c=n(12400);let u=class extends((0,i.J)(o.wq)){constructor(e){super(e),this.type="local",this.origin=(0,c.Ue)()}};(0,r._)([(0,a.J)({local:"local"},{readOnly:!0})],u.prototype,"type",void 0),(0,r._)([(0,s.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],u.prototype,"origin",void 0),u=(0,r._)([(0,l.j)("esri.geometry.support.MeshLocalVertexSpace")],u);const d=u},69048:(e,t,n)=>{n.d(t,{G7:()=>f,QK:()=>p,rU:()=>h,vI:()=>g,z1:()=>u,zZ:()=>d});var r=n(44927),i=n(32718),o=n(32035),s=n(848),a=n(8623),l=n(50250);function c(){return i.Z.getLogger("esri.geometry.Mesh")}function u(e){return!d(e)}function d(e){return null!=e.origin}function p(e){return d(e.vertexSpace)}function h(e,t){if(!d(e))return null;const[n,r,i]=e.origin;return new s.Z({x:n,y:r,z:i,spatialReference:t})}function f(e,t){var n,i;const{x:o,y:s,z:u,spatialReference:d}=e,p=[o,s,null!==u&&void 0!==u?u:0];return void 0!==(null===t||void 0===t?void 0:t.geographic)&&((0,r.x9)(c(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&c().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(null!==(n=null!==(i=null===t||void 0===t?void 0:t.vertexSpace)&&void 0!==i?i:function(e){return null==e?void 0:e?"local":"georeferenced"}(null===t||void 0===t?void 0:t.geographic))&&void 0!==n?n:function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(d))?new l.Z({origin:p}):new a.Z({origin:p})}function g(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,o.e)(e.origin,t.origin))}},70178:(e,t,n)=>{n.d(t,{Fz:()=>l,fS:()=>u,kg:()=>a});n(93169);var r=n(16889),i=n(92975);function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r.length!==i.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==i[e])return!1}return!0}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!o(e[n],t[n]))return!1;return!0}function a(e,t){return e===t||null!=e&&null!=t&&(0,i.fS)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function l(e,t,n){var o,s,a,l;return e===t||null!=e&&null!=t&&(0,i.fS)(e.spatialReference,t.spatialReference)&&(0,r.W8)(e.x,t.x,n)&&(0,r.W8)(e.y,t.y,n)&&(0,r.W8)(null!==(o=e.z)&&void 0!==o?o:0,null!==(s=t.z)&&void 0!==s?s:0,n)&&(0,r.W8)(null!==(a=e.m)&&void 0!==a?a:0,null!==(l=t.m)&&void 0!==l?l:0,n)}function c(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return a(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,i.fS)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,i.fS)(e.spatialReference,t.spatialReference)&&s(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,i.fS)(e.spatialReference,t.spatialReference)&&s(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,i.fS)(e.spatialReference,t.spatialReference)&&o(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function u(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!c(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const i of n)if(e[i]!==t[i])return!1;return!0}(e.attributes,t.attributes)}},41388:(e,t,n)=>{n.d(t,{b:()=>s});var r=n(66978),i=n(76432),o=n(73553);class s{constructor(){this._tasks=new Array,this._runningTasks=(0,i.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return o.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,n){return++this._runningTasks.value,new Promise(((r,i)=>this._tasks.push(new a(r,i,e,t,n)))).finally((()=>--this._runningTasks.value))}unshift(e,t,n){return++this._runningTasks.value,new Promise(((r,i)=>this._tasks.unshift(new a(r,i,e,t,n)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const i=(0,r.Hc)(t.signal);if(i&&!t.abortCallback)t.reject((0,r.zE)());else{var n;const o=i?null===(n=t.abortCallback)||void 0===n?void 0:n.call(t,(0,r.zE)()):t.callback(e);(0,r.y8)(o)?o.then(t.resolve,t.reject):t.resolve(o)}}catch(s){t.reject(s)}return!0}cancelAll(){const e=(0,r.zE)();for(const t of this._tasks)if(t.abortCallback){const n=t.abortCallback(e);t.resolve(n)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=n,this.signal=r,this.abortCallback=i}}},96387:(e,t,n)=>{n.d(t,{$o:()=>O,Go:()=>T,Si:()=>C,Uu:()=>E,ZL:()=>A,_Z:()=>y,bD:()=>b,bh:()=>S,zE:()=>v});var r=n(68860),i=n(29134),o=n(7025),s=n(12400),a=n(19093),l=n(86361),c=n(79803),u=n(41414),d=n(65156),p=n(4954),h=n(69662),f=n(55946),g=n(37818);function v(e,t){if("point"===e.type)return m(e,t,!1);if((0,g.Ou)(e))switch(e.type){case"extent":return m(e.center,t,!1);case"polygon":return m(e.centroid,t,!1);case"polyline":return m(_(e),t,!0);case"mesh":return m(e.origin,t,!1)}else switch(e.type){case"extent":return m(function(e){return(0,f.T)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return m(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const n=(0,p.a)(e.rings,!!e.hasZ);return(0,f.T)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return m(_(e),t,!0)}}function _(e){const t=e.paths[0];if(!t||0===t.length)return null;const n=(0,h.n8)(t,(0,h.ok)(t)/2);return(0,f.T)(n[0],n[1],n[2],e.spatialReference)}function m(e,t,n){const r=n?e:(0,g.WG)(e);return t&&e?(0,c.projectPoint)(e,r,t)?r:null:r}function T(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,d.Ue)());const i=e;let o=.5*i.width*(n-1),s=.5*i.height*(n-1);return i.width<1e-7*i.height?o+=s/20:i.height<1e-7*i.width&&(s+=o/20),(0,a.s)(t,i.xmin-o-r,i.ymin-s-r,i.xmax+o+r,i.ymax+s+r),t}return null}function E(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,l.d9)(l.hq);return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),n&&(r[0]*=n,r[1]*=n,r[2]*=n,r[3]*=n),r}function O(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0,0,0];for(let s=0;s<3;++s)o[s]=null!=(null===e||void 0===e?void 0:e[s])?e[s]:null!=(null===n||void 0===n?void 0:n[s])?n[s]:i[s];return o[3]=null!=t?t:null!=r?r:i[3],o}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.hq,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const i=new Array(3);if(null==t||null==n)i[0]=1,i[1]=1,i[2]=1;else{let r,o=0;for(let s=2;s>=0;s--){const a=e[s];let l;const c=null!=a,u=0===s&&!r&&!c,d=n[s];"symbol-value"===a||u?l=0!==d?t[s]/d:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==d?a/d:1),null!=l&&(i[s]=l,r=l,o=Math.max(o,Math.abs(l)))}for(let e=2;e>=0;e--)null==i[e]?i[e]=r:0===i[e]&&(i[e]=.001*o)}for(let o=2;o>=0;o--)i[o]/=r;return(0,s.nI)(i)}function S(e){return A(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function A(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}function y(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.Ue)();return e&&(0,i.jI)(r,r,-e/180*Math.PI),t&&(0,i.lM)(r,r,t/180*Math.PI),n&&(0,i.uD)(r,r,n/180*Math.PI),r}function C(e,t,n){if(null!=n.minDemResolution)return n.minDemResolution;const i=(0,r.c9)(t),o=(0,u.bf)(e)*i,s=(0,u.Ye)(e)*i,a=(0,u.Cb)(e)*(t.isGeographic?1:i);return 0===o&&0===s&&0===a?n.minDemResolutionForPoints:.01*Math.max(o,s,a)}},43449:(e,t,n)=>{n.d(t,{T6:()=>a,TX:()=>s,j9:()=>l});var r=n(54463),i=n(55848),o=n(22178);function s(e){return(0,o.nn)(e)&&e.intersector===r.q7.TERRAIN&&!!e.target}class a extends i.Dx{constructor(e,t,n){super(e,t),this.triangleNr=n}}function l(e){return(0,o.nn)(e)&&e.intersector===r.q7.OVERLAY&&!!e.target}},28156:(e,t,n)=>{n.d(t,{H:()=>l});var r,i,o=n(30168),s=n(13773),a=n(98634);function l(e){e.uniforms.add(new s.U("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add((0,a.H)(r||(r=(0,o.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])))),e.code.add((0,a.H)(i||(i=(0,o.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))))}},81879:(e,t,n)=>{n.d(t,{R:()=>T,c:()=>m});var r,i,o,s,a,l,c,u=n(30168),d=n(49223),p=n(62993),h=n(41012),f=n(95276),g=n(58406),v=n(98634),_=n(4760);const m=.5;function T(e,t){e.include(p.cK),e.attributes.add(_.T.POSITION,"vec3"),e.attributes.add(_.T.NORMAL,"vec3"),e.attributes.add(_.T.CENTEROFFSETANDDISTANCE,"vec4");const n=e.vertex;(0,h.Sv)(n,t),(0,h.hY)(n,t),n.uniforms.add(new f.N("viewport",((e,t)=>t.camera.fullViewport)),new g.p("polygonOffset",(e=>e.shaderPolygonOffset)),new g.p("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,d.V)(n),n.constants.add("smallOffsetAngle","float",.984807753012208),n.code.add((0,v.H)(r||(r=(0,u.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),n.code.add((0,v.H)(i||(i=(0,u.Z)(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = ",";\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is\n      // dropped is instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])),t.multipassEnabled?v.H.float(0):(0,v.H)(o||(o=(0,u.Z)(["sign(pointGroundDistance)"]))))),t.draped&&!t.hasVerticalOffset||(0,h._8)(n),t.draped||(n.uniforms.add(new g.p("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),n.code.add((0,v.H)(s||(s=(0,u.Z)(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * ",";\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])),v.H.float(m)))),t.screenCenterOffsetUnitsEnabled&&(0,h.ZI)(n),t.hasScreenSizePerspective&&(0,p.m8)(n),n.code.add((0,v.H)(a||(a=(0,u.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      vec3 centerOffset = centerOffsetAndDistance.xyz;\n      float pointGroundDistance = centerOffsetAndDistance.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,v.H)(l||(l=(0,u.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled?"":(0,v.H)(c||(c=(0,u.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))),t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""))}},50913:(e,t,n)=>{n.d(t,{R:()=>u});var r,i,o,s=n(30168),a=n(28156),l=n(15226),c=n(98634);function u(e,t){const{vertex:n,fragment:u}=e;n.include(a.H),t.multipassEnabled&&e.varyings.add("depth","float"),n.code.add((0,c.H)(r||(r=(0,s.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassEnabled?"depth = projectAux.posView.z;":"")),e.include(l.l,t),u.code.add((0,c.H)(i||(i=(0,s.Z)(["\n  void main() {\n    fragColor = vec4(1);\n    ","\n  }\n  "])),t.multipassEnabled?(0,c.H)(o||(o=(0,s.Z)(["\n        if(terrainDepthTest(depth)) {\n          fragColor.g = 0.5;\n        }"]))):""))}},55616:(e,t,n)=>{n.d(t,{P:()=>d});var r,i=n(30168),o=n(28156),s=n(83866),a=n(95276),l=n(58406),c=n(98634),u=n(19253);function d(e){e.vertex.uniforms.add(new l.p("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===s.U.Occluded?1:t.hudRenderStyle===s.U.NotOccluded?0:.75)),new a.N("viewport",((e,t)=>t.camera.fullViewport)),new u.A("hudVisibilityTexture",((e,t)=>{var n;return null===(n=t.hudVisibility)||void 0===n?void 0:n.getTexture()}))),e.vertex.include(o.H),e.vertex.code.add((0,c.H)(r||(r=(0,i.Z)(["bool testHUDVisibility(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}},66832:(e,t,n)=>{n.d(t,{E:()=>R});var r=n(93169),i=n(86361),o=n(55158),s=n(37081),a=n(68401),l=n(23620),c=n(78041),u=n(93822),d=n(4760),p=n(12594),h=n(11983),f=n(65964),g=n(82144),v=n(31132),_=n(7566),m=n(27627),T=n(50411),E=n(25920),O=n(45028),b=n(8548),S=n(36207);class A extends v.A{initializeProgram(e){return new m.$(e.rctx,A.shader.get().build(this.configuration),_.i)}_createPipeline(e,t){const n=this.configuration,r=e===E.A.NONE,i=e===E.A.FrontFace;return(0,S.sm)({blending:n.output===s.H_.Color&&n.transparent?r?c.wu:(0,c.j7)(e):null,culling:(0,S.zp)(n.cullFace),depthTest:n.draped?null:{func:(0,c.Bh)(e)},depthWrite:n.draped?null:(r||i)&&n.writeDepth?S.LZ:null,drawBuffers:n.output===s.H_.Depth?{buffers:[b.Xg.NONE]}:(0,c.V7)(e),colorWrite:S.BK,stencilWrite:n.hasOccludees?T.s3:null,stencilTest:n.hasOccludees?t?T.eD:T.RY:null,polygonOffset:r||i?n.polygonOffset?y:null:(0,c.je)(n.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}A.shader=new g.J(O.C,(()=>n.e(23173).then(n.bind(n,23173))));const y={factor:1,units:1};var C=n(27366),P=n(33559),x=n(8883);class I extends x.W{constructor(){super(...arguments),this.output=s.H_.Color,this.cullFace=a.Vr.None,this.transparencyPassType=E.A.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1,this.draped=!1}}(0,C._)([(0,P.o)({count:s.H_.COUNT})],I.prototype,"output",void 0),(0,C._)([(0,P.o)({count:a.Vr.COUNT})],I.prototype,"cullFace",void 0),(0,C._)([(0,P.o)({count:E.A.COUNT})],I.prototype,"transparencyPassType",void 0),(0,C._)([(0,P.o)()],I.prototype,"hasSlicePlane",void 0),(0,C._)([(0,P.o)()],I.prototype,"hasVertexColors",void 0),(0,C._)([(0,P.o)()],I.prototype,"transparent",void 0),(0,C._)([(0,P.o)()],I.prototype,"polygonOffset",void 0),(0,C._)([(0,P.o)()],I.prototype,"enableOffset",void 0),(0,C._)([(0,P.o)()],I.prototype,"writeDepth",void 0),(0,C._)([(0,P.o)()],I.prototype,"hasOccludees",void 0),(0,C._)([(0,P.o)()],I.prototype,"multipassEnabled",void 0),(0,C._)([(0,P.o)()],I.prototype,"cullAboveGround",void 0),(0,C._)([(0,P.o)()],I.prototype,"objectAndLayerIdColorInstanced",void 0),(0,C._)([(0,P.o)()],I.prototype,"vvColor",void 0),(0,C._)([(0,P.o)()],I.prototype,"draped",void 0),(0,C._)([(0,P.o)({constValue:!1})],I.prototype,"occlusionPass",void 0),(0,C._)([(0,P.o)({constValue:!0})],I.prototype,"hasVvInstancing",void 0),(0,C._)([(0,P.o)({constValue:!1})],I.prototype,"vvSize",void 0),(0,C._)([(0,P.o)({constValue:!1})],I.prototype,"vvOpacity",void 0);class R extends h.c{constructor(e){super(e,new N),this.supportsEdges=!0,this.produces=new Map([[u.r.OPAQUE_MATERIAL,e=>e===s.H_.Highlight||(0,s.CQ)(e)&&!this._isTransparent],[u.r.OPAQUE_NO_SSAO_DEPTH,e=>(0,s.BX)(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[u.r.TRANSPARENT_MATERIAL,e=>(0,s.CQ)(e)&&this._isTransparent&&this.parameters.writeDepth],[u.r.TRANSPARENT_NO_SSAO_DEPTH,e=>(0,s.BX)(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[u.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>((0,s.CQ)(e)||(0,s.BX)(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[u.r.DRAPED_MATERIAL,e=>(0,s.xs)(e)]]),this._configuration=new I}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new w(e)}createBufferWriter(){const e=(0,o.U$)().vec3f(d.T.POSITION);return(0,r.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(d.T.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(d.T.COLORFEATUREATTRIBUTE):e.vec4u8(d.T.COLOR),new p.G(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class w extends l.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===s.H_.Color&&this._updateOccludeeState(e),this.ensureTechnique(A,e)}}class N extends f.n{constructor(){super(...arguments),this.color=i.AG,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.Vr.None,this.hasOccludees=!1,this.draped=!1}}},21400:(e,t,n)=>{n.d(t,{A:()=>Q});var r=n(93169),i=n(16889),o=n(29303),s=n(21389),a=n(29134),l=n(7025),c=n(6644),u=n(32035),d=n(12400),p=n(86361);function h(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var f=n(65156),g=n(25158),v=n(66202),_=n(94463),m=n(55158),T=n(37081),E=n(81879),O=n(17363),b=n(56529),S=n(93822),A=n(65216),y=n(97731),C=n(4760),P=n(21166),x=n(33236),I=n(22909),R=n(83544),w=n(50951),N=n(82144),L=n(31132),D=n(7566),U=n(78041),z=n(27627),H=n(25920),F=n(8548),k=n(36207);class j extends L.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===w.JY.Global}initializeProgram(e){return new z.$(e.rctx,j.shader.get().build(this.configuration),D.i)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,n=e===H.A.NONE,r=e===H.A.FrontFace,i=this.configuration.hasPolygonOffset?V:null,o=t.draped?null:(n||r)&&t.output!==T.H_.Highlight&&(t.depthEnabled||t.occlusionPass)?k.LZ:null;return(0,k.sm)({blending:t.output===T.H_.Color||t.output===T.H_.Highlight?n?M:(0,U.j7)(e):null,depthTest:t.draped?null:{func:F.wb.LEQUAL},depthWrite:o,drawBuffers:(0,U.V7)(e),colorWrite:k.BK,polygonOffset:i})}get primitiveType(){return this.configuration.occlusionPass?F.MX.POINTS:F.MX.TRIANGLES}}j.shader=new N.J(R.H,(()=>n.e(16823).then(n.bind(n,16823))));const V={factor:0,units:-4},M=(0,k.if)(F.zi.ONE,F.zi.ONE_MINUS_SRC_ALPHA);var G=n(27366),Z=n(33559),B=n(8883);class Y extends B.W{constructor(){super(...arguments),this.output=T.H_.Color,this.transparencyPassType=H.A.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,G._)([(0,Z.o)({count:T.H_.COUNT})],Y.prototype,"output",void 0),(0,G._)([(0,Z.o)({count:H.A.COUNT})],Y.prototype,"transparencyPassType",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"spherical",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"occlusionTestEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"signedDistanceFieldEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"vvSize",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"vvColor",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"hasVerticalOffset",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"hasScreenSizePerspective",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"debugDrawLabelBorder",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"hasSlicePlane",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"hasPolygonOffset",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"depthEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"pixelSnappingEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"draped",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"multipassEnabled",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"cullAboveGround",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"occlusionPass",void 0),(0,G._)([(0,Z.o)()],Y.prototype,"objectAndLayerIdColorInstanced",void 0),(0,G._)([(0,Z.o)({constValue:!0})],Y.prototype,"hasSliceInVertexProgram",void 0),(0,G._)([(0,Z.o)({constValue:!1})],Y.prototype,"hasVvInstancing",void 0);class Q extends b.F5{constructor(e){super(e,new fe),this._configuration=new Y,this.produces=new Map([[S.r.HUD_MATERIAL,e=>(0,T.L_)(e)&&!this.parameters.drawInSecondSlot],[S.r.LABEL_MATERIAL,e=>(0,T.L_)(e)&&this.parameters.drawInSecondSlot],[S.r.OCCLUSION_PIXELS,()=>this.parameters.occlusionTest],[S.r.DRAPED_MATERIAL,e=>(0,T.L_)(e)]])}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.draped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===S.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest,e===T.H_.Color&&(this._configuration.debugDrawLabelBorder=!!_.h.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,n,r,i,s){if(!(n.options.selectionMode&&n.options.hud&&e.visible&&n.point))return;const l=this.parameters,c=n.point,p=n.camera;let{scaleX:h,scaleY:f}=this._getScreenScale(e);h*=p.pixelRatio,f*=p.pixelRatio,(0,o.xO)(re,t),e.attributes.has(C.T.FEATUREATTRIBUTE)&&function(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+n*n+r*r),d=1/Math.sqrt(i*i+o*o+s*s),p=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=n*u,e[2]=r*u,e[3]=i*d,e[4]=o*d,e[5]=s*d,e[6]=a*p,e[7]=l*p,e[8]=c*p}(re);const g=e.attributes.get(C.T.POSITION),v=e.attributes.get(C.T.SIZE),_=e.attributes.get(C.T.NORMAL),m=e.attributes.get(C.T.CENTEROFFSETANDDISTANCE);(0,y.hu)(g.size>=3);const T=(0,R.c)(l),E="screen"===this.parameters.centerOffsetUnits;for(let o=0;o<g.data.length/g.size;o++){const e=o*g.size;(0,u.s)(K,g.data[e],g.data[e+1],g.data[e+2]),(0,u.h)(K,K,t);const r=o*v.size;pe[0]=v.data[r]*h,pe[1]=v.data[r+1]*f,(0,u.h)(K,K,p.viewMatrix);const i=o*m.size;if((0,u.s)(se,m.data[i],m.data[i+1],m.data[i+2]),!E&&(K[0]+=se[0],K[1]+=se[1],0!==se[2])){const e=se[2];(0,u.n)(se,K),(0,u.f)(K,K,(0,u.j)(se,se,e))}const O=o*_.size;if((0,u.s)($,_.data[O],_.data[O+1],_.data[O+2]),q($,re,p,ce),this._applyVerticalOffsetTransformationView(K,ce,p,J),p.applyProjection(K,ee),ee[0]>-1){E&&(se[0]||se[1])&&(ee[0]+=se[0]*p.pixelRatio,0!==se[1]&&(ee[1]+=(0,A.sX)(se[1],J.factorAlignment)*p.pixelRatio),p.unapplyProjection(ee,K)),ee[0]+=this.parameters.screenOffset[0]*p.pixelRatio,ee[1]+=this.parameters.screenOffset[1]*p.pixelRatio,ee[0]=Math.floor(ee[0]),ee[1]=Math.floor(ee[1]),(0,A.TU)(pe,J.factor,pe);const e=ue*p.pixelRatio;let t=0;if(l.textureIsSignedDistanceField&&(t=l.outlineSize*p.pixelRatio/2),X(c,ee[0],ee[1],pe,e,t,l,T)){const e=n.ray;if((0,u.h)(ne,K,(0,a.U_)(oe,p.viewMatrix)),ee[0]=c[0],ee[1]=c[1],p.unprojectFromRenderScreen(ee,K)){const t=(0,d.Ue)();(0,u.c)(t,e.direction);const n=1/(0,u.l)(t);(0,u.j)(t,t,n),s((0,u.p)(e.origin,K)*n,t,-1,!0,1,ne)}}}}}intersectDraped(e,t,n,r,i,o){const s=e.attributes.get(C.T.POSITION),a=e.attributes.get(C.T.SIZE),l=this.parameters,c=(0,R.c)(l);let{scaleX:u,scaleY:d}=this._getScreenScale(e);u*=e.screenToWorldRatio,d*=e.screenToWorldRatio;const p=de*e.screenToWorldRatio;for(let h=0;h<s.data.length/s.size;h++){const t=h*s.size,n=s.data[t],f=s.data[t+1],g=h*a.size;pe[0]=a.data[g]*u,pe[1]=a.data[g+1]*d;let v=0;l.textureIsSignedDistanceField&&(v=l.outlineSize*e.screenToWorldRatio/2),X(r,n,f,pe,p,v,l,c)&&i(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new _e(this)}_updateScaleInfo(e,t,n){const r=this.parameters;null!=r.screenSizePerspective?(0,A.PV)(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,A.PV)(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,n,r,i,o,s){const a=q(t,n,i,ce);return this._applyVerticalGroundOffsetView(e,a,i,s),this._applyVerticalOffsetTransformationView(s,a,i,o),this._applyPolygonOffsetView(s,a,r[3],i,s),this._applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,n,r,i){return this._applyCenterOffsetNDC(e,t,n,r),null!=i&&(0,u.c)(i,r),this._applyPolygonOffsetNDC(r,t,n,r),r}_applyPolygonOffsetView(e,t,n,r,o){const s=r.aboveGround?1:-1;let a=Math.sign(n);0===a&&(a=s);const l=s*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(o,e);const c=(0,i.uZ)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/r.viewport[2];return(0,u.j)(o,e,l>0?d:1/d),o}_applyVerticalGroundOffsetView(e,t,n,r){const i=(0,u.l)(e),o=n.aboveGround?1:-1,s=n.computeRenderPixelSizeAtDist(i)*E.c,a=(0,u.j)(K,t.normal,o*s);return(0,u.g)(r,e,a),r}_applyVerticalOffsetTransformationView(e,t,n,r){var i,o;const s=this.parameters;if(null===(i=s.verticalOffset)||void 0===i||!i.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const n=(0,u.l)(e);this._updateScaleInfo(r,n,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=(0,u.l)(e),l=null!==(o=s.screenSizePerspectiveAlignment)&&void 0!==o?o:s.screenSizePerspective,c=(0,I.Hx)(n,a,s.verticalOffset,t.cosAngle,l);return this._updateScaleInfo(r,a,t.cosAngle),(0,u.j)(t.normal,t.normal,c),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,n){const r="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,u.c)(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,u.n)($,n),(0,u.g)(n,n,(0,u.j)($,$,t[2])))),n}_applyCenterOffsetNDC(e,t,n,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,n,r){const i=this.parameters.shaderPolygonOffset;if(e!==r&&(0,u.c)(r,e),i){const e=n.aboveGround?1:-1,o=e*Math.sign(t[3]);r[2]-=(o||e)*i}return r}createGLMaterial(e){return new W(e)}calculateRelativeScreenBounds(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,f.Ue)();return function(e,t,n,r){r[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*n,r[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*n}(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}_getScreenScale(e){const t=e.attributes.get(C.T.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const n=(0,p.nI)(t.data,le),[r,i]=(0,v.FE)(ae,this.parameters,n);return{scaleX:r,scaleY:i}}}class W extends O.F{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(j,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function q(e,t,n,r){return h(t)&&(t=(0,o.xO)(ie,t)),(0,u.t)(r.normal,e,t),(0,u.h)(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=(0,u.m)(te,he),r}function X(e,t,n,r,i,o,s,a){let l=t-i-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*i,u=n-i-(a[1]>0?r[1]*a[1]:0),d=u+r[1]+2*i;const p=s.distanceFieldBoundingBox;return s.textureIsSignedDistanceField&&null!=p&&(l+=r[0]*p[0],u+=r[1]*p[1],c-=r[0]*(1-p[2]),d-=r[1]*(1-p[3]),l-=o,c+=o,u-=o,d+=o),e[0]>l&&e[0]<c&&e[1]>u&&e[1]<d}const J=new P.G,K=(0,d.Ue)(),$=(0,d.Ue)(),ee=(0,p.Ue)(),te=(0,d.Ue)(),ne=(0,d.Ue)(),re=(0,s.Ue)(),ie=(0,s.Ue)(),oe=(0,l.Ue)(),se=(0,d.Ue)(),ae=(0,d.Ue)(),le=(0,p.Ue)(),ce={normal:te,cosAngle:0},ue=1,de=2,pe=[0,0],he=(0,d.al)(0,0,1);class fe extends O.E{constructor(){super(...arguments),this.renderOccluded=b.yD.Occlude,this.isDecoration=!1,this.color=(0,p.al)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,c.al)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,p.al)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.draped=!1}}const ge=(0,m.U$)().vec3f(C.T.POSITION).vec3f(C.T.NORMAL).vec2f(C.T.UV0).vec4u8(C.T.COLOR).vec2f(C.T.SIZE).vec4f(C.T.CENTEROFFSETANDDISTANCE).vec4f(C.T.FEATUREATTRIBUTE),ve=ge.clone().vec4u8(C.T.OBJECTANDLAYERIDCOLOR);class _e{constructor(e){this._material=e,this.vertexBufferLayout=(0,r.Z)("enable-feature:objectAndLayerId-rendering")?ve:ge}elementCount(e){return 6*e.attributes.get(C.T.POSITION).indices.length}write(e,t,n,r,i){(0,x.ho)(n.attributes.get(C.T.POSITION),e,r.position,i,6),(0,x.s5)(n.attributes.get(C.T.NORMAL),t,r.normal,i,6);const o=n.attributes.get(C.T.UV0).data;let s,a,l,c;if(null==o||o.length<4){const e=this._material.parameters;s=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else s=o[0],a=o[1],l=o[2],c=o[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let u=n.attributes.get(C.T.POSITION).indices.length,d=i;const p=r.uv0;for(let g=0;g<u;++g)p.set(d,0,s),p.set(d,1,a),d++,p.set(d,0,l),p.set(d,1,a),d++,p.set(d,0,l),p.set(d,1,c),d++,p.set(d,0,l),p.set(d,1,c),d++,p.set(d,0,s),p.set(d,1,c),d++,p.set(d,0,s),p.set(d,1,a),d++;(0,x.Vs)(n.attributes.get(C.T.COLOR),4,r.color,i,6);const{data:h,indices:f}=n.attributes.get(C.T.SIZE);u=f.length;const v=r.size;d=i;for(let g=0;g<u;++g){const e=h[2*f[g]],t=h[2*f[g]+1];for(let n=0;n<6;++n)v.set(d,0,e),v.set(d,1,t),d++}if(n.attributes.get(C.T.CENTEROFFSETANDDISTANCE)?(0,x.SW)(n.attributes.get(C.T.CENTEROFFSETANDDISTANCE),r.centerOffsetAndDistance,i,6):(0,x.h)(r.centerOffsetAndDistance,i,6*u),n.attributes.get(C.T.FEATUREATTRIBUTE)?(0,x.SW)(n.attributes.get(C.T.FEATUREATTRIBUTE),r.featureAttribute,i,6):(0,x.h)(r.featureAttribute,i,6*u),null!=n.objectAndLayerIdColor){var _;const e=null===(_=n.attributes.get(C.T.POSITION))||void 0===_?void 0:_.indices;if(e){const t=e.length,o=r.getField(C.T.OBJECTANDLAYERIDCOLOR,g.mc);(0,x.xP)(n.objectAndLayerIdColor,o,t,i,6)}}}}},21166:(e,t,n)=>{n.d(t,{G:()=>r});class r{constructor(){this.factor=new i,this.factorAlignment=new i}}class i{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}},11983:(e,t,n)=>{n.d(t,{c:()=>o});var r=n(56529),i=n(42235);class o extends r.F5{intersect(e,t,n,r,o,s){return(0,i.Bw)(e,n,r,o,void 0,s)}}},75248:(e,t,n)=>{var r;n.d(t,{n:()=>r}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(r||(r={}))},93463:(e,t,n)=>{n.d(t,{G5:()=>P,T8:()=>r,sq:()=>x,z4:()=>_});var r,i=n(100),o=(n(93169),n(32718)),s=n(92026),a=n(90941),l=n(27546),c=n(66978),u=n(94172),d=n(76432),p=n(38499),h=n(41388),f=n(32609),g=n(75248),v=n(73553);function _(){return new y.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(r||(r={}));const m=new Map([[r.RESOURCE_CONTROLLER_IMMEDIATE,0],[r.RESOURCE_CONTROLLER,4],[r.SLIDE,0],[r.STREAM_DATA_LOADER,0],[r.ELEVATION_QUERY,0],[r.TERRAIN_SURFACE,1],[r.SURFACE_GEOMETRY_UPDATES,1],[r.LOD_RENDERER,2],[r.GRAPHICS_CORE,2],[r.I3S_CONTROLLER,2],[r.POINT_CLOUD_LAYER,2],[r.FEATURE_TILE_FETCHER,2],[r.OVERLAY,4],[r.STAGE,4],[r.GRAPHICS_DECONFLICTOR,4],[r.FILTER_VISIBILITY,4],[r.SCALE_VISIBILITY,4],[r.FRUSTUM_VISIBILITY,4],[r.CLOUDS_GENERATOR,4],[r.POINT_OF_INTEREST_FREQUENT,6],[r.POINT_OF_INTEREST_INFREQUENT,30],[r.LABELER,8],[r.FEATURE_QUERY_ENGINE,8],[r.FEATURE_TILE_TREE,16],[r.FEATURE_TILE_TREE_ACTIVE,0],[r.ELEVATION_ALIGNMENT,12],[r.ELEVATION_ALIGNMENT_SCENE,14],[r.TEXT_TEXTURE_ATLAS,12],[r.TEXTURE_UNLOAD,12],[r.LINE_OF_SIGHT_TOOL,16],[r.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[r.SNAPPING,0],[r.SHADOW_ACCUMULATOR,30]]);function T(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const E=(0,p.HA)(6.5),O=(0,p.HA)(1),b=(0,p.HA)(30),S=(0,p.HA)(1e3/30),A=(0,p.HA)(100);var y,C;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,d.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new n,this._state=g.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.watch)((()=>f.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.initial);for(const e of Object.keys(r))this.performanceInfo.tasks.set(r[e],new a.Z(r[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,s.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,n){const r=new t(this,e,n);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a.Z(e)),r}registerIdleStateCallbacks(e,t){const n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),this.state===g.n.IDLE&&this._idleUpdatesStartFired&&n.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(n),set idleBegin(e){r._idleUpdatesStartFired&&(n.idleEnd(),r._state===g.n.IDLE&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==g.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=E,n=e.frameDuration,r=O;switch(this.state){case g.n.IDLE:t=(0,p.HA)(0),n=(0,p.HA)(Math.max(A,e.frameDuration)),r=b;break;case g.n.INTERACTING:n=(0,p.HA)(Math.max(S,e.frameDuration));case g.n.ANIMATING:}return n=(0,p.HA)(n-e.elapsedFrameTime-t),this.state!==g.n.IDLE&&n<O&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,p.HA)(Math.max(n,r)),this._budget.reset(n,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case g.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case g.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,p.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return C.SCHEDULED;let t=C.IDLE;return this._tasks.forAll((n=>{n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=C.READY:t!==C.READY&&(t=C.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((n=>{n.name===e&&(t+=n.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,n)=>{t+=e>1?" ".concat(e,"x ").concat(n):" ".concat(n)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((n=>{n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority&&n.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,n.basePriority),1===n.schedulePriority?(n.schedulePriority=0,this._runQueue.push(n)):--n.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const n=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)===v.J&&(i.blockFrame=this._frameNumber)}catch(t){o.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(i.name,'"'),t),i.blockFrame=this._frameNumber}!this._budget.hasProgressed&&i.blockFrame!==this._frameNumber&&i.needsUpdate&&(i.name,r.I3S_CONTROLLER,i.blockFrame=this._frameNumber),i.schedulePriority=i.basePriority;const s=this._budget.now()-n;if(i.runtime+=s,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+s),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(r))this._frameTaskTimes.set(r[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,n){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new h.b,this._handles=new i.Z,this._basePriority=T(t),this.schedulePriority=this._basePriority,this._task=(0,d.t)(null!=n?n:this._queue),this._handles.add((0,u.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(P),this._scheduler.removeTask(this),this.schedule=x.schedule,this.reschedule=x.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=T(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,n){return this._queue.push(e,t,n)}reschedule(e,t,n){return this._queue.unshift(e,t,n)}processQueue(e){return this._queue.runTask(e)}}class n{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=g.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=n}(y||(y={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(C||(C={}));const P=(()=>{const e=new y.Budget;return e.enabled=!1,e})();const x=new class{remove(){}processQueue(){}schedule(e,t,n){try{if((0,c.Hc)(t)){const e=(0,c.zE)();return n?Promise.resolve(n(e)):Promise.reject(e)}return(0,c.gx)(e(P))}catch(r){return Promise.reject(r)}}reschedule(e,t,n){return this.schedule(e,t,n)}}},73553:(e,t,n)=>{n.d(t,{J:()=>r});const r=Symbol("Yield")},32609:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(27366),i=n(7138),o=n(49861),s=(n(93169),n(32718),n(84936),n(69912));let a=class extends i.default{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,r._)([(0,o.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,r._)([(0,o.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,r._)([(0,s.j)("esri.views.support.debugFlags")],a);const l=new a}}]);
//# sourceMappingURL=68683.a88df8ca.chunk.js.map