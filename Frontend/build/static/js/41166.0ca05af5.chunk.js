"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[41166,14254,53226],{47898:(e,t,i)=>{i.d(t,{Fp:()=>u,GJ:()=>o,M1:()=>r,MQ:()=>g,Ww:()=>v,bA:()=>d,hw:()=>h,mE:()=>c,ne:()=>a,nn:()=>n,qF:()=>y,yG:()=>l,yP:()=>p});var s=i(68860);function r(e){return{value:e}}function l(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}function a(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arithmetic";return{type:(0,s.UF)(t),value:e,unit:t,rotationType:i}}function n(e,t){const i=c(e,t);return"angle"===e.type?o(i,t,e.rotationType):function(e,t){return{type:(0,s.UF)(t),value:e,unit:t}}(i,t)}function c(e,t){return(0,s.En)(e.value,e.unit,t)}function u(e,t){return null==e?t:null==t||e.value>(0,s.En)(t.value,t.unit,e.unit)?e:t}function d(e,t){return null==e?null:{...e,value:e.value*t}}function h(e,t,i){if(t===i)return e;switch(i){case"arithmetic":case"geographic":return 90-e}}const p=l(0,"meters"),g=a(0,"square-meters"),v=(o(0,"radians"),o(0,"degrees")),y=o(0,"degrees","geographic")},57858:(e,t,i)=>{i.d(t,{Q:()=>a,q:()=>l});var s=i(19545),r=i(76200);async function l(e,t,i){var l;if(!(null===s.id||void 0===s.id?void 0:s.id.findCredential(e.restUrl)))return null;if("loaded"===e.loadStatus&&""===t&&null!==(l=e.user)&&void 0!==l&&l.sourceJSON&&!1===i)return e.user.sourceJSON;const a={responseType:"json",query:{f:"json"}};if(i&&(a.query.returnUserLicenseTypeExtensions=!0),""===t){const t=await(0,r.Z)(e.restUrl+"/community/self",a);if(t.data){const e=t.data;if(null!==e&&void 0!==e&&e.username)return e}return null}const o=await(0,r.Z)(e.restUrl+"/community/users/"+t,a);if(o.data){const e=o.data;return e.error?null:e}return null}async function a(e,t,i){var s,r;const a=await l(e,t,!0);return null!==(s=null===a||void 0===a||null===(r=a.userLicenseTypeExtensions)||void 0===r?void 0:r.includes(i))&&void 0!==s&&s}},25952:(e,t,i)=>{i.d(t,{Z:()=>u});var s=i(27366),r=i(43404),l=i(46784),a=i(49861),o=(i(93169),i(32718),i(84936),i(69912));const n=new r.X({startingPoint:"starting-point",barrier:"barrier"});let c=class extends l.wq{constructor(e){super(e),this.globalId=null,this.isFilterBarrier=!1,this.percentAlong=null,this.terminalId=null,this.type=null}};(0,s._)([(0,a.Cb)({type:String,json:{write:!0}})],c.prototype,"globalId",void 0),(0,s._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],c.prototype,"isFilterBarrier",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],c.prototype,"percentAlong",void 0),(0,s._)([(0,a.Cb)({type:Number,json:{write:!0}})],c.prototype,"terminalId",void 0),(0,s._)([(0,a.Cb)({type:n.apiValues,json:{type:n.jsonValues,read:{reader:n.read,source:"traceLocationType"},write:{writer:n.write,target:"traceLocationType"}}})],c.prototype,"type",void 0),c=(0,s._)([(0,o.j)("esri.rest.networks.support.TraceLocation")],c);const u=c},53226:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var s,r=i(27366),l=i(46784),a=i(49861),o=i(25243),n=(i(84936),i(93169),i(69912)),c=i(31201),u=i(78952),d=i(18769),h=i(29259),p=i(25952);let g=s=class extends l.wq{static from(e){return(0,o.TJ)(s,e)}constructor(e){super(e),this.namedTraceConfigurationGlobalId=null,this.gdbVersion=null,this.traceLocations=[],this.moment=null,this.outSpatialReference=null,this.traceConfiguration=null,this.resultTypes=null,this.traceType=null}writeOutSR(e,t,i){if(null!=e){const{wkid:s}=e;t[i]=JSON.stringify({wkid:s})}}};(0,r._)([(0,a.Cb)({type:String,json:{read:{source:"traceConfigurationGlobalId"},write:{target:"traceConfigurationGlobalId"}}})],g.prototype,"namedTraceConfigurationGlobalId",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],g.prototype,"gdbVersion",void 0),(0,r._)([(0,a.Cb)({type:[p.Z],json:{write:!0}})],g.prototype,"traceLocations",void 0),(0,r._)([(0,a.Cb)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],g.prototype,"moment",void 0),(0,r._)([(0,a.Cb)({type:u.Z,json:{write:{allowNull:!0,target:"outSR"}}})],g.prototype,"outSpatialReference",void 0),(0,r._)([(0,c.c)("outSpatialReference")],g.prototype,"writeOutSR",null),(0,r._)([(0,a.Cb)({type:h.Z,json:{write:!0}})],g.prototype,"traceConfiguration",void 0),(0,r._)([(0,a.Cb)({type:[Object],json:{write:!0}})],g.prototype,"resultTypes",void 0),(0,r._)([(0,a.Cb)({type:d.Fh.apiValues,json:{type:d.Fh.jsonValues,read:d.Fh.read,write:d.Fh.write}})],g.prototype,"traceType",void 0),g=s=(0,r._)([(0,n.j)("esri.rest.networks.support.TraceParameters")],g);const v=g},14254:(e,t,i)=>{i.r(t),i.d(t,{submitTraceJob:()=>o,trace:()=>a});var s=i(76200),r=i(23084),l=i(20039);async function a(e,t,i){const a=(0,r.en)(e),o=t.toJSON();o.traceLocations=JSON.stringify(t.traceLocations),t.resultTypes&&(o.resultTypes=JSON.stringify(t.resultTypes));const n=(0,r.lA)(a.query,{query:(0,r.cv)({...o,f:"json"}),...i}),c="".concat(a.path,"/trace");return(0,s.Z)(c,n).then((e=>function(e,t){const{data:i}=e,s=l.Z.fromJSON(i.traceResults);return s.aggregatedGeometry&&t&&(s.aggregatedGeometry.line&&(s.aggregatedGeometry.line.spatialReference=t.clone()),s.aggregatedGeometry.multipoint&&(s.aggregatedGeometry.multipoint.spatialReference=t.clone()),s.aggregatedGeometry.polygon&&(s.aggregatedGeometry.polygon.spatialReference=t.clone())),s}(e,t.outSpatialReference)))}async function o(e,t,i){const l=(0,r.en)(e),a=t.toJSON();a.traceLocations=JSON.stringify(t.traceLocations),t.resultTypes&&(a.resultTypes=JSON.stringify(t.resultTypes));const o=(0,r.lA)(l.query,{query:(0,r.cv)({...a,async:!0,f:"json"}),...i}),n="".concat(l.path,"/trace"),{data:c}=await(0,s.Z)(n,o);return c.statusUrl}},51021:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ye});var s=i(27366),r=i(94172),l=i(49861),a=(i(93169),i(32718)),o=(i(84936),i(69912)),n=i(52175),c=i(33565),u=i(8905),d=i(7021),h=i(80975),p=i(80532),g=i(28907),v=i(67005),y=i(19545),m=i(80987),w=i(10064),_=i(91505),f=i(77981),b=i(41201),T=i(64326),A=i(93655),S=i(37933),C=i(69518),R=i(4141),F=i(7575),k=i(57858),I=i(14254),G=i(25952),N=i(53226),M=(i(59486),i(2170)),P=i(29909),x=i(79803),B=i(78952);function L(e){return"polygon"===e.type||"polyline"===e.type}class O{createBuffer(e,t,i,s){if(Array.isArray(e)){if(e.length>0){const r=B.Z.fromJSON(e[0].spatialReference);return r.isWGS84||r.isWebMercator?(0,M.geodesicBuffer)(e,t,i):(0,M.buffer)(e,t,i,s)}return}const r=B.Z.fromJSON(e.spatialReference);return r.isWGS84||r.isWebMercator?(0,M.geodesicBuffer)(e,t[0],i):(0,M.buffer)(e,t[0],i)}createConvexHull(e){if(Array.isArray(e)){if(1===e.length&&function(e){return function(e){return e.hasOwnProperty("points")}(e)&&2===e.points.length}(e[0])){const t=(0,M.convexHull)(e[0]);if(L(t))return t}return(0,M.convexHull)(e,!0).filter(L)}const t=(0,M.convexHull)(e);if(L(t))return t}calculateArea(e,t){const i=new B.Z({wkid:e.spatialReference.wkid});return i.isWGS84||i.isWebMercator?parseFloat((0,M.geodesicArea)(e,t).toFixed(2)):parseFloat((0,M.planarArea)(e,t).toFixed(2))}mergeAggregatedToGeometries(e){const t=[],{line:i,multipoint:s,polygon:r}=e;return i&&t.push(i),s&&t.push(s),r&&t.push(r),t}getPercentageAlong(e,t,i){let s=e;const r=this._createPolyline(e.paths,i.wkid);if("point"===t.type){const e=t.x-.5,l=t.x+.5,a=[[e,t.y-.5],[l,t.y+.5]];s=this._createPolyline(a,t.spatialReference.wkid),s=(0,x.project)(s,i);const o=(0,M.cut)(r,s);if(o.length>0){const e=(0,M.planarLength)(r,"feet");let t;return t=o[0].paths[0][0][0]===r.paths[0][0][0]?(0,M.planarLength)(o[0],"feet"):(0,M.planarLength)(o[1],"feet"),[t/e]}return[.5]}s=(0,x.project)(t,i);const l=(0,M.cut)(r,s);if(l.length>0){const e=(0,M.planarLength)(r,"feet");return[(0,M.planarLength)(l[0],"feet")/e]}return[.5]}async projectGeometry(e,t){return await(0,x.load)(),(0,x.project)(e,t)}_createPolyline(e,t){return new P.Z({hasZ:!1,hasM:!0,paths:e,spatialReference:{wkid:t}})}}var H=i(52639),E=i(61459),U=i(14404),D=i(16072),V=i(22006),j=i(98173),Z=i(40763);const q=[227,27,21,.6],W=[21,244,21,.6],z=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class J{constructor(){this.highlightColor=[...z]}addCustomColor(e){this.highlightColor=[...z],this.highlightColor.some((t=>t.hex.toLowerCase()===e.hex.toLowerCase()))||this.highlightColor.push(e)}getFlagGraphic(e,t,i,s){const r="starting-point"===t?W:q;if("polygon"===e.type){const t=e;t.centroid&&(e=t.centroid)}return s?this.makeGraphic(e,r,null===i||void 0===i?void 0:i.attributes,null,s):this.makeGraphic(e,r,null===i||void 0===i?void 0:i.attributes)}initializeSketch(e,t,i){const s=new m.Z;return i.forEach((e=>s.add(new V.Z({layer:e,enabled:!0})))),new Z.Z({layer:t,view:e,snappingOptions:new j.Z({enabled:!0,featureEnabled:!0,featureSources:s})})}makeGraphic(e,t,i,s,r){let l,a=e;switch(e.type){case"multipoint":l=new D.default({color:t,size:12,outline:{color:t,width:0}}),s&&(a=e);break;case"point":l=r||new D.default({color:t,size:12,outline:{color:t,width:0}}),s&&(a=e);break;case"polyline":l=new U.default({color:t,width:12}),s&&(a=e);break;case"polygon":l=new E.default({color:t,outline:{color:t,width:12}}),s&&(a=e)}return new H.Z({geometry:a,symbol:l,attributes:null!==i&&void 0!==i?i:null})}}var Q=i(44055),X=i(16698);const Y="utility-network-trace-result-area-".concat(Date.now());function $(e){return"graphics"===e.type}class K{constructor(){this.traceInformation={},this._geometryHandler=new O}addResultAreaToMap(e,t){const i=this.createGraphicLayer(t);i&&$(i)&&i.add(e)}changeResultAreaColor(e,t,i){const s=new E.default({color:t.color,style:"solid",outline:{color:t.color,width:1}}),r=this._findGraphicsByTraceId(e,i);return r&&r.forEach((e=>{e.symbol=s})),s}createBuffer(e,t,i,s){return this._geometryHandler.createBuffer(e,t,i,s)}createConvexHull(e,t,i){const s=this._geometryHandler.createConvexHull(e);return t>0&&s?this.createBuffer(s,[t],i,!1):s}createResultAreaGraphic(e,t,i,s,r,l){const a=new E.default({color:l.color,style:"solid",outline:{color:l.color,width:1}}),o=[];for(const c in t){var n;o.push(new X.Z({fieldName:c,label:"areaStatistic"===c?s.attributeStrings[c]+" ("+(null===(n=r.units[i])||void 0===n?void 0:n.abbr)+")":s.attributeStrings[c]}))}return new H.Z({geometry:e,symbol:a,attributes:t,popupTemplate:new Q.Z({title:t.traceName,content:[{type:"fields",fieldInfos:o}]})})}removeResultArea(e,t){const i=t.findLayerById(Y);if(i&&$(i)){const s=this._findGraphicsByTraceId(e,t);return s&&i.removeMany(s),s}return null}removeAllResultAreaGraphics(e){if(e){const t=e.findLayerById(Y);t&&$(t)&&t.removeAll()}}createGraphicLayer(e,t){const i=e.findLayerById(Y);if(i&&$(i))return i;const s=new A.default({title:null!==t&&void 0!==t?t:Y,listMode:"hide",id:Y});return e.add(s),s}_findGraphicsByTraceId(e,t){const i=t.findLayerById(Y);if(i&&$(i)){const t=i.graphics.filter((t=>t.attributes.traceId===e));return t.length>0?t.toArray():null}return null}}function ee(e){return"feature"===e.type}function te(e,t){return e.url.includes(t)}function ie(e,t){var i;return((null===(i=e.dataElement)||void 0===i?void 0:i.domainNetworks)||[]).some((e=>e.subnetworkLayerId===t.layerId))}class se{getValidUtilityNetworkLayers(e,t){const i=[];return null!==e&&void 0!==e&&e.allLayers.forEach((e=>{"group"===e.type?i.push(...e.layers.filter(S.Te).filter((e=>ee(e)&&t.isUtilityLayer(e)&&!ie(t,e))).filter((e=>te(e,t.featureServiceUrl))).toArray()):"subtype-group"===e.type?i.push(...e.sublayers.filter((e=>te(e,t.featureServiceUrl))).toArray()):(0,S.Te)(e)&&ee(e)&&t.isUtilityLayer(e)&&!ie(t,e)&&te(e,t.featureServiceUrl)&&i.push(e)})),i}}const re="utility-network-trace-flags-".concat(Date.now()),le="utility-network-trace-results-".concat(Date.now());let ae=class extends _.Z.EventedAccessor{constructor(e){super(e),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._flagId=0,this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._utilityHelper=new se,this._watchHandler=null,this._validUNLayers=[],this._traceTimeout=6e5,this._sketchViewModel=null,this.traces=[],this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){this._geometryHandler=new O,this.graphicHandler=new J,this._resultAreaHandler=new K,(async()=>{const[e,t]=await Promise.all([(0,b.ME)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),(0,b.ME)("esri/core/t9n/Units")]);this.set({messages:e,messagesUnits:t})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(e){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...e}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach((t=>{var i;const s=null===(i=t.resultArea)||void 0===i?void 0:i.show;t.resultArea={...this.defaultResultAreaProperties,...e},this.removeResultAreaFromMap(t),this.enableResultArea&&this.createResultAreaGraphic(t).then((i=>{if(i){var r;t.resultAreaGraphic=i;const l=null!==(r=null===e||void 0===e?void 0:e.show)&&void 0!==r?r:s;t.resultArea&&(t.resultArea.show=l),l&&this.addResultAreaToMap(t,i)}}))}))}get state(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"loading"}get view(){return this._get("view")}set view(e){e&&"2d"!==e.type&&a.Z.getLogger(this).error(new w.Z("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e),this.utilityNetwork&&this.reset(),this.utilityNetwork=null,this.loadUtilityNetwork().then((e=>{e&&this.selectTracesOnLoad()}))}addFlagByHit(e,t){const i=e=>{var t;(null===(t=this.view)||void 0===t?void 0:t.popup)&&(this.view.popupEnabled=e)};return new Promise(((s,r)=>{var l;i(!1),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this._clickHandler=this._sketchViewModel.on("create",(l=>{if("complete"===l.state){const a=this._getGraphicLayer(re);a&&l.graphic&&a.remove(l.graphic),this.queryFlagByHitTest(l,e,t).then((r=>{var l;i(!0),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this.emit("add-flag-complete",{type:e,symbol:t}),s(r)})).catch((s=>{var l;i(!0),null!==(l=this._clickHandler)&&void 0!==l&&l.remove(),this.emit("add-flag-error",{type:e,symbol:t}),r(s)}))}})),this._sketchViewModel.create("point"),this.emit("add-flag",{type:e})}))}async addFlagsOnLoad(){return this._flags.length>0?[]:(await(0,r.whenOnce)((()=>null!=this.view&&!this.view.updating)),(await Promise.all(this.flags.map((async e=>{if(!e.mapPoint)return null;const{type:t}=e,i=e.mapPoint.clone(),s="barrier"===t?q:W,r={graphic:this.graphicHandler.makeGraphic(i,s),state:"complete",tool:"point",toolEventInfo:null,type:"create"};try{return await this.queryFlagByHitTest(r,e.type,null),this.emit("add-flag-complete",{type:t}),null}catch(ie){return this.emit("add-flag-error",{type:t}),"barrier"===t?"barrier":"starting-point"}})))).filter((e=>!e)))}async addResultAreaToMap(e,t){var i;if(this.view)if(e.resultArea.show=!0,t)null!==(i=this._resultAreaHandler)&&void 0!==i&&i.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t});else if(e.results){var s;const t=await this.createResultAreaGraphic(e);t&&(e.resultAreaGraphic=t,null!==(s=this._resultAreaHandler)&&void 0!==s&&s.addResultAreaToMap(t,this.view.map),this.emit("add-result-area",{graphic:t}))}}async addResultGraphicToView(e,t){const{view:i}=this,{results:s}=e;if(i&&s&&this.utilityNetwork)for(const l in s.aggregatedGeometry)if("line,multipoint,polygon".includes(l)){const a=l,o=s.aggregatedGeometry[a];if(null!=o){o.spatialReference=this.utilityNetwork.spatialReference,e.graphicEnabled=!0;const s=await this._geometryHandler.projectGeometry(o,i.spatialReference),l={globalid:e.trace.globalId};if(null!==s){var r;const e=this.graphicHandler.makeGraphic(s,t.color,l,i.spatialReference);null===(r=this._getGraphicLayer(le))||void 0===r||r.add(e)}}}}addTerminal(e,t){const i=[...this._flags];i.forEach((i=>{var s,r;i.globalId===t.globalId&&((null===(s=t.selectedTerminals)||void 0===s?void 0:s.includes(parseInt(e,10)))||null===(r=i.selectedTerminals)||void 0===r||r.push(parseInt(e,10)))})),this._flags=i}async callTrace(){const e=this.traces.filter((e=>e.selected));return e.length>0&&(this.traceResults.length>0&&this.traceResults.forEach((e=>{this.removeResultGraphicFromView(e)})),this.traceResults=[],this.removeSelection(),await Promise.all(e.map((async(e,t)=>{var i;const s=e,r=new N.default({gdbVersion:this.utilityNetwork?this.utilityNetwork.gdbVersion:this.gdbVersion,moment:null,traceType:s.traceType,traceLocations:this._flags,namedTraceConfigurationGlobalId:s.globalId,traceConfiguration:null,outSpatialReference:null,resultTypes:null});await this.executeTrace(s,null===(i=this.utilityNetwork)||void 0===i?void 0:i.networkServiceUrl,r).then((e=>{if(e.hasOwnProperty("results")){const i={...e};if(null!==i.results){i.resultArea={...this.resultAreaProperties};const e=[...i.results.elements];i.results.elements.length=0;const s=new Map;for(const t of e)s.has(t.globalId)||(s.set(t.globalId,!0),i.results.elements.push(t));const r=[...this.traceResults];r.splice(t,0,i),this.traceResults=r,null!==i.results&&(this.selectOnComplete&&this.mergeSelection(!0,i.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(i,i.graphicColor),this.enableResultArea&&this.createResultAreaGraphic(i).then((e=>{var t;e&&(i.resultAreaGraphic=e,(null===(t=i.resultArea)||void 0===t?void 0:t.show)&&this.addResultAreaToMap(i,i.resultAreaGraphic))})))}else{const i=[...this.traceResults];i.splice(t,0,e),this.traceResults=i}this._activeProgress=!1}else{this._activeProgress=!1;const i=[...this.traceResults];i.splice(t,0,e),this.traceResults=i}})).catch((e=>{throw this._activeProgress=!1,e}))}))),!0)}changeResultAreaColor(e,t){var i;if(!e.resultArea)return;e.resultArea.color=t;const s=null===(i=this._resultAreaHandler)||void 0===i?void 0:i.changeResultAreaColor(e.trace.globalId,t,this.view.map);e.resultAreaGraphic&&(e.resultAreaGraphic.symbol=s)}changeResultGraphicColor(e,t){const i=[...this.traceResults];i.length>0&&i.forEach((i=>{i.trace.globalId===t.trace.globalId&&(i.graphicColor=e,i.graphicEnabled=!0)})),this.traceResults=i,this.removeResultGraphicFromView(t),this.addResultGraphicToView(t,e)}changeFlagSymbol(e,t){this._flags.length>0&&this._flags.forEach((i=>{i.type===e&&t&&i.mapGraphic&&(i.mapGraphic.symbol=t)}))}checkCanTrace(){const e={status:!0,issues:[]};let t=!1;const i=this._flags.some((e=>"starting-point"===e.type)),s=this._flags.filter((e=>null!==e.allTerminals));s.length>0&&(t=s.some((e=>e.selectedTerminals.length<=0)));let r=[];return i?(r=this.traces.filter((e=>e.selected)),r.length<=0?(e.status=!1,e.issues=["noTrace"],t&&(e.status=!1,e.issues=["noTrace","noTerminalSelected"])):t&&(e.status=!1,e.issues=["noTerminalSelected"])):(r=this.traces.filter((e=>!0===e.selected)),r.length>0?(e.status=!1,e.issues=["noStart"],t&&(e.status=!1,e.issues=["noStart","noTerminalSelected"])):(e.status=!1,e.issues=["noStart","noTrace"],t&&(e.status=!1,e.issues=["noStart","noTrace","noTerminalSelected"]))),e}checkSelectionExist(){return this._highlightHandler.some((e=>e))}clearResult(e){if(!this.view)return;let t=this.traceResults;if(t.length>0){const i=t.filter((t=>t.trace.globalId===e.globalId));i.length>0&&(this.removeResultGraphicFromView(i[0]),this.removeResultAreaFromMap(i[0])),t=t.filter((t=>t.trace.globalId!==e.globalId))}this.traceResults=t,0===t.length?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,e)}createResultAreaGeometries(e,t,i){var s,r,l,a,o,n,c,u,d,h,p;if(!this.view||!this.resultAreaProperties)return;let g;if(g="convexhull"===(null===(s=this.resultAreaProperties)||void 0===s?void 0:s.type)?1===t.length&&((0,f.wp)(t[0])||(0,f.aW)(t[0])&&1===t[0].points.length)?null===(r=this._resultAreaHandler)||void 0===r?void 0:r.createBuffer(t,i,null===(l=e.resultArea)||void 0===l?void 0:l.unit,!0):null===(a=this._resultAreaHandler)||void 0===a?void 0:a.createConvexHull(t,null===(o=e.resultArea)||void 0===o?void 0:o.distance,null===(n=e.resultArea)||void 0===n?void 0:n.unit):null===(c=this._resultAreaHandler)||void 0===c?void 0:c.createBuffer(t,i,null===(u=e.resultArea)||void 0===u?void 0:u.unit,!0),!g)return;if(Array.isArray(g)){for(const t of g){var v,y,m;const i=this.getResultAreaAttributes(e,t),s=null===(v=this._resultAreaHandler)||void 0===v?void 0:v.createResultAreaGraphic(t,i,null===(y=e.resultArea)||void 0===y?void 0:y.areaUnit,this.messages,this.messagesUnits,null===(m=e.resultArea)||void 0===m?void 0:m.color);if(s)return s}return}const w=this.getResultAreaAttributes(e,g);return null===(d=this._resultAreaHandler)||void 0===d?void 0:d.createResultAreaGraphic(g,w,null===(h=e.resultArea)||void 0===h?void 0:h.areaUnit,this.messages,this.messagesUnits,null===(p=e.resultArea)||void 0===p?void 0:p.color)}async createResultAreaGraphic(e){if(e.results){const i=await this._createResultAreaInputGeometry(e.results);if(i.length>0){var t;const s=Array(i.length).fill(null===(t=e.resultArea)||void 0===t?void 0:t.distance),r=this.createResultAreaGeometries(e,i,s);return this.emit("create-result-area",{graphic:r}),r}}}executeTrace(e,t,i){const s=this._processFlags(i.traceLocations);return i.traceLocations=s,(0,I.trace)(t,i,{timeout:this._traceTimeout}).then((t=>({trace:e,results:t,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date}))).catch((t=>({trace:e,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:t.message,date:new Date})))}getResultAreaAttributes(e,t){var i,s,r,l;const{messages:a}=this,o=[],n=[];this._flags.forEach((e=>{var t,i,s,r;const l=(null===(t=e.displayValue)||void 0===t?void 0:t.field)+":"+(null===(i=e.displayValue)||void 0===i?void 0:i.value)+";"+a.attributeStrings.globalid+":"+e.globalId+";"+a.attributeStrings.terminalid+":"+e.terminalId+";"+a.attributeStrings.x+":"+(null===(s=e.mapPoint)||void 0===s?void 0:s.x)+";"+a.attributeStrings.y+":"+(null===(r=e.mapPoint)||void 0===r?void 0:r.y);"starting-point"===e.type?o.push(l):n.push(l)}));const c=this.utilityNetwork?this.utilityNetwork.gdbVersion:this.gdbVersion;return{traceId:e.trace.globalId,traceName:e.trace.title,traceDescription:null!==(i=e.trace.description)&&void 0!==i?i:"",startingPoints:o.toString(),barriers:n.toString(),version:null!==c&&void 0!==c?c:void 0,username:y.id.credentials[0].userId,date:e.date,elementCount:null===(s=e.results)||void 0===s?void 0:s.elements.length,functionResult:JSON.stringify(null===(r=e.results)||void 0===r?void 0:r.globalFunctionResults),areaStatistic:t?this._geometryHandler.calculateArea(t,null===(l=e.resultArea)||void 0===l?void 0:l.areaUnit):0}}getValidSources(){var e,t;let i=[];const s=null!==(e=null===(t=this.utilityNetwork)||void 0===t||null===(t=t.dataElement)||void 0===t?void 0:t.domainNetworks)&&void 0!==e?e:[];for(const r of s)i=i.concat(r.junctionSources),i=i.concat(r.edgeSources);return i}groupResultsByNetworkSource(e){return 0===e.length?[]:this._groupBy(e,"networkSourceId")}async loadUtilityNetwork(){var e;const{view:t}=this;if(!t)return null;if(await t.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof C.default){try{const e=t.map;await e.loadAll(),this._loadUNSupportItems()}catch(se){this._loadUNSupportItems()}return this.utilityNetwork}return null}const i=t.map,s=null===(e=i.utilityNetworks)||void 0===e?void 0:e.at(0);if(s){if(await s.load(),this.utilityNetwork=s,!await async function(e){const t=new T.default({url:e.networkSystemLayers.dirtyAreasLayerUrl});await t.load();const i=t.version;if(Number(i)<=11.1){var s;const t=await(0,S.oP)(e.layerUrl),i=new F.Z({url:t});await i.load();const r=null===i||void 0===i||null===(s=i.user)||void 0===s?void 0:s.username;return!!r&&(0,k.Q)(i,r,"utilityNetwork")}return!0}(s))throw new w.Z("utility-network:no-user-type-extension","User type extension not found");try{await i.loadAll(),this._loadUNSupportItems()}catch(se){}finally{this._loadUNSupportItems()}return s}return null}manageFilterBarrier(e,t){const i=[...this._flags];i.forEach((i=>{i.globalId===t.globalId&&"barrier"===t.type&&i.id===t.id&&(i.isFilterBarrier=e)})),this._flags=i}mergeSelection(e,t){let i=[];const s=[...this.traceResults],r=t.globalId;s.forEach((t=>{var s,l,a;r===t.trace.globalId&&(t.selectionEnabled=e),t.selectionEnabled&&null!==(null===(s=t.results)||void 0===s?void 0:s.elements)&&(i=[...i,...null!==(l=null===(a=t.results)||void 0===a?void 0:a.elements)&&void 0!==l?l:[]])})),this.selectResults([...new Set(i)])}async queryFeaturesById(e){var t,i;const{view:s}=this;if(!s||!this.utilityNetwork)return null;const r=(0,R.Cf)(this.utilityNetwork,e),l={layerUrl:r[0].layerUrl,objectIds:r[0].objectIds,outFields:["*"]},a=null!==(t=null===(i=s.map)||void 0===i?void 0:i.allTables.toArray().filter((e=>{var t;return(null===e||void 0===e||null===(t=e.parsedUrl)||void 0===t?void 0:t.path)===r[0].layerUrl})).filter(S.Te))&&void 0!==t?t:[];this._getUniqueMapLayerViews(s).filter((e=>{var t;let{layer:i}=e;return(null===i||void 0===i||null===(t=i.parsedUrl)||void 0===t?void 0:t.path)===r[0].layerUrl})).forEach((e=>{let{layer:t}=e;"feature"!==t.type&&"subtype-group"!==t.type||a.push(t)}));const o=(await Promise.all(a.map((async e=>{const t={layers:new m.Z([e]),layerInfos:[l],returnGeometry:!0,outSpatialReference:s.spatialReference},[i]=await(0,R.n7)(t,!1);return i})))).filter((e=>{let{featureSet:t}=e;return t.features.length>0}));return o.length>0?o:null}queryFlagByHitTest(e,t,i){return this._lookupFlagByHit(e).then((e=>{const{view:s}=this;if(!s)return!1;if(e.length>0){const s=[...this._flags],r=i;return e.forEach((e=>{const i=e.graphic,l=i.attributes.hasOwnProperty("GLOBALID")?i.attributes.GLOBALID:i.attributes.globalid;if(s.filter((e=>e.globalId===l)).length<=0){var a;const e=this.graphicHandler.getFlagGraphic(i.attributes.mapPoint,t,i,r);null===(a=this._getGraphicLayer(re))||void 0===a||a.add(e);const l=this._createFlagProperty(i,t,e);s.push(l)}else if(null!==i.attributes.percentAlong){var o;const e=this.graphicHandler.getFlagGraphic(i.attributes.mapPoint,t,i,r);null===(o=this._getGraphicLayer(re))||void 0===o||o.add(e);const l=this._createFlagProperty(i,t,e);s.push(l)}})),this._flags=s,!0}return!1}))}removeResultGraphicFromView(e){var t;const{view:i}=this;if(!i)return;const s=null===(t=this._getGraphicLayer(le))||void 0===t?void 0:t.graphics;e.graphicEnabled=!1;const r=null===s||void 0===s?void 0:s.filter((t=>t.attributes[t.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===e.trace.globalId));null===r||void 0===r||r.forEach((e=>{var t;null===(t=this._getGraphicLayer(le))||void 0===t||t.remove(e)}))}removeFlag(e){const t=this._flags.filter((t=>{if(t.id!==e.id)return t}));this._removeGraphic(e),this._flags=t}removeAllResultAreaGraphics(){var e;null===(e=this._resultAreaHandler)||void 0===e||e.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(e){if(e.resultArea){var t,i;e.resultArea.show=!1;const s=null===(t=this._resultAreaHandler)||void 0===t?void 0:t.removeResultArea(e.trace.globalId,null===(i=this.view)||void 0===i?void 0:i.map);s&&this.emit("remove-result-area",{graphic:s})}}removeSelection(){this._highlightHandler.forEach((e=>{e&&e.remove()})),this._highlightHandler=[]}removeTerminal(e,t){const i=[...this._flags];i.forEach((i=>{var s;if(i.globalId===t.globalId&&null!==(s=t.selectedTerminals)&&void 0!==s&&s.includes(parseInt(e,10))){var r;const s=t.selectedTerminals.indexOf(parseInt(e,10));null===(r=i.selectedTerminals)||void 0===r||r.splice(s,1)}})),this._flags=i}removeFlagsOnLoadWatcher(){this._watchHandler&&null!==this._watchHandler&&this._watchHandler.remove()}removeClickHandler(){this._clickHandler&&(this._sketchViewModel.cancel(),this._clickHandler.remove())}reset(){var e,t;this._flags=[],this.traceResults=[];const i=[...this.traces];i.forEach((e=>{e.selected=!1})),this.traces=i,this.view&&(null!==(e=this._getGraphicLayer(le))&&void 0!==e&&e.removeAll(),null!==(t=this._getGraphicLayer(re))&&void 0!==t&&t.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}))}selectFeaturesById(e){const{view:t}=this;if(!t||!this.utilityNetwork)return;const i=(0,R.Cf)(this.utilityNetwork,e);this._getUniqueMapLayerViews(t).forEach((e=>{var t;(function(e){return"layer"in e})(e)&&(null===(t=e.layer)||void 0===t||null===(t=t.parsedUrl)||void 0===t?void 0:t.path)===i[0].layerUrl&&function(e){return"feature"===e.layer.type||"subtype-group"===e.layer.type}(e)&&this._highlightHandler.push(e.highlight(i[0].objectIds))}))}selectResults(e){if(e.length>0){this.removeSelection();const t=this.groupResultsByNetworkSource(e),i=[];for(const e in t)this.selectFeaturesById(t[e]),i.push(this.queryFeaturesById(t[e]));Promise.all(i).then((e=>{this.emit("select-features",{resultSet:e})}))}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(e,t){const i=[...this.traces];i.forEach((i=>{t===i.globalId&&(i.selected=e)})),this.traces=i}selectTracesOnLoad(){var e;(null===(e=this.utilityNetwork)||void 0===e?void 0:e.hasOwnProperty("sharedNamedTraceConfigurations"))&&(this.traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this.traces.forEach((e=>{e.selected=!1,this.selectedTraces.includes(e.globalId)&&(e.selected=!0)})))}zoomToAsset(e){var t;null===(t=this.view)||void 0===t||t.goTo(e).catch((e=>console.error(e)))}async _createResultAreaInputGeometry(e){if(null!=e.aggregatedGeometry)return this._geometryHandler.mergeAggregatedToGeometries(e.aggregatedGeometry);const t=this.groupResultsByNetworkSource(e.elements),i=[];for(const s in t)i.push(this.queryFeaturesById(t[s]));try{const e=await Promise.all(i),t=[];for(const i of e)if(i)for(const e of i)for(const i of e.featureSet.features)t.push(i.geometry);return t}catch{return[]}}_loadUNSupportItems(){var e;if(!this.utilityNetwork)return;const{map:t}=this.view,{messages:i}=this;this._populateOutfields(),this._createGraphicLayer(re),this._createGraphicLayer(le),null!==(e=this._resultAreaHandler)&&void 0!==e&&e.createGraphicLayer(t,null===i||void 0===i?void 0:i.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(t,this.utilityNetwork),this._sketchViewModel=this.graphicHandler.initializeSketch(this.view,this._getGraphicLayer(re),this._validUNLayers)}_getUniqueMapLayerViews(e){const t=[];return e.layerViews.filter((e=>{let{layer:{type:t}}=e;return"feature"===t||"group"===t||"subtype-group"===t})).toArray().forEach((e=>{switch(e.layer.type){case"group":if(function(e){return void 0!==e.layerViews}(e))for(const i of e.layerViews)t.push(i);break;case"subtype-group":t.push(e);break;default:t.some((t=>t.layer.id===e.layer.id))||t.push(e)}})),t}_processFlags(e){const t=[];return e.forEach((e=>{if(null!==e.selectedTerminals&&e.selectedTerminals.length>0)e.selectedTerminals.forEach((i=>{const s=new G.Z({globalId:e.globalId,percentAlong:e.percentAlong,terminalId:i,type:e.type,isFilterBarrier:e.isFilterBarrier});t.push(s)}));else{const i=new G.Z({globalId:e.globalId,percentAlong:e.percentAlong,type:e.type,isFilterBarrier:e.isFilterBarrier});t.push(i)}})),t}_getDisplayField(e){var t;return"subtype-sublayer"===(null===e||void 0===e||null===(t=e.layer)||void 0===t?void 0:t.type)?this._getDisplayFieldBySublayer(e):this._getDisplayFieldByFeatureLayer(e)}_getDisplayFieldBySublayer(e){let t="",i="";const s=e.layer;t=this._checkParentForData(s,"displayField");for(const l in e.attributes){var r;const a=l.toLowerCase();a===(null===(r=t)||void 0===r?void 0:r.toLowerCase())?(i=e.attributes[l],"assetgroup"===a||"assettype"===a?i=this._checkSubtype(s,s.subtypeCode):(i=this._checkDomain(s.fields,l,i),"string"==typeof i&&(i=this._defaultDisplayField(i,s)))):(i=this._checkDomain(s.fields,l,i),"string"==typeof i&&(i=this._defaultDisplayField(i,s)))}return{field:t,value:i.toString()}}_getDisplayFieldByFeatureLayer(e){const t=e.layer;let i=t.displayField,s="";for(const o in e.attributes){var r;const n=o.toLowerCase();if(n===(null===(r=i)||void 0===r?void 0:r.toLowerCase()))if(s=e.attributes[o],"assetgroup"===n||"assettype"===n){var l,a;let r=e.attributes[t.typeIdField.toUpperCase()];r||(r=e.attributes[t.typeIdField.toLowerCase()]),i=t.typeIdField,s=this._checkSubtype(t,r),""===i&&(t.templates&&t.templates.length>0?(i=null===(l=t.templates[0])||void 0===l?void 0:l.name,s=null===(a=t.templates[0])||void 0===a?void 0:a.name):(i=t.displayField,s=e.attributes[o]))}else s=this._checkDomain(t.fields,o,s),"string"==typeof s&&(s=this._defaultDisplayField(s,t));else s=this._checkDomain(t.fields,o,s),"string"==typeof s&&(s=this._defaultDisplayField(s,t))}return{field:i,value:s?s.toString():""}}_checkSubtype(e,t){let i=t;if("subtype-sublayer"===e.type){const s=this._checkParentForData(e,"subtypes");(null===s||void 0===s?void 0:s.length)>0&&s.forEach((e=>{e.code===t&&(i=e.name)}))}else if(null!=e.types&&e.types.length>0){const s=e.types.filter((e=>e.id===t));s.length>0&&(i=s[0].name)}return i}_checkDomain(e,t,i){var s;let r=i;const l=e.filter((e=>e.name.toLowerCase()===t.toLowerCase()));if(l.length>0&&function(e){return e instanceof n.Z}(l[0].domain)&&null!==(s=l[0].domain)&&void 0!==s&&s.codedValues){const e=l[0].domain.codedValues.filter((e=>{let{code:t}=e;return t===i}));e.length>0&&(r=e[0].name)}return r}_checkParentForData(e,t){var i,s;return null!==(i=null===(s=e.parent)||void 0===s?void 0:s[t])&&void 0!==i?i:null}_defaultDisplayField(e,t){var i;return e.trim()?e:t.templates&&(null===(i=t.templates)||void 0===i?void 0:i.length)>0?t.templates[0].name:t.title}get _uniqueFlagId(){return this._flagId++}_groupBy(e,t){return e.reduce(((e,i)=>((e[i[t]]=e[i[t]]||[]).push(i),e)),{})}async _lookupFlagByHit(e){var t;const i=null===(t=e.graphic)||void 0===t?void 0:t.geometry,s=[];if(i&&(0,f.wp)(i)&&this.view){const t=this.view.toScreen(i);if(t){const i=await this.view.hitTest(t,{include:this._validUNLayers});if(i&&i.results.length>0){var r;const t=i.results.find((e=>null!==e.layer));if(null!=(null===(r=t.graphic)||void 0===r?void 0:r.geometry))if("polyline"===t.graphic.geometry.type){var l;const i={terminalId:null,isFilterBarrier:!1,allTerminals:null,selectedTerminals:null,percentAlong:this._geometryHandler.getPercentageAlong(t.graphic.geometry,null===(l=e.graphic)||void 0===l?void 0:l.geometry,t.graphic.geometry.spatialReference),displayValue:this._getDisplayField(t.graphic),mapPoint:t.mapPoint};t.graphic.attributes={...t.graphic.attributes,...i},s.push(t)}else if(("point"===t.graphic.geometry.type||"polygon"===t.graphic.geometry.type)&&null!==this.utilityNetwork){var a;const e=null===(a=this.utilityNetwork)||void 0===a?void 0:a.getTerminalConfiguration(t.graphic),i=this._getDisplayField(t.graphic),r={terminalId:e?e.terminals[0].id||null:1,isFilterBarrier:!1,allTerminals:null!==e&&void 0!==e?e:null,selectedTerminals:[e?e.terminals[0].id||null:1],percentAlong:null,displayValue:i,mapPoint:t.mapPoint};t.graphic.attributes={...t.graphic.attributes,...r},s.push(t)}}}}return s}_createFlagProperty(e,t,i){const s=new G.Z;s.terminalId=e.attributes.terminalId,s.isFilterBarrier=e.attributes.isFilterBarrier,s.percentAlong=e.attributes.percentAlong,s.globalId=e.attributes.globalid||e.attributes.GLOBALID,s.type=t;const r=s;return r.details=e,r.mapGraphic=i,r.id=this._uniqueFlagId,r.allTerminals=e.attributes.allTerminals,r.selectedTerminals=e.attributes.selectedTerminals,r.displayValue=e.attributes.displayValue,r.mapPoint=e.attributes.mapPoint,r}async _populateOutfields(){var e;const t=null===(e=this.view)||void 0===e?void 0:e.map,i=this.getValidSources();null===t||void 0===t||t.layers.forEach((e=>{"group"===e.type?e.layers.forEach((e=>{i.some((t=>t.layerId===e.layerId))&&e.fields.some((e=>"assetgroup"===e.name.toLowerCase()))&&(e.outFields=["assetgroup","assettype","globalid","objectid"])})):i.some((t=>t.layerId===e.layerId))&&e.fields.some((e=>"assetgroup"===e.name.toLowerCase()))&&(e.outFields=["assetgroup","assettype","globalid","objectid"])}))}_removeGraphic(e){var t;null===(t=this._getGraphicLayer(re))||void 0===t||t.remove(e.mapGraphic)}_createGraphicLayer(e){const{map:t}=this.view;if(!t.findLayerById(e)){const i=new A.default({title:e,listMode:"hide",id:e});t.add(i)}}_getGraphicLayer(e){const{map:t}=this.view;if(t){const i=t.findLayerById(e);if(i&&function(e){return"graphics"===e.type}(i))return i}return null}};(0,s._)([(0,l.Cb)()],ae.prototype,"_activeProgress",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"_flags",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"traces",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"defaultGraphicColor",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"enableResultArea",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"flags",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"gdbVersion",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"messages",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"messagesUnits",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"resultAreaProperties",null),(0,s._)([(0,l.Cb)()],ae.prototype,"selectedTraces",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"selectOnComplete",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"showGraphicsOnComplete",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"showSelectionAttributes",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],ae.prototype,"state",null),(0,s._)([(0,l.Cb)()],ae.prototype,"traceResults",void 0),(0,s._)([(0,l.Cb)()],ae.prototype,"utilityNetwork",void 0),(0,s._)([(0,l.Cb)({value:null})],ae.prototype,"view",null),ae=(0,s._)([(0,o.j)("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],ae);const oe=ae,ne="esri-utility-trace-network",ce={base:ne,loaderContainer:"".concat(ne,"__loader-container"),loader:"".concat(ne,"__loader"),fadeIn:"".concat(ne,"--fade-in"),addButtonContainer:"".concat(ne,"__add-button-container"),noticeContainer:"".concat(ne,"__notice-container"),listContainer:"".concat(ne,"__list-container"),resultsContainer:"".concat(ne,"__results-container"),flow:"".concat(ne,"__flow"),numberInput:"".concat(ne,"__number-input"),clearPrompt:"".concat(ne,"__reset-prompt"),promptDivider:"".concat(ne,"__divider"),paddingTop:"".concat(ne,"__padTop")};function ue(e){return{height:e+"px"}}function de(e){return{width:e+"px"}}function he(e){return{width:"100%",height:window.getComputedStyle(e).getPropertyValue("max-height")}}function pe(e){return{display:"flex",flexDirection:e}}const ge=-2147208474;let ve=class extends c.Z{constructor(e,t){super(e,t),this._selectToolActive=!1,this._activeTrace=null,this._activeSwatch="",this._traceHeaderForFlow="",this._assetGroupHeader="",this._assetTypeHeader="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this._activeTab="input",this._flagViewType="starting-point",this._alertRemoveModal=!1,this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoStartAssetFound=!1,this._warningNoBarrierAssetFound=!1,this._warningNoTerminal=!1,this._confirmReset=!1,this._showResultOptions=!1,this._resultObjectIdField="objectid",this._resultDisplayField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._swatchNode=null,this._individualResultNode=null,this._symbolStartFlag=null,this._symbolBarrier=null,this._watchHandler=null,this._loadUNError=!0,this._errorMessage="",this.disabled=!0,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new oe,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles((0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.resultAreaProperties}),(()=>this.scheduleRender())))}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get gdbVersion(){return this.viewModel.gdbVersion}set gdbVersion(e){this.viewModel.gdbVersion=e}get icon(){return"utility-network-trace"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1;const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach((e=>{switch(e){case"noStart":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}}))}confirmReset(){this._confirmReset=!0}render(){const{state:e}=this.viewModel;this._mixCustomStrings(),this._overrideFlagSymbol();const t="loading"===e?this._renderWarningMessage("noTraceConfig",!1):this._renderUtilityNetworkTrace();return(0,v.u)("div",{class:this.classes(ce.base,d.z.widget,d.z.panel,{[d.z.widgetDisabled]:this.disabled}),styles:{height:"100%"}},t)}loadDependencies(){return(0,u.h)({action:()=>Promise.all([i.e(92358),i.e(46895),i.e(65138),i.e(91741)]).then(i.bind(i,6814)),"action-group":()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(70405)]).then(i.bind(i,70405)),"action-pad":()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(11299)]).then(i.bind(i,11299)),block:()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(4758)]).then(i.bind(i,4758)),"block-section":()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(93090)]).then(i.bind(i,93090)),button:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(14105),i.e(32275)]).then(i.bind(i,32275)),checkbox:()=>Promise.all([i.e(92358),i.e(54438),i.e(12424)]).then(i.bind(i,12424)),"color-picker-swatch":()=>Promise.all([i.e(92358),i.e(97446),i.e(93580)]).then(i.bind(i,93580)),combobox:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(89219),i.e(1579),i.e(34504),i.e(63017),i.e(70419)]).then(i.bind(i,70419)),"combobox-item":()=>Promise.all([i.e(92358),i.e(15862)]).then(i.bind(i,15862)),flow:()=>i.e(53049).then(i.bind(i,53049)),"flow-item":()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(89524),i.e(48926)]).then(i.bind(i,48926)),icon:()=>Promise.all([i.e(92358),i.e(87474)]).then(i.bind(i,87474)),"input-number":()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(18135),i.e(77244)]).then(i.bind(i,90460)),label:()=>Promise.all([i.e(92358),i.e(35738)]).then(i.bind(i,35738)),list:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(34504),i.e(8715),i.e(38782)]).then(i.bind(i,38782)),"list-item":()=>Promise.all([i.e(92358),i.e(46895),i.e(65138),i.e(21340)]).then(i.bind(i,67994)),loader:()=>i.e(92382).then(i.bind(i,92382)),notice:()=>Promise.all([i.e(92358),i.e(46895),i.e(15669)]).then(i.bind(i,15669)),option:()=>i.e(19790).then(i.bind(i,19790)),panel:()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(89524),i.e(85026)]).then(i.bind(i,85026)),popover:()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(447)]).then(i.bind(i,61580)),scrim:()=>Promise.all([i.e(92358),i.e(46895),i.e(99174)]).then(i.bind(i,99174)),select:()=>Promise.all([i.e(92358),i.e(54438),i.e(26369)]).then(i.bind(i,26369)),tab:()=>Promise.all([i.e(92358),i.e(68266)]).then(i.bind(i,68266)),"tab-nav":()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(14105),i.e(37136),i.e(7209)]).then(i.bind(i,7209)),"tab-title":()=>Promise.all([i.e(92358),i.e(46895),i.e(68073),i.e(73151)]).then(i.bind(i,42006)),tabs:()=>Promise.all([i.e(92358),i.e(7769)]).then(i.bind(i,7769)),tooltip:()=>Promise.all([i.e(92358),i.e(89219),i.e(94730)]).then(i.bind(i,94730))})}switchTab(e){this._activeTab=e}switchToFunctions(e,t){this._traceResultsFunctions=e,this._showTraceResultFunctions=t}switchToAssetGroup(e,t,i){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._showTraceResultAssetGroup=i}switchToAssetType(e,t,i){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._showTraceResultAssetType=i}switchToIndividualRecords(e,t,i){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._showIndividualRecords=i}_renderUtilityNetworkTrace(){const{messages:e,messagesCommon:t}=this;let i=(0,v.u)("calcite-tabs",{layout:"center",position:"top",styles:he(this.container)},(0,v.u)("calcite-tab-nav",{slot:"title-group"},(0,v.u)("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:"input"===this._activeTab},e.inputsStrings.headerTabInputs),(0,v.u)("calcite-tab-title",{onclick:()=>{this.switchTab("result")},selected:"result"===this._activeTab},e.resultsStrings.headerTabResults)),(0,v.u)("calcite-tab",{selected:"input"===this._activeTab},this._renderInputPanel()),(0,v.u)("calcite-tab",{selected:"result"===this._activeTab},this.viewModel._activeProgress?(0,v.u)("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"}):this.viewModel.traceResults.length>0?this._renderResultPanel():this._renderWarningMessage("noTraceExecuted",!1),this._confirmReset?(0,v.u)("calcite-scrim",{key:"prompt"},(0,v.u)("div",{class:ce.clearPrompt},(0,v.u)("h3",{slot:"header"},e.resultsStrings.startOverButton),(0,v.u)("div",{slot:"content"},e.resultsStrings.startOverValidation),(0,v.u)("div",{class:ce.promptDivider}),(0,v.u)("div",{styles:pe("row")},(0,v.u)("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),(0,v.u)("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok)))):null));return 0===this.viewModel.traces.length&&(i=(0,v.u)("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUNError||(i=(0,v.u)("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),i}_renderInputPanel(){const{messages:e}=this;return(0,v.u)("calcite-flow",{class:ce.flow},(0,v.u)("calcite-flow-item",null,this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?(0,v.u)("div",{styles:ue(10)}):null,(0,v.u)("calcite-button",{kind:"brand",onclick:()=>{this.checkCanTrace()},slot:"footer",width:"full"},e.tracingStrings.runTrace)),this._selectToolActive?this._renderActiveTool():null)}_renderResultPanel(){return(0,v.u)("calcite-flow",{styles:{height:"100%"}},this._renderTraceResults(),this._showTraceResultFunctions?this._renderTraceResultFunctions():null,this._showTraceResultAssetGroup?this._renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this._renderTraceResultByAssetType():null,this._showIndividualRecords?this._renderTraceResultIndividual():null,this._showIndividualRecords?this._renderTraceResultIndividualPopover():null)}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"starting-point"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"start"))}));let s=null;return this._symbolStartFlag&&(s=this._getSymbolIcon(this._symbolStartFlag)),(0,v.u)("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerStartingPoint+" ("+i.length+")",open:!0,overlayPositioning:"fixed"},(0,v.u)("div",{slot:"icon"},s||(0,v.u)("calcite-icon",{icon:"pin",scale:"s"})),(0,v.u)("div",null,e.inputsStrings.startingPointHint),(0,v.u)("div",{class:ce.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,(0,v.u)("div",{class:ce.addButtonContainer},(0,v.u)("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="starting-point",this._selectToolActive=!0,this._warningNoStartAssetFound=!1,this.viewModel.addFlagByHit("starting-point",this._symbolStartFlag).then((e=>{this._changeCursor("default"),e?this._warningNoFlag=!1:this._warningNoStartAssetFound=!0,this._selectToolActive=!1}))},round:!0})))}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let i=[];i=this.viewModel._flags.filter((e=>"barrier"===e.type)),i.forEach((e=>{e.displayValue&&t.push(this._renderFlagRow(e,"barrier"))}));let s=null;return this._symbolBarrier&&(s=this._getSymbolIcon(this._symbolBarrier)),(0,v.u)("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerBarrier+" ("+i.length+")",open:!1,overlayPositioning:"fixed"},(0,v.u)("div",{slot:"icon"},s||(0,v.u)("calcite-icon",{icon:"x-circle-f",scale:"s"})),(0,v.u)("div",null,e.inputsStrings.barrierPointHint),(0,v.u)("div",{class:ce.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,(0,v.u)("div",{class:ce.addButtonContainer},(0,v.u)("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",kind:"brand",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="barrier",this._selectToolActive=!0,this._warningNoBarrierAssetFound=!1,this.viewModel.addFlagByHit("barrier",this._symbolBarrier).then((e=>{this._changeCursor("default"),e||(this._warningNoBarrierAssetFound=!0),this._selectToolActive=!1}))},round:!0})))}_renderFlagRow(e,t){var i,s;const{messages:r,messagesCommon:l}=this,a=[];let o=!1;return null!=e.allTerminals&&e.allTerminals.terminals.length>0&&(o=!0,e.allTerminals.terminals.forEach((t=>{var i;let s=!1;null!==e&&void 0!==e&&null!==(i=e.selectedTerminals)&&void 0!==i&&i.includes(t.id)&&(s=!0),a.push((0,v.u)("calcite-combobox-item",{key:t.name,selected:s,textLabel:t.name,value:t.id}))}))),(0,v.u)("calcite-block",{collapsible:null!==e.allTerminals||"barrier"===e.type,heading:null!==(i=null===(s=e.displayValue)||void 0===s?void 0:s.value)&&void 0!==i?i:"",key:"pop"+e.globalId+e.type+e.id+t,overlayPositioning:"fixed"},(0,v.u)("calcite-action",{icon:"trash",label:l.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:l.remove,textEnabled:!0}),(0,v.u)("calcite-action",{icon:"zoom-to-object",label:r.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:r.globalStrings.zoomToFeature,textEnabled:!0}),"barrier"===e.type?(0,v.u)("calcite-label",{layout:"inline",scale:"s"},(0,v.u)("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),r.inputsStrings.barrierFilter):null,o?(0,v.u)("calcite-combobox",{label:r.globalStrings.selectTerminalPlaceholder,maxItems:0,placeholder:r.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:t=>{t.target.selectedItems.length>0?(e.selectedTerminals=[],t.target.selectedItems.forEach((t=>{this.viewModel.addTerminal(t.value,e)}))):e.selectedTerminals=[]},onCalciteComboboxChipClose:t=>{t.preventDefault(),this.viewModel.removeTerminal(t.target.value,e)}},a):null)}_renderActiveTool(){const{messages:e}=this;let t=null;return"starting-point"===this._flagViewType?this._symbolStartFlag&&(t=this._getSymbolIcon(this._symbolStartFlag)):this._symbolBarrier&&(t=this._getSymbolIcon(this._symbolBarrier)),(0,v.u)("calcite-flow-item",{heading:e.inputsStrings.addPointOption,onCalciteFlowItemBack:()=>{var e;this.viewModel.removeClickHandler(),null!==(e=this.view)&&void 0!==e&&e.popup&&(this.view.popupEnabled=!0),this._changeCursor("default"),this._selectToolActive=!1}},(0,v.u)("calcite-block",{collapsible:!1,heading:"",open:!0,overlayPositioning:"fixed"},(0,v.u)("div",{styles:{textAlign:"center",padding:"1rem"}},t||(0,v.u)("calcite-icon",{icon:"starting-point"===this._flagViewType?"pin-plus":"x-circle-f"})),(0,v.u)("div",{styles:{textAlign:"center",padding:"1rem"}},e.inputsStrings.addPointHint)))}_renderTraceSelectorContainer(){const{messages:e}=this,t=[];let i=e.tracingStrings.traceOperation,s=0;return this.viewModel.traces.length>0&&this.viewModel.traces.forEach((e=>{t.push((0,v.u)("calcite-combobox-item",{key:e.globalId,selected:e.selected,textLabel:e.title,value:e.globalId,onCalciteComboboxItemChange:e=>{const t=e.target;this.viewModel.selectTraces(t.selected,t.value),this.viewModel.traces.length>0&&(this._warningNoTraceSelected=!1)}})),e.selected&&s++})),i+=" (".concat(s,")"),(0,v.u)("calcite-block",{collapsible:!0,heading:i,open:!0,overlayPositioning:"fixed"},(0,v.u)("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),(0,v.u)("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple"},t))}_renderStartOverContainer(){const{messages:e}=this;return(0,v.u)("calcite-button",{kind:"brand",onclick:()=>{this.confirmReset()},slot:"footer",width:"full"},e.resultsStrings.startOverButton)}_renderWarningMessage(e,t,i){const{messages:s}=this;let r=s.alertsStrings.NoRunAlertHeader,l=s.alertsStrings.noResultsInfo;switch(e){case"flag":r=s.alertsStrings.startingPointAlertHeader,l=s.alertsStrings.startingPointAlert;break;case"noTerminal":r=s.alertsStrings.noTerminalDefinedHeader,l=s.alertsStrings.noTerminalDefined;break;case"trace":r=s.alertsStrings.selectTraceAlertHeader,l=s.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":r=s.alertsStrings.NoRunAlertHeader,l=s.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":r=s.alertsStrings.noAssetsFoundHeader,l=s.alertsStrings.noAssetFound;break;case"noTraceConfig":r="",l=s.alertsStrings.noTraceSupported;break;default:r=s.alertsStrings.genericErrorHeader,l=i||""}return(0,v.u)("div",{class:ce.noticeContainer,key:e},(0,v.u)("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},(0,v.u)("div",{slot:"title"},r),(0,v.u)("div",{slot:"message"},l)))}_renderRemoveTraceContainer(e){const{messages:t}=this;return(0,v.u)("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderHighlightColorPicker(e,t,i){const{messages:s}=this,{graphicHandler:r}=this.viewModel,l=[],a=new RegExp("^".concat(e.hex,"$"),"i"),o=r.highlightColor.length>z.length?5:4;for(const n of r.highlightColor)l.push((0,v.u)("calcite-action",{active:a.test(n.hex),key:n.hex,label:s.resultsStrings.graphicColor,onclick:()=>{"aggregate"===i?this.viewModel.changeResultGraphicColor(n,t):this.viewModel.changeResultAreaColor(t,n)},scale:"s",text:s.resultsStrings.graphicColor},(0,v.u)("calcite-color-picker-swatch",{active:a.test(n.hex),color:n.hex,scale:"s"})));return(0,v.u)("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},(0,v.u)("calcite-action-group",{columns:o,layout:"grid"},l))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:i}=e.resultsStrings,s=this.viewModel.traceResults,r=[];return s.forEach(((t,s)=>{var l,a,o,n,c,u,d;let h=[],p=[],g=!1,y=!1,m=!1,w="";null!==t.results&&t.results.hasOwnProperty("elements")?(null!==t.results.aggregatedGeometry&&(y=!0),null!==t.results.globalFunctionResults&&t.results.globalFunctionResults.length>0&&(p=t.results.globalFunctionResults,p.length>0&&(m=!0)),t.results.elements&&t.results.elements.length>0&&(h=t.results.elements,h.length>0&&(g=!0)),(y||g)&&(w=null===(l=this.messagesUnits.units[null===(a=t.resultArea)||void 0===a?void 0:a.unit])||void 0===l?void 0:l.abbr),r.push((0,v.u)("calcite-block",{collapsible:!0,description:null!==(o=t.trace.description)&&void 0!==o?o:"",heading:t.trace.title,key:"".concat(t.trace.title).concat(s),open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),(0,v.u)("calcite-list",null,m?(0,v.u)("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+p.length+")",onCalciteListItemSelect:()=>{this.switchToFunctions(p,!0)}},(0,v.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,g&&this.viewModel.showSelectionAttributes?(0,v.u)("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+h.length+")",onCalciteListItemSelect:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(t),t.trace.title+" ("+h.length+")",!0)}},(0,v.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?(0,v.u)("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),g?(0,v.u)("div",{class:ce.paddingTop},(0,v.u)("calcite-label",{layout:"inline",onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)},scale:"s"},(0,v.u)("calcite-checkbox",{checked:t.selectionEnabled,onclick:e=>{e.preventDefault(),e.stopPropagation(),this.viewModel.mergeSelection(!t.selectionEnabled,t.trace)}}),this.viewModel.showSelectionAttributes?i:"".concat(i," (").concat(h.length,")"))):null,y?(0,v.u)("calcite-block-section",{key:"aggregate-".concat(t.trace.title,"-").concat(s),open:t.graphicEnabled,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.target.open?this.viewModel.changeResultGraphicColor(t.graphicColor,t):this.viewModel.removeResultGraphicFromView(t)}},(0,v.u)("calcite-list",{selectionMode:"none"},(0,v.u)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{const t=e.target;this._swatchNode=t,this._activeSwatch="aggGeom_"+s}},(0,v.u)("calcite-color-picker-swatch",{color:t.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(y||g)?(0,v.u)("calcite-block-section",{key:"area-".concat(t.trace.title,"-").concat(s),open:null===(n=t.resultArea)||void 0===n?void 0:n.show,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:e=>{e.target.open?t.resultAreaGraphic?this.viewModel.addResultAreaToMap(t,t.resultAreaGraphic):this.viewModel.addResultAreaToMap(t):this.viewModel.removeResultAreaFromMap(t)}},(0,v.u)("calcite-list",{selectionMode:"none"},(0,v.u)("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:e=>{const t=e.target;this._swatchNode=t,this._activeSwatch="resultArea_"+s}},(0,v.u)("calcite-color-picker-swatch",{color:null===(c=t.resultArea)||void 0===c?void 0:c.color.hex,scale:"s",slot:"actions-end"}))),(0,v.u)("calcite-list",{selectionMode:"none"},(0,v.u)("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},(0,v.u)("calcite-input-number",{afterCreate:this._afterComponentCreate,class:ce.numberInput,max:999999,maxLength:999999,min:0,scale:"s",slot:"actions-end",suffixText:w,value:null===(u=t.resultArea)||void 0===u?void 0:u.distance.toString(),onCalciteInputNumberChange:e=>{var i;if(null===(i=this.view)||void 0===i||!i.popup)return;this.view.popup.visible&&this.view.closePopup();const s=e.target;t.resultArea.distance>=0?(t.resultArea.distance=parseInt(s.value,10),this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t)):(t.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(t),this.viewModel.addResultAreaToMap(t))}})))):null,(0,v.u)("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+s||this._activeSwatch==="resultArea_"+s,placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+s?null===(d=t.resultArea)||void 0===d?void 0:d.color:t.graphicColor,t,this._activeSwatch==="resultArea_"+s?"resultArea":"aggregate"))))):r.push((0,v.u)("calcite-block",{collapsible:!1,heading:t.trace.title,key:"error-"+s,open:!0,overlayPositioning:"fixed"},this._renderRemoveTraceContainer(t),this._renderWarningMessage("noController",!1,t.status)))})),(0,v.u)("calcite-flow-item",{key:"traceResults",styles:{height:"100%"}},r,this._renderStartOverContainer(),this._alertRemoveModal?(0,v.u)("calcite-scrim",{key:"prompt"},(0,v.u)("div",{class:ce.clearPrompt},(0,v.u)("h3",{slot:"header"},e.globalStrings.clearResults),(0,v.u)("div",{slot:"content"},e.alertsStrings.clearResultsAlert),(0,v.u)("div",{class:ce.promptDivider}),(0,v.u)("div",{styles:pe("row")},(0,v.u)("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),(0,v.u)("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,0===this.viewModel.traceResults.length?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1)},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceResultFunctions(){const{messages:e}=this,t=this._traceResultsFunctions,i=[];return t.forEach((e=>{i.push(this._renderResultRowFunctions(e))})),(0,v.u)("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",onCalciteFlowItemBack:()=>{this.switchToFunctions([],!1)}},i,this._renderStartOverContainer())}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const i in e){const s=e[i];for(const e in s)t.push(this._renderResultRowAssetGroup(s[e]))}return(0,v.u)("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",onCalciteFlowItemBack:()=>{this.switchToAssetGroup([],"",!1)}},(0,v.u)("calcite-list",null,t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const i in e)e[i].length>0&&t.push(this._renderResultRowAssetType(e[i]));return(0,v.u)("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",onCalciteFlowItemBack:()=>{this.switchToAssetType([],"",!1)}},(0,v.u)("calcite-list",{selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultIndividual(){const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const i=[];var s,r;t.length>0&&(null!==(s=null===(r=t[0].details)||void 0===r?void 0:r.fields.some((e=>{let{name:t}=e;return t.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()})))&&void 0!==s&&s||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach((e=>{(null===e||void 0===e?void 0:e.details)&&i.push(this._renderResultRowIndividual(e))})),0===i.length&&i.push((0,v.u)("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap})));return(0,v.u)("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToIndividualRecords([],"",!1)}},(0,v.u)("calcite-action",{afterCreate:h.Yo,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),(0,v.u)("calcite-list",{selectionMode:"none"},i),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,i=[],s=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach((e=>{let{name:t,alias:r}=e;i.push((0,v.u)("calcite-option",{key:"display-".concat(t),label:null!==r&&void 0!==r?r:t,selected:t===this._resultDisplayField,value:t})),s.push((0,v.u)("calcite-option",{key:"sort-".concat(t),label:null!==r&&void 0!==r?r:t,selected:t===this._resultSortField,value:t}))})):(i.push((0,v.u)("calcite-option",{key:"display-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})),s.push((0,v.u)("calcite-option",{key:"sort-".concat(this._resultDisplayField),label:this._resultDisplayField,value:this._resultDisplayField})))),(0,v.u)("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:null!==this.domNode?de(.75*this.domNode.clientWidth):{width:"75%"}},(0,v.u)("calcite-block",{heading:"",open:!0,overlayPositioning:"fixed"},(0,v.u)("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,(0,v.u)("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:e=>{const t=e.target;this._resultDisplayField=t.selectedOption.value,this._showResultOptions=!1}},i)),(0,v.u)("calcite-label",{scale:"s"},e.resultsStrings.sortBy,(0,v.u)("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:e=>{const i=e.target;this._resultSortField=i.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},s))))}_renderResultRowFunctions(e){return(0,v.u)("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result,overlayPositioning:"fixed"})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return(0,v.u)("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")",!0)}},(0,v.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return(0,v.u)("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.viewModel.queryFeaturesById(e).then((i=>{if(null!==i&&void 0!==i&&i.length){this._resultObjectIdField=i[0].layer.objectIdField,"objectid"===this._resultDisplayField&&(this._resultDisplayField=i[0].layer.objectIdField),"objectid"===this._resultSortField&&(this._resultSortField=i[0].layer.objectIdField);const s=this._appendAttributes(e,i,"objectId");this.switchToIndividualRecords(s,t+" ("+e.length+")",!0)}else this.switchToIndividualRecords(e,t+" ("+e.length+")",!0)}))}},(0,v.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){var t,i,s,r,l,a;const{messages:o}=this,c="display-".concat(e.objectId,"-nso"),{nonSpatialObject:u,zoomToFeature:d}=o.globalStrings;let h="",p=null;if(p=null===e||void 0===e||null===(t=e.details)||void 0===t?void 0:t.fields.find((e=>{let{name:t}=e;return t===this._resultDisplayField})),"date"===(null===(i=p)||void 0===i?void 0:i.type))h=new Date(e.details.attributes[this._resultDisplayField]).toDateString();else if("assetgroup"===this._resultDisplayField.toLowerCase())h=this._getAssetGroupName(e);else if("assettype"===this._resultDisplayField.toLowerCase())h=this._getAssetTypeName(e);else if(null!==(s=p)&&void 0!==s&&s.domain&&function(e){return e instanceof n.Z}(p.domain)){const t=p.domain.codedValues.find((t=>{let{code:i}=t;return i===e.details.attributes[this._resultDisplayField]}));h=null===t||void 0===t?void 0:t.name}else h=null!==(r=null===(l=e.details)||void 0===l?void 0:l.attributes[this._resultDisplayField])&&void 0!==r?r:e.objectId;return h&&""!==h&&null!==h?"string"==typeof h&&(h.trim()||(h=o.resultsStrings.noValue)):h=o.resultsStrings.noValue,null!==(null===e||void 0===e||null===(a=e.details)||void 0===a?void 0:a.geometry)?(0,v.u)("calcite-list-item",{label:h,onCalciteListItemSelect:()=>{this.viewModel.zoomToAsset(e.details.geometry)}},(0,v.u)("calcite-icon",{icon:"zoom-to-object",scale:"s",slot:"content-end",textLabel:d})):(0,v.u)("calcite-list-item",{label:h},(0,v.u)("calcite-icon",{icon:"table",id:c,scale:"s",slot:"content-end",textLabel:u}),(0,v.u)("calcite-tooltip",{label:u,referenceElement:c},(0,v.u)("span",null,u)))}_afterComponentCreate(e){"value"in e&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach((t=>{"starting-point"===t.type&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),"barrier"===t.type&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)}))}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach((e=>{"starting-point"===e.type?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)}))}_utilityNetworkTraceInitialized(){return this.viewModel.loadUtilityNetwork().then((e=>{var t;if(e)return this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel.flags.length>0&&this._processFlagOnLoad(),null===(t=this.view)||void 0===t?void 0:t.when().then((()=>{this._watchViewState()}));this.disabled=!1})).catch((e=>{const{messages:t}=this;this._loadUNError=!1,"utility-network:no-user-type-extension"===e.name||e.details.raw.extendedCode===ge?this._errorMessage=t.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1}))}_processFlagOnLoad(){var e;return null===(e=this.view)||void 0===e?void 0:e.when().then((()=>{this._watchHandler=(0,r.when)((()=>{var e;return!(null!==(e=this.view)&&void 0!==e&&e.updating)}),(async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const e=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),e.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),e.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,null!==this._watchHandler&&this._watchHandler.remove()}))}))}_registerWatchers(){this.addHandles([(0,r.watch)((()=>this.selectedTraces),(()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()})),(0,r.watch)((()=>this.defaultGraphicColor),(()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach((e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)})),this.scheduleRender()}))])}_groupResultsByAssetGroup(e){var t;const i=[],s=null===(t=e.results)||void 0===t?void 0:t.elements,r=this._groupBy(null!==s&&void 0!==s?s:[],"networkSourceId");for(const l in r)i.push(this._groupBy(r[l],"assetGroupCode"));return i}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_appendAttributes(e,t,i){const s=[];return e.forEach((e=>{t.forEach((t=>{t.featureSet.features.forEach((r=>{e[i]===r.attributes[this._resultObjectIdField]&&(e.details=r,e.details.fields=t.featureSet.fields,s.push(e))}))}))})),s}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(s){const e=s.assetGroups.find((e=>e.assetGroupCode===i));e&&(t=e.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const i=e.assetGroupCode,s=this.viewModel.getValidSources().find((t=>t.sourceId===e.networkSourceId));if(s){const r=s.assetGroups.find((e=>e.assetGroupCode===i));if(r){const i=r.assetTypes.find((t=>t.assetTypeCode===e.assetTypeCode));i&&(t=i.assetTypeName)}}return t}_compare(e,t){return(i,s)=>{var r,l,a,o;let n=0,c=null!==(r=null===(l=i.details)||void 0===l?void 0:l.attributes[e])&&void 0!==r?r:i.objectId,u=null!==(a=null===(o=s.details)||void 0===o?void 0:o.attributes[e])&&void 0!==a?a:s.objectId;return isNaN(c)&&(c=c.toLowerCase()),isNaN(u)&&(u=u.toLowerCase()),"desc"===t?c>u?n=1:c<u&&(n=-1):c<u?n=1:c>u&&(n=-1),n}}_groupBy(e,t){return e.reduce(((e,i)=>((e[i[t]]=e[i[t]]||[]).push(i),e)),{})}_getSymbolIcon(e){var t;return"picture-marker"===e.type?(0,v.u)("img",{height:e.height,src:null!==(t=e.url)&&void 0!==t?t:void 0,width:e.width}):null}_watchViewState(){this._watchHandler=(0,r.when)((()=>{var e;return!(null!==(e=this.view)&&void 0!==e&&e.updating)}),(()=>{this.disabled=!1,null!==this._watchHandler&&this._watchHandler.remove()}),{initial:!0})}_changeCursor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";const i=null===(e=this.view)||void 0===e||null===(e=e.container)||void 0===e?void 0:e.style;i&&(i.cursor=t)}};(0,s._)([(0,l.Cb)()],ve.prototype,"_selectToolActive",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_activeTrace",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_activeSwatch",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_traceHeaderForFlow",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_assetGroupHeader",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_assetTypeHeader",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_traceResultsFunctions",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_traceResultsAssetGroup",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_traceResultsAssetType",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_traceResultsIndividual",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_showTraceResultFunctions",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_showTraceResultAssetGroup",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_showTraceResultAssetType",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_showIndividualRecords",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_activeTab",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_alertRemoveModal",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_warningNoFlag",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_warningNoTraceSelected",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_confirmReset",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_swatchNode",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"_errorMessage",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"defaultGraphicColor",null),(0,s._)([(0,l.Cb)()],ve.prototype,"disabled",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"flags",null),(0,s._)([(0,l.Cb)()],ve.prototype,"gdbVersion",null),(0,s._)([(0,l.Cb)()],ve.prototype,"icon",null),(0,s._)([(0,l.Cb)()],ve.prototype,"inputSettings",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"label",null),(0,s._)([(0,l.Cb)(),(0,p.H)("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],ve.prototype,"messages",void 0),(0,s._)([(0,l.Cb)(),(0,p.H)("esri/t9n/common")],ve.prototype,"messagesCommon",void 0),(0,s._)([(0,l.Cb)(),(0,p.H)("esri/core/t9n/Units")],ve.prototype,"messagesUnits",void 0),(0,s._)([(0,l.Cb)()],ve.prototype,"resultAreaProperties",null),(0,s._)([(0,l.Cb)()],ve.prototype,"selectedTraces",null),(0,s._)([(0,l.Cb)()],ve.prototype,"selectOnComplete",null),(0,s._)([(0,l.Cb)()],ve.prototype,"showGraphicsOnComplete",null),(0,s._)([(0,l.Cb)()],ve.prototype,"enableResultArea",null),(0,s._)([(0,l.Cb)()],ve.prototype,"showSelectionAttributes",null),(0,s._)([(0,l.Cb)()],ve.prototype,"utilityNetwork",null),(0,s._)([(0,l.Cb)()],ve.prototype,"view",null),(0,s._)([(0,g.s)(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area","create-result-area"]),(0,l.Cb)({type:oe})],ve.prototype,"viewModel",void 0),ve=(0,s._)([(0,o.j)("esri.widgets.UtilityNetworkTrace")],ve);const ye=ve}}]);
//# sourceMappingURL=41166.0ca05af5.chunk.js.map