"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[9245],{13491:(e,t,i)=>{i.d(t,{Q:()=>o});var n=i(63780),s=(i(93169),i(27546)),r=i(36231);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,t=arguments.length>1?arguments[1]:void 0;this._compareMinX=h,this._compareMinY=p,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),v.prune(),b.prune(),E.prune(),I.prune()}all(e){a(this._data,e)}search(e,t){let i=this._data;const n=this._toBBox;if(f(e,i))for(v.clear();i;){for(let s=0,r=i.children.length;s<r;s++){const r=i.children[s],o=i.leaf?n(r):r;f(e,o)&&(i.leaf?t(r):g(e,o)?a(r,t):v.push(r))}i=v.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!f(e,t))return!1;for(v.clear();t;){for(let n=0,s=t.children.length;n<s;n++){const s=t.children[n],r=t.leaf?i(s):s;if(f(e,r)){if(t.leaf||g(e,r))return!0;v.push(s)}}t=v.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new C([]),this}remove(e){if(!e)return this;let t,i=this._data,s=null,r=0,o=!1;const a=this._toBBox(e);for(E.clear(),I.clear();i||E.length>0;){var l;if(i||(i=E.pop(),s=E.data[E.length-1],r=null!==(l=I.pop())&&void 0!==l?l:0,o=!0),i.leaf&&(t=(0,n.cq)(i.children,e,i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),E.push(i),this._condense(E),this;o||i.leaf||!g(i,a)?s?(r++,i=s.children[r],o=!1):i=null:(E.push(i),I.push(r),r=0,s=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,n){const s=i-t+1;let r=this._maxEntries;if(s<=r){const n=new C(e.slice(t,i+1));return l(n,this._toBBox),n}n||(n=Math.ceil(Math.log(s)/Math.log(r)),r=Math.ceil(s/r**(n-1)));const o=new R([]);o.height=n;const a=Math.ceil(s/r),d=a*Math.ceil(Math.sqrt(r));T(e,t,i,d,this._compareMinX);for(let l=t;l<=i;l+=d){const t=Math.min(l+d-1,i);T(e,l,t,a,this._compareMinY);for(let i=l;i<=t;i+=a){const s=Math.min(i+a-1,t);o.children.push(this._build(e,i,s,n-1))}}return l(o,this._toBBox),o}_insert(e,t,i){const n=this._toBBox,s=i?e:n(e);E.clear();const r=function(e,t,i,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==i;){let i,n=1/0,s=1/0;for(let r=0,o=t.children.length;r<o;r++){const o=t.children[r],a=c(o),l=y(e,o)-a;l<s?(s=l,n=a<n?a:n,i=o):l===s&&a<n&&(n=a,i=o)}t=i||t.children[0]}return t}(s,this._data,t,E);for(r.children.push(e),u(r,s);t>=0&&E.data[t].children.length>this._maxEntries;)this._split(E,t),t--;!function(e,t,i){for(let n=i;n>=0;n--)u(t.data[n],e)}(s,E,t)}_split(e,t){const i=e.data[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const r=this._chooseSplitIndex(i,s,n);if(!r)return;const o=i.children.splice(r,i.children.length-r),a=i.leaf?new C(o):new R(o);a.height=i.height,l(i,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this._data=new R([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let n,s,r;n=s=1/0;for(let o=t;o<=i-t;o++){const t=d(e,0,o,this._toBBox),a=d(e,o,i,this._toBBox),l=_(t,a),u=c(t)+c(a);l<n?(n=l,r=o,s=u<s?u:s):l===n&&u<s&&(s=u,r=o)}return r}_chooseSplitAxis(e,t,i){const n=e.leaf?this._compareMinX:h,s=e.leaf?this._compareMinY:p;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,s)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const s=this._toBBox,r=d(e,0,t,s),o=d(e,i-t,i,s);let a=m(r)+m(o);for(let l=t;l<i-t;l++){const t=e.children[l];u(r,e.leaf?s(t):t),a+=m(r)}for(let l=i-t-1;l>=t;l--){const t=e.children[l];u(o,e.leaf?s(t):t),a+=m(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const s=e.data[t-1],r=s.children;r.splice((0,n.cq)(r,i,r.length,s.indexHint),1)}else this.clear();else l(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let i=e;for(b.clear();i;){var n;if(!0===i.leaf)for(const e of i.children)t(e);else b.pushArray(i.children);i=null!==(n=b.pop())&&void 0!==n?n:null}}function l(e,t){d(e,0,e.children.length,t,e)}function d(e,t,i,n,s){s||(s=new C([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r,o=t;o<i;o++)r=e.children[o],u(s,e.leaf?n(r):r);return s}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function p(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function y(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function _(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,r-n)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function T(e,t,i,n,s){const o=[t,i];for(;o.length;){const t=o.pop(),i=o.pop();if(t-i<=n)continue;const a=i+Math.ceil((t-i)/n/2)*n;(0,r.q)(e,a,i,t,s),o.push(i,a,a,t)}}const v=new s.Z,b=new s.Z,E=new s.Z,I=new s.Z({deallocator:void 0});class w{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class S extends w{constructor(){super(...arguments),this.height=1,this.indexHint=new n.SO}}class C extends S{constructor(e){super(),this.children=e,this.leaf=!0}}class R extends S{constructor(e){super(),this.children=e,this.leaf=!1}}},66020:(e,t,i)=>{i.d(t,{H:()=>l});var n=i(93169),s=i(13491),r=i(65156);const o={minX:0,minY:0,maxX:0,maxY:0};function a(e,t,i){(function(e){o.minX=e[0],o.minY=e[1],o.maxX=e[2],o.maxY=e[3]})(t),e.search(o,i)}class l{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.Q(9,(0,n.Z)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((i,n)=>{e[t++]=n})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,r.cS)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),a(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},68928:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(63780),s=i(10064),r=i(91505),o=i(32718),a=i(41414),l=i(65156),d=i(83406),u=i(66020),h=i(3306),p=i(77835);const c=(0,a.Ue)();class m{constructor(e){this.geometryInfo=e,this._boundsStore=new u.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new r.Z,this.featureAdapter=p.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,i,n,s]=this.fullBounds;return{xmin:t,ymin:i,xmax:n,ymax:s,spatialReference:(0,h.S2)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map((e=>this._upsert(e)));return this._emitChanged(),t.filter(n.pC)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const i of e){const e=this._boundsStore.get(i.objectId);e&&t((0,a.JR)(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,i)=>{this._markedIds.has(i)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){var t;if(!e)return;const i=e.objectId;if(null==i)return void o.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.Z("featurestore:invalid-feature","feature id is missing",{feature:e}));const n=this._featuresById.get(i);let r;if(this._markedIds.add(i),n?(e.displayId=n.displayId,r=this._boundsStore.get(i),this._boundsStore.delete(i)):null!=this.onFeatureAdd&&this.onFeatureAdd(e),null===(t=e.geometry)||void 0===t||null===(t=t.coords)||void 0===t||!t.length)return this._boundsStore.set(i,null),void this._featuresById.set(i,e);r=(0,d.$)(null!=r?r:(0,l.Ue)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=r&&this._boundsStore.set(i,r),this._featuresById.set(i,e)}_upsert(e){var t;const i=null===e||void 0===e?void 0:e.objectId;if(null==i)return o.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.Z("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const n=this._featuresById.get(i);if(!n)return this._add(e),e;this._markedIds.add(i);const{geometry:r,attributes:a}=e;for(const s in a)n.attributes[s]=a[s];return r&&(n.geometry=r,this._boundsStore.set(i,null!==(t=(0,d.$)((0,l.Ue)(),r,this.geometryInfo.hasZ,this.geometryInfo.hasM))&&void 0!==t?t:null)),n}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._markedIds.delete(t),this._boundsStore.delete(t),this._featuresById.delete(t),e}}},34311:(e,t,i)=>{function n(e,t,i){return{objectId:e,target:t,distance:i,type:"vertex"}}function s(e,t,i,n,s){return{objectId:e,target:t,distance:i,type:"edge",start:n,end:s,draped:arguments.length>5&&void 0!==arguments[5]&&arguments[5]}}i.d(t,{p:()=>s,u:()=>n})},63543:(e,t,i)=>{i.d(t,{Dm:()=>u,Hq:()=>p,MS:()=>c,bU:()=>a});var n=i(93169),s=i(84652),r=i(60480),o=i(76115);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.I4:"esriGeometryPolyline"===e?o.ET:o.lF}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;function u(e,t){if((0,n.Z)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let i="this".concat(h(t)," = null;");for(const t in e)i+="this".concat(h(t)," = ").concat(JSON.stringify(e[t]),";");const n=new Function("\n      return class AttributesClass$".concat(d++," {\n        constructor() {\n          ").concat(i,";\n        }\n      }\n    "))();return()=>new n}catch(i){return()=>({[t]:null,...e})}}function h(e){return l.test(e)?".".concat(e):'["'.concat(e,'"]')}function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,s.d9)(e)}}]}function c(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:r.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},50568:(e,t,i)=>{i.d(t,{Qc:()=>N,Fd:()=>R,TD:()=>S,Cn:()=>C,zS:()=>I,WZ:()=>w});var n=i(27366),s=(i(59486),i(7138)),r=i(10064),o=i(32718),a=i(77427),l=i(76672),d=i(49861),u=(i(93169),i(84936),i(69912)),h=i(80885),p=i(79803),c=i(92975),m=i(83406),y=i(3182),_=i(77981);class g{constructor(){this._featureLookup=new Map}static getInstance(){return g.instance||(g.instance=new g),g.instance}static resetInstance(){g.instance&&(g.instance=null)}deleteFromStore(e){e.forEach((e=>{this._featureLookup.delete(e)}))}readFromStoreByList(e){const t=[];return e.forEach((e=>{const i=this.readFromStoreById(e);i&&t.push(i)})),t}readFromStoreById(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}writeToStore(e,t,i){const n=[];return e.forEach((e=>{if(null===e||void 0===e||!e.id)return;e.properties||(e.properties=[]);let s,r=null;if(i&&e.properties[i]&&(r=(0,m.GH)(e.properties[i])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const n=this._featureLookup.get(e.id),o=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));i&&e.properties[i]&&(o[i]=(0,_.im)(e.properties[i])),s=new y.u_(r?JSON.parse(JSON.stringify(r)):null!==n&&void 0!==n&&n.geometry?JSON.parse(JSON.stringify(n.geometry)):null,o,null,e.properties[t])}else s=new y.u_(r?JSON.parse(JSON.stringify(r)):null,e.properties,null,e.properties[t]);this._featureLookup.set(e.id,s),n.push(s)})),n}}var f=i(69086),T=i(97316),v=i(5924),b=i(21149),E=i(53866);const I="ESRI__ID",w="ESRI__ORIGIN_ID",S="ESRI__DESTINATION_ID",C="ESRI__LAYOUT_GEOMETRY",R="ESRI__AGGREGATION_COUNT";let N=class extends s.default{constructor(e){var t,i,n;super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const s=new Map;null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((t=>{var i,n;t.name&&(s.set(t.name,"entity"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers)||this.entityTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach((e=>{var i;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(i=e.name)&&void 0!==i?i:"",geometryType:e.geometryType})})))})),null!==(i=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==i&&i.forEach((t=>{var i,n;t.name&&(s.set(t.name,"relationship"),this._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(i=e.inclusionModeDefinition)&&void 0!==i&&i.generateAllSublayers)||this.relationshipTypeNames.add(t.name),null===(n=t.properties)||void 0===n||n.forEach((e=>{var i;e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(t.name,{name:null!==(i=e.name)&&void 0!==i?i:"",geometryType:e.geometryType})})))})),null===(n=e.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.forEach(((t,i)=>{var n;if("entity"===s.get(i))this.entityTypeNames.add(i);else{var r;if("relationship"!==s.get(i))return o.Z.getLogger(this).warn("A named type, ".concat(i,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(r=e.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.delete(i));this.relationshipTypeNames.add(i)}const l=new Map;null!==(n=t.members)&&void 0!==n&&n.forEach((e=>{(0,a.s1)(this.memberIdTypeLookup,e.id,(()=>new Set)).add(i);const t=this.getById(e.id);t&&l.set(e.id,t)})),this.sublayerCaches.set(i,l)}))}addToLayer(e){e.forEach((e=>{let{typeName:t,id:i}=e;if(!this.inclusionModeDefinition)throw new r.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const e=this.inclusionModeDefinition.namedTypeDefinitions.get(t);e.members||(e.members=new Map),e.members.set(i,{id:i}),(0,a.s1)(this.memberIdTypeLookup,i,(()=>new Set)).add(t)}}else{const e=new Map;e.set(i,{id:i}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:e}),(0,a.s1)(this.memberIdTypeLookup,i,(()=>new Set)).add(t)}}))}getById(e){return g.getInstance().readFromStoreById(e)}async getData(e,t,i){var n;if(t.objectType.name&&null!==(n=this.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let s;if(s=e||new b.Z({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){var r,o,a;const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(null!==(r=t.objectType.name)&&void 0!==r?r:""),n=s.outFields;n&&1===n.length&&n[0]===I&&"1=1"===s.where||await Promise.all(null!==i&&void 0!==i?i:[]);const l=this.sublayerCaches.has(null!==(o=t.objectType.name)&&void 0!==o?o:"")?Array.from(null===(a=this.sublayerCaches.get(t.objectType.name))||void 0===a?void 0:a.values()):[],d=[];return l.forEach((i=>{this.relationshipTypeNames.has(t.objectType.name)?i.geometry=e.relationshipLinkChartDiagramLookup.get(i.attributes[t.objectIdField]):i.geometry=e.entityLinkChartDiagramLookup.get(i.attributes[t.objectIdField]),i.attributes[C]=i.geometry,d.push(i)})),d}return this.retrieveDataFromService(s,t,i)}async getConnectedRecordIds(e,t){const i=[];let n="";const s=[],r=new Map;if(e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const i of this.memberIdTypeLookup.get(e)){var t;if(!this.entityTypeNames.has(i))return;r.has(i)?null===(t=r.get(i))||void 0===t||t.push(e):r.set(i,[e])}})),t&&0!==(null===t||void 0===t?void 0:t.length)){for(const e of t)n=n+e+"|";n=n.slice(0,-1)}return r.forEach(((e,r)=>{let a;a=t&&0!==(null===t||void 0===t?void 0:t.length)?"MATCH (n:".concat(r,")-[r:").concat(n,"]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"):"MATCH (n:".concat(r,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]");const l=new Promise((t=>{(async()=>{const t=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new v.Z({openCypherQuery:a,bindParameters:{ids:e}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:n}=await t.read();if(e)break;for(let t=0;t<n.length;t++){const e=n[t];i.push({id:e[0],typeName:e[1]}),i.push({id:e[2],typeName:e[3]})}}}catch(n){if("AbortError"!==n.name)throw n;o.Z.getLogger(this).info("Request aborted as expected")}})().then((()=>{t()}))}));s.push(l)})),this.refreshCacheContent(),await Promise.all(s),i}async getAttachedRelationships(e,t){const i=[],n=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new v.Z({openCypherQuery:"MATCH (n)-[r]->(m) WHERE id(n) IN $nodeIds AND id(m) in $nodeIds AND NOT id(r) IN $relationshipExclusionIds return id(r), type(r)",bindParameters:{nodeIds:e,relationshipExclusionIds:t}}))).resultRowsStream.getReader();try{for(;;){const{done:e,value:t}=await n.read();if(e)break;for(let n=0;n<t.length;n++){const e=t[n];i.push({id:e[0],typeName:e[1]})}}}catch(s){if("AbortError"!==s.name)throw s;o.Z.getLogger(this).info("Request aborted as expected")}return i}async refreshCacheContent(e,t,i){var n,s,o,l,d;let u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=g.getInstance(),p=[],c=new Map,m=new Map;null!==(n=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==n&&n.forEach((e=>{e.name&&m.set(e.name,e)})),null!==(s=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==s&&s.forEach((e=>{e.name&&m.set(e.name,e)})),e||this.inclusionModeDefinition?e?e.forEach((e=>{if(this.memberIdTypeLookup.has(e))for(const i of this.memberIdTypeLookup.get(e)){var t;c.has(i)?null===(t=c.get(i))||void 0===t||t.push(e):c.set(i,[e])}})):null===(o=this.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||o.forEach(((e,t)=>{e.useAllData?c.set(t,null):e.members&&e.members.forEach((e=>{var i;c.has(t)&&null!==c.get(t)?null===(i=c.get(t))||void 0===i||i.push(e.id):c.set(t,[e.id])}))})):(null!==(l=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==l&&l.forEach((e=>{e.name&&c.set(e.name,null)})),null===(d=this.knowledgeGraph.dataModel.entityTypes)||void 0===d||d.forEach((e=>{e.name&&c.set(e.name,null)})));for(const[_,g]of c){var y;const e=new Promise((e=>{(async()=>{var e;const n=new Set,s=[];let o,l="",d=!1;if(t||null!==(e=m.get(_))&&void 0!==e&&null!==(e=e.properties)&&void 0!==e&&e.forEach((e=>{e.name&&n.add(e.name)})),i&&this.geographicLookup.has(_)){var p;const e=null===(p=this.geographicLookup.get(_))||void 0===p?void 0:p.name;e&&n.add(e)}if(this.entityTypeNames.has(_))l="MATCH (n:".concat(_,") ").concat(g?"WHERE id(n) IN $ids ":"","return ID(n)"),n.forEach((e=>{l+=", n.".concat(e),s.push(e)}));else{if(!this.relationshipTypeNames.has(_))throw new r.Z("knowledge-graph:layer-data-manager","The graph type of ".concat(_," could not be determined. Was this type set in the KG data model and inclusion definition?"));d=!0,l="MATCH ()-[n:".concat(_,"]->() ").concat(g?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),n.forEach((e=>{l+=", n.".concat(e),s.push(e)}))}o=new v.Z(g?{openCypherQuery:l,bindParameters:{ids:g}}:{openCypherQuery:l});const c=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,o)).resultRowsStream.getReader();for(;;){var y,f,b,E;const{done:e,value:t}=await c.read();if(e)break;const i=[];for(let o=0;o<t.length;o++){const e=t[o];let n=0,r=0;const l={properties:{}};for(l.id=e[n],n++,r++,d&&(l.originId=e[n],n++,r++,l.destinationId=e[n],n++,r++,(0,a.s1)(this.nodeConnectionsLookup,l.originId,(()=>new Set)).add(l.id),(0,a.s1)(this.nodeConnectionsLookup,l.destinationId,(()=>new Set)).add(l.id),(0,a.s1)(this.relationshipConnectionsLookup,l.id,(()=>[l.originId,l.destinationId])));n<e.length;n++)l.properties[s[n-r]]=e[n];i.push(l)}const n=h.writeToStore(i,I,null===(y=this.geographicLookup.get(_))||void 0===y?void 0:y.name);this.sublayerCaches.has(_)||this.sublayerCaches.set(_,new Map),u&&!(null!==(f=this.inclusionModeDefinition)&&void 0!==f&&f.namedTypeDefinitions.has(_))&&null!==(b=this.inclusionModeDefinition)&&void 0!==b&&b.namedTypeDefinitions.set(_,{useAllData:!1,members:new Map}),u&&(null===(E=this.inclusionModeDefinition)||void 0===E||!E.namedTypeDefinitions.get(_).members)&&(this.inclusionModeDefinition.namedTypeDefinitions.get(_).members=new Map);const r=this.sublayerCaches.get(_);n.forEach((e=>{var t,i;null!==r&&void 0!==r&&r.set(e.attributes[I],e),u&&(null===(t=this.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(_).members.has(e.attributes[I]))&&(null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions.get(_).members.set(e.attributes[I],{id:e.attributes[I]}),(0,a.s1)(this.memberIdTypeLookup,e.attributes[I],(()=>new Set)).add(_))}))}})().then((()=>{e(null)}))}));p.push(e),null===(y=this._processingCacheUpdatesLookup.get(_))||void 0===y||y.push(e)}await Promise.all(p)}removeFromLayer(e){const t=new Set,i=new Set(e.map((e=>e.id)));for(const o of e){var n,s,r;t.add(o.typeName),1===(null===(n=this.memberIdTypeLookup.get(o.id))||void 0===n?void 0:n.size)?this.memberIdTypeLookup.delete(o.id):null===(s=this.memberIdTypeLookup.get(o.id))||void 0===s||s.delete(o.typeName),null===(r=this.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.forEach(((e,t)=>{var i;t===o.typeName&&(null===(i=e.members)||void 0===i?void 0:i.has(o.id))&&e.members.delete(o.id)}))}t.forEach((e=>{var t;null===(t=this.sublayerCaches.get(e))||void 0===t||t.forEach(((t,n)=>{var s;i.has(n)&&(null===(s=this.sublayerCaches.get(e))||void 0===s||s.delete(n))}))}))}async retrieveDataFromService(e,t,i){var n,s,o;const a=g.getInstance(),d=new Set,u=[];let m,y="",_=[];const b="relationship"===t.graphType,w=null===(n=this.inclusionModeDefinition)||void 0===n||null===(n=n.namedTypeDefinitions)||void 0===n||null===(n=n.get(t.objectType.name))||void 0===n?void 0:n.useAllData,S=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let C=!w&&S?Array.from(S).sort():null;if(null!==(s=this.inclusionModeDefinition)&&void 0!==s&&null!==(s=s.namedTypeDefinitions)&&void 0!==s&&null!==(s=s.get(t.objectType.name))&&void 0!==s&&s.useAllData)(null===(o=this.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(t.objectType.name))||void 0===o?void 0:o.useAllData)&&null!=e.objectIds&&(C=e.objectIds);else if(null!=e.objectIds&&C&&C.length>0){const t=e.objectIds;e.objectIds=C.filter((e=>t.includes(e)))}else if(null!=e.objectIds)C=e.objectIds;else{var R,N,L;if(null!==(R=this.inclusionModeDefinition)&&void 0!==R&&R.namedTypeDefinitions.has(t.objectType.name)&&(null===(N=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===N||!N.members||(null===(L=this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name))||void 0===L||null===(L=L.members)||void 0===L?void 0:L.size)<1))return e.objectIds=[],[];e.objectIds=C}if(null!=e.outFields){const i=e.outFields;i.includes("*")?t.fields.forEach((e=>{d.add(e.name)})):i.forEach((e=>{e!==I&&e!==t.geometryFieldName&&d.add(e)}))}if(null!=e.geometry){var M,A,x;const i=e.geometry;let n;const s=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,o=null===s||void 0===s?void 0:s.spatialReference,a=null===s||void 0===s||null===(M=s.serviceCapabilities)||void 0===M?void 0:M.geometryCapabilities;let _=null===a||void 0===a?void 0:a.geometryMaxBoundingRectangleSizeX,g=null===a||void 0===a?void 0:a.geometryMaxBoundingRectangleSizeY;if(null===i||void 0===i||null===(A=i.extent)||void 0===A||!A.spatialReference||null!==(x=i.spatialReference)&&void 0!==x&&x.isWGS84?n=i.extent:(await(0,p.initializeProjection)(i.extent.spatialReference,c.YU),n=(0,p.project)(i.extent,c.YU)),_&&g&&o){if(4326!==o.wkid){const e=new E.Z({spatialReference:o,xmax:_,ymax:g}),t=(0,p.project)(e,c.YU);_=t.xmax,g=t.ymax}if(n.xmax-n.xmin>_)throw new r.Z("knowledge-graph:layer-data-manager","Extent x bounds should be within ".concat(_,"\xb0 latitude, limit exceeded"));if(n.ymax-n.ymin>g)throw new r.Z("knowledge-graph:layer-data-manager","Extent y bounds should be within ".concat(g,"\xb0 longitude, limit exceeded"))}if(null!=e.where&&"1=1"!==e.where){const i=await(0,l.E)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach((e=>{i.fieldNames.includes(e.name)&&d.add(e.name)}))}y=b?"Match ()-[n:".concat(t.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(t.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(t.geometryFieldName,") return ID(n)"),t.geometryFieldName&&d.add(t.geometryFieldName),d.forEach((e=>{y+=", n.".concat(e),u.push(e)})),m=new v.Z({openCypherQuery:y,bindParameters:{param_filter_geom:new h.Z({rings:(0,f.MM)(n)})}})}else{let i="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,l.E)(e.where,t.fieldsIndex);t.fields.forEach((e=>{n.fieldNames.includes(e.name)&&d.add(e.name)}));const s=new Set(["column-reference","string","number","binary-expression"]),r=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let o=!1;const a=e=>{if("column-reference"===e.type)return"n.".concat(e.column);if("string"===e.type)return"'".concat(e.value,"'");if("number"===e.type)return"".concat(e.value);if("binary-expression"===e.type&&s.has(e.left.type)&&s.has(e.right.type)&&r.has(e.operator))return"".concat(a(e.left)," ").concat(e.operator," ").concat(a(e.right));if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+="lower(n.".concat(e.left.args.value[0].column,")");else{if("column-reference"!==e.left.type)return o=!0,"";t+="lower(n.".concat(e.left.column,")")}if(t+=" CONTAINS (","string"!==e.right.type)return o=!0,"";{let i=e.right.value;"%"===i.charAt(0)&&(i=i.slice(1)),"%"===i.charAt(i.length-1)&&(i=i.slice(0,-1)),t+="'".concat(i.toLowerCase(),"')")}return t}return o=!0,""};i=a(n.parseTree),o&&(i="")}let n="";n=b?"Match ()-[n:".concat(t.objectType.name,"]->()"):"Match (n:".concat(t.objectType.name,")");let s=!1;C&&(s=!0,n+=" WHERE ID(n) IN $ids"),i&&(n+=s?" AND":" WHERE",n+=" ".concat(i)),n+=" return ID(n)",b&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&d.add(t.geometryFieldName),d.forEach((e=>{n+=", n.".concat(e),u.push(e)})),m=new v.Z(C?{openCypherQuery:n,bindParameters:{ids:C}}:{openCypherQuery:n})}const k=(await(0,T.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,m,i)).resultRowsStream.getReader();for(;;){var D;const{done:e,value:i}=await k.read();if(e)break;const n=[];for(let t=0;t<i.length;t++){const e=i[t];let s=0,r=0;const o={properties:{}};for(o.id=e[s],s++,r++,b&&(o.originId=e[s],s++,r++,o.destinationId=e[s],s++,r++);s<e.length;s++)o.properties[u[s-r]]=e[s];n.push(o)}_=_.concat(a.writeToStore(n,I,null===(D=t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name))||void 0===D?void 0:D.name))}return _}};(0,n._)([(0,d.Cb)()],N.prototype,"knowledgeGraph",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"entityTypeNames",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"geographicLookup",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"sublayerCaches",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"relationshipConnectionsLookup",void 0),(0,n._)([(0,d.Cb)()],N.prototype,"memberIdTypeLookup",void 0),N=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],N)},21438:(e,t,i)=>{i.d(t,{Z:()=>z});var n=i(27366),s=(i(59486),i(44055)),r=(i(94931),i(15126),i(98689),i(57823),i(32066),i(49018),i(34999),i(28189),i(9014)),o=i(40464),a=i(84652),l=i(97642),d=(i(70431),i(49861)),u=(i(93169),i(32718),i(69912)),h=i(31201),p=i(25265),c=i(79803),m=i(78952),y=i(92975),_=i(30651),g=i(68928),f=i(75878),T=i(63543),v=i(50568);i(84936);const b=(0,i(25610).v)(),E=e=>{let t=class extends e{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,d.Cb)(b.fields)],t.prototype,"fields",void 0),(0,n._)([(0,d.Cb)(b.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],t),t};var I=i(6693),w=i(7632),S=i(49661),C=i(9855),R=i(71684),N=i(56811),L=i(99063),M=i(70361),A=i(7653),x=i(83040),k=i(37270),D=i(77748),O=i(85116),F=i(49818),B=i(21149),j=i(81085),U=i(82485),G=i(53866),P=i(80885),q=i(29909),Z=i(27823);function Y(e){if(!e.json)return e;e.json.write=Q(e.json.write);const t=e.json.origins;if(!t)return e;let i;for(i in t){const e=t[i];e&&(e.write=Q(e.write))}return e}function Q(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:i,overridePolicy:n,...s}=e;return function(e,t){const i=X.call(this,e,t);return i.enabled?{...s,...i}:i}}(e)),e):!0===e?H():e}function H(){return{overridePolicy:X}}function X(e,t){const i=!!this.geometryType;let n={enabled:i};return i&&(n={...n,...V.call(this,e,t)}),n}function V(e,t){return{ignoreOrigin:this.originIdOf(t)>p.s3.DEFAULTS}}let J=class extends(E((0,S.M)((0,w.b)((0,I.h7)((0,C.c)((0,L.n)((0,N.M)((0,R.Q)((0,l.R)(_.Z)))))))))){constructor(e){var t;super(e),t=this,this.blendMode="normal",this.capabilities=(0,T.MS)(!1,!1),this.charts=null,this.definitionExpression=null,this.displayField="",this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=v.zS,this.objectType=null,this.opacity=1,this.orderBy=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then((()=>{const e=new MessageChannel;return new U.Z(e.port1,{channel:e,client:{queryFeatures:function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=B.Z.fromJSON(e);return t.queryFeaturesJSON(n,i)}}}),[e.port2]}))},this.title=null,this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){var e;const t=[];return null!==(e=this.objectType)&&void 0!==e&&null!==(e=e.properties)&&void 0!==e&&e.forEach((e=>{const i="esriFieldTypeOID"===e.fieldType?"esriFieldTypeInteger":e.fieldType;t.push(x.Z.fromJSON({name:e.name,type:i,alias:e.alias,defaultValue:e.defaultValue,editable:e.editable,nullable:e.nullable}))})),t.push(x.Z.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),x.Z.fromJSON({name:v.Fd,type:"esriFieldTypeInteger",alias:v.Fd,editable:!1})),t}get geometryType(){var e,t,i;if("link-chart"===(null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.type))return"relationship"===this.graphType?"polyline":"point";const n=null===(t=this.parentCompositeLayer)||void 0===t?void 0:t.dataManager.geographicLookup.get(null===(i=this.objectType)||void 0===i?void 0:i.name),s=null===n||void 0===n?void 0:n.geometryType;return s&&"esriGeometryNull"!==s?Z.M.fromJSON(s):null}get geometryFieldName(){var e,t,i,n;if("link-chart"===(null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.type))return v.Cn;const s=null===(t=this.parentCompositeLayer)||void 0===t?void 0:t.dataManager.geographicLookup.get(null===(i=this.objectType)||void 0===i?void 0:i.name);return null!==(n=null===s||void 0===s?void 0:s.name)&&void 0!==n?n:null}get graphTypeName(){var e;return null===(e=this.objectType)||void 0===e?void 0:e.name}get hasM(){var e,t,i,n;const s=null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.dataManager.geographicLookup.get(null===(t=this.objectType)||void 0===t?void 0:t.name),r=null===s||void 0===s?void 0:s.name,o=r?null===(i=this.objectType)||void 0===i||null===(i=i.properties)||void 0===i?void 0:i[r]:null;return null!==(n=null===o||void 0===o?void 0:o.hasM)&&void 0!==n&&n}get hasZ(){var e,t,i,n;const s=null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.dataManager.geographicLookup.get(null===(t=this.objectType)||void 0===t?void 0:t.name),r=null===s||void 0===s?void 0:s.name,o=r?null===(i=this.objectType)||void 0===i||null===(i=i.properties)||void 0===i?void 0:i[r]:null;return null!==(n=null===o||void 0===o?void 0:o.hasZ)&&void 0!==n&&n}set renderer(e){(0,k.YN)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){var e;return this._isOverridden("renderer")?this._get("renderer"):"link-chart"===(null===(e=this.parentCompositeLayer)||void 0===e?void 0:e.type)?"relationship"===this.graphType?(0,r.i)((0,T.bU)(Z.M.toJSON("polyline")).renderer):(0,r.i)((0,T.bU)(Z.M.toJSON("point")).renderer):(0,r.i)((0,T.bU)(Z.M.toJSON(this.geometryType)).renderer)}get spatialReference(){var e,t;return null!==(e=null===(t=this.parentCompositeLayer)||void 0===t||null===(t=t.dataManager)||void 0===t||null===(t=t.knowledgeGraph)||void 0===t||null===(t=t.dataModel)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:m.Z.WGS84}writeTitle(e,t){t.title=null!==e&&void 0!==e?e:"Layer"}createPopupTemplate(e){return(0,j.eZ)(this,e)}createQuery(){return new B.Z({where:"1=1",outFields:["*"]})}getField(e){for(let t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];return null}getFieldDomain(e,t){return null}async queryFeatures(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e),s=F.Z.fromJSON(await n.executeQuery(i.toJSON(),null===t||void 0===t?void 0:t.signal));return s.features.forEach((e=>{e.sourceLayer=this})),s}async queryFeaturesJSON(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(i.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryFeatureCount(e,t){const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(i.toJSON(),null===t||void 0===t?void 0:t.signal)}async queryExtent(){var e,t,i,n;let s=arguments.length>1?arguments[1]:void 0;const r={...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},returnGeometry:!0},{resolvedQuery:o,queryEngine:a}=await this._setupQueryObjects(r),l=await a.executeQueryForExtent(o.toJSON(),null===s||void 0===s?void 0:s.signal);let d;return d=null!=(null===(e=l.extent)||void 0===e?void 0:e.xmin)&&null!=(null===(t=l.extent)||void 0===t?void 0:t.xmax)&&null!=(null===(i=l.extent)||void 0===i?void 0:i.ymin)&&null!=(null===(n=l.extent)||void 0===n?void 0:n.ymax)?new G.Z(l.extent):new G.Z,{count:l.count,extent:d}}async queryObjectIds(e,t){const i=B.Z.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);n=this.loadQueryEngine(e)}return n.executeQueryForIds(i.toJSON(),null===t||void 0===t?void 0:t.signal)}loadQueryEngine(e){const t=new g.Z({geometryType:Z.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new f.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Z.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return i.featureStore.addMany(e),i}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new B.Z({where:"1=1",outFields:[v.zS]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}async _setupQueryObjects(e,t){var i;const n=B.Z.from(e),s=n.geometry;let r;if(s&&!(null!==(i=s.spatialReference)&&void 0!==i&&i.isWGS84)&&(await(0,c.initializeProjection)(s.spatialReference,y.YU),n.geometry=(0,c.project)(s instanceof P.Z||s instanceof q.Z?s:s.extent,y.YU)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)r=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(n,this,t);r=this.loadQueryEngine(e)}return{resolvedQuery:n,queryEngine:r}}};(0,n._)([(0,d.Cb)(Y((0,a.d9)(I.nE)))],J.prototype,"blendMode",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"capabilities",void 0),(0,n._)([(0,d.Cb)({json:{origins:{"web-scene":{write:!1}},write:H()}})],J.prototype,"charts",void 0),(0,n._)([(0,d.Cb)({readOnly:!0})],J.prototype,"defaultPopupTemplate",null),(0,n._)([(0,d.Cb)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],J.prototype,"definitionExpression",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"displayField",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(I.qu)))],J.prototype,"effect",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"elevationInfo",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(w.d)))],J.prototype,"featureEffect",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(A.d)))],J.prototype,"featureReduction",null),(0,n._)([(0,d.Cb)()],J.prototype,"fields",null),(0,n._)([(0,d.Cb)()],J.prototype,"geometryType",null),(0,n._)([(0,d.Cb)()],J.prototype,"geometryFieldName",null),(0,n._)([(0,d.Cb)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],J.prototype,"graphType",void 0),(0,n._)([(0,d.Cb)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],J.prototype,"graphTypeName",null),(0,n._)([(0,d.Cb)()],J.prototype,"hasM",null),(0,n._)([(0,d.Cb)()],J.prototype,"hasZ",null),(0,n._)([(0,d.Cb)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],J.prototype,"id",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.iR)))],J.prototype,"labelsVisible",void 0),(0,n._)([(0,d.Cb)({type:[D.Z],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:O.r,write:H()}})],J.prototype,"labelingInfo",void 0),(0,n._)([(0,d.Cb)({readOnly:!0,json:{read:!1,write:{writer(e,t){t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],J.prototype,"layerType",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.rn)))],J.prototype,"legendEnabled",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.u1)))],J.prototype,"maxScale",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.rO)))],J.prototype,"minScale",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"objectIdField",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"objectType",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.Oh)))],J.prototype,"opacity",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(C.l)))],J.prototype,"orderBy",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(M.C_)))],J.prototype,"popupEnabled",void 0),(0,n._)([(0,d.Cb)({type:s.Z,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],J.prototype,"popupTemplate",void 0),(0,n._)([(0,d.Cb)({type:Number,json:{write:{overridePolicy:V}}})],J.prototype,"refreshInterval",void 0),(0,n._)([(0,d.Cb)({types:o.A,json:{name:"layerDefinition.drawingInfo.renderer",write:H()}})],J.prototype,"renderer",null),(0,n._)([(0,d.Cb)()],J.prototype,"source",void 0),(0,n._)([(0,d.Cb)()],J.prototype,"spatialReference",null),(0,n._)([(0,d.Cb)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],J.prototype,"title",void 0),(0,n._)([(0,h.c)("title")],J.prototype,"writeTitle",null),(0,n._)([(0,d.Cb)({json:{read:!1}})],J.prototype,"type",void 0),(0,n._)([(0,d.Cb)(Y((0,a.d9)(L.I)))],J.prototype,"useViewTime",void 0),(0,n._)([(0,d.Cb)({type:Boolean,json:{name:"visibility",write:H()}})],J.prototype,"visible",void 0),J=(0,n._)([(0,u.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],J);const z=J},69086:(e,t,i)=>{i.d(t,{MM:()=>_,Ag:()=>f,bv:()=>g,jR:()=>T});var n,s=i(76200),r=i(10064),o=i(77427),a=(i(83406),i(97316)),l=i(5924);i(59486),i(78952);!function(e){e.ELEMENTUID="ELEMENTUID",e.TYPENAME="TYPENAME"}(n||(n={}));n.ELEMENTUID,n.TYPENAME;var d,u;!function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME"}(d||(d={})),function(e){e[e.ELEMENTUID=0]="ELEMENTUID",e[e.TYPENAME=1]="TYPENAME",e[e.FROMUID=2]="FROMUID",e[e.TOUID=3]="TOUID"}(u||(u={}));var h,p,c,m,y=i(72430);i(71084);function _(e){if(!e.spatialReference.isWGS84)throw new r.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}async function g(e,t){var i;const n=[],s=new Map,r=[];if(null!==(i=t.dataModel)&&void 0!==i&&i.relationshipTypes)for(const a of t.dataModel.relationshipTypes)a.name&&s.set(a.name,[]);for(const a of e){var o;s.has(a.typeName)&&(null===(o=s.get(a.typeName))||void 0===o||o.push(a.id))}for(const[d,u]of s){if(u.length<1)continue;const e=new l.Z({openCypherQuery:"MATCH (n)-[r:".concat(d,"]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]"),bindParameters:{ids:u}});r.push((0,a.executeQueryStreaming)(t,e).then((async e=>{const t=e.resultRowsStream.getReader();for(;;){const{done:e,value:i}=await t.read();if(e)break;for(const t of i)n.push({id:t[0],typeName:t[1]}),n.push({id:t[2],typeName:t[3]})}})))}return await Promise.all(r),n}async function f(e,t){var i;null!==(i=t)&&void 0!==i||(t=!1);const n={generateAllSublayers:t,namedTypeDefinitions:new Map};return await v(e).then((e=>{b(e,n)})),n}async function T(e){const t=await(0,y.$G)(),i=new t.MapOfObjectIdentifierSets;!function(e,t,i){for(const[n,s]of i.namedTypeDefinitions){if(!s.members||s.useAllData)continue;const i=s.members.keys(),r=new t.GlobalIdArray,o=new t.ObjectIdentifierSet;for(const e of i)r.add_globalid(e);o.set_globalid_array(r),r.delete(),e.put_identifier_set(n,o),o.delete()}}(i,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(i),n.encode();const e=n.get_encoding_result();if(0!==e.error.error_code)throw new r.Z("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{i.delete()}}async function v(e){const t=await(0,s.Z)(e,{responseType:"array-buffer"}),i=await t.data;return async function(e){const t=new((await(0,y.$G)()).MapOfObjectIdentifierSetsDecoder),i=t.decode(new Uint8Array(e)),n=new Map;if(0!==i.error_code)throw new r.Z("knowledge-graph:layer-support-utils",i.error_message);const s=t.get_map_of_identifier_sets(),o=s.keys,a=o.size();for(let l=0;l<a;l++){const e=o.get(l),t=s.query_identifier_set(e),i=[];if(t.id_array_type.value===m.GLOBALID_ARRAY){const e=t.get_globalid_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_globalid_at(t))}else{if(t.id_array_type.value!==m.IDENTIFIER_ARRAY)throw new r.Z("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=t.get_identifier_array(),n=e.count();for(let t=0;t<n;t++)i.push(e.get_identifier_at(t).toString())}}n.set(e,i)}return t.delete(),n}(new Uint8Array(i))}function b(e,t){for(const[i,n]of e){const e=(0,o.s1)(t.namedTypeDefinitions,i,(()=>({useAllData:!1,members:new Map})));for(const t of n)e.members.has(t)||e.members.set(t,{id:t})}return t}!function(e){e[e.featureResult=0]="featureResult",e[e.countResult=1]="countResult",e[e.idsResult=2]="idsResult"}(h||(h={})),function(e){e[e.upperLeft=0]="upperLeft",e[e.lowerLeft=1]="lowerLeft"}(p||(p={})),function(e){e[e.sqlTypeBigInt=0]="sqlTypeBigInt",e[e.sqlTypeBinary=1]="sqlTypeBinary",e[e.sqlTypeBit=2]="sqlTypeBit",e[e.sqlTypeChar=3]="sqlTypeChar",e[e.sqlTypeDate=4]="sqlTypeDate",e[e.sqlTypeDecimal=5]="sqlTypeDecimal",e[e.sqlTypeDouble=6]="sqlTypeDouble",e[e.sqlTypeFloat=7]="sqlTypeFloat",e[e.sqlTypeGeometry=8]="sqlTypeGeometry",e[e.sqlTypeGUID=9]="sqlTypeGUID",e[e.sqlTypeInteger=10]="sqlTypeInteger",e[e.sqlTypeLongNVarchar=11]="sqlTypeLongNVarchar",e[e.sqlTypeLongVarbinary=12]="sqlTypeLongVarbinary",e[e.sqlTypeLongVarchar=13]="sqlTypeLongVarchar",e[e.sqlTypeNChar=14]="sqlTypeNChar",e[e.sqlTypeNVarChar=15]="sqlTypeNVarChar",e[e.sqlTypeOther=16]="sqlTypeOther",e[e.sqlTypeReal=17]="sqlTypeReal",e[e.sqlTypeSmallInt=18]="sqlTypeSmallInt",e[e.sqlTypeSqlXml=19]="sqlTypeSqlXml",e[e.sqlTypeTime=20]="sqlTypeTime",e[e.sqlTypeTimestamp=21]="sqlTypeTimestamp",e[e.sqlTypeTimestamp2=22]="sqlTypeTimestamp2",e[e.sqlTypeTinyInt=23]="sqlTypeTinyInt",e[e.sqlTypeVarbinary=24]="sqlTypeVarbinary",e[e.sqlTypeVarchar=25]="sqlTypeVarchar"}(c||(c={})),function(e){e[e.OID_ARRAY=0]="OID_ARRAY",e[e.GLOBALID_ARRAY=1]="GLOBALID_ARRAY",e[e.STRING_ARRAY=2]="STRING_ARRAY",e[e.IDENTIFIER_ARRAY=3]="IDENTIFIER_ARRAY"}(m||(m={}))},41388:(e,t,i)=>{i.d(t,{b:()=>o});var n=i(66978),s=i(76432),r=i(73553);class o{constructor(){this._tasks=new Array,this._runningTasks=(0,s.t)(0)}get length(){return this._tasks.length}get running(){return this._runningTasks.value>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return r.J;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return++this._runningTasks.value,new Promise(((n,s)=>this._tasks.push(new a(n,s,e,t,i)))).finally((()=>--this._runningTasks.value))}unshift(e,t,i){return++this._runningTasks.value,new Promise(((n,s)=>this._tasks.unshift(new a(n,s,e,t,i)))).finally((()=>--this._runningTasks.value))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const s=(0,n.Hc)(t.signal);if(s&&!t.abortCallback)t.reject((0,n.zE)());else{var i;const r=s?null===(i=t.abortCallback)||void 0===i?void 0:i.call(t,(0,n.zE)()):t.callback(e);(0,n.y8)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(o){t.reject(o)}return!0}cancelAll(){const e=(0,n.zE)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;this.resolve=e,this.reject=t,this.callback=i,this.signal=n,this.abortCallback=s}}},14725:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(27366),s=(i(59486),i(49861)),r=(i(93169),i(32718),i(84936),i(69912)),o=i(25695),a=i(848);let l=class extends o.Z{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,s.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,r.j)("esri.rest.knowledgeGraph.Entity")],l);const d=l},25695:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(27366),s=i(49861),r=(i(93169),i(32718),i(84936),i(69912)),o=i(92364);let a=class extends o.Z{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,n._)([(0,r.j)("esri.rest.knowledgeGraph.GraphNamedObject")],a);const l=a},92364:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(27366),s=i(46784),r=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends s.wq{constructor(e){super(e),this.properties=null}};(0,n._)([(0,r.Cb)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.GraphObject")],a);const l=a},5924:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(27366),s=i(49861),r=(i(93169),i(32718),i(84936),i(69912)),o=i(7138);let a=class extends o.default{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,s.Cb)()],a.prototype,"openCypherQuery",void 0),a=(0,n._)([(0,r.j)("esri.rest.knowledgeGraph.GraphQuery")],a);const l=a;let d=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n._)([(0,s.Cb)()],d.prototype,"bindParameters",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"outputQuantizationParameters",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"outputSpatialReference",void 0),(0,n._)([(0,s.Cb)()],d.prototype,"provenanceBehavior",void 0),d=(0,n._)([(0,r.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],d);const u=d},2736:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(27366),s=(i(32718),i(93169),i(84936),i(10064),i(69912)),r=i(92364);let o=class extends r.Z{constructor(e){super(e)}};o=(0,n._)([(0,s.j)("esri.rest.knowledgeGraph.ObjectValue")],o);const a=o},11933:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(27366),s=i(46784),r=i(49861),o=(i(93169),i(32718),i(84936),i(69912)),a=i(92364);let l=class extends s.wq{constructor(e){super(e),this.path=null}};(0,n._)([(0,r.Cb)({type:[a.Z],json:{write:!0}})],l.prototype,"path",void 0),l=(0,n._)([(0,o.j)("esri.rest.knowledgeGraph.Path")],l);const d=l},49074:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(27366),s=(i(59486),i(49861)),r=(i(93169),i(32718),i(84936),i(69912)),o=i(25695),a=i(29909);let l=class extends o.Z{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n._)([(0,s.Cb)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n._)([(0,s.Cb)({type:a.Z,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,r.j)("esri.rest.knowledgeGraph.Relationship")],l);const d=l},75248:(e,t,i)=>{var n;i.d(t,{n:()=>n}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(n||(n={}))},93463:(e,t,i)=>{i.d(t,{G5:()=>R,T8:()=>n,sq:()=>N,z4:()=>g});var n,s=i(100),r=(i(93169),i(32718)),o=i(92026),a=i(90941),l=i(27546),d=i(66978),u=i(94172),h=i(76432),p=i(38499),c=i(41388),m=i(32609),y=i(75248),_=i(73553);function g(){return new S.Scheduler}!function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.ELEVATION_ALIGNMENT_SCENE="elevation alignment scene",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(n||(n={}));const f=new Map([[n.RESOURCE_CONTROLLER_IMMEDIATE,0],[n.RESOURCE_CONTROLLER,4],[n.SLIDE,0],[n.STREAM_DATA_LOADER,0],[n.ELEVATION_QUERY,0],[n.TERRAIN_SURFACE,1],[n.SURFACE_GEOMETRY_UPDATES,1],[n.LOD_RENDERER,2],[n.GRAPHICS_CORE,2],[n.I3S_CONTROLLER,2],[n.POINT_CLOUD_LAYER,2],[n.FEATURE_TILE_FETCHER,2],[n.OVERLAY,4],[n.STAGE,4],[n.GRAPHICS_DECONFLICTOR,4],[n.FILTER_VISIBILITY,4],[n.SCALE_VISIBILITY,4],[n.FRUSTUM_VISIBILITY,4],[n.CLOUDS_GENERATOR,4],[n.POINT_OF_INTEREST_FREQUENT,6],[n.POINT_OF_INTEREST_INFREQUENT,30],[n.LABELER,8],[n.FEATURE_QUERY_ENGINE,8],[n.FEATURE_TILE_TREE,16],[n.FEATURE_TILE_TREE_ACTIVE,0],[n.ELEVATION_ALIGNMENT,12],[n.ELEVATION_ALIGNMENT_SCENE,14],[n.TEXT_TEXTURE_ATLAS,12],[n.TEXTURE_UNLOAD,12],[n.LINE_OF_SIGHT_TOOL,16],[n.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[n.SNAPPING,0],[n.SHADOW_ACCUMULATOR,30]]);function T(e){return f.has(e)?f.get(e):"number"==typeof e?e:1}const v=(0,p.HA)(6.5),b=(0,p.HA)(1),E=(0,p.HA)(30),I=(0,p.HA)(1e3/30),w=(0,p.HA)(100);var S,C;!function(e){e.Scheduler=class{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some((e=>e.needsUpdate))}constructor(){this._updating=(0,h.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=y.n.INTERACTING,this._tasks=new l.Z,this._runQueue=new l.Z,this._load=0,this._idleStateCallbacks=new l.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,u.watch)((()=>m.Z.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),u.initial);for(const e of Object.keys(n))this.performanceInfo.tasks.set(n[e],new a.Z(n[e]))}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),(0,o.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())})))}registerTask(e,i){const n=new t(this,e,i);return this._tasks.push(n),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a.Z(e)),n}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===y.n.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const n=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){n._idleUpdatesStartFired&&(i.idleEnd(),n._state===y.n.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==y.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return this._state}updateBudget(e){++this._frameNumber;let t=v,i=e.frameDuration,n=b;switch(this.state){case y.n.IDLE:t=(0,p.HA)(0),i=(0,p.HA)(Math.max(w,e.frameDuration)),n=E;break;case y.n.INTERACTING:i=(0,p.HA)(Math.max(I,e.frameDuration));case y.n.ANIMATING:}return i=(0,p.HA)(i-e.elapsedFrameTime-t),this.state!==y.n.IDLE&&i<b&&!this._forceTask?(this._forceTask=!0,!1):(i=(0,p.HA)(Math.max(i,n)),this._budget.reset(i,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case y.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case y.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}}stopFrame(){this._budget.reset((0,p.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return C.SCHEDULED;let t=C.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=C.READY:t!==C.READY&&(t=C.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?" ".concat(e,"x ").concat(i):" ".concat(i)})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&i.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),s=this._runQueue.pop();this._budget.resetProgress();try{s.task.runTask(this._budget)===_.J&&(s.blockFrame=this._frameNumber)}catch(t){r.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(s.name,'"'),t),s.blockFrame=this._frameNumber}!this._budget.hasProgressed&&s.blockFrame!==this._frameNumber&&s.needsUpdate&&(s.name,n.I3S_CONTROLLER,s.blockFrame=this._frameNumber),s.schedulePriority=s.basePriority;const o=this._budget.now()-i;if(s.runtime+=o,this._frameTaskTimes.set(s.priority,this._frameTaskTimes.get(s.priority)+o),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(n))this._frameTaskTimes.set(n[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){}};class t{get task(){return this._task.value}get updating(){return this._queue.running}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new c.b,this._handles=new s.Z,this._basePriority=T(t),this.schedulePriority=this._basePriority,this._task=(0,h.t)(null!=i?i:this._queue),this._handles.add((0,u.when)((()=>this.task.running),(t=>e.taskRunningChanged(t))))}remove(){this.processQueue(R),this._scheduler.removeTask(this),this.schedule=N.schedule,this.reschedule=N.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=T(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){return this._queue.runTask(e)}}class i{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=y.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}e.Budget=i}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(C||(C={}));const R=(()=>{const e=new S.Budget;return e.enabled=!1,e})();const N=new class{remove(){}processQueue(){}schedule(e,t,i){try{if((0,d.Hc)(t)){const e=(0,d.zE)();return i?Promise.resolve(i(e)):Promise.reject(e)}return(0,d.gx)(e(R))}catch(n){return Promise.reject(n)}}reschedule(e,t,i){return this.schedule(e,t,i)}}},73553:(e,t,i)=>{i.d(t,{J:()=>n});const n=Symbol("Yield")},32609:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(27366),s=i(7138),r=i(49861),o=(i(93169),i(32718),i(84936),i(69912));let a=class extends s.default{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,n._)([(0,r.Cb)()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,n._)([(0,r.Cb)()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=(0,n._)([(0,o.j)("esri.views.support.debugFlags")],a);const l=new a}}]);
//# sourceMappingURL=9245.04a498d1.chunk.js.map