"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[71784],{15946:(e,t,i)=>{i.d(t,{Z:()=>_});var l,s=i(27366),o=i(46784),n=i(84652),r=i(49861),a=(i(93169),i(32718),i(69912)),d=i(28158),u=i(43404),v=i(25243);i(84936);const c=new u.X({slider:"slider",picker:"picker"});let h=l=class extends o.wq{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new l({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};(0,s._)([(0,r.Cb)({type:c.apiValues,nonNullable:!0,json:{type:c.jsonValues,default:null,read:{reader:c.read},write:{isRequired:!0,writer:c.write}}})],h.prototype,"interactionMode",void 0),(0,s._)([(0,r.Cb)({type:v.z8,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],h.prototype,"numStops",void 0),(0,s._)([(0,r.Cb)({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],h.prototype,"stopInterval",void 0),h=l=(0,s._)([(0,a.j)("esri.webdoc.widgets.Range")],h);const p=h;var f,m=i(64850);let y=f=class extends o.wq{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new f((0,n.d9)({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};(0,s._)([(0,r.Cb)({type:p,json:{write:!0}})],y.prototype,"range",void 0),(0,s._)([(0,r.Cb)({type:m.Z,json:{write:!0}})],y.prototype,"timeSlider",void 0),(0,s._)([(0,r.Cb)({type:d.Z,json:{write:!0}})],y.prototype,"floorFilter",void 0),y=f=(0,s._)([(0,a.j)("esri.webdoc.Widgets")],y);const _=y},28158:(e,t,i)=>{i.d(t,{Z:()=>u});var l,s=i(27366),o=i(46784),n=i(84652),r=i(49861),a=(i(93169),i(32718),i(69912));let d=l=class extends o.wq{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new l((0,n.d9)({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};(0,s._)([(0,r.Cb)({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],d.prototype,"enabled",void 0),(0,s._)([(0,r.Cb)({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],d.prototype,"longNames",void 0),(0,s._)([(0,r.Cb)({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],d.prototype,"minimized",void 0),(0,s._)([(0,r.Cb)({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],d.prototype,"pinnedLevels",void 0),(0,s._)([(0,r.Cb)({type:String,json:{read:{source:"site"},write:{target:"site"}}})],d.prototype,"site",void 0),(0,s._)([(0,r.Cb)({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],d.prototype,"facility",void 0),(0,s._)([(0,r.Cb)({type:String,json:{read:{source:"level"},write:{target:"level"}}})],d.prototype,"level",void 0),d=l=(0,s._)([(0,a.j)("esri.webdoc.widgets.FloorFilter")],d);const u=d},64850:(e,t,i)=>{i.d(t,{Z:()=>y});var l,s=i(27366),o=i(62044),n=i(12355),r=i(46784),a=i(84652),d=i(18202),u=i(49861),v=i(25243),c=i(38511),h=i(69912),p=i(31201),f=i(58359);let m=l=class extends r.wq{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){if(!e)return;const t=null!=e[0]?new Date(e[0]):null,i=null!=e[1]?new Date(e[1]):null;return new o.Z({start:t,end:i})}writeCurrentTimeExtent(e,t,i){e&&(0,d.RB)(i,[null!=e.start?e.start.getTime():null,null!=e.end?e.end.getTime():null],t)}readFullTimeExtent(e,t){const i=t.properties;if(!i)return;const l=null!=i.endTime?new Date(i.endTime):null,s=null!=i.startTime?new Date(i.startTime):null;return new o.Z({start:s,end:l})}writeFullTimeExtent(e,t){if(!e)return;const i=t.properties=t.properties||{},l=e.end,s=e.start;l&&(i.endTime=null!=l?l.getTime():null),s&&(i.startTime=null!=s?s.getTime():null)}readStopInterval(e,t,i){return e?n.Z.fromJSON({value:e.interval,unit:e.units},i):null}writeStopInterval(e,t,i,l){if(!e)return;const s=e.toJSON(l);(0,d.RB)("properties.timeStopInterval",{interval:s.value,units:s.unit},t)}readStops(e){return null!==e&&void 0!==e&&e.length?e.map((e=>new Date(e))):null}writeStops(e,t,i){(null===e||void 0===e?void 0:e.length)&&(0,d.RB)(i,e.map((e=>e.getTime())),t)}clone(){return new l((0,a.d9)({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};(0,s._)([(0,u.Cb)({type:o.Z,json:{type:[[v.z8,v.p2]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],m.prototype,"currentTimeExtent",void 0),(0,s._)([(0,c.r)("currentTimeExtent")],m.prototype,"readCurrentTimeExtent",null),(0,s._)([(0,p.c)("currentTimeExtent")],m.prototype,"writeCurrentTimeExtent",null),(0,s._)([(0,u.Cb)({type:o.Z,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],m.prototype,"fullTimeExtent",void 0),(0,s._)([(0,c.r)("fullTimeExtent")],m.prototype,"readFullTimeExtent",null),(0,s._)([(0,p.c)("fullTimeExtent")],m.prototype,"writeFullTimeExtent",null),(0,s._)([(0,u.Cb)({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],m.prototype,"loop",void 0),(0,s._)([(0,u.Cb)({type:v.z8,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var e;const t=!!this.stopInterval,i=!(null===(e=this.stops)||void 0===e||!e.length),l=!(t||i);return{enabled:l,isRequired:l}}}}})],m.prototype,"numStops",void 0),(0,s._)([(0,u.Cb)({type:[1,2],nonNullable:!0,json:{type:v.z8,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],m.prototype,"numThumbs",void 0),(0,s._)([(0,u.Cb)({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],m.prototype,"stopDelay",void 0),(0,s._)([(0,u.Cb)({type:n.Z,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:f.v.jsonValues.filter((e=>"esriTimeUnitsUnknown"!==e))}},overridePolicy(){var e;const t=null!=this.numStops,i=!(null===(e=this.stops)||void 0===e||!e.length);return{enabled:!i,isRequired:!(t||i)}}}}})],m.prototype,"stopInterval",void 0),(0,s._)([(0,c.r)("stopInterval")],m.prototype,"readStopInterval",null),(0,s._)([(0,p.c)("stopInterval")],m.prototype,"writeStopInterval",null),(0,s._)([(0,u.Cb)({type:[Date],json:{type:[v.z8],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],m.prototype,"stops",void 0),(0,s._)([(0,c.r)("stops")],m.prototype,"readStops",null),(0,s._)([(0,p.c)("stops")],m.prototype,"writeStops",null),m=l=(0,s._)([(0,h.j)("esri.webdoc.widgets.TimeSlider")],m);const y=m},71784:(e,t,i)=>{i.r(t),i.d(t,{default:()=>k});var l=i(27366),s=(i(59166),i(94172)),o=i(49861),n=(i(93169),i(32718),i(84936),i(69912)),r=i(33565);const a="esri-floor-filter",d="".concat(a,"__filter-menu"),u={floorFilter:a,floorFilterLayout:"".concat(a,"__layout--"),floorFilterPosition:"".concat(a,"__position--"),buttonContainer:"".concat(a,"__button-container"),buttonContainerLevels:"".concat(a,"__button-container--levels"),buttonInfo:"".concat(a,"__button-info"),buttonLabel:"".concat(a,"__button-label"),browseButton:"".concat(a,"__browse-button"),closeLevelsButton:"".concat(a,"__close-levels-button"),zoomButton:"".concat(a,"__zoom-button"),zoomButtonLevels:"".concat(a,"__zoom-button--levels"),minimizeToggleButton:"".concat(a,"__minimize-toggle-button"),levelsContainer:"".concat(a,"__levels-container"),levelButton:"".concat(a,"__level-button"),levelButtonActive:"".concat(a,"__level-button--active"),separator:"".concat(a,"__separator"),filterMenu:d,filterMenuHeader:"".concat(d,"-header"),filterMenuHeaderTextGroup:"".concat(d,"-header-text-group"),filterMenuHeaderText:"".concat(d,"-header-text"),filterMenuHeaderSubtext:"".concat(d,"-header-subtext"),filterMenuHeaderBack:"".concat(d,"-header-back"),filterMenuSearch:"".concat(d,"-search"),filterMenuSearchInput:"".concat(d,"-search-input"),filterMenuItems:"".concat(d,"-items"),filterMenuItemName:"".concat(d,"-item-name"),filterMenuSelectedItem:"".concat(d,"-item-name--selected"),filterMenuSite:"".concat(d,"-site"),filterMenuFacility:"".concat(d,"-facility"),selectedItemCircle:"".concat(a,"__selected-item-circle")};var v=i(7138),c=i(14921),h=i(80987),p=i(10064),f=i(66978),m=i(38499),y=i(15946),_=i(28158),g=i(38675),b=i(99505);let w=class extends((0,b._)(v.default)){constructor(e){super(e),this.filterMenuOpen=!1,this.filterMenuType="site",this.filterMode="base-floors",this.levelsExpanded=!0,this.searchTerm=null,this.view=null,this._updateFloorFilterTask=null,this._viewHeightBreakpoint=null,this._viewWidthBreakpoint=null}initialize(){this.addHandles([(0,s.watch)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),(e=>{null!=this._updateFloorFilterTask&&(this._updateFloorFilterTask.abort(),this._updateFloorFilterTask=null),this._updateFloorFilterTask=(0,c.vr)((async t=>{await this._updateFloorFilterFromMap(e),(0,f.k_)(t),this._setInitialViewState(e)}))}),s.initial),(0,s.watch)((()=>this.view),((e,t)=>{this._unregisterWidget(t),this._registerWidget(e),this._watchSearchResults(e)}),s.syncAndInitial),(0,s.watch)((()=>{var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.widthBreakpoint)&&void 0!==e?e:null}),(e=>{this._viewWidthBreakpoint=e})),(0,s.watch)((()=>{var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.heightBreakpoint)&&void 0!==e?e:null}),(e=>{this._viewHeightBreakpoint=e}))])}destroy(){this._unregisterWidget(this.view),this.view=null,null!=this._updateFloorFilterTask&&(this._updateFloorFilterTask.abort(),this._updateFloorFilterTask=null)}set enabled(e){this._callOverride("enabled",e)}set facility(e){if(e&&this._isOverridden("facility")){const t=this.getFacility(e);this.hasMultipleSites&&(this.site=(null===t||void 0===t?void 0:t.siteId)||null)}this._callOverride("facility",e)}set filterFeatures(e){this._callOverride("filterFeatures",e)}set filterLayers(e){this._callOverride("filterLayers",e)}get hasFacilities(){var e,t;return null!=(null===(e=this.filterLayers)||void 0===e?void 0:e.facilityLayer)&&(null===(t=this.filterFeatures)||void 0===t||null===(t=t.facilities)||void 0===t||null===(t=t.facilitiesInfo)||void 0===t?void 0:t.length)>0}get hasLevels(){var e,t;return null!=(null===(e=this.filterLayers)||void 0===e?void 0:e.levelLayer)&&(null===(t=this.filterFeatures)||void 0===t||null===(t=t.levels)||void 0===t||null===(t=t.levelsInfo)||void 0===t?void 0:t.length)>0}get hasMultipleSites(){var e,t;return null!=(null===(e=this.filterLayers)||void 0===e?void 0:e.siteLayer)&&(null===(t=this.filterFeatures)||void 0===t||null===(t=t.sites)||void 0===t||null===(t=t.sitesInfo)||void 0===t?void 0:t.length)>1}get isNormalMode(){let e=!0;const t=this._viewWidthBreakpoint;return"xsmall"!==this._viewHeightBreakpoint&&"xsmall"!==t||(e=!1),e}set level(e){var t,i,l;if(!e)return this._callOverride("level",e),this.facility=null,this.site=null,void this.setFloors(null);let s=null,o=null;const n=null===e||void 0===e?void 0:e.split("--");if((null===n||void 0===n?void 0:n.length)>1&&"all"===n[0]?(o=n[1],s={id:e,facilityId:o,shortName:null,longName:null,levelNumber:null,verticalOrder:null}):(s=this.getLevel(e),o=null!==(t=null===(i=s)||void 0===i?void 0:i.facilityId)&&void 0!==t?t:null),this.level!==e||this.isNormalMode||this.levelsExpanded)s&&this.hasFacilities&&this.hasLevels?(this.facility=o,this.hasMultipleSites&&(this.site=(null===(l=this.getFacility(o))||void 0===l?void 0:l.siteId)||null),this.setFloors(s)):this._isOverridden("level")&&(this.facility=null,this.site=null,this.hasMultipleSites&&(this.filterMenuType="site"),this.setFloors(null)),this._callOverride("level",e);else{const e=this.getFacilityLevels(o);(null===e||void 0===e?void 0:e.length)>1&&(this.levelsExpanded=!0)}}set longNames(e){this._callOverride("longNames",e)}set minimized(e){this._callOverride("minimized",e)}set pinnedLevels(e){this._callOverride("pinnedLevels",e)}set site(e){this._callOverride("site",e)}get state(){return this.view&&this.filterFeatures&&this.hasFacilities&&this.hasLevels?"ready":this.view&&!this.filterFeatures?"loading":"disabled"}filterFacilities(e){let t=e;return this.searchTerm&&(this.searchTerm=this.searchTerm.trim(),t=e.filter((e=>{var t;const{name:i}=e;return i.toLowerCase().includes(null===(t=this.searchTerm)||void 0===t?void 0:t.toLowerCase())}))),this.site&&(t=t.filter((e=>e.siteId===this.site))),t.sort(((e,t)=>{const i=e.name,l=t.name;return i.localeCompare(l,void 0,{sensitivity:"base"})}))}filterSites(e){let t=e;return this.searchTerm&&(this.searchTerm=this.searchTerm.trim(),t=e.filter((e=>{var t;const{name:i}=e;return i.toLowerCase().includes(null===(t=this.searchTerm)||void 0===t?void 0:t.toLowerCase())}))),t.sort(((e,t)=>{const i=e.name,l=t.name;return i.localeCompare(l,void 0,{sensitivity:"base"})}))}getBaseLevel(e){var t;const i=null===(t=this.filterFeatures)||void 0===t||null===(t=t.levels)||void 0===t?void 0:t.levelsInfo;let l=null;if(e){const{id:t}=e;if(i&&i.length>0&&(i.forEach((e=>{0===e.verticalOrder&&e.facilityId===t&&(l=e)})),!l)){let e=null;i.forEach((i=>{var l,s;i.facilityId===t&&(e?(null!==(l=i.verticalOrder)&&void 0!==l?l:0)>=0?null!=e.verticalOrder&&(e.verticalOrder<0||(null!==(s=i.verticalOrder)&&void 0!==s?s:0)<e.verticalOrder)&&(e=i):null!=e.verticalOrder&&null!=i.verticalOrder&&e.verticalOrder<0&&i.verticalOrder>e.verticalOrder&&(e=i):e=i)})),e&&(l=e)}}return l}getFacility(e){var t,i;return null!==(t=null===(i=this.filterFeatures)||void 0===i||null===(i=i.facilities)||void 0===i||null===(i=i.facilitiesInfo)||void 0===i?void 0:i.find((t=>t.id===e)))&&void 0!==t?t:null}getFacilityLevels(e){var t;return e&&null!==(t=this.filterFeatures)&&void 0!==t&&null!==(t=t.levels)&&void 0!==t&&t.levelsInfo?this.filterFeatures.levels.levelsInfo.filter((t=>t.facilityId===e)).sort(((e,t)=>{var i,l;const s=null!==(i=e.verticalOrder)&&void 0!==i?i:0,o=null!==(l=t.verticalOrder)&&void 0!==l?l:0;return s>o?-1:s===o?0:1})):[]}getLevel(e){var t,i;return null!==(t=null===(i=this.filterFeatures)||void 0===i||null===(i=i.levels)||void 0===i||null===(i=i.levelsInfo)||void 0===i?void 0:i.find((t=>t.id===e)))&&void 0!==t?t:null}getSite(e){var t,i;return null!==(t=null===(i=this.filterFeatures)||void 0===i||null===(i=i.sites)||void 0===i||null===(i=i.sitesInfo)||void 0===i?void 0:i.find((t=>t.id===e)))&&void 0!==t?t:null}goTo(e){const{view:t}=this;if(!t||!e)return;const{geometry:i}=e;i&&i.extent&&this.callGoTo({target:i.extent,options:{duration:(0,m.HA)(1e3),easing:"in-out-quad"}})}setFloors(e){var t;const{view:i}=this;i&&(null!==i&&void 0!==i&&null!==(t=i.map)&&void 0!==t&&null!==(t=t.allLayers)&&void 0!==t&&t.forEach((e=>{"feature"===e.type&&this._computeViewAllModeFloors(e)})),i.floors=new h.Z(this._computeFloors(e)))}updateWebDocument(e){if((0,g.s)(e)){var t,i,l;const s=new _.Z({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:null!==(t=this.site)&&void 0!==t?t:null,facility:null!==(i=this.facility)&&void 0!==i?i:null,level:null!==(l=this.level)&&void 0!==l?l:null});e.widgets?e.widgets.floorFilter=s:e.widgets=new y.Z({floorFilter:s})}}_computeFloors(e){var t;if("single-floor"===this.filterMode)this._computeSingleFloor(e);else if("base-floors"===this.filterMode)return"3d"===(null===(t=this.view)||void 0===t?void 0:t.type)?this._computeBaseFloors3D(e):this._computeBaseFloors(e);return this._computeEmptyFloors()}_computeSingleFloor(e){if(!e)return this._computeEmptyFloors();const t=[];return"all"===(null===e||void 0===e?void 0:e.id)?this.getFacilityLevels(e.facilityId).forEach((e=>{e.id&&t.push(e.id)})):e&&t.push(e.id),t}_computeBaseFloors(e){var t;const i=null===(t=this.filterFeatures)||void 0===t||null===(t=t.levels)||void 0===t?void 0:t.levelsInfo;if(null===i||void 0===i||!i.length)return this._computeEmptyFloors();const l=[];"all"===(null===e||void 0===e?void 0:e.id)?this.getFacilityLevels(e.facilityId).forEach((e=>{e.id&&l.push(e.id)})):e&&l.push(e.id);const s=null===e||void 0===e?void 0:e.facilityId;return i.forEach((e=>{const{id:t,facilityId:i,verticalOrder:o}=e;(s||0!==o||l.includes(t))&&(i===s||0!==o||l.includes(t))||l.push(t)})),l}_computeBaseFloors3D(e){var t,i;const l=null===(t=this.filterFeatures)||void 0===t||null===(t=t.levels)||void 0===t?void 0:t.levelsInfo;if(null===l||void 0===l||!l.length)return this._computeEmptyFloors();const s=[],o=null!==(i=null===e||void 0===e?void 0:e.id.split("--"))&&void 0!==i?i:[];(null===o||void 0===o?void 0:o.length)>1&&"all"===o[0]?this.getFacilityLevels(null===e||void 0===e?void 0:e.facilityId).forEach((e=>{e.id&&s.push(e.id)})):e&&s.push(e.id);const n=null===e||void 0===e?void 0:e.facilityId;return l.forEach((e=>{const{id:t,facilityId:i}=e;(n||s.includes(t))&&(i===n||s.includes(t))||s.push(t)})),s}_computeEmptyFloors(){return[]}async _setFilterLayers(){const{view:e}=this;if(e&&!this._isOverridden("filterLayers")){if(!(0,g.s)(e.map)&&!function(e){return"esri.WebScene"===e.declaredClass}(e.map))throw new p.Z("Map must be a webmap or webscene");{var t;const v=e.map,c=null===v||void 0===v?void 0:v.allLayers;if((null===c||void 0===c||null===(t=c.items)||void 0===t?void 0:t.length)>0){var i,l,s,o,n,r;const e={siteLayer:null,facilityLayer:null,levelLayer:null},t=null===(i=v.floorInfo)||void 0===i||null===(i=i.siteLayer)||void 0===i?void 0:i.layerId,h=null===(l=v.floorInfo)||void 0===l||null===(l=l.facilityLayer)||void 0===l?void 0:l.layerId,p=null===(s=v.floorInfo)||void 0===s||null===(s=s.levelLayer)||void 0===s?void 0:s.layerId,f=(null===(o=v.floorInfo)||void 0===o||null===(o=o.siteLayer)||void 0===o?void 0:o.sublayerId)||(null===(n=v.floorInfo)||void 0===n||null===(n=n.facilityLayer)||void 0===n?void 0:n.sublayerId)||(null===(r=v.floorInfo)||void 0===r||null===(r=r.levelLayer)||void 0===r?void 0:r.sublayerId);if(!h||!p)return;const m=c.items.filter((e=>"feature"===e.type||"scene"===e.type)),y=c.items.filter((e=>"map-image"===e.type));if((null===y||void 0===y?void 0:y.length)>0&&f){var a,d,u;await Promise.all(y.map((e=>e.load())));const i=null===(a=v.floorInfo)||void 0===a||null===(a=a.siteLayer)||void 0===a?void 0:a.sublayerId,l=null===(d=v.floorInfo)||void 0===d||null===(d=d.facilityLayer)||void 0===d?void 0:d.sublayerId,s=null===(u=v.floorInfo)||void 0===u||null===(u=u.levelLayer)||void 0===u?void 0:u.sublayerId;y.forEach((o=>{const n=o.id,r=null===o||void 0===o?void 0:o.allSublayers,a=null===r||void 0===r?void 0:r.items;(n===t||n===h||n===p)&&(null===a||void 0===a?void 0:a.length)>0&&r.items.forEach((o=>{const r=o.id;n===t&&r===i?e.siteLayer=o:r===l?e.facilityLayer=o:r===s&&(e.levelLayer=o)}))}))}(null===m||void 0===m?void 0:m.length)>0&&m.forEach((i=>{const l=i.id;l===t?e.siteLayer=i:l===h?e.facilityLayer=i:l===p&&(e.levelLayer=i)})),this.filterLayers=e}}}}async _getFilterFeatures(){if(this._isOverridden("filterFeatures"))return this.filterFeatures;const[e,t,i]=await Promise.all([this._getSites(),this._getFacilities(),this._getLevels()]);return{sites:e,facilities:t,levels:i}}async _getSites(){var e,t;const i={sitesInfo:[]},{filterLayers:l,view:s}=this,o=null===s||void 0===s?void 0:s.map,{siteLayer:n}=l;if(!n||null===o||void 0===o||null===(e=o.floorInfo)||void 0===e||!e.siteLayer)return i;const r=n.createQuery();r.returnGeometry=!0,r.outFields=["*"],r.returnZ=!0,"type"in n&&"scene"===n.type&&(r.multipatchOption="xyFootprint");const{siteIdField:a,nameField:d}=o.floorInfo.siteLayer,u=await n.queryFeatures(r);if((null===u||void 0===u||null===(t=u.features)||void 0===t?void 0:t.length)>0){var v,c;const e=u.features,t=(null===n||void 0===n||null===(v=n.fieldsIndex.get(a))||void 0===v?void 0:v.name)||a,l=(null===n||void 0===n||null===(c=n.fieldsIndex.get(d))||void 0===c?void 0:c.name)||d;null!=t&&null!=l&&e.forEach((e=>{const s=e.attributes,o=e.geometry,n=s[t],r=s[l];n&&r&&i.sitesInfo.push({id:n,name:r,geometry:o})}))}return i}async _getFacilities(){var e,t;const{filterLayers:i,view:l}=this,s=null===l||void 0===l?void 0:l.map,{facilityLayer:o}=i,n={facilitiesInfo:[]};if(!o||null===s||void 0===s||null===(e=s.floorInfo)||void 0===e||!e.facilityLayer)return n;const r=o.createQuery();r.returnGeometry=!0,r.outFields=["*"],r.returnZ=!0,"type"in o&&"scene"===o.type&&(r.multipatchOption="xyFootprint");const{facilityIdField:a,siteIdField:d,nameField:u}=s.floorInfo.facilityLayer,v=await o.queryFeatures(r);if((null===v||void 0===v||null===(t=v.features)||void 0===t?void 0:t.length)>0){var c,h,p;const e=v.features,t=(null===o||void 0===o||null===(c=o.fieldsIndex.get(a))||void 0===c?void 0:c.name)||a,i=(null===o||void 0===o||null===(h=o.fieldsIndex.get(d))||void 0===h?void 0:h.name)||d,l=(null===o||void 0===o||null===(p=o.fieldsIndex.get(u))||void 0===p?void 0:p.name)||u;t&&i&&l&&e.forEach((e=>{const s=e.attributes,o=e.geometry,r=s[t],a=s[i],d=s[l];r&&d&&n.facilitiesInfo.push({id:r,siteId:a,name:d,geometry:o})}))}return n}async _getLevels(){var e,t;const{filterLayers:i,view:l}=this,s=null===l||void 0===l?void 0:l.map,{levelLayer:o}=i,n={levelsInfo:[]};if(!o||null===s||void 0===s||null===(e=s.floorInfo)||void 0===e||!e.levelLayer)return n;const r=o.createQuery();r.returnGeometry=!0,r.outFields=["*"],r.returnZ=!0;const{levelIdField:a,facilityIdField:d,longNameField:u,shortNameField:v,levelNumberField:c,verticalOrderField:h}=s.floorInfo.levelLayer,p=await o.queryFeatures(r);if((null===p||void 0===p||null===(t=p.features)||void 0===t?void 0:t.length)>0){var f,m,y,_,g,b;const e=p.features,t=(null===o||void 0===o||null===(f=o.fieldsIndex.get(a))||void 0===f?void 0:f.name)||a,i=(null===o||void 0===o||null===(m=o.fieldsIndex.get(d))||void 0===m?void 0:m.name)||d,l=(null===o||void 0===o||null===(y=o.fieldsIndex.get(u))||void 0===y?void 0:y.name)||u,s=(null===o||void 0===o||null===(_=o.fieldsIndex.get(v))||void 0===_?void 0:_.name)||v,r=(null===o||void 0===o||null===(g=o.fieldsIndex.get(c))||void 0===g?void 0:g.name)||c,w=(null===o||void 0===o||null===(b=o.fieldsIndex.get(h))||void 0===b?void 0:b.name)||h;t&&i&&l&&s&&r&&w&&e.forEach((e=>{const o=e.attributes,a=o[t],d=o[i],u=o[l],v=o[s],c=o[r],h=o[w];a&&d&&u&&v&&"number"==typeof c&&"number"==typeof h&&n.levelsInfo.push({id:a,facilityId:d,longName:u,shortName:v,levelNumber:c,verticalOrder:h})}))}return n}_registerWidget(e){(null===e||void 0===e?void 0:e.persistableViewModels.includes(this))||null===e||void 0===e||e.persistableViewModels.add(this)}_unregisterWidget(e){null===e||void 0===e||e.persistableViewModels.remove(this)}_watchSearchResults(e){null===e||void 0===e||e.on("select-result-floor",(e=>{const t=this.getLevel(e);t&&this.level!==e&&(this.level=e,this.setFloors(t))}))}async _setInitialViewState(e){if(this.view)try{await this.view.when(),await this._setFilterLayers();const i=await this._getFilterFeatures();if(!i)return;if(this.filterFeatures=i,!this.hasFacilities||!this.hasLevels)return void console.error("Facilities and Levels are required for the Floor Filter widget");if(this.hasMultipleSites||(this.filterMenuType="facility"),this.facility&&this.level){this.filterMenuType="facility";const e=this.getFacility(this.facility),t=this.getLevel(this.level);this.site||(this.site=(null===e||void 0===e?void 0:e.siteId)||void 0),this.setFloors(t)}else if(this.facility&&!this.level){this.filterMenuType="facility";const e=this.getFacility(this.facility),t=this.getBaseLevel(e);this.site||(this.site=(null===e||void 0===e?void 0:e.siteId)||void 0),this.level=(null===t||void 0===t?void 0:t.id)||void 0,this.setFloors(t)}else if(!this.facility&&this.level){this.filterMenuType="facility";const e=this.getLevel(this.level),t=this.getFacility(null===e||void 0===e?void 0:e.facilityId);this.facility=(null===t||void 0===t?void 0:t.id)||void 0,this.site||(this.site=(null===t||void 0===t?void 0:t.siteId)||void 0),this.setFloors(e)}else if(!this.site||this.facility||this.level){var t;if(!e||!(0,g.s)(e))return void this.setFloors(null);const i=null===e||void 0===e||null===(t=e.widgets)||void 0===t?void 0:t.floorFilter;if(!i)return void this.setFloors(null);i.site&&!this.site&&(this.site=i.site,this.filterMenuType="facility"),this.setFloors(null)}else this.filterMenuType="site",this.setFloors(null)}catch(d){console.error("Couldn't retrieve sites, facilities, and levels",d)}}_callOverride(e,t){this._override(e,t)}async _updateFloorFilterFromMap(e){var t;if(!e||!(0,g.s)(e))return;const i=null===e||void 0===e||null===(t=e.widgets)||void 0===t?void 0:t.floorFilter;i&&(this._isOverridden("enabled")||(this.enabled=i.enabled),this._isOverridden("longNames")||(this.longNames=i.longNames),this._isOverridden("minimized")||(this.minimized=i.minimized),this._isOverridden("pinnedLevels")||(this.pinnedLevels=i.pinnedLevels),this._isOverridden("site")||(this.site=i.site),this._isOverridden("facility")||(this.facility=i.facility),this._isOverridden("level")||(this.level=i.level))}_computeViewAllModeFloors(e){var t;const{filterFeatures:i}=this;if(null!==(t=e.floorInfo)&&void 0!==t&&t.viewAllMode&&this.hasLevels&&this.hasFacilities&&"base-floors"===this.filterMode){const{level:t,facility:l}=this,s=[];i.levels.levelsInfo.forEach((e=>{const{id:i,facilityId:o}=e;l&&o===l?t&&i===t&&s.push(i):s.push(i)})),e.floorInfo.viewAllLevelIds=new h.Z(s)}}};(0,l._)([(0,o.Cb)({value:!1})],w.prototype,"enabled",null),(0,l._)([(0,o.Cb)({value:void 0})],w.prototype,"facility",null),(0,l._)([(0,o.Cb)({value:null})],w.prototype,"filterFeatures",null),(0,l._)([(0,o.Cb)({value:null})],w.prototype,"filterLayers",null),(0,l._)([(0,o.Cb)()],w.prototype,"filterMenuOpen",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"filterMenuType",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"filterMode",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"hasFacilities",null),(0,l._)([(0,o.Cb)()],w.prototype,"hasLevels",null),(0,l._)([(0,o.Cb)()],w.prototype,"hasMultipleSites",null),(0,l._)([(0,o.Cb)({readOnly:!0})],w.prototype,"isNormalMode",null),(0,l._)([(0,o.Cb)({value:void 0})],w.prototype,"level",null),(0,l._)([(0,o.Cb)({value:!1})],w.prototype,"longNames",null),(0,l._)([(0,o.Cb)()],w.prototype,"levelsExpanded",void 0),(0,l._)([(0,o.Cb)({value:!1})],w.prototype,"minimized",null),(0,l._)([(0,o.Cb)({value:!1})],w.prototype,"pinnedLevels",null),(0,l._)([(0,o.Cb)()],w.prototype,"searchTerm",void 0),(0,l._)([(0,o.Cb)({value:void 0})],w.prototype,"site",null),(0,l._)([(0,o.Cb)({readOnly:!0})],w.prototype,"state",null),(0,l._)([(0,o.Cb)()],w.prototype,"view",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"_viewHeightBreakpoint",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"_viewWidthBreakpoint",void 0),(0,l._)([(0,o.Cb)()],w.prototype,"updateWebDocument",null),w=(0,l._)([(0,n.j)("esri.widgets.FloorFilter.FloorFilterViewModel")],w);const M=w;var F=i(7021),I=i(96919),L=i(33095),T=i(80975),C=i(80532),S=i(67005),x=i(8704);const N=new Set(["ArrowUp","ArrowDown","End","Home"]);let B=class extends r.Z{constructor(e,t){super(e,t),this._activeMenu=null,this._activeMenuIndex={levels:-1,menuItems:-1},this._baseNode=null,this._facilitiesListNode=null,this._levelsListNode=null,this._sitesListNode=null,this._searchInput=null,this.viewModel=new M,this.messages=null,this.messagesCommon=null,this.headingLevel=2,this._resizeObserver=new ResizeObserver((()=>this.scheduleRender())),this.addHandles((0,s.watch)((()=>this._searchInput),(()=>this._focusSearch())))}destroy(){var e;null===(e=this._resizeObserver)||void 0===e||e.disconnect()}get enabled(){return this.viewModel.enabled}set enabled(e){this.viewModel.enabled=e}get longNames(){return this.viewModel.longNames}set longNames(e){this.viewModel.longNames=e}get minimized(){return this.viewModel.minimized}set minimized(e){this.viewModel.minimized=e}get pinnedLevels(){return this.viewModel.pinnedLevels}set pinnedLevels(e){this.viewModel.pinnedLevels=e}get site(){return this.viewModel.site}set site(e){this.viewModel.site=e}get facility(){return this.viewModel.facility}set facility(e){this.viewModel.facility=e}get level(){return this.viewModel.level}set level(e){this.viewModel.level=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"floor-plan"}set icon(e){this._overrideIfSome("icon",e)}updateWebDocument(e){return this.viewModel.updateWebDocument(e)}render(){var e;const{longNames:t}=this,i=t&&this.viewModel.isNormalMode?"expanded":"collapsed",l=this._renderButtons(),s=this._renderFilterMenu(),o=(0,S.u)("div",{class:this.classes(u.separator)}),n=this._getComponentPosition(),r=this._getPosition(n),a="top-right"===n||"bottom-right"===n,d="top-left"===n||"bottom-left"===n,v=(0,T.dZ)(this.container),c=v&&d||!v&&a?s:l,h=v&&d||!v&&a?l:s;return(0,S.u)("div",{afterCreate:this._afterBaseNodeCreate,class:this.classes(u.floorFilter,F.z.widget,"".concat(u.floorFilterLayout).concat(i),"".concat(u.floorFilterPosition).concat(r)),key:"floor-filter-menu"},c,null!==(e=this.viewModel)&&void 0!==e&&e.filterMenuOpen?o:null,h)}_renderButtons(){const e=this._getComponentPosition(),t=[];return"top"===this._getPosition(e)?(t.push(this._renderBrowseButton()),t.push(this._renderLevelButtons()),t.push(this._renderCloseLevelsButton()),t.push(this._renderZoomButton()),t.push(this._renderCollapseToggleButton())):(t.push(this._renderCollapseToggleButton()),t.push(this._renderZoomButton()),t.push(this._renderCloseLevelsButton()),t.push(this._renderLevelButtons()),t.push(this._renderBrowseButton())),(0,S.u)("div",{class:this.classes(F.z.widget,u.buttonContainer),key:"button-container"},t)}_renderBrowseButton(){var e;const{longNames:t,messages:i}=this;return(0,S.u)("button",{"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":i.buttons.browse,bind:this,class:this.classes(F.z.widget,F.z.widgetButton,F.z.interactive,("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&F.z.buttonDisabled,u.browseButton,(null===(e=this.viewModel)||void 0===e?void 0:e.filterMenuOpen)&&F.z.widgetButtonActive),key:"browse-button",onclick:this._toggleFilterMenu,title:i.buttons.browse,type:"button"},(0,S.u)("div",{class:this.classes(u.buttonInfo)},(0,S.u)("span",{class:this.classes(L.W.icon,L.W.urbanModel)}),(0,S.u)("span",{class:this.classes(u.buttonLabel)},t&&this.viewModel.isNormalMode?i.buttons.browse:null)))}_renderLevelButtons(){var e,t,i,l;if(null===(e=this.viewModel)||void 0===e||null===(e=e.filterFeatures)||void 0===e||null===(e=e.levels)||void 0===e||!e.levelsInfo||!this.facility)return null;const{facility:s,messagesCommon:o,messages:n}=this,r=null===(t=this.viewModel)||void 0===t?void 0:t.getFacility(s),a=(null===(i=this.viewModel)||void 0===i?void 0:i.getFacilityLevels(s)).map((e=>this._renderLevelButton(e)));if(!a.length)return null;const d=r&&(0,x.n)(n.selector.levelsLabel,{name:'"'.concat(r.name,'"')});if(this._isWebScene(null===(l=this.view)||void 0===l?void 0:l.map)&&(null===a||void 0===a?void 0:a.length)>1){const e={id:"all--".concat(s),facilityId:s,shortName:o.all,longName:o.all,levelNumber:null,verticalOrder:null},t=this._renderLevelButton(e);a.push(t)}return(0,S.u)("ul",{afterCreate:T.Yo,"aria-label":d,bind:this,class:this.classes(u.levelsContainer),"data-id":"levels","data-node-ref":"_levelsListNode",key:"levels-button-container",onkeydown:this._handleListKeydown},a)}_renderLevelButton(e){const{longNames:t}=this,{shortName:i,longName:l,id:s}=e,o="levels--".concat(s),n=this.level===s,r=t&&this.viewModel.isNormalMode?l:i;return this.viewModel.isNormalMode||n||this.viewModel.levelsExpanded?(0,S.u)("li",{key:o},(0,S.u)("button",{bind:this,class:this.classes(F.z.widgetButton,n?F.z.widgetButtonActive:null,F.z.interactive,u.levelButton),"data-id":s,"data-list-id":"levels",onclick:this._levelSelected,onfocus:this._onItemFocus,type:"button"},r)):null}_renderCloseLevelsButton(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const{messagesCommon:e}=this;return(0,S.u)("button",{"aria-label":e.close,bind:this,class:this.classes(F.z.widget,F.z.widgetButton,F.z.interactive,u.closeLevelsButton),key:"close-levels-button",onclick:this._closeLevels,title:e.close,type:"button"},(0,S.u)("div",{class:this.classes(u.buttonInfo)},(0,S.u)("span",{class:this.classes(L.W.icon,L.W.close)})))}_renderZoomButton(){var e,t,i,l,s;const{longNames:o,messages:n,facility:r,site:a}=this,d=null===(e=this.viewModel)||void 0===e?void 0:e.filterMenuType,v=null===(t=this.viewModel)||void 0===t?void 0:t.filterMenuOpen,c=null===(i=this.viewModel)||void 0===i?void 0:i.getSite(a),h=null===(l=this.viewModel)||void 0===l?void 0:l.getFacility(r),p="site"===d&&v?!c:!h;return(0,S.u)("button",{"aria-label":n.buttons.zoomTo,bind:this,class:this.classes(F.z.widget,F.z.widgetButton,p&&F.z.buttonDisabled,F.z.interactive,(null===(s=this.viewModel)||void 0===s?void 0:s.getFacilityLevels(r).length)>0?u.zoomButtonLevels:u.zoomButton),key:"zoom-button",onclick:this._zoomToClicked,title:n.buttons.zoomTo,type:"button"},(0,S.u)("div",{class:this.classes(u.buttonInfo)},(0,S.u)("span",{class:this.classes(L.W.icon,L.W.zoomToObject)}),(0,S.u)("span",{class:this.classes(u.buttonLabel)},o&&this.viewModel.isNormalMode?n.buttons.zoomTo:null)))}_renderCollapseToggleButton(){const{longNames:e,messagesCommon:t}=this,i=e?L.W.collapse:L.W.expand,l=this.classes(L.W.icon,i),s=e?t.collapse:t.expand;return(0,S.u)("button",{"aria-label":s,bind:this,class:this.classes(F.z.widget,F.z.widgetButton,F.z.interactive,u.minimizeToggleButton),key:"minimize-toggle-button",onclick:this._toggleCollapsed,title:s,type:"button"},(0,S.u)("div",{class:this.classes(u.buttonInfo)},(0,S.u)("span",{class:l}),(0,S.u)("span",{class:this.classes(u.buttonLabel)},e&&this.viewModel.isNormalMode?t.collapse:null)))}_renderFilterMenu(){var e,t,i;return null!==(e=this.viewModel)&&void 0!==e&&e.filterMenuOpen?"site"===(null===(t=this.viewModel)||void 0===t?void 0:t.filterMenuType)?this._renderSiteFilterMenu():"facility"===(null===(i=this.viewModel)||void 0===i?void 0:i.filterMenuType)?this._renderFacilityFilterMenu():null:null}_renderSiteFilterMenu(){var e;const{messages:t,messagesCommon:i}=this,l=this.site?null===(e=this.viewModel)||void 0===e||null===(e=e.getSite(this.site))||void 0===e?void 0:e.name:t.selector.selectSite,s=(0,S.u)("div",{class:this.classes("".concat(u.filterMenuHeader)),key:"filter-menu-site-header"},(0,S.u)("div",{class:this.classes(u.filterMenuHeaderTextGroup)},(0,S.u)(I.X,{class:this.classes(u.filterMenuHeaderText),level:this.headingLevel},l)),(0,S.u)("button",{bind:this,class:this.classes(L.W.icon,L.W.close),onclick:this._closeClicked,title:i.close,type:"button"})),o=this._renderSearchInput(),n=this._renderSiteItems();return(0,S.u)("div",{class:this.classes(u.filterMenu),key:"filter-menu-site"},s,o,n)}_renderFacilityFilterMenu(){var e,t;const{messages:i,messagesCommon:l,site:s}=this,o=null===(e=this.viewModel)||void 0===e||null===(e=e.getSite(s))||void 0===e?void 0:e.name,n=this.facility&&(null===(t=this.viewModel)||void 0===t||null===(t=t.getFacility(this.facility))||void 0===t?void 0:t.name)||i.selector.selectFacility,r=this.viewModel.hasMultipleSites?(0,S.u)("button",{bind:this,class:this.classes(u.filterMenuHeaderBack),onclick:this._backClicked,title:l.back,type:"button"},(0,S.u)("span",{class:this.classes((0,T.dZ)(this.container)?L.W.right:L.W.left)})):null,a=this.viewModel.hasMultipleSites?(0,S.u)(I.X,{class:this.classes(u.filterMenuHeaderSubtext),level:(0,I.M)(this.headingLevel)},o):null,d=(0,S.u)("div",{class:this.classes(u.filterMenuHeader),key:"filter-menu-site-header"},r,(0,S.u)("div",{class:this.classes(u.filterMenuHeaderTextGroup)},(0,S.u)(I.X,{class:this.classes(u.filterMenuHeaderText),level:this.headingLevel},n),a),(0,S.u)("button",{bind:this,class:this.classes(L.W.icon,L.W.close),onclick:this._closeClicked,title:l.close,type:"button"})),v=this._renderSearchInput(),c=this._renderFacilityItems();return(0,S.u)("div",{class:this.classes(u.filterMenu),key:"filter-menu-facility"},d,v,c)}_renderSearchInput(){var e;const{messagesCommon:t}=this;return(0,S.u)("div",{class:this.classes(u.filterMenuSearch),key:"filter-menu-search"},(0,S.u)("span",{class:this.classes(L.W.icon,L.W.search)}),(0,S.u)("input",{afterCreate:T.Yo,bind:this,class:this.classes(u.filterMenuSearchInput),"data-node-ref":"_searchInput",oninput:this._onSearchChange,onpaste:this._onSearchChange,placeholder:t.search,value:null!==(e=this.viewModel.searchTerm)&&void 0!==e?e:void 0}))}_renderBlueCircle(){return(0,S.u)("span",{class:this.classes(u.selectedItemCircle),key:"floor-filter__selected-item-circle"})}_renderSiteItems(){var e,t;if(null===(e=this.viewModel)||void 0===e||null===(e=e.filterFeatures)||void 0===e||null===(e=e.sites)||void 0===e||!e.sitesInfo)return null;const{messages:i}=this,l=this.viewModel.filterFeatures.sites.sitesInfo,s=this.viewModel.filterSites(l).map((e=>this._renderSiteItem(e))),o=0===s.length&&(null===(t=this.viewModel)||void 0===t?void 0:t.searchTerm)&&(0,S.u)("div",{class:this.classes(F.z.empty)},i.noResults);return(0,S.u)("ul",{afterCreate:T.Yo,"aria-label":i.selector.sitesLabel,bind:this,class:this.classes(u.filterMenuItems),"data-id":"sites","data-node-ref":"_sitesListNode",key:"filter-menu-items--sites",onkeydown:this._handleListKeydown,tabIndex:-1},s,o)}_renderSiteItem(e){const{name:t,id:i}=e,l="filter-menu-site--".concat(i),s=this.site===i;return(0,S.u)("li",{key:l},(0,S.u)("button",{bind:this,class:this.classes(u.filterMenuSite),"data-id":i,"data-list-id":"sites",onclick:this._siteSelected,onfocus:this._onItemFocus,type:"button"},s?this._renderBlueCircle():null,(0,S.u)("span",{class:this.classes(s?u.filterMenuSelectedItem:u.filterMenuItemName)},t),(0,S.u)("span",{class:this.classes((0,T.dZ)(this.container)?L.W.left:L.W.right)})))}_renderFacilityItems(){var e,t;if(null===(e=this.viewModel)||void 0===e||null===(e=e.filterFeatures)||void 0===e||null===(e=e.facilities)||void 0===e||!e.facilitiesInfo)return null;const{messages:i,site:l}=this,s=this.viewModel.getSite(l),o=this.viewModel.filterFeatures.facilities.facilitiesInfo,n=this.viewModel.filterFacilities(o).map((e=>this._renderFacilityItem(e))),r=0===n.length&&(null===(t=this.viewModel)||void 0===t?void 0:t.searchTerm)&&(0,S.u)("div",{class:this.classes(F.z.empty)},i.noResults),a=s?(0,x.n)(i.selector.siteFacilitiesLabel,{name:'"'.concat(s.name,'"')}):i.selector.facilitiesLabel;return(0,S.u)("ul",{afterCreate:T.Yo,"aria-label":a,bind:this,class:this.classes(u.filterMenuItems),"data-id":"facilities","data-node-ref":"_facilitiesListNode",key:"filter-menu-items--facilities",onkeydown:this._handleListKeydown,tabIndex:-1},n,r)}_renderFacilityItem(e){const{name:t,id:i}=e,l="filter-menu-facility--".concat(i),s=this.facility===i;return(0,S.u)("li",{key:l},(0,S.u)("button",{bind:this,class:this.classes(u.filterMenuFacility),"data-id":i,"data-list-id":"facilities",onclick:this._facilitySelected,onfocus:this._onItemFocus,type:"button"},s?this._renderBlueCircle():null,(0,S.u)("span",{class:this.classes(s?u.filterMenuSelectedItem:u.filterMenuItemName)},t)))}_afterBaseNodeCreate(e){var t,i;this._baseNode&&null!==(t=this._resizeObserver)&&void 0!==t&&t.unobserve(this._baseNode),this._baseNode=e,null===(i=this._resizeObserver)||void 0===i||i.observe(this._baseNode)}_toggleCollapsed(){this.longNames=!this.longNames}_toggleFilterMenu(){var e,t;const i=null!==(e=null===(t=this.viewModel)||void 0===t?void 0:t.filterMenuOpen)&&void 0!==e&&e;this.viewModel.filterMenuOpen=!i}_setFilterMenuType(e){this.viewModel.filterMenuType=e}_zoomToClicked(){var e,t;if(this.site&&"site"===(null===(e=this.viewModel)||void 0===e?void 0:e.filterMenuType)&&null!==(t=this.viewModel)&&void 0!==t&&t.filterMenuOpen){var i;const e=null===(i=this.viewModel)||void 0===i?void 0:i.getSite(this.site);this.viewModel.goTo(e)}else if(this.facility){var l;const e=null===(l=this.viewModel)||void 0===l?void 0:l.getFacility(this.facility);this.viewModel.goTo(e)}else if(this.site){var s;const e=null===(s=this.viewModel)||void 0===s?void 0:s.getSite(this.site);this.viewModel.goTo(e)}}_onSearchChange(e){var t;const i=e.target;""===i.value?this.viewModel.searchTerm=null:i.value&&(null===(t=this.viewModel)||void 0===t?void 0:t.searchTerm)!==i.value&&(this.viewModel.searchTerm=i.value)}_closeClicked(){this.viewModel.searchTerm=null,this.viewModel.filterMenuOpen=!1}_backClicked(){this._setFilterMenuType("site"),this.viewModel.searchTerm=null}_siteSelected(e){const t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getSite(t);let l=!1;this.site!==t&&(this.facility=null,this.level=null,l=!0,this.viewModel.levelsExpanded=!1),this.site=t,this.viewModel.searchTerm=null,this._setFilterMenuType("facility"),this.viewModel.goTo(i),l&&this.viewModel.setFloors(null)}_facilitySelected(e){const t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getFacility(t);let l=!1;if(this.facility!==t){if("base-floors"===this.viewModel.filterMode){var s;const e=null===(s=this.viewModel)||void 0===s?void 0:s.getBaseLevel(i);this.level=e?e.id:null}else this.level=null;l=!0,this.viewModel.levelsExpanded=!1}if(this.facility=t,this.viewModel.goTo(i),l){const e=this.viewModel.getLevel(this.level);this.viewModel.setFloors(e)}if(!this.viewModel.isNormalMode){const e=this.viewModel.getFacilityLevels(t);(null===e||void 0===e?void 0:e.length)>1&&(this.viewModel.levelsExpanded=!0)}setTimeout((()=>this._focusActiveLevel()),50)}_levelSelected(e){const t=e.currentTarget.getAttribute("data-id");this.level=t}_closeLevels(){this.viewModel.levelsExpanded=!1}_isWebScene(e){return"esri.WebScene"===(null===e||void 0===e?void 0:e.declaredClass)}_getComponentPosition(){var e;return null!=this.container?null===(e=this.view)||void 0===e||null===(e=e.ui)||void 0===e?void 0:e.getPosition(this.container):null}_getPosition(e){switch(e){case"bottom-right":case"bottom-left":return"bottom";default:return"top"}}_handleListKeydown(e){const t=e.currentTarget.getAttribute("data-id");let i=null;"sites"===t||"facilities"===t?(this._activeMenu!==t&&(this._activeMenuIndex.menuItems=-1),this._activeMenu=t,i="menuItems"):"levels"===t&&(i="levels");const l="sites"===t?this._sitesListNode:"facilities"===t?this._facilitiesListNode:"levels"===t?this._levelsListNode:null,{key:s}=e,o="Tab"===s,n=N.has(s);n&&e.preventDefault();const r=null===l||void 0===l?void 0:l.getElementsByTagName("li");r&&0!==r.length&&(n||o)&&this._handleItemNavigation(s,e.shiftKey,r,o,i)}_handleItemNavigation(e,t,i,l,s){if(!s)return;this._activeMenuIndex[s]===i.length&&this._activeMenuIndex[s]--,-1===this._activeMenuIndex[s]&&this._activeMenuIndex[s]++;const o=this._activeMenuIndex[s];switch(e){case"Home":this._activeMenuIndex[s]=0;break;case"End":this._activeMenuIndex[s]=i.length-1;break;case"ArrowUp":this._activeMenuIndex[s]=this._activeMenuIndex[s]<=0?i.length-1:this._activeMenuIndex[s]-1;break;case"ArrowDown":this._activeMenuIndex[s]=this._activeMenuIndex[s]===i.length-1?0:this._activeMenuIndex[s]+1}if("Tab"===e&&t&&this._activeMenuIndex[s]>=0&&this._activeMenuIndex[s]--,"Tab"===e&&!t&&this._activeMenuIndex[s]<i.length&&this._activeMenuIndex[s]++,o!==this._activeMenuIndex[s]&&this._activeMenuIndex[s]>-1&&this._activeMenuIndex[s]<i.length&&!l){const e=i[this._activeMenuIndex[s]].getElementsByTagName("button"),t=1===(null===e||void 0===e?void 0:e.length)?e[0]:null;null===t||void 0===t||t.focus()}}_focusSearch(){var e;null===(e=this._searchInput)||void 0===e||e.focus()}_focusActiveLevel(){var e;const{level:t}=this,i=this._levelsListNode,l=null===i||void 0===i?void 0:i.getElementsByTagName("li");if(!t||!i||!l)return;const s=null===(e=this._facilitiesListNode)||void 0===e?void 0:e.getElementsByTagName("li");this._activeMenuIndex.menuItems=s?s.length-1:-1;const o=[];for(let n=0;n<l.length;n++){const e=l[n].getElementsByTagName("button");1===(null===e||void 0===e?void 0:e.length)&&o.push(e[0])}o.forEach(((e,i)=>{e.getAttribute("data-id")===t&&(e.focus(),this._activeMenuIndex.levels=i)}))}_onItemFocus(e){const t=e.currentTarget,i=t.getAttribute("data-list-id"),l=t.getAttribute("data-id"),s="sites"===i?this._sitesListNode:"facilities"===i?this._facilitiesListNode:"levels"===i?this._levelsListNode:null;if(!s)return;const o=null===s||void 0===s?void 0:s.getElementsByTagName("li");if(!o)return;const n=[];Array.from(o).forEach((e=>{const t=e.getElementsByTagName("button");1===(null===t||void 0===t?void 0:t.length)&&n.push(t[0])}));let r=null;switch(i){case"sites":case"facilities":r="menuItems";break;case"levels":r="levels"}if(!r)return;const a=r;n.forEach(((e,t)=>{e.getAttribute("data-id")===l&&this._activeMenuIndex[a]!==t&&(this._activeMenuIndex[a]=t)}))}};(0,l._)([(0,o.Cb)()],B.prototype,"_searchInput",void 0),(0,l._)([(0,o.Cb)()],B.prototype,"enabled",null),(0,l._)([(0,o.Cb)()],B.prototype,"longNames",null),(0,l._)([(0,o.Cb)()],B.prototype,"minimized",null),(0,l._)([(0,o.Cb)()],B.prototype,"pinnedLevels",null),(0,l._)([(0,o.Cb)()],B.prototype,"site",null),(0,l._)([(0,o.Cb)()],B.prototype,"facility",null),(0,l._)([(0,o.Cb)()],B.prototype,"level",null),(0,l._)([(0,o.Cb)()],B.prototype,"view",null),(0,l._)([(0,o.Cb)({type:M})],B.prototype,"viewModel",void 0),(0,l._)([(0,o.Cb)(),(0,C.H)("esri/widgets/FloorFilter/t9n/FloorFilter")],B.prototype,"messages",void 0),(0,l._)([(0,o.Cb)(),(0,C.H)("esri/t9n/common")],B.prototype,"messagesCommon",void 0),(0,l._)([(0,o.Cb)()],B.prototype,"goToOverride",null),(0,l._)([(0,o.Cb)()],B.prototype,"headingLevel",void 0),(0,l._)([(0,o.Cb)()],B.prototype,"icon",null),B=(0,l._)([(0,n.j)("esri.widgets.FloorFilter")],B);const k=B}}]);
//# sourceMappingURL=71784.3684a1a9.chunk.js.map