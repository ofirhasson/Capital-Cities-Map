"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[67667,73238],{73238:(e,t,r)=>{r.d(t,{$E:()=>D,$R:()=>P,Bl:()=>M,FB:()=>L,I6:()=>q,IE:()=>m,Je:()=>U,Li:()=>f,Lm:()=>T,MP:()=>k,Ns:()=>Q,Pk:()=>J,Pr:()=>R,Uf:()=>w,V$:()=>j,V7:()=>b,Vs:()=>h,Wh:()=>C,ZP:()=>N,_n:()=>_,cs:()=>S,ib:()=>v,ll:()=>A,m1:()=>g,of:()=>E,ql:()=>z,sq:()=>I,wz:()=>$,xy:()=>F,zN:()=>W});r(59166);var o=r(63780),l=r(41644),n=r(84652),i=r(32718),a=r(643),u=r(73813),s=r(39638),d=r(37270),y=r(62734),p=r(83651),c=r(8704);const h=e=>"field"===(null===e||void 0===e?void 0:e.type),v=e=>"group"===(null===e||void 0===e?void 0:e.type),b=e=>"relationship"===(null===e||void 0===e?void 0:e.type),C=e=>"text"===e.type,_=e=>!v(e)&&null!=e.group,f=e=>e.reduce(((e,t)=>v(t)?[...e,...t.inputs]:[...e,t]),[]),m=e=>f(e).filter(h),g=e=>f(e).filter(b),F=e=>null!=e&&(q(e,"combo-box")||q(e,"radio-buttons")),q=(e,t)=>{var r;return null!=e&&(null===(r=e.input)||void 0===r?void 0:r.type)===t},w=e=>null!=e&&(q(e,"text-box")||q(e,"text-area")),A=e=>{let{domain:t,inputType:r="text-box",dataType:o}=e;return"number"===o&&"text-box"===r&&(!t||"coded-value"!==t.type)},P=e=>"items"in e;function I(e){const{attributes:t,fieldsIndex:r,label:l,timeZone:n}=e;if(!t||"object"!=typeof t)return l;const i=Object.keys(t).filter((e=>(0,a.pZ)(l,e))),u=i.map((e=>t[e])),s=i.map((e=>r.get(e))).filter(o.pC);return function(e,t){return(0,a.gx)((0,a.gx)(e,(e=>"{".concat(e.toLowerCase(),"}"))),Object.fromEntries(Object.entries(t).map((e=>{let[t,r]=e;return[t.toLowerCase(),r]}))))}(l,M({values:u,fields:s,timeZone:n}))}const O="expression/",x="expr/",V="field/";function E(e){const[t,r]=e.split(O);return""===t&&r?r:(i.Z.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input","The string ".concat(e," is not a valid expression reference of the form '").concat(O,"/expressionName'")),"")}function j(e){return"".concat(O).concat(e)}function T(e){return"".concat(V).concat(e)}function R(e){return e.startsWith(O)}function L(e){return e.startsWith(x)}function M(e){var t;const{fields:r,values:o}=e,l=null!==(t=e.timeZone)&&void 0!==t?t:void 0,n=r.map(((e,t)=>{let r=o[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find((e=>e.code===r));(null===t||void 0===t?void 0:t.name)&&(r=t.name)}return((0,y.a8)(e)||(0,d.sX)(e))&&(r=(0,p.sx)(e,r,{timeZone:l,...(0,p.fu)(e)})),[e.name,r]}));return Object.fromEntries(n)}const N=e=>{var t,r,o,l,n,i,a;const u={typeFieldName:null,types:[]};return e?("subtype-sublayer"===e.type?(u.typeFieldName=null===(t=e.parent)||void 0===t?void 0:t.subtypeField,u.types=null!==(r=null===(o=e.parent)||void 0===o?void 0:o.subtypes)&&void 0!==r?r:[]):"subtype-group"===e.type||"feature"===e.type&&null!==(l=e.subtypes)&&void 0!==l&&l.length?(u.typeFieldName=e.subtypeField,u.types=null!==(n=e.subtypes)&&void 0!==n?n:[]):"types"in e&&e.types&&(u.typeFieldName=e.typeIdField,u.types=e.types.map((e=>{let{id:t,name:r,domains:o}=e;return{code:t,name:r,domains:o}}))),null!=u.typeFieldName&&(u.typeFieldName=null!==(i=null===(a=e.getField(u.typeFieldName))||void 0===a?void 0:a.name)&&void 0!==i?i:u.typeFieldName),u):u},D=(e,t)=>{if(!e)return!0;const{operations:r}=e;switch(t){case"INSERT":return r.supportsAdd;case"UPDATE":case"DELETE":return r.supportsUpdate;default:return!0}};var Q,B;(B=Q||(Q={})).TOO_SHORT="length-validation-error::too-short",B.TOO_LONG="length-validation-error::too-long";const Z={type:"number"},H={type:"number",intlOptions:{notation:"scientific"}};function G(e){return e>=1e7||e<=-1e7}const U=(e,t,r)=>{const{dataType:o,error:l,minLength:n,value:i,required:a}=e,u=null===t||void 0===t?void 0:t.validationErrors;if(!u||!l)return null;if(a&&null===i)return u.cannotBeNull;if(l===s.V$.VALUE_OUT_OF_RANGE||l===d.M$.OUT_OF_RANGE){const{field:l,range:n}=e,i={type:"date",intlOptions:{timeZone:"date"===l.type&&r?r:void 0,...(0,p.fu)(l)}},a=function(e,t){let{validationErrors:r}=t;return null!=e.max&&null!=e.min?r.outsideRange:null!=e.max?r.outsideRangeMax:r.outsideRangeMin}(n,t);return(0,c.n)(a,n,{format:{max:"date"===o?i:null!=n.max&&G(n.max)?H:Z,min:"date"===o?i:null!=n.min&&G(n.min)?H:Z}})}return l===s.V$.INVALID_CODED_VALUE?u.invalidCodedValue:l===d.Gz.INVALID_TYPE?u.invalidType:l===Q.TOO_SHORT?(0,c.n)(u.tooShort,{min:n}):(Q.TOO_LONG,null)},k=e=>{var t;if(!e)return;const r=e.layer,o=r&&"geometryType"in r?r.geometryType:void 0,l=null===(t=e.geometry)||void 0===t?void 0:t.type;return"polyline"===l||"polyline"===o?"line":"mesh"===l||"mesh"===o||"multipatch"===o?"cube":"multipoint"===l||"multipoint"===o?"point":l||o||"table"},$=e=>{const t=[];if(e.formTemplate){var r;const{description:o,title:l}=e.formTemplate;null===(r=e.fields)||void 0===r||r.forEach((e=>{const r=l&&(0,a.pZ)(l,e.name),n=o&&(0,a.pZ)(o,e.name);(r||n)&&t.push(e.name)}))}return t};function S(e,t){const r=null!==t&&void 0!==t?t:"formTemplate"in e&&e.formTemplate;var o,l;return!!r&&(null!==(o=null===(l=r.elements)||void 0===l?void 0:l.filter(u.fY))&&void 0!==o?o:[]).some((t=>{let{fieldName:r}=t;return!e.fieldsIndex.get(r)}))}function z(e,t){return null==e||t.onValue!==e&&t.offValue!==e}function W(e,t){var r;switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===(null===(r=t.codedValue)||void 0===r?void 0:r.code);case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return(0,l.Bg)(t.objectType),!1}}function J(e,t,r){var o,l;if(!e||!("subtypes"in e))return!1;const i=null===(o=e.subtypes)||void 0===o?void 0:o.find((e=>e.code===r));if(!i)return!1;const a=null===(l=e.subtypes)||void 0===l?void 0:l.find((e=>e.code===t));return!(0,n.y7)(i.defaultValues,null===a||void 0===a?void 0:a.defaultValues)&&Object.values(i.defaultValues).some((e=>null!=e))}},67667:(e,t,r)=>{r.d(t,{Z:()=>_});var o=r(27366),l=r(52639),n=r(7138),i=r(63780),a=r(11582),u=r(80987),s=r(79056),d=r(66978),y=r(94172),p=r(49861),c=(r(93169),r(32718),r(69912)),h=r(99086),v=r(45276),b=r(73238);let C=class extends((0,a.J)((0,s.IG)(n.default))){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await(0,d.R8)(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await(0,d.R8)(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await(0,d.R8)(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=(0,d.Ds)(this._queryController,100),this._queryFeatureCountDebounced=(0,d.Ds)(this._queryFeatureCountController,100),this._queryPageDebounced=(0,d.Ds)(this._queryPageController,100),this._query=async()=>{const{_queryAbortController:e,relatedFeatures:t}=this;this.featureCount&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,t.destroyAll(),this.destroyed||t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:null===e||void 0===e?void 0:e.signal}))))},this.addHandles([(0,y.watch)((()=>{var e;return[this.displayCount,this.graphic,this.layer,null===(e=this.layer)||void 0===e?void 0:e.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount]}),(()=>this._queryDebounced()),y.initial),(0,y.watch)((()=>[this.featurePage,this.showAllEnabled]),(()=>this._queryPageDebounced())),(0,y.watch)((()=>[this.layer,this.relationshipId,this.objectId,this.canQuery]),(()=>this._queryFeatureCountDebounced()))])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,o=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,1),o))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&null!==t&&void 0!==t&&t.loaded?e.map((e=>{const r=e.clone();return r.field=(0,v.k6)(e.field,t),r})):null!==e&&void 0!==e?e:[]}get supportsCacheHint(){var e;return!(null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.queryRelated)||void 0===e||!e.supportsCacheHint)}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){var e;const t=null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e?void 0:e.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&null!==t&&void 0!==t&&t.supportsCount&&null!==t&&void 0!==t&&t.supportsPagination)}get itemDescriptionFieldName(){var e;return(null===(e=this.orderByFieldsFixedCasing[0])||void 0===e?void 0:e.field)||null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e,0),10))}get displayCount(){return this._get("displayCount")}get objectId(){var e,t;return null!==(e=this.objectIdField&&(null===(t=this.graphic)||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t[this.objectIdField]))&&void 0!==e?e:null}get objectIdField(){var e;return(null===(e=this.layer)||void 0===e?void 0:e.objectIdField)||null}get relatedFeatures(){return this._get("relatedFeatures")||new u.Z}get relatedLayer(){var e;const{layer:t,map:r,relationship:o}=this;return null!==t&&void 0!==t&&t.loaded&&r&&o&&null!==(e=(0,v.T2)(r,t,o))&&void 0!==e?e:null}get relationship(){var e,t;const{relationshipId:r,layer:o}=this;return null!=r&&null!==(e=null===o||void 0===o||null===(t=o.relationships)||void 0===t?void 0:t.find((e=>{let{id:t}=e;return t===r})))&&void 0!==e?e:null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new u.Z}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:o,_loaded:l,canLoad:n}=this;return t||n&&!l?"loading":e||r?"querying":o?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find((t=>t.getObjectId()===e))}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){var e;null===(e=this.relatedFeatureViewModels)||void 0===e||e.destroyAll()}async _queryFeatureCount(){var e;const{layer:t,relatedLayer:r,relationshipId:o,objectId:l,_queryFeatureCountAbortController:n,canQuery:i,supportsCacheHint:a}=this;if(await(null===t||void 0===t?void 0:t.load()),await(null===r||void 0===r?void 0:r.load()),!i||!t||!r||null==l)return void this._set("featureCount",0);const u=r.createQuery(),{historicMoment:s,gdbVersion:d}=t,y=new h.default({cacheHint:a,gdbVersion:d,historicMoment:s,relationshipId:o,returnGeometry:!1,objectIds:[l],where:null!==(e=u.where)&&void 0!==e?e:void 0}),p=await t.queryRelatedFeaturesCount(y,{signal:null===n||void 0===n?void 0:n.signal});this._set("featureCount",p[l]||0)}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:o,featureCount:l}=this;!r||t<2||!l||e.addMany(await this._queryRelatedFeatures({signal:null===o||void 0===o?void 0:o.signal}))}async _queryRelatedFeatures(e){var t,r;const{orderByFieldsFixedCasing:o,showAllEnabled:l,featuresPerPage:n,displayCount:a,layer:u,relationshipId:s,featurePage:d,featureCount:y,relatedLayer:p,supportsCacheHint:c}=this,{canQuery:v,objectId:C}=this;if(!v||!u||!p||null==C)return[];const _=l?((d-1)*n+y)%y:0,f=l?n:a,m=p.objectIdField,g=[...o.map((e=>e.field)),...(0,b.wz)(p),m].filter(i.pC),F=o.map((e=>"".concat(e.field," ").concat(e.order))),q=p.createQuery(),{historicMoment:w,gdbVersion:A}=u,P=new h.default({orderByFields:F,start:_,num:f,outFields:g,cacheHint:c,historicMoment:w,gdbVersion:A,relationshipId:s,returnGeometry:!1,objectIds:[C],where:null!==(t=q.where)&&void 0!==t?t:void 0}),I=(null===(r=(await u.queryRelatedFeatures(P,{signal:null===e||void 0===e?void 0:e.signal}))[C])||void 0===r?void 0:r.features)||[];return I.forEach((e=>{e.sourceLayer=p,e.layer=p})),I}};(0,o._)([(0,p.Cb)()],C.prototype,"_loaded",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"_queryAbortController",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"_queryPageAbortController",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"_queryFeatureCountAbortController",void 0),(0,o._)([(0,p.Cb)({value:1})],C.prototype,"featurePage",null),(0,o._)([(0,p.Cb)()],C.prototype,"featuresPerPage",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"orderByFieldsFixedCasing",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"supportsCacheHint",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"canLoad",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"canQuery",null),(0,o._)([(0,p.Cb)()],C.prototype,"description",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"itemDescriptionFieldName",null),(0,o._)([(0,p.Cb)({value:3})],C.prototype,"displayCount",null),(0,o._)([(0,p.Cb)({type:l.Z})],C.prototype,"graphic",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"layer",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"map",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"objectId",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"objectIdField",null),(0,o._)([(0,p.Cb)()],C.prototype,"orderByFields",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"relatedFeatures",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"relatedLayer",null),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"relationship",null),(0,o._)([(0,p.Cb)()],C.prototype,"featureCount",void 0),(0,o._)([(0,p.Cb)({readOnly:!0})],C.prototype,"relatedFeatureViewModels",null),(0,o._)([(0,p.Cb)()],C.prototype,"relationshipId",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"showAllEnabled",void 0),(0,o._)([(0,p.Cb)()],C.prototype,"state",null),(0,o._)([(0,p.Cb)()],C.prototype,"title",void 0),C=(0,o._)([(0,c.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],C);const _=C}}]);
//# sourceMappingURL=67667.973daa07.chunk.js.map