"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[90856],{25889:(e,t,i)=>{i.d(t,{AC:()=>d,Fz:()=>u,Q_:()=>f,_C:()=>c,fB:()=>p,i1:()=>w,jO:()=>h,kE:()=>l,ks:()=>s,s8:()=>v,sc:()=>r});var a=i(10064);const n="upload-assets",o=()=>new Error;class r extends a.Z{constructor(){super("".concat(n,":unsupported"),"Layer does not support asset uploads.",o())}}class s extends a.Z{constructor(){super("".concat(n,":no-glb-support"),"Layer does not support glb.",o())}}class l extends a.Z{constructor(){super("".concat(n,":no-supported-source"),"No supported external source found",o())}}class d extends a.Z{constructor(){super("".concat(n,":not-base-64"),"Expected gltf data in base64 format after conversion.",o())}}class c extends a.Z{constructor(){super("".concat(n,":unable-to-prepare-options"),"Unable to prepare uploadAsset request options.",o())}}class u extends a.Z{constructor(e,t){super("".concat(n,":bad-response"),"Bad response. Uploaded ".concat(e," items and received ").concat(t," results."),o())}}class p extends a.Z{constructor(e,t){var i,a;super("".concat(n,"-layer:upload-failed"),"Failed to upload mesh file ".concat(e,". Error code: ").concat(null!==(i=null===t||void 0===t?void 0:t.code)&&void 0!==i?i:"-1",". Error message: ").concat(null!==(a=null===t||void 0===t?void 0:t.messages)&&void 0!==a?a:"unknown"),o())}}class h extends a.Z{constructor(e){super("".concat(n,"-layer:unsupported-format"),"The service allowed us to upload an asset of FormatID ".concat(e,", but it does not list it in its supported formats."),o())}}class v extends a.Z{constructor(){super("".concat(n,":convert3D-failed"),"convert3D failed.")}}class f extends a.Z{constructor(){super("invalid-input:no-model","No supported model found")}}class w extends a.Z{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}}},18277:(e,t,i)=>{i.d(t,{$6:()=>w,$z:()=>o,F7:()=>n,Ow:()=>l,S0:()=>s,d1:()=>d,dm:()=>c,ir:()=>r});const a=[["binary","application/octet-stream","bin",""]];function n(e,t){var i;return null!=p(t.name,null!==(i=null===e||void 0===e?void 0:e.supportedFormats)&&void 0!==i?i:[])}function o(e,t){var i;if(!e)return!1;const a=c(t,null!==(i=e.supportedFormats)&&void 0!==i?i:[]);return null!=a&&e.editFormats.includes(a)}function r(e){var t;return u(null!==(t=null===e||void 0===e?void 0:e.supportedFormats)&&void 0!==t?t:[]).flatMap(f).map((e=>".".concat(e)))}function s(e,t){return h(function(e,t){const i=e.toLowerCase();return u(t).find((e=>v(e)===i))}(e,t))}function l(e,t){return h(p(e,t))}function d(e,t){return v(function(e,t){return u(t).find((t=>h(t)===e))}(e,t))}function c(e,t){var i;return null!==(i=l(e.name,t))&&void 0!==i?i:s(e.type,t)}function u(e){return[...a,...e]}function p(e,t){const i=e.toLowerCase();return u(t).find((e=>f(e).some((e=>i.endsWith(e)))))}function h(e){return null===e||void 0===e?void 0:e[0]}function v(e){return null===e||void 0===e?void 0:e[1].toLowerCase()}function f(e){var t;return null!==(t=null===e||void 0===e?void 0:e[2].split(",").map((e=>e.toLowerCase())))&&void 0!==t?t:[]}function w(e){var t;return null===(t=e.tables)||void 0===t?void 0:t.find((e=>"assetMaps"===e.role))}},96669:(e,t,i)=>{function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){var i;return"number"==typeof e?e:null!==e&&void 0!==e&&null!==(i=e.stops)&&void 0!==i&&i.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const n=e[a].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function o(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(n(i,e)+n(a,e))/2}));let a=0;const o=i.length;if(0===o)return e;for(let n=0;n<o;n++)a+=i[n];const r=Math.floor(a/o);return Math.max(r,e)}function r(e){const t=null===e||void 0===e?void 0:e.renderer,i="touch"===(null===e||void 0===e?void 0:e.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?o(i,t.visualVariables):i;if("simple"===t.type)return a(n,t.symbol);if("unique-value"===t.type){var r;let e=n;return null!==(r=t.uniqueValueInfos)&&void 0!==r&&r.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return"dot-density"===t.type||t.type,n}i.d(t,{k:()=>r})},94687:(e,t,i)=>{i.d(t,{F:()=>s});var a=i(27366),n=i(91505),o=i(49861),r=(i(93169),i(32718),i(84936),i(69912));let s=class extends n.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,o.Cb)({constructOnly:!0})],s.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)()],s.prototype,"tracking",void 0),(0,a._)([(0,o.Cb)()],s.prototype,"displaying",void 0),(0,a._)([(0,o.Cb)()],s.prototype,"isDraped",void 0),s=(0,a._)([(0,r.j)("esri.views.3d.layers.graphics.GraphicState")],s)},74982:(e,t,i)=>{i.d(t,{Z:()=>u});var a=i(27366),n=i(7138),o=i(49861),r=(i(93169),i(32718),i(84936),i(69912)),s=i(83089),l=i(69787),d=i(45276);let c=class extends n.default{constructor(e){super(e),this.view=null}add(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._highlight(e)))}remove(e){const t=!e||Array.isArray(e)?e:[e];(null===t||void 0===t?void 0:t.length)&&t.forEach((e=>this._removeHighlight(e)))}removeAll(){this.removeAllHandles()}_highlight(e){const t=(0,s.j)(this.view,e.layer);(0,l.tl)(t)&&this.addHandles(t.highlight(e),(0,d.wi)(e))}_removeHighlight(e){e&&this.removeHandles((0,d.wi)(e))}};(0,a._)([(0,o.Cb)()],c.prototype,"view",void 0),c=(0,a._)([(0,r.j)("esri.views.draw.support.HighlightHelper")],c);const u=c},86547:(e,t,i)=>{function a(e,t){switch(e){case"point":case"multipoint":return"point";case"polyline":return function(e){return(null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}(t);case"polygon":return function(e){const t=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}(t);default:return}}i.d(t,{A:()=>a})},45008:(e,t,i)=>{i.d(t,{D:()=>s,K:()=>r});i(59486);var a=i(68860),n=i(96669),o=i(53866);function r(e,t,i){var n;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.Z,s=0;if("2d"===i.type)s=t*(null!==(n=i.resolution)&&void 0!==n?n:0);else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),o=i.basemapSpatialReference;s=null==o||o.equals(i.spatialReference)?t*n:(0,a.c9)(o)/(0,a.c9)(i.spatialReference)}const l=e.x-s,d=e.y-s,c=e.x+s,u=e.y+s,{spatialReference:p}=i;return r.xmin=Math.min(l,c),r.ymin=Math.min(d,u),r.xmax=Math.max(l,c),r.ymax=Math.max(d,u),r.spatialReference=p,r}function s(e,t,i){const a=i.toMap(e);return null!=a&&r(a,(0,n.k)(),i,l).intersects(t)}const l=new o.Z},90856:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_i});var a=i(27366),n=(i(59166),i(44927)),o=i(32718),r=i(92026),s=i(66978),l=i(94172),d=i(49861),c=(i(93169),i(84936),i(69912)),u=i(47863),p=i(21993),h=i(76385),v=i(72521),f=i(45966),w=i(33565);const m="esri-editor",g={base:m,helpMessage:"".concat(m,"__help-message"),updateActions:"".concat(m,"__update-actions"),updateActionsList:"".concat(m,"__update-actions-list"),featureTemplatesContainer:"".concat(m,"__feature-templates-container"),templateItemContentEnd:"".concat(m,"__template-item-content-end")};var y=i(14921),b=i(80987),_=i(10064),k=i(91505),C=i(42537),M=i(46634),F=i(93655),I=i(69767),A=i(37933),E=i(80139),S=i(59981),W=i(38856),O=i(98173),V=i(4819),P=i(52639),T=i(63780),L=i(71907),x=i(86547),U=i(1614),H=i(22006),D=i(7138);let Z=class extends D.default{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.parent=null,this.pendingFeatures=new b.Z,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this.upload=null}};(0,a._)([(0,d.Cb)()],Z.prototype,"creationInfo",void 0),(0,a._)([(0,d.Cb)()],Z.prototype,"editorItem",void 0),(0,a._)([(0,d.Cb)()],Z.prototype,"parent",void 0),(0,a._)([(0,d.Cb)({constructOnly:!0})],Z.prototype,"sketchOptions",void 0),(0,a._)([(0,d.Cb)()],Z.prototype,"snappingManager",void 0),(0,a._)([(0,d.Cb)()],Z.prototype,"viewModel",void 0),(0,a._)([(0,d.Cb)()],Z.prototype,"upload",void 0),Z=(0,a._)([(0,c.j)("esri.widgets.Editor.CreateFeaturesWorkflowData")],Z);var R=i(84652),z=i(17842),G=i(48732),B=i(37270),N=i(96669),j=i(49229),q=i(80724),Q=i(56011),K=i(23707),J=i(86828),X=i(94687),$=i(45008),Y=i(74923),ee=i(36571);function te(e){const t=e.sourceLayer;if(!t||"feature"!==t.type||!function(e){switch(null===e||void 0===e?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}(t.renderer))return{rotation:null,size:null};let a=null,n=null;const o=t.renderer.getVisualVariablesForType("rotation").filter((t=>(!t.axis||"heading"===t.axis)&&t.field&&!t.valueExpression&&null!=(0,Q.getRotationAngle)(t,e)));1===o.length&&(a=function(e,t){var i;const a="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,n=e.field,o=t.fields&&t.fields.filter((e=>e.name===n)),r=o&&1===o.length?o[0].type:"double",s={initial:0,current:0};return{field:n,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:e=>(s.current=s.initial-a*e,ie((s.current+360)%360,r)),setInitialValue:e=>{s.initial=e,s.current=0},isUpdatingInteractively:!1,rotationType:null!==(i=e.rotationType)&&void 0!==i?i:"geographic"}}(o[0],t));const r=t.renderer.getVisualVariablesForType("size").filter((t=>t.field&&!t.useSymbolValue&&!t.valueExpression&&(0,q.QW)(t)===q.hL.RealWorldSize&&null!=(0,Q.getSize)(t,e)));return 1===r.length&&(n=function(e,t){var a;const n=e.field,o=e.axis,r=t.fields&&t.fields.filter((e=>e.name===n)),s=r&&1===r.length?r[0].type:"double",l={initial:0,current:0},d=null!==(a=j.a[e.valueUnit])&&void 0!==a?a:1;let c;return c="area"===e.valueRepresentation?e=>(e*d/2)**2*Math.PI:"radius"===e.valueRepresentation||"distance"===e.valueRepresentation?e=>e*d/2:e=>e*d,{field:n,fieldType:s,getDefault:async(e,t)=>ie(c(await async function(e,t,a){if(null==t)return 0;const{symbol:n}=(0,K.q)(t);if(null==n||"web-style"===n.type||"cim"===n.type)return 0;const o=n.symbolLayers.at(0);if(!o)return 0;switch(o.type){case"icon":{const{computeIconLayerResourceSize:e}=await i.e(23657).then(i.bind(i,23657));return o.size||Math.min(he.icon,(await e(o,he.icon))[0])||he.icon}case"text":return o.size||he.text;case"line":return o.size||he.line;case"object":{const{computeObjectLayerResourceSize:t}=await i.e(23657).then(i.bind(i,23657));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await t(o,e.scale/he.viewScaleSizeFactor),a)}case"path":return(null!=o.width?o.width:o.height)||e.scale/he.viewScaleSizeFactor;case"extrude":return o.size||e.scale/he.viewScaleSizeFactor;default:return 0}}(t,e,o)),s),getValue:(e,t)=>(l.initial||(l.initial=t.pixelSizeAt(t.center)),l.current=l.initial*e,ie(l.current,s)),setInitialValue:e=>{l.initial=e,l.current=0},isUpdatingInteractively:!1,displayUnit:fe(e.valueUnit),axis:e.axis}}(r[0],t)),{rotation:a,size:n}}function ie(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}async function ae(e,t,i){const a=await(0,J.zd)(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:i});null!=(0,G.Hg)(e.symbol,a)&&(e.symbol=a)}async function ne(e,t,i){var a,n,o;const r=t.layer,d={...null===(a=t.template)||void 0===a?void 0:a.prototype.attributes,...t.attributeOverrides};let c=null;const{view:u}=e,p="2d"===(null===u||void 0===u?void 0:u.type);if(await oe(e,r,d,i,p?u.scale:null),p){const t=(0,s.Ds)((t=>oe(e,r,d,i,t)));c=(0,l.watch)((()=>u.scale),(e=>t(e)))}const{data:h,editing:v}=r.capabilities;return e.layer.elevationInfo=r.elevationInfo,null==t.geometryToPlace?await e.create(function(e){if(!e)throw new Error("no geometry type");return"multipatch"===e?"mesh":e}(r.geometryType),{graphicProperties:{attributes:d,sourceLayer:r},hasZ:h.supportsZ,defaultZ:null!==(n=p?v.zDefault:null)&&void 0!==n?n:e.defaultCreateOptions.defaultZ}):await e.place(t.geometryToPlace,{graphicProperties:{attributes:d,sourceLayer:r}}),null!==(o=c)&&void 0!==o?o:(0,C.kB)()}async function oe(e,t,i,a,n){var o;const r=new P.Z({sourceLayer:t,attributes:i}),{rotation:s,size:l}=te(r);let d=await(0,J.zd)(r,{useSourceLayer:!0,webStyleCache:a,scale:n}),c=!1;for(const u of[l,s])null!=u&&null==i[u.field]&&(i[u.field]=await u.getDefault(d,e.view),c=!0);switch(c&&(d=await(0,J.zd)(r,{useSourceLayer:!0,webStyleCache:a,scale:n})),null===(o=d)||void 0===o?void 0:o.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=d;break;case"simple-line":case"line-3d":e.polylineSymbol=d;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=d;break;case"mesh-3d":e.meshSymbol=d}re(e.tooltipOptions,l,s)}function re(e,t,i){var a;e.visualVariables=null!=t||null!=i?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=i?{valueType:i.fieldType,rotationType:null!==(a=i.rotationType)&&void 0!==a?a:"geographic"}:null}:null}async function se(e,t,i,a){switch(t.type){case"3d":return async function(e,t,i,a){if(0===e.length)return[];const{updatable:n,graphicsByLayer:o}=await i.async((async()=>{const{results:n}=await(0,s.Hl)((0,Y.ZV)(t,i),a),o=new Map,r=e=>{const t=e.layer,i=o.get(t);if(!i){const e=new Array;return o.set(t,e),e}return i};(0,Y.HV)(n).forEach((e=>{let{graphic:t}=e;return r(t).push(t)}));const l=e.filter((e=>{let{capabilities:t,layer:i}=e;return t.update.enabled&&o.has(i)}));return 0!==l.length&&i.stopPropagation(),{updatable:l,graphicsByLayer:o}}));return(0,s.Hl)(Promise.allSettled(n.map((async e=>{let{layer:t}=e;const i=o.get(t),n=le(t);if(i.every((e=>(0,B.R9)(n,e))))return i;const r=[];for(const a of i){r.push(a.getObjectId());const e=Object.keys(a.attributes);(0,T.w6)(n,e)}const s=t.createQuery();return s.returnGeometry=!1,s.objectIds=r,s.outFields=(0,B.Q0)(t.fieldsIndex,n),t.queryFeatures(s,{signal:a}).then((e=>{let{features:t}=e;return t}))}))),a)}(e,t,i,a);case"2d":return async function(e,t,i,a){if(0===e.length)return[];const{mapPoint:n}=i;if(null==n)return[];let o=null;const r=await i.async((async()=>{const{results:n}=await(0,s.Hl)(t.hitTest(i),a);if(0===n.length)return[];const r=new Set;o=(0,Y.HV)(n),o.forEach((e=>{let{graphic:t}=e;return t&&r.add(t.layer)}));const l=e.filter((e=>r.has(e.layer)&&e.supportsUpdateWorkflow));return l.length>0&&i.stopPropagation(),l}));return(0,s.Hl)(Promise.allSettled(r.map((async e=>{var r;let{layer:s}=e;const l=s.createQuery();l.returnGeometry=!1,l.outFields=le(s);const d="renderer"in s?(0,N.k)({renderer:s.renderer,pointerType:i.pointerType}):0;l.geometry=(0,$.K)(n,d,t),l.outSpatialReference=t.spatialReference;const{features:c}=await s.queryFeatures(l,{signal:a});return null!==(r=o)&&void 0!==r&&r.forEach((e=>{let{graphic:t}=e;t.layer!==s||c.some((e=>e.getObjectId()===t.getObjectId()))||c.push(t)})),c}))),a)}(e,t,i,a)}}function le(e){return(0,B.Q0)(e.fieldsIndex,[e.objectIdField,(0,B.O5)({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function de(e){const{graphic:t,sketchViewModel:i,sourceLayer:a,visualVariables:n,webStyleCache:o}=e;let r=!1;const{rotation:s,size:l}=n;if([s,l].forEach((async e=>{if(null==e)return;const a=t.getAttribute(e.field);if(null!=a)e.setInitialValue(a);else{const a=await e.getDefault(t.symbol,i.view);e.setInitialValue(a),t.setAttribute(e.field,a),r=!0}})),r){var d;const e="2d"===(null===(d=i.view)||void 0===d?void 0:d.type)?i.view.scale:null;await ae(t,o,e)}const c={multipleSelectionEnabled:!1};return"point"===a.geometryType&&(c.enableRotation=null!=s,c.enableScaling=null!=l),re(i.tooltipOptions,l,s),i.layer.elevationInfo=a.elevationInfo,i.update(t,c)}async function ce(e,t,i,a,n){var o;if(null==t.geometry||"point"!==(null===(o=t.geometry)||void 0===o?void 0:o.type))return;const r=a.rotation,s=function(e){return null==e||"rotate-start"!==e.type&&"rotate"!==e.type&&"rotate-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=r&&null!=s){const{field:i,getValue:a}=r;"rotate-stop"===s.type?(r.isUpdatingInteractively=!1,r.setInitialValue(t.getAttribute(i))):(r.isUpdatingInteractively=!0,t.setAttribute(i,a(s.angle,e)))}const l=a.size,d=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(i.toolEventInfo);if(null!=l&&null!=d){const{field:i,getValue:a}=l;"scale-stop"===d.type?(l.isUpdatingInteractively=!1,l.setInitialValue(t.getAttribute(i))):(l.isUpdatingInteractively=!0,t.setAttribute(i,a(d.xScale,e)))}await ae(t,n,"2d"===e.type?e.scale:null)}async function ue(e,t,i){const a=e.view;e.layer.add(i);const n=t.sourceLayer,o=t.layer,r=t.getAttribute(o.objectIdField);let d=null;function c(e){var t;null!==(t=d)&&void 0!==t&&t.abort(),d=(0,y.vr)((async t=>{var i;const o=await me(a,n);(0,s.k_)(t),null===(i=o.setVisibility)||void 0===i||i.call(o,r,e)}))}return await async function(e,t){if("3d"===e.type){const i=new X.F({graphic:t}),a=e.trackGraphicState(i);await(0,l.whenOnce)((()=>i.displaying)),a.remove()}else await(0,l.whenOnce)((()=>t.visible))}(a,i),c(!1),(0,C.AL)([pe(a,i,(e=>c(!e))),(0,C.kB)((async()=>{c(!0);try{const e=await me(a,n);await(0,l.whenOnce)((()=>!e.updating))}finally{e.layer.remove(i)}}))])}function pe(e,t,i){if("3d"===e.type){const a=new X.F({graphic:t});return(0,C.AL)([e.trackGraphicState(a),(0,l.watch)((()=>a.displaying),i)])}return(0,l.watch)((()=>t.visible),i)}const he={icon:(0,z.Wz)(24),text:(0,z.Wz)(12),line:(0,z.Wz)(1),viewScaleSizeFactor:100};function ve(e,t,i){let a=!1;return e.filter((e=>!!a||(a=e===t,a))).map((e=>i[e]()))}function fe(e){switch(e){case"unknown":case"decimal-degrees":return null;default:return e}}const we=e=>/-stop/.test(e)||/vertex-/.test(e),me=(e,t)=>{const i="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(i)};function ge(e){const t=e.geometry;if("mesh"===(null===t||void 0===t?void 0:t.type)){var i,a;const n=e.cloneShallow();return n.attributes=(0,R.d9)(e.attributes),n.geometry=t.cloneShallow(),n.geometry.transform=null!==(i=null===(a=t.transform)||void 0===a?void 0:a.clone())&&void 0!==i?i:null,n}return e.clone()}function ye(e){const t=e.cursor;return e.cursor="progress",(0,C.kB)((()=>e.cursor=t))}function be(e){const t=null===e||void 0===e?void 0:e.layer;return"scene"===(null===t||void 0===t?void 0:t.type)}let _e=class extends k.Z.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new M.R,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter((e=>!e.parent)).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{force:!0};return!1!==e.force?this._cancel(e):new Promise(((t,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(t)},deny:()=>i(new _.Z("workflow:cancel-denied","Request to cancel workflow was denied."))}})}))}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,i=t.findIndex((t=>t.id===e));this._indexHistory.push(this._stepIndex),await this._go(i)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cancelCurrentStep:!1};await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel(){let{emitCancelEvent:e=!0,error:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.started&&(this._set("started",!1),await this._transaction((()=>{var e;return null===(e=this.steps[this._stepIndex])||void 0===e?void 0:e.tearDown({canceled:!0})}))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._transaction((async()=>{const{steps:i}=this;if(!(e<=-1||e>=i.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await i[this._lastStepIndex].tearDown({canceled:t});try{await i[e].setUp()}catch(a){(0,s.H9)(a)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}}))}async _transaction(e){const t=this._pendingOperation,i=(0,s.hh)(),a=(null!==t&&void 0!==t?t:Promise.resolve()).then((()=>i.promise));this._pendingOperation=a,this._updatingHandles.addPromise(a);try{t&&await t,await e()}finally{i.resolve(),a===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};(0,a._)([(0,d.Cb)()],_e.prototype,"data",void 0),(0,a._)([(0,d.Cb)()],_e.prototype,"hasNextStep",null),(0,a._)([(0,d.Cb)()],_e.prototype,"hasPreviousStep",null),(0,a._)([(0,d.Cb)()],_e.prototype,"onCommit",void 0),(0,a._)([(0,d.Cb)()],_e.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.Cb)()],_e.prototype,"hasInvalidFormTemplate",null),(0,a._)([(0,d.Cb)()],_e.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.Cb)()],_e.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.Cb)()],_e.prototype,"started",void 0),(0,a._)([(0,d.Cb)({readOnly:!0})],_e.prototype,"stepId",null),(0,a._)([(0,d.Cb)()],_e.prototype,"steps",void 0),(0,a._)([(0,d.Cb)({readOnly:!0})],_e.prototype,"type",void 0),(0,a._)([(0,d.Cb)()],_e.prototype,"helpMessage",null),(0,a._)([(0,d.Cb)()],_e.prototype,"hasPendingEdits",null),(0,a._)([(0,d.Cb)()],_e.prototype,"keyboardCancellationEnabled",null),(0,a._)([(0,d.Cb)()],_e.prototype,"updating",null),_e=(0,a._)([(0,c.j)("esri.widgets.Editor.Workflow")],_e);const ke=_e;var Ce,Me=i(16458),Fe=i(40763);const Ie=Symbol(),Ae=Symbol(),Ee=Symbol();let Se=Ce=class extends ke{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new Me.Z,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=(0,s.Ds)(((e,t,i)=>ae(e,t,i)))}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){var e;if(this.numPendingFeatures>0)return!0;const{creationInfo:t,upload:i}=this.data,a=this._sketchViewModel,{activeComponent:n}=a,o=null===(e=a.createGraphic)||void 0===e||null===(e=e.geometry)||void 0===e?void 0:e.type;return!("polyline"!==o&&"polygon"!==o&&"multipoint"!==o||"draw-2d"!==(null===n||void 0===n?void 0:n.type)&&"draw-3d"!==(null===n||void 0===n?void 0:n.type))&&n.drawOperation.committedVertices.length>0||!(!i||"pending"!==i.state&&"success"!==i.state)||!(null===t||void 0===t||!t.geometryToPlace)}get helpMessage(){const{creationInfo:e,viewModel:t}=this.data;if("creating-features"!==this.stepId||!e)return;const a=e.layer.geometryType,n=this._sketchViewModel.createGraphic;if("mesh"===a){var o;this._getDrawMeshHelpMessage||i.e(4035).then(i.bind(i,79422)).then((e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage}));const{view:e}=t;return"3d"===(null===e||void 0===e?void 0:e.type)?null===(o=this._getDrawMeshHelpMessage)||void 0===o?void 0:o.call(this,n,e):void 0}return(0,x.A)(a,null===n||void 0===n?void 0:n.geometry)}get layer(){var e;return null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get parentLayer(){var e;return null===(e=this.parent)||void 0===e?void 0:e.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){var e,t;return null!==(e=null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.reliesOnOwnerAdminPrivileges)&&void 0!==e&&e}get shouldShowAttachments(){var e,t;return null!==(e=null===(t=this.data.editorItem)||void 0===t?void 0:t.capabilities.create.attachments.enabled)&&void 0!==e&&e}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([Ee])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this._sketchViewModel.cancel(),(0,T.Od)(this._lastActiveGraphics,e),this._startUpdating(e,t)}async start(){var e;return await super.start(),(0,A.wb)(null===(e=this.data.creationInfo)||void 0===e?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}static create(e){var t;const{addAttachmentsCallback:i,applyEditsCallback:a,isNested:n,creationInfo:o,parent:r,snappingManager:s,startAt:l,viewModel:d}=e,c=null!==(t=e.sketchOptions)&&void 0!==t?t:new S.Z,u=null===o||void 0===o?void 0:o.layer,p=u?d.findEditorItemForLayer(u):void 0,h=new Ce({data:new Z({creationInfo:o,editorItem:p,parent:r,sketchOptions:c,snappingManager:s,viewModel:d}),isNested:n,onCommit:async e=>{var t;const{creationInfo:n}=e;if(!n)return;const o=e.pendingFeatures.toArray(),{layer:r}=n,s=(null===(t=r.capabilities)||void 0===t?void 0:t.editing.supportsGlobalId)&&"globalIdField"in r,l=h._attachmentFileInfos;if(s){const e=function(e,t,i){const a=[],n=t.globalIdField;return e.forEach(((t,o)=>{var r,s;null!==(s=(r=e[o].attributes)[n])&&void 0!==s||(r[n]=(0,L.zS)()),((null===i||void 0===i?void 0:i.get(t))||[]).forEach((e=>{let{file:i}=e;return a.push({feature:t,attachment:{globalId:(0,L.zS)(),data:i}})}))})),a.length?{addFeatures:e,addAttachments:a}:{addFeatures:e}}(o,r,l);return void await a(r,e,{globalIdUsed:!0})}const d=await a(r,{addFeatures:o});if(l.size>0){var c;const e=null!==(c=null===d||void 0===d?void 0:d.addFeatureResults)&&void 0!==c?c:[];await i(r,function(e,t,i,a){const n=[];return t.forEach(((t,o)=>{if(!t.error){const r=e[o],s=a.get(r)||[];r.attributes[i.objectIdField]=t.objectId,s.forEach((e=>{let{form:t}=e;return n.push({feature:r,attachment:t})}))}})),n}(o,e,r,l))}}});return h._set("steps",this._createWorkflowSteps(h,l)),h}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",(0,C.kB)((()=>e.effect=t))}const t=e.opacity;return e.opacity=.7,(0,C.kB)((()=>e.opacity=t))}_highlight(e){const t=this.data.viewModel.view;"3d"===(null===t||void 0===t?void 0:t.type)&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){(0,r.hw)(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(Ae);const{creationInfo:t}=this.data;if(!t)return;this.createFeatureState="create-new";const i=await ne(this._sketchViewModel,t,e);this.addHandles(i,Ae)}async _startUpdating(e,t){var i;const{pendingFeatures:a}=this;a.includes(e)||a.add(e);const{_featureFormViewModel:n,_sketchViewModel:o}=this,{creationInfo:s,viewModel:d}=this.data,{attachmentsViewModel:c,layerInfos:u,view:p}=d;if(!p||!s)return;const h=s.layer,v=function(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}(u,h),f=null===v||void 0===v?void 0:v.formTemplate,w=p.spatialReference;if(n.set({arcadeEditType:"INSERT",feature:e,formTemplate:f,spatialReference:w,map:p.map}),"add"!==c.mode&&"edit"!==c.mode||null!==(i=d.activeWorkflow)&&void 0!==i&&i.previous(),c.graphic=e,c.fileInfos.removeAll(),c.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach((e=>{let{file:t,form:i}=e;return c.addFile(t,i)})),this._removeHighlight(e),await ae(e,t,"2d"===p.type?p.scale:null),this.removeHandles(Ae),(0,r.hw)(this._featureFormHandle),"2d"===p.type){const i=(0,l.watch)((()=>p.scale),(i=>this._updateGraphicDebounced(e,t,i)));this.addHandles(i,Ae)}return this._featureFormHandle=(0,C.AL)([n.on("value-change",(async()=>{e.attributes=n.getValues(),await ae(e,t,"2d"===p.type?p.scale:null)})),o.on(["update","undo","redo"],(e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&we(e.toolEventInfo.type))&&n.notifyFeatureGeometryChanged()}))]),this.createFeatureState="update-pending",this._visualVariableAttributes=te(e),(0,A.wb)(h)?void 0:de({graphic:e,sketchViewModel:o,sourceLayer:h,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";const{data:a}=e,n=ve(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:n}=a,{view:o}=n;o&&(be(t)?e.addHandles(await async function(e){let{view:t,data:a,signal:n,next:o,cancel:r}=e;const{creationInfo:d}=a;if(!d)return(0,C.kB)();if(!be(d))return(0,C.kB)();const{layer:c}=d,u=null!=d.geometryToPlace;if(d.geometryToPlace=null,u)return r(),(0,C.kB)();const{Upload:p}=await i.e(24931).then(i.bind(i,85079));(0,s.k_)(n);const h=new p;a.upload=h;let v=null;const f=()=>{var e;return null===(e=v)||void 0===e?void 0:e.remove()},w=(0,C.AL)([(0,l.watch)((()=>h.state),(e=>{switch(e){case"default":case"error":f();break;case"pending":f(),v=ye(t);break;case"success":d.maxFeatures=1,d.geometryToPlace=h.result,f(),o()}})),(0,C.kB)((()=>{h.cancel(),f()}))]);return h.uploadTo(c),w}({view:o,data:a,next:()=>e.next(),cancel:()=>n.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(a.parent&&t&&(e.addHandles(n.lockFeatureTemplatesViewModel(),this.id),n.featureTemplatesViewModel.layers=[t.layer]),e.addHandles(n.featureTemplatesViewModel.on("select",(t=>{let{item:i}=t;i&&(a.creationInfo={...a.creationInfo,layer:i.layer,template:i.template},e.next())})),this.id)))},async tearDown(){e.removeHandles([this.id,Ae])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:i}=a;t.canceled&&(e.removeHandles([Ee,Ie,Ae]),i.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=a.viewModel,{graphic:i,fileInfos:n}=t;e._attachmentFileInfos.set(i,n.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=a.viewModel,{graphic:i,fileInfos:n}=t;e._attachmentFileInfos.set(i,n.toArray()),t.mode="view"}})});return function(e,t){e.viewModel.syncFeatureTemplates();const i=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&i){const e=i.layer,a=(0,ee.J)(e);1===a.length&&"scene"!==e.type&&(i.template=a[0],t.shift())}return t}(a,n)}static _configureSketchViewModel(e,t){const{data:i}=e,{creationInfo:a,viewModel:n}=i,{view:o}=n,s=e._sketchViewModel;let d=null;const c=[];if(!o)return(0,C.kB)();"2d"===o.type&&a&&c.push(e._fadeExistingFeatures(a.layer));const u=async i=>{if("cancel"===i.state){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e._lastActiveGraphics.length<1)return e._startCreating(t);const i=e._lastActiveGraphics.pop();return e._startUpdating(i,t)}if("complete"===i.state&&i.graphic)return e._startUpdating(i.graphic,t)},p=async i=>{const{attachmentsViewModel:r}=n,{_featureFormViewModel:s}=e,c=i.graphics[0];if("complete"===i.state){var u;c!==d&&(e._lastActiveGraphics.push(c),e._highlight(c)),d=null;const{hasPendingSubtypeChoice:p,submittable:h}=s;if(e.numPendingFeatures===(null===a||void 0===a?void 0:a.maxFeatures)||p||!h){!h&&s.submit();const i=e._lastActiveGraphics.pop();return e._startUpdating(i,t)}if("add"!==r.mode&&"edit"!==r.mode||null!==(u=n.activeWorkflow)&&void 0!==u&&u.previous(),i.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);e.addHandles([ye(o),o.on("click",(e=>e.preventDefault()))],Ie),await(0,l.whenOnce)((()=>!s.updating)),e.removeHandles(Ie),e._startCreating(t)}"start"===i.state&&e._removeHighlight(c);const p=e._visualVariableAttributes;await ce(o,c,i,p,t);const h=c.attributes,{rotation:v,size:f}=p;if(null!=v){const{field:e}=v;s.setValue(e,h[e])}if(null!=f){const{field:e}=f;s.setValue(e,h[e])}},h=t=>{const i=t.graphics[0];e.pendingFeatures.remove(i),(0,T.Od)(e._lastActiveGraphics,i),d=i},v=async i=>{if(be(a))return;const{results:n}=await o.hitTest(i,{include:s.layer}),r=n.find((e=>"graphic"===e.type&&e.graphic.sourceLayer===(null===a||void 0===a?void 0:a.layer)));if(!r)return;const l=r.graphic;if("transform"===s.activeTool||"reshape"===s.activeTool){if(s.updateGraphics.at(0)===l)return;const{submittable:i,hasPendingSubtypeChoice:a}=e._featureFormViewModel;if(!i||a)return;await e.updatePendingFeature(l,t)}};c.push(s.on("create",(t=>e._updatingHandles.addPromise(u(t)))),s.on("update",(t=>e._updatingHandles.addPromise(p(t)))),s.on("delete",(e=>h(e))),o.on("immediate-click",(t=>e._updatingHandles.addPromise(v(t))),U.f.TOOL),(0,C.kB)((()=>{e._preventDefaultActionOnCancel=!0,s.cancel()})),function(e,t){let i=null;const a=()=>e.snappingOptions.featureSources,n=()=>(i=new H.Z({layer:e.layer}),a().add(i),i),o=()=>{null!=i&&(a().remove(i),i=(0,r.SC)(i))};return(0,C.AL)([(0,l.watch)((()=>{var e,i;const n=null===(e=t.creationInfo)||void 0===e?void 0:e.layer,o=a().find((e=>e.layer===n));return{hasFeatureLayerSource:!!o,enabled:null!==(i=null===o||void 0===o?void 0:o.enabled)&&void 0!==i&&i}}),(e=>{var t;let{hasFeatureLayerSource:a,enabled:r}=e;if(!a)return o();null!==(t=i)&&void 0!==t||(i=n()),i.enabled=r}),l.syncAndInitial),(0,C.kB)(o)])}(s,i));const f=(0,C.AL)(c);return s.addHandles(f),f}_initializeSketchViewModel(){var e;const{data:t}=this,{view:i}=t.viewModel,a=new F.default({elevationInfo:null===(e=t.creationInfo)||void 0===e?void 0:e.layer.elevationInfo,internal:!0,listMode:"hide"}),n=new Fe.Z({layer:a,sketchOptions:t.sketchOptions,snappingManager:t.snappingManager,updateOnGraphicClick:!1,view:i});this._sketchViewModel=n,null!==i&&void 0!==i&&i.map.add(a),this.addHandles((0,C.kB)((()=>{null!==i&&void 0!==i&&i.destroyed||null!==i&&void 0!==i&&i.map.remove(a),a.destroy()})))}async _setUpCreatingFeaturesStep(){if(this.hasHandles(Ee))return;const{creationInfo:e,viewModel:t}=this.data,{attachmentsViewModel:i,view:a}=t;if(!a||null===e||void 0===e||!e.layer)throw new _.Z("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:n,layer:o}=e,s=this._sketchViewModel,d=new Map,c=[];this._lastActiveGraphics=[],this._featureFormHandle=(0,r.hw)(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},this.data.editorItem=t.findEditorItemForLayer(e.layer),function(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}(i),c.push((0,l.watch)((()=>i.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})));const u=ye(a);c.push(u);const p=(0,A.wb)(e.layer);try{if(p){var h;const t=null!==n&&void 0!==n?n:new P.Z({attributes:{...null===(h=e.template)||void 0===h?void 0:h.prototype.attributes,...e.attributeOverrides},sourceLayer:o});await this._startUpdating(t,d)}else c.push(Ce._configureSketchViewModel(this,d)),n?(s.layer.add(n),await this._startUpdating(n,d)):await this._startCreating(d)}finally{u.remove()}const v=(0,C.kB)((()=>this.pendingFeatures.drain((e=>s.layer.remove(e))))),f=(0,l.watch)((()=>null===a||void 0===a?void 0:a.timeZone),(e=>this._featureFormViewModel.timeZone=e),l.initial),w=(0,C.kB)((()=>{be(e)&&t.cancelWorkflow({warnIfNoWorkflow:!1})}));this._featureFormHandle&&c.push(this._featureFormHandle),this.addHandles(c,this._handleKeys.beforeCommit),this.addHandles([(0,C.kB)((()=>i.fileInfos.removeAll())),(0,C.AL)(c),w,v,f],Ee)}};(0,a._)([(0,d.Cb)()],Se.prototype,"createFeatureState",void 0),(0,a._)([(0,d.Cb)()],Se.prototype,"data",void 0),(0,a._)([(0,d.Cb)({constructOnly:!0})],Se.prototype,"isNested",void 0),(0,a._)([(0,d.Cb)()],Se.prototype,"featureFormViewModel",null),(0,a._)([(0,d.Cb)()],Se.prototype,"hasPendingEdits",null),(0,a._)([(0,d.Cb)()],Se.prototype,"_getDrawMeshHelpMessage",void 0),(0,a._)([(0,d.Cb)()],Se.prototype,"helpMessage",null),(0,a._)([(0,d.Cb)()],Se.prototype,"layer",null),(0,a._)([(0,d.Cb)()],Se.prototype,"parent",null),(0,a._)([(0,d.Cb)()],Se.prototype,"parentLayer",null),(0,a._)([(0,d.Cb)()],Se.prototype,"keyboardCancellationEnabled",null),(0,a._)([(0,d.Cb)()],Se.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.Cb)()],Se.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.Cb)()],Se.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.Cb)()],Se.prototype,"sketchViewModel",null),Se=Ce=(0,a._)([(0,c.j)("esri.widgets.Editor.CreateFeaturesWorkflow")],Se);const We=Se;var Oe=i(43e3),Ve=i(92377),Pe=i(74982),Te=i(74509),Le=i(69787);function xe(e){return null==e?null:JSON.stringify(e)}let Ue=class extends D.default{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){return this._stringifyAttributes(this.feature)!==this._stringifyAttributes(this.initialFeature)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){var e;this.initialFeature=null===(e=this.feature)||void 0===e?void 0:e.clone()}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified"))}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyAttributes(e){return xe(null===e||void 0===e?void 0:e.attributes)}_stringifyGeometry(e){const t=null===e||void 0===e?void 0:e.geometry;return xe("mesh"===(null===t||void 0===t?void 0:t.type)?{transform:t.transform,vertexSpace:t.vertexSpace}:t)}};var He;(0,a._)([(0,d.Cb)()],Ue.prototype,"_stagedForDelete",void 0),(0,a._)([(0,d.Cb)()],Ue.prototype,"attributesModified",null),(0,a._)([(0,d.Cb)()],Ue.prototype,"feature",void 0),(0,a._)([(0,d.Cb)()],Ue.prototype,"geometryModified",null),(0,a._)([(0,d.Cb)()],Ue.prototype,"initialFeature",void 0),(0,a._)([(0,d.Cb)()],Ue.prototype,"modified",null),Ue=(0,a._)([(0,c.j)("esri.widgets.Editor.Edits")],Ue);let De=He=class extends D.default{constructor(e){super(e),this.editorItem=null,this.edits=null,this.parent=null,this.relatedRecordCallbacks=null,this.viewModel=null}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=He._makeConstructorProps(e);return new He(t)}static _makeConstructorProps(e){const{feature:t,parent:i,relatedRecordCallbacks:a,viewModel:n}=e,o=n.editorItems.find((e=>e.layer===t.layer));if(!o)throw new _.Z("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{editorItem:o,edits:new Ue({feature:t}),parent:i,relatedRecordCallbacks:a,viewModel:n}}};(0,a._)([(0,d.Cb)()],De.prototype,"attachmentsCapabilities",null),(0,a._)([(0,d.Cb)({constructOnly:!0})],De.prototype,"editorItem",void 0),(0,a._)([(0,d.Cb)()],De.prototype,"edits",void 0),(0,a._)([(0,d.Cb)()],De.prototype,"formTemplate",null),(0,a._)([(0,d.Cb)()],De.prototype,"parent",void 0),(0,a._)([(0,d.Cb)()],De.prototype,"relatedRecordCallbacks",void 0),(0,a._)([(0,d.Cb)()],De.prototype,"viewModel",void 0),De=He=(0,a._)([(0,c.j)("esri.widgets.Editor.UpdateRecordWorkflowData")],De);const Ze=De;var Re;let ze=Re=class extends Ze{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){var t;const{feature:i,snappingManager:a,viewModel:n}=e,o=null!==(t=e.sketchOptions)&&void 0!==t?t:new S.Z,{view:r}=n;if(!r)throw new _.Z("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const s=await me(r,i.layer);return new Re({...Re._makeConstructorProps(e),layerView:s,sketchOptions:o,snappingManager:a})}};(0,a._)([(0,d.Cb)()],ze.prototype,"layerView",void 0),(0,a._)([(0,d.Cb)({constructOnly:!0})],ze.prototype,"sketchOptions",void 0),(0,a._)([(0,d.Cb)()],ze.prototype,"snappingManager",void 0),ze=Re=(0,a._)([(0,c.j)("esri.widgets.Editor.UpdateFeatureWorkflowData")],ze);const Ge=ze;var Be,Ne=i(28554);const je={exit:Symbol()};let qe=Be=class extends ke{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:i}=e.viewModel,a=t.feature,n=new AbortController;this.addHandles((0,C.F2)(n)),this._updatingHandles.addPromise(async function(e,t,i){const{sourceLayer:a}=e,n=a.createQuery();n.objectIds=[e.getAttribute(a.objectIdField)],n.outFields=["*"],n.returnM=a.capabilities.data.supportsM,n.returnZ=a.capabilities.data.supportsZ,"scene"===a.type&&null!=a.infoFor3D||(n.outSpatialReference=t);const o=await a.queryFeatures(n,{signal:i});return(0,s.k_)(i),o.features[0]}(a,e.viewModel.view.spatialReference,n.signal).then((e=>{(0,s.Hc)(n)||(this._onFullFeatureLoaded(e),this._initializeFeatureFormViewModel())}),(e=>this.cancel({force:!0,error:new _.Z("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:e}})})))),i&&(this._highlightHelper=new Pe.Z({view:i}),this.addHandles((0,C.kB)((()=>{var e;return null===(e=this._highlightHelper)||void 0===e?void 0:e.removeAll()}))))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){var e;return null===(e=this.parent)||void 0===e?void 0:e.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(je.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:i,viewModel:a}=e,{attachmentsViewModel:n}=a;n.set({capabilities:i,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([(0,C.kB)((()=>n.fileInfos.removeAll())),(0,l.watch)((()=>n.mode),(e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}))],je.exit)}_initializeFeatureFormViewModel(){const{edits:e,formTemplate:t,viewModel:{view:i}}=this.data,a=this._featureFormViewModel=new Me.Z({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:t,highlightHelper:this._highlightHelper,map:null===i||void 0===i?void 0:i.map,spatialReference:i.spatialReference,timeZone:null===i||void 0===i?void 0:i.timeZone});a.relatedRecordCallbacks={...this.data.relatedRecordCallbacks,showAllRelatedRecords:e=>a.relationshipId=e.relationshipId};const{initialFeature:n}=e;n&&a.overrideInitialFeature(n),this.addHandles([a.on("value-change",(()=>{e.updateAttributes(a.getValues()),this.fullFeature.attributes=e.feature.attributes})),(0,l.watch)((()=>null===i||void 0===i?void 0:i.timeZone),(e=>a.timeZone=e))])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new Be({data:await Ze.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};var Qe;qe._onCommitFactory=e=>async t=>{const{edits:i}=t,{feature:a}=i;if(!a)return;const n=a.sourceLayer,o=a.clone();if(!i.attributesModified||i.stagedForDelete){const e=n.objectIdField;if(o.attributes={[e]:a.getAttribute(e)},(0,Ne.Rx)()&&(0,Ne.yA)()&&"scene"===n.type&&null!=n.infoFor3D){var r;const e=null===(r=n.associatedLayer)||void 0===r?void 0:r.globalIdField;null!=e&&o.setAttribute(e,a.getAttribute(e))}}i.geometryModified&&!i.stagedForDelete||(o.geometry=null);const s=i.stagedForDelete?"deleteFeatures":"updateFeatures";await e(n,{[s]:[o]})},(0,a._)([(0,d.Cb)()],qe.prototype,"editorItem",null),(0,a._)([(0,d.Cb)()],qe.prototype,"featureFormViewModel",null),(0,a._)([(0,d.Cb)()],qe.prototype,"fullFeature",void 0),(0,a._)([(0,d.Cb)()],qe.prototype,"hasPendingEdits",null),(0,a._)([(0,d.Cb)()],qe.prototype,"layer",null),(0,a._)([(0,d.Cb)()],qe.prototype,"parent",null),(0,a._)([(0,d.Cb)()],qe.prototype,"parentLayer",null),(0,a._)([(0,d.Cb)()],qe.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.Cb)()],qe.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.Cb)()],qe.prototype,"reliesOnOwnerAdminPrivileges",null),qe=Be=(0,a._)([(0,c.j)("esri.widgets.Editor.UpdateRecordWorkflow")],qe);const Ke={...je,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol()};let Je=Qe=class extends qe{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){var e;null===(e=this._layerViewEditSession)||void 0===e||e.rollback()}async commit(){this.removeHandles(Ke.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?null===t||void 0===t||t.rollback():null===t||void 0===t||t.commit()}catch(m){throw await this._configureSketchViewModel(),new _.Z("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:m})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles(this._featureFormViewModel.on("value-change",(e=>{var t;null===(t=this._layerViewEditSession)||void 0===t||t.setAttribute(e.fieldName,e.value)})))}_configureHighlight(){const{edits:e,layerView:t}=this.data;(0,Le.tl)(t)&&this.addHandles(t.highlight(e.feature),Ke.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:i,_sketchGraphicClone:a}=this,{edits:n,viewModel:o}=t,r=n.feature,{view:d}=o,c=te(r),u=await async function(e){var t;let{feature:i,featureClone:a,visualVariableAttributes:n,sketchViewModel:o,view:r,onUpdate:d,webStyleCache:c}=e;await ae(a,c,"2d"===r.type?r.scale:null);let u=null;if("2d"===(null===o||void 0===o||null===(t=o.view)||void 0===t?void 0:t.type)){const e=(0,s.Ds)((e=>ae(a,c,e)));u=(0,l.watch)((()=>{var e;return null===o||void 0===o||null===(e=o.view)||void 0===e?void 0:e.scale}),(t=>e(t)))}const p=a.sourceLayer,h=me(r,p);await de({graphic:a,sketchViewModel:o,sourceLayer:p,visualVariables:n,webStyleCache:c});let v=null;h.then((e=>v=e)).catch((()=>{}));const f=n.size,w=n.rotation,m=(0,l.watch)((()=>i.attributes),(async e=>{let t=!1;for(const i in e){const n=e[i];n!==a.getAttribute(i)&&(a.setAttribute(i,n),null==f||f.isUpdatingInteractively||f.field!==i||f.setInitialValue(n),null==w||w.isUpdatingInteractively||w.field!==i||w.setInitialValue(n),(null==v||v.requiredFields.includes(i))&&(t=!0))}t&&await ae(a,c,"2d"===r.type?r.scale:null)})),g=o.on("update",(async e=>{const t=e.graphics[0];if("complete"===e.state)return de({graphic:t,sketchViewModel:o,sourceLayer:p,visualVariables:n,webStyleCache:c});await ce(r,t,e,n,c),d(ge(t),e)})),y=o.on(["undo","redo"],(async e=>{d(ge(e.graphics[0]),e)}));return(0,C.AL)([y,g,(0,C.kB)((()=>o.cancel())),m,u])}({feature:r,featureClone:a,visualVariableAttributes:c,sketchViewModel:e,view:d,onUpdate:(e,t)=>{let{geometry:a,attributes:o}=e;if(n.updateAttributes(o),n.updateGeometry(a),i.feature.geometry=a,null!=c.rotation){const{field:e}=c.rotation;i.setValue(e,o[e])}if(null!=c.size){const{field:e}=c.size;i.setValue(e,o[e])}("undo"===t.type||"redo"===t.type||"update"===t.type&&null!=t.toolEventInfo&&we(t.toolEventInfo.type))&&i.notifyFeatureGeometryChanged()},webStyleCache:this._webStyleCache});this.addHandles(u,Ke.sketchGraphics),e.addHandles(u)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,i=e.edits.feature,{capabilities:a,layer:n}=e.editorItem,{view:o}=e.viewModel;if(this.removeHandles([Ke.highlights,Ke.sketchGraphics,Ke.sketchViewModel]),!a.update.geometry||"3d"===(null===o||void 0===o?void 0:o.type)&&(0,Te.XH)(n.elevationInfo))return{enter:async()=>{this.hasHandles(Ke.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([Ke.highlights])};const s=new F.default({elevationInfo:n.elevationInfo,internal:!0,listMode:"hide"}),l=new Fe.Z({allowDeleteKey:!1,layer:s,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:o});return this._sketchViewModel=l,null!==o&&void 0!==o&&o.map.add(s),this.addHandles((0,C.kB)((()=>{null!==o&&void 0!==o&&o.destroyed||null!==o&&void 0!==o&&o.map.remove(s),s.destroy(),this._sketchViewModel=(0,r.SC)(l)})),Ke.sketchViewModel),await ae(t,this._webStyleCache,"2d"===(null===o||void 0===o?void 0:o.type)?o.scale:null),this.addHandles([await ue(l,i,t)]),{enter:async()=>{this.hasHandles(Ke.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([Ke.sketchGraphics]),viewModel:l}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=ge(e),{edits:i,layerView:a}=this.data;i.updateGeometry(e.geometry),i.trackChanges(),function(e){return"createInteractiveEditSession"in e}(a)&&(this._layerViewEditSession=a.createInteractiveEditSession(t))}static async create(e){const t=new Qe({data:await Ge.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){}};(0,a._)([(0,d.Cb)()],Je.prototype,"_layerViewEditSession",void 0),(0,a._)([(0,d.Cb)()],Je.prototype,"_sketchGraphicClone",void 0),(0,a._)([(0,d.Cb)()],Je.prototype,"_sketchViewModel",void 0),Je=Qe=(0,a._)([(0,c.j)("esri.widgets.Editor.UpdateFeatureWorkflow")],Je);let Xe=class extends D.default{constructor(e){super(e),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};(0,a._)([(0,d.Cb)()],Xe.prototype,"addAttachmentsCallback",void 0),(0,a._)([(0,d.Cb)()],Xe.prototype,"applyEditsCallback",void 0),(0,a._)([(0,d.Cb)()],Xe.prototype,"candidates",void 0),(0,a._)([(0,d.Cb)()],Xe.prototype,"rootFeature",void 0),(0,a._)([(0,d.Cb)({constructOnly:!0})],Xe.prototype,"sketchOptions",void 0),(0,a._)([(0,d.Cb)()],Xe.prototype,"snappingManager",void 0),(0,a._)([(0,d.Cb)()],Xe.prototype,"viewModel",void 0),Xe=(0,a._)([(0,c.j)("esri.widgets.Editor.UpdateWorkflowData")],Xe);const $e=Xe;var Ye,et=i(45276);const tt="esri.widgets.Editor.UpdateWorkflow";let it=Ye=class extends ke{constructor(e){super(e),this._workflowStack=new Oe.Z(Ve.Z$),this._sketchStack=new Oe.Z(Ve.Z$),this.data=void 0,this.type="update"}get activeEditorItem(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.data.editorItem)&&void 0!==e?e:void 0}get activeFeatureFormViewModel(){var e;return null===(e=this.activeWorkflow)||void 0===e?void 0:e.featureFormViewModel}get activeSketchViewModel(){var e;return null===(e=this._sketchStack.peek())||void 0===e?void 0:e.viewModel}get activeWorkflow(){return this._workflowStack.last()}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some((e=>{var i;let{layer:a}=e;return null===(i=t.findEditorItemForLayer(a))||void 0===i?void 0:i.supportsUpdateWorkflow}))}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.capabilities.attachments.enabled)}get shouldAllowAttachmentEditing(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.capabilities.update.attachments.enabled)}get hasPendingEdits(){return Array.from(this._workflowStack).some((e=>e.hasPendingEdits))}get helpMessage(){var e;return null!==(e=this.activeWorkflow)&&void 0!==e&&e.helpMessage?this.activeWorkflow.helpMessage:"awaiting-feature-to-update"===this.stepId?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.reliesOnOwnerAdminPrivileges)&&void 0!==e&&e}get hasInvalidFormTemplate(){var e;return!(null===(e=this.activeEditorItem)||void 0===e||!e.hasInvalidFormTemplate)}async back(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>Promise.resolve(!0);const{activeWorkflow:t}=this;if(null==(null===t||void 0===t?void 0:t.featureFormViewModel.relationshipId))if(t){if(t.hasPendingEdits&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else t.featureFormViewModel.relationshipId=null}async cancelActiveWorkflow(e){var t;await(null===(t=this.activeWorkflow)||void 0===t?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack((e=>e.commit())),await super.commit()}static create(e){var t;const{viewModel:i,snappingManager:a,startAt:n,addAttachmentsCallback:o,applyEditsCallback:r}=e,s=null!==(t=e.sketchOptions)&&void 0!==t?t:new S.Z,l=new Ye({data:new $e({addAttachmentsCallback:o,applyEditsCallback:r,sketchOptions:s,snappingManager:a,viewModel:i}),onCommit:async()=>{}});return l._set("steps",this._createWorkflowSteps(l,n)),l}async save(){var e;this.nestedWorkflowCount>1?(await(null===(e=this.activeWorkflow)||void 0===e?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(qt){throw new _.Z("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:qt})}}async startUpdating(e){try{const t=await this._createNestedUpdateWorkflow(e);await this._pushWorkflow(t)}catch(qt){throw new _.Z("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:qt})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new _.Z("editor:nothing-to-delete","There is no feature to delete");nt(e)?await e.deleteAndCommit():await e.cancel(),1===this.nestedWorkflowCount?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack((e=>e.cancel({force:!0})))}async _createNestedCreateFeaturesWorkflow(e){var t;const{relatedLayer:i}=e,{addAttachmentsCallback:a,applyEditsCallback:n,sketchOptions:o,snappingManager:r,viewModel:s}=this.data;if(!(0,I.K)(i))throw new _.Z("editor:unsupported-layer","Editing is not supported on the provided layer");const l=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),d=l.template||l.initialFeature?"creating-features":"awaiting-feature-creation-info",c="create-features"!==(null===(t=this.activeWorkflow)||void 0===t?void 0:t.type)?this.activeWorkflow:void 0;return We.create({addAttachmentsCallback:a,applyEditsCallback:n,creationInfo:l,isNested:!0,parent:c,sketchOptions:o,snappingManager:r,startAt:d,viewModel:s})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!(0,I.K)(t)||(0,A.e9)(t))throw new _.Z("editor:unsupported-layer","Editing is not supported on the provided layer");const i={layer:t,maxFeatures:1},a=this._makeRelatedRecordAttributes(e),n=(0,ee.J)(t);return(null===n||void 0===n?void 0:n.length)>0?(i.attributeOverrides=a,1===n.length&&(i.template=n[0])):i.initialFeature=new P.Z({sourceLayer:t,attributes:a}),i}async _createNestedUpdateWorkflow(e){var t;const i=(0,A.wb)(e.sourceLayer)?qe:Je,{applyEditsCallback:a,sketchOptions:n,snappingManager:o,viewModel:r}=this.data,s="create-features"!==(null===(t=this.activeWorkflow)||void 0===t?void 0:t.type)?this.activeWorkflow:void 0,d=await i.create({feature:e,parent:s,sketchOptions:n,snappingManager:o,viewModel:r,applyEdits:a,relatedRecordCallbacks:{addRelatedRecord:async e=>await this.startCreatingRelatedRecord(e),editRelatedRecord:async e=>{let{relatedFeature:t}=e;return await this.startUpdating(t)}}});return await(0,l.whenOnce)((()=>!d.updating)),d}async _drainWorkflowStack(e){const t=this._workflowStack,i=[];for(;t.length>0;){const a=t.pop();this._sketchStack.pop();const n=e(a).then((()=>a.destroy()));this._updatingHandles.addPromise(n),i.push(n)}await Promise.all(i)}_makeRelatedRecordAttributes(e){var t,i;const{parentFeature:a,relatedLayer:n,relationshipId:o}=e;if(!(0,et.tJ)(a))return;const r=null===(t=n.relationships)||void 0===t?void 0:t.find((e=>e.id===o));if(!r)return void at("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if("origin"===r.role)return void at("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const s=a.sourceLayer;r.relatedTableId!==s.layerId&&at("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const l=null===(i=s.relationships)||void 0===i?void 0:i.find((e=>e.id===o));if(!l)return void at("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const d=a.getAttribute(l.keyField);return d||at("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[r.keyField]:d}}async _popWorkflow(){var e;null!==(e=this._workflowStack.pop())&&void 0!==e&&e.destroy(),this._sketchStack.pop();const t=await this._reconcileWorkflowStack();if(t.failureCount>0)throw new _.Z("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",t)}async _pushWorkflow(e){var t;const i=this._workflowRequiresSketchViewModel(e);null===(t=this.activeWorkflow)||void 0===t||t.exit({removeSketchHandles:i});const a=this._sketchStack,n=await(null===e||void 0===e?void 0:e.start()),o=a.peek();n?(null!==o&&void 0!==o&&o.exit(),a.push(n)):a.push(this._cloneSketchController(o)),this._workflowStack.push(e);const r=await this._reconcileWorkflowStack();if(r.failureCount>0)throw new _.Z("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",r)}async _reconcileWorkflowStack(){const e=this._workflowStack,t=this._sketchStack;try{var i;const a=e.peek();return await(null===a||void 0===a?void 0:a.enter()),await(null===(i=t.peek())||void 0===i?void 0:i.enter()),{activeWorkflow:a,failureCount:0}}catch(wt){e.pop().destroy(),t.pop();const{activeWorkflow:a,failureCount:n}=await this._reconcileWorkflowStack();return{activeWorkflow:a,failureCount:n+1}}}_cloneSketchController(e){var t,i;return{enter:null!==(t=null===e||void 0===e?void 0:e.enter)&&void 0!==t?t:async()=>{},exit:null!==(i=null===e||void 0===e?void 0:e.exit)&&void 0!==i?i:async()=>{},viewModel:null===e||void 0===e?void 0:e.viewModel}}_workflowRequiresSketchViewModel(e){var t;const{type:i}=e;return"update-feature"===i||"create-features"===i&&!(0,A.wb)(null===(t=e.data.creationInfo)||void 0===t?void 0:t.layer)}static _createWorkflowSteps(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-to-update";const{data:i}=e;return ve(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:t}=i.viewModel,a=i.viewModel.view;let n=null;e.addHandles((0,C.kB)((()=>{n=(0,r.IM)(n)})),this.id),i.rootFeature=null,i.candidates=[];const o=a.on("immediate-click",(async o=>{var r;t.location=o.mapPoint,t.visible=!0,null===(r=n)||void 0===r||r.abort();const{editorItems:l}=i.viewModel;n=new AbortController;const d=await o.async((()=>new Promise(((e,t)=>{var i,r;(0,s.fu)(null===(i=n)||void 0===i?void 0:i.signal,(()=>t((0,s.zE)()))),e(se(l,a,o,null===(r=n)||void 0===r?void 0:r.signal))}))));(0,s.k_)(n),i.candidates=d.filter((e=>"fulfilled"===e.status)).flatMap((e=>e.value)).filter((e=>!e.isAggregate)),t.visible=1===i.candidates.length,0!==i.candidates.length&&(o.stopPropagation(),1===i.candidates.length?(i.rootFeature=i.candidates[0],e.go("editing-existing-feature").catch((()=>{})).then((()=>t.visible=!1))):e.next())}),U.f.TOOL);a.focus(),e.addHandles(o,this.id)},async tearDown(){0===i.candidates.length&&(i.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){i.rootFeature=null;const{view:t}=i.viewModel;if(!t)return;const a=new Pe.Z({view:t});e.addHandles([(0,l.watch)((()=>i.rootFeature),((e,t)=>{a.remove(t),a.add(e)}),l.sync),(0,C.kB)((()=>a.removeAll()))],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:t,viewModel:i}=e.data;if(!t)throw new _.Z("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(t),i.spinnerViewModel.visible=!1;const a=(0,s.Ds)((async()=>{await(0,l.whenOnce)((()=>!e.updating)),e.previous()}));e.addHandles([(0,l.watch)((()=>e.nestedWorkflowCount),((e,t)=>{0===e&&0!==t&&a()}),l.sync)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){i.viewModel.attachmentsViewModel.mode="view"}})})}};(0,a._)([(0,d.Cb)()],it.prototype,"activeEditorItem",null),(0,a._)([(0,d.Cb)()],it.prototype,"activeFeatureFormViewModel",null),(0,a._)([(0,d.Cb)()],it.prototype,"activeSketchViewModel",null),(0,a._)([(0,d.Cb)()],it.prototype,"activeWorkflow",null),(0,a._)([(0,d.Cb)()],it.prototype,"data",void 0),(0,a._)([(0,d.Cb)()],it.prototype,"hasUpdatableCandidates",null),(0,a._)([(0,d.Cb)()],it.prototype,"nestedWorkflowCount",null),(0,a._)([(0,d.Cb)()],it.prototype,"shouldShowAttachments",null),(0,a._)([(0,d.Cb)()],it.prototype,"shouldAllowAttachmentEditing",null),(0,a._)([(0,d.Cb)()],it.prototype,"hasPendingEdits",null),(0,a._)([(0,d.Cb)()],it.prototype,"helpMessage",null),(0,a._)([(0,d.Cb)()],it.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.Cb)()],it.prototype,"hasInvalidFormTemplate",null),it=Ye=(0,a._)([(0,c.j)(tt)],it);const at=(e,t)=>o.Z.getLogger(tt).warn("editor:".concat(e),t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),nt=e=>!!e&&/update-/.test(e.type),ot=it;let rt=class extends D.default{constructor(e){super(e),this.layer=null}get attachments(){var e;return{enabled:this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.data.supportsAttachment)}}get create(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._createEnabled,n=a,o=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsAdd,r=!(null===t||void 0===t||!t.operations.supportsAdd);return{attachments:{enabled:a&&this.attachments.enabled},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!o&&r}}get delete(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsDelete,n=!(null===t||void 0===t||!t.operations.supportsDelete);return{enabled:this._effectiveEnabled&&!(null===t||void 0===t||!t.operations.supportsDelete),reliesOnOwnerAdminPrivileges:!a&&n}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){var e;const{_effectiveCapabilities:t,layer:i}=this,a=this._updateEnabled,n=!(!a||null===t||void 0===t||!t.editing.supportsGeometryUpdate),o=null===(e=i.capabilities)||void 0===e?void 0:e.operations.supportsUpdate,r=!(null===t||void 0===t||!t.operations.supportsUpdate),s=this.attachments.enabled,l=s&&this._canCreateOrUpdate;return{attachments:{enabled:s,create:l,update:l},attributes:a,enabled:a,geometry:n,reliesOnOwnerAdminPrivileges:!o&&r}}get _createEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsAdd)}get _updateEnabled(){var e;return this._effectiveEnabled&&!(null===(e=this._effectiveCapabilities)||void 0===e||!e.operations.supportsUpdate)}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return(0,A.ln)(this.layer)}get _effectiveCapabilities(){return(0,A.S1)(this.layer)}};(0,a._)([(0,d.Cb)()],rt.prototype,"attachments",null),(0,a._)([(0,d.Cb)()],rt.prototype,"create",null),(0,a._)([(0,d.Cb)()],rt.prototype,"delete",null),(0,a._)([(0,d.Cb)()],rt.prototype,"layer",void 0),(0,a._)([(0,d.Cb)()],rt.prototype,"reliesOnOwnerAdminPrivileges",null),(0,a._)([(0,d.Cb)()],rt.prototype,"update",null),(0,a._)([(0,d.Cb)()],rt.prototype,"_createEnabled",null),(0,a._)([(0,d.Cb)()],rt.prototype,"_updateEnabled",null),(0,a._)([(0,d.Cb)()],rt.prototype,"_canCreateOrUpdate",null),(0,a._)([(0,d.Cb)()],rt.prototype,"_effectiveEnabled",null),(0,a._)([(0,d.Cb)()],rt.prototype,"_effectiveCapabilities",null),rt=(0,a._)([(0,c.j)("esri.layers.support.EditingCapabilities")],rt);const st=rt;var lt=i(92975),dt=i(18277),ct=i(50951);const ut="esri.views.layers.support.editableLayerViews";let pt=class extends st{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==(null===t||void 0===t?void 0:t.enabled)}}get create(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,o=t.create,r=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.addEnabled),s=o.enabled&&r;return{attributes:s&&o.attributes,enabled:s,geometry:s&&o.geometry&&ht(a,n),attachments:{enabled:e.enabled&&s&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnCreateEnabled)},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}get defaults(){return new st({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,i=e.delete,a=!1!==(null===t||void 0===t?void 0:t.enabled)&&!1!==(null===t||void 0===t?void 0:t.deleteEnabled);return{enabled:i.enabled&&a,reliesOnOwnerAdminPrivileges:i.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return null!==t&&void 0!==t&&t.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){var e,t;const{layer:i}=this,a=!(!(0,et.Um)(i)||null===(e=i.relationships)||void 0===e||!e.length),n=!(null===(t=this.formTemplate)||void 0===t||null===(t=t.elements)||void 0===t||!t.some((e=>"relationship"===e.type)));return{enabled:a&&n}}get update(){const{attachments:e,defaults:t,layerInfo:i,layer:a,layerView:n}=this,o=t.update,r=!1!==(null===i||void 0===i?void 0:i.enabled)&&!1!==(null===i||void 0===i?void 0:i.updateEnabled),s=o.enabled&&r,l=s&&o.attributes&&!1!==(null===i||void 0===i?void 0:i.attributeUpdatesEnabled),d=s&&o.geometry&&!1!==(null===i||void 0===i?void 0:i.geometryUpdatesEnabled)&&ht(a,n),c=e.enabled&&!1!==(null===i||void 0===i?void 0:i.attachmentsOnUpdateEnabled);return{attributes:l,enabled:s,geometry:d,attachments:{enabled:c,create:c&&o.attachments.create,update:c&&o.attachments.update},reliesOnOwnerAdminPrivileges:o.reliesOnOwnerAdminPrivileges}}};function ht(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&function(e,t){var i,a,n,r,s,l,d;const{associatedLayer:c}=e,u=null===c||void 0===c?void 0:c.infoFor3D;if(!u)return!1;const{supportedFormats:p,queryFormats:h}=u,v=null!==(i=(0,dt.S0)("model/gltf-binary",p))&&void 0!==i?i:(0,dt.Ow)("glb",p);if(null==v||!h.includes(v))return o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(a=e.title)&&void 0!==a?a:"Untitled layer",", ").concat(e.id,") does not support geometry edits because it does not support GLB queries.")),!1;const f=e.spatialReference,w=c.spatialReference;if(!(0,lt.fS)(f,w))return o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(n=e.title)&&void 0!==n?n:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(f.wkid,") is different from its associated FeatureLayer's spatial reference (wkid:").concat(w.wkid,").")),!1;const m=c.sourceJSON.sourceSpatialReference;if(null!=m&&!(0,lt.fS)(m,w))return o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(r=e.title)&&void 0!==r?r:"Untitled layer",", ").concat(e.id,") does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:").concat(w.wkid,") is different from its source spatial reference (wkid:").concat(m.wkid,").")),!1;const{view:g}=t;if(t.destroyed||null==g)return!1;const y=g.spatialReference,{viewingMode:b}=g.state,_=(0,lt.sT)(f),k=b===ct.JY.Global;return _&&!k?(o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(s=e.title)&&void 0!==s?s:"Untitled layer",", ").concat(e.id,") does not support geometry edits in local viewing mode because its spatial reference (wkid:").concat(f.wkid,") is geographic. Please consider changing the viewing mode to global.")),!1):!_&&k?(o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(l=e.title)&&void 0!==l?l:"Untitled layer",", ").concat(e.id,") does not support geometry edits in global viewing mode because its spatial reference (wkid:").concat(f.wkid,") is projected. Please consider changing the viewing mode to local.")),!1):!!((0,lt.fS)(f,y)||k&&(0,lt.sS)(y)&&(0,lt.oR)(f))||(o.Z.getLogger(ut).warnOnce("SceneLayer (".concat(null!==(d=e.title)&&void 0!==d?d:"Untitled layer",", ").concat(e.id,") does not support geometry edits because its spatial reference (wkid:").concat(f.wkid,") does not match the view spatial reference (wkid:").concat(y.wkid,").")),!1)}(e,t)}(0,a._)([(0,d.Cb)()],pt.prototype,"attachments",null),(0,a._)([(0,d.Cb)()],pt.prototype,"create",null),(0,a._)([(0,d.Cb)()],pt.prototype,"defaults",null),(0,a._)([(0,d.Cb)()],pt.prototype,"delete",null),(0,a._)([(0,d.Cb)()],pt.prototype,"formTemplate",null),(0,a._)([(0,d.Cb)()],pt.prototype,"layerInfo",void 0),(0,a._)([(0,d.Cb)()],pt.prototype,"layerView",void 0),(0,a._)([(0,d.Cb)()],pt.prototype,"relationship",null),(0,a._)([(0,d.Cb)()],pt.prototype,"update",null),pt=(0,a._)([(0,c.j)("esri.widgets.Editor.support.EditorEditingCapabilities")],pt);const vt=pt;var ft=i(73238);let wt=class extends D.default{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){var e;return!(null===(e=this.layerView)||void 0===e||!e.suspended)}get capabilities(){return new vt({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:i,delete:{enabled:a}}=this.capabilities,n=e.attachments.enabled||i.attachments.enabled;return!this.disabled&&(e.enabled||i.enabled||n||a||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return(0,ft.cs)(this.layer,this.formTemplate)}get isTable(){return(0,A.wb)(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};(0,a._)([(0,d.Cb)()],wt.prototype,"_suspended",null),(0,a._)([(0,d.Cb)()],wt.prototype,"capabilities",null),(0,a._)([(0,d.Cb)()],wt.prototype,"disabled",void 0),(0,a._)([(0,d.Cb)()],wt.prototype,"editable",null),(0,a._)([(0,d.Cb)()],wt.prototype,"formTemplate",null),(0,a._)([(0,d.Cb)()],wt.prototype,"hasInvalidFormTemplate",null),(0,a._)([(0,d.Cb)()],wt.prototype,"isTable",null),(0,a._)([(0,d.Cb)()],wt.prototype,"layer",void 0),(0,a._)([(0,d.Cb)()],wt.prototype,"layerInfo",void 0),(0,a._)([(0,d.Cb)()],wt.prototype,"layerView",void 0),(0,a._)([(0,d.Cb)()],wt.prototype,"supportsCreateFeaturesWorkflow",null),(0,a._)([(0,d.Cb)()],wt.prototype,"supportsUpdateWorkflow",null),(0,a._)([(0,d.Cb)()],wt.prototype,"visible",null),wt=(0,a._)([(0,c.j)("esri.widgets.Editor.support.EditorItem")],wt);const mt=wt;var gt=i(26138),yt=i(67354);const bt="esri.widgets.Editor.EditorViewModel",_t=["create-features","update"];function kt(e,t,i){o.Z.getLogger(bt).error(new _.Z(e,t,i))}function Ct(e,t){return null===e||void 0===e?void 0:e.find((e=>e.layer===t))}let Mt=class extends k.Z.EventedAccessor{constructor(e){var t;super(e),t=this,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new F.default({listMode:"hide",internal:!0}),this._snappingManager=null,this._updateItemsTask=null,this._updatingHandles=new M.R,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=new b.Z,this.editorItems=new b.Z,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new V.Z({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new gt.Z({disabledItemFunction:e=>{let{layer:t}=e;return this._itemIsSuspended(t)}}),this.layerInfos=null,this.ownSketchViewModel=new Fe.Z({layer:this._sketchGraphicsLayer}),this.sketchOptions=new S.Z,this.snappingOptions=new O.Z({attributeRulesEnabled:!0}),this.spinnerViewModel=new yt.Z,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{var e;this.canGoBack&&(null!==(e=this.activeWorkflow)&&void 0!==e&&e.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var e;const{featureFormViewModel:t}=this;if(t){if(t.submit(),!t.submittable||t.hasPendingSubtypeChoice)return;const e=t.getValues();if(t.validateContingencyConstraints(e,{includeIncompleteViolations:!0}).length>0)return}await(null===(e=this.activeWorkflow)||void 0===e?void 0:e.save())},this.selectFeature=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=t.activeWorkflow;t._candidateCommitted||"update"!==(null===a||void 0===a?void 0:a.type)||(a.data.rootFeature=e,i&&(a.next(),t._candidateCommitted=!0))}}initialize(){this.addHandles([(0,l.watch)((()=>{var e;const t=this.view,i=null===t||void 0===t||null===(e=t.map)||void 0===e?void 0:e.editableLayers,a=null===t||void 0===t?void 0:t.allLayerViews,n=null===a||void 0===a?void 0:a.filter((e=>!(null===i||void 0===i||!i.includes(e.layer))));return[i,n,this.layerInfos,this.allowedWorkflows]}),(()=>this._updateEditorItems()),l.syncAndInitial),(0,l.watch)((()=>this.hideTemplatesForInactiveLayers),(()=>this.syncFeatureTemplates())),(0,l.on)((()=>this.activeWorkflow),"cancel",(()=>this.emit("workflow-cancel"))),(0,l.on)((()=>this.activeWorkflow),"commit",(()=>this.emit("workflow-commit"))),(0,l.on)((()=>this.activeWorkflow),"complete",(()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)})),(0,l.when)((()=>{var e;return null===(e=this.view)||void 0===e?void 0:e.map}),(e=>e.add(this._sketchGraphicsLayer)),l.initial),(0,l.on)((()=>this.editorItems),"change",(()=>this._afterEditorItemsChange())),(0,l.watch)((()=>[this.canCreate,this.canUpdateVisible]),(()=>this._afterEditorItemsChange())),(0,l.watch)((()=>this.page),((e,t)=>{const i=[...this.pageStack];if(-1===i.indexOf(e))i.push(e);else for(;i.length&&i.at(-1)!==e;)i.pop();this.pageStack=i}),l.syncAndInitial),(0,l.when)((()=>"awaiting-update-feature-candidate"===this.state),(()=>this._candidateCommitted=!1)),(0,l.on)((()=>this.featureTemplatesViewModel),"select",(async e=>{let{item:t,oldItem:i}=e;const{activeWorkflow:a}=this;if(a){var n;if("update"===a.type&&"awaiting-feature-creation-info"===(null===(n=a.activeWorkflow)||void 0===n?void 0:n.stepId))return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(i,{emit:!1})}}if(!t)return;const o={layer:t.layer,template:t.template};if(t.supportsUpload)return this.featureTemplatesViewModel.select(i,{emit:!1}),this.startCreateFeaturesWorkflow(o);this.startCreateFeaturesWorkflowAtFeatureCreation(o)})),(0,l.on)((()=>this.view),"key-down",(e=>{var t;"Escape"===e.key&&(null===(t=this.activeWorkflow)||void 0===t?void 0:t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())})),(0,l.on)((()=>this.sketchViewModel),["create","delete","update"],(e=>{var t,i;const{activeWorkflow:a}=this,n="update"===(null===a||void 0===a?void 0:a.type),o=n?null===(t=a.activeWorkflow)||void 0===t?void 0:t.layer:null===a||void 0===a?void 0:a.layer,r=n?null===a||void 0===a||null===(i=a.activeWorkflow)||void 0===i?void 0:i.parentLayer:void 0,s="sketch-".concat(e.type);this.emit(s,{type:s,detail:e,layer:o,parentLayer:r})}),l.sync),(0,l.watch)((()=>this.view),(e=>{if(this._snappingManager=(0,r.SC)(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new W.N({view:e,options:t})}),l.syncAndInitial),(0,l.watch)((()=>this.snappingOptions),(e=>{this._snappingManager&&(this._snappingManager.options=e)}),l.syncAndInitial)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then((()=>{var e;null!==(e=this.view)&&void 0!==e&&null!==(e=e.map)&&void 0!==e&&e.remove(this._sketchGraphicsLayer),this.view=null})),this._updateItemsTask=(0,r.IM)(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=(0,r.hw)(this._sketchEventListenerHandle)}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){(0,n.Mr)(o.Z.getLogger(this),"allowedWorkflows",{replacement:"Editor.visibleElements",version:"4.29",warnOnce:!0}),e&&0!==e.length||(e=[..._t]),this._set("allowedWorkflows",e)}get canCreate(){return this.editorItems.some((e=>e.supportsCreateFeaturesWorkflow))}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some((e=>e.supportsUpdateWorkflow))}get canUpdateVisible(){return this.editorItems.some((e=>e.supportsUpdateWorkflow&&e.visible))}get featureTemplatesLayers(){const e=new b.Z;for(const t of this.editorItems){const i=t.supportsCreateFeaturesWorkflow&&!t.isTable,a=this.hideTemplatesForInactiveLayers&&!t.visible;i&&!a&&e.push(t.layer)}return e}get editableItems(){return(0,n.Mr)(o.Z.getLogger(this),"editableItems",{replacement:"editorItems",version:"4.29",warnOnce:!0}),this.editorItems.map((e=>{const{capabilities:t,disabled:i,hasInvalidFormTemplate:a,layer:n}=e,o=[],r=t.create,s=t.update,l=t.delete;return r.enabled&&o.push("create"),s.enabled&&o.push("update"),l.enabled&&o.push("delete"),{layer:n,supports:o,suspended:i,attributeUpdatesEnabled:s.attributes,geometryUpdatesEnabled:s.geometry,attachmentsOnCreateEnabled:r.attachments.enabled,attachmentsOnUpdateEnabled:s.attachments.enabled,hasInvalidFormTemplate:a,hasAttachments:t.attachments.enabled}}))}get featureFormViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeFeatureFormViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.featureFormViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return"update"===(null===e||void 0===e?void 0:e.type)?e.activeSketchViewModel:"create-features"===(null===e||void 0===e?void 0:e.type)?e.sketchViewModel:this.ownSketchViewModel}get state(){var e,t;if(null===(e=this.view)||void 0===e||!e.ready)return"disabled";const i=this.attachmentsViewModel.mode;if("add"===i)return"adding-attachment";if("edit"===i)return"editing-attachment";const{activeWorkflow:a}=this;return null!==a&&void 0!==a&&a.stepId?"update"===a.type&&null!==(t=a.activeWorkflow)&&void 0!==t&&t.stepId?a.activeWorkflow.stepId:a.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||!0===(null===(e=this.activeWorkflow)||void 0===e?void 0:e.updating)}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get page(){const{activeWorkflow:e,state:t}=this;if("update"===(null===e||void 0===e?void 0:e.type)&&"awaiting-feature-to-update"===e.stepId)return"ready";if("create-features"===(null===e||void 0===e?void 0:e.type)&&0===e.numPendingFeatures){const t=e.data.upload;if(t)return"default"===t.state?"ready":"creating-features-upload-details"}return null!==t&&void 0!==t?t:"disabled"}get featureFormDisabled(){var e;const{activeWorkflow:t}=this;return"update"===(null===t||void 0===t?void 0:t.type)&&!1===(null===(e=t.activeEditorItem)||void 0===e?void 0:e.capabilities.update.attributes)}get canGoBack(){return null!=this.activeWorkflow&&!this.syncing}get shouldShowDeleteButton(){var e;const{activeWorkflow:t}=this;return!!t&&"update"===t.type&&!(null===(e=t.activeEditorItem)||void 0===e||!e.capabilities.delete.enabled)}get hasPendingEdits(){var e,t;return null!==(e=null===(t=this.activeWorkflow)||void 0===t?void 0:t.hasPendingEdits)&&void 0!==e&&e}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"awaiting-feature-creation-info";if(await(0,l.whenOnce)((()=>!this.updating)),!this.canCreate)throw new _.Z("editing:unsupported-workflow","Creating features is unsupported or disabled.");const i=this._createUpdatingResolver();try{await this._cancelWorkflow();const i=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",i),await i.start()}catch(Et){this._logErrorAndCancelWorkflow(Et)}finally{i.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await(0,l.whenOnce)((()=>!this.updating));const t=this._createUpdatingResolver();try{const{initialFeature:t}=e,i=t.sourceLayer=t.layer,a=i?this.findEditorItemForLayer(i):void 0;if(null===a||void 0===a||!a.supportsCreateFeaturesWorkflow)throw new _.Z("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const n=this._createCreateFeaturesWorkflow({initialFeature:t,layer:a.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",n),await n.start()}catch(wt){this._logErrorAndCancelWorkflow(wt)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void kt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(m){this._logErrorAndCancelWorkflow(m)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void kt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,this._set("activeWorkflow",t),await t.start()}catch(wt){this._logErrorAndCancelWorkflow(wt)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await(0,l.whenOnce)((()=>!this.updating)),!this.canUpdate)return void kt("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.rootFeature=e,this._set("activeWorkflow",t),await t.start()}catch(wt){this._logErrorAndCancelWorkflow(wt)}finally{t.resolve()}}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveFeature():kt("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find((t=>t.layer===e))}itemHasInvalidFormTemplate(e){var t;return null!=e&&!0===(null===(t=this.findEditorItemForLayer(e.layer))||void 0===t?void 0:t.hasInvalidFormTemplate)}syncFeatureTemplates(){this._featureTemplatesViewModelLocked||(this.featureTemplatesViewModel.layers=this.featureTemplatesLayers.toArray())}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&"awaiting-feature-to-update"===this.state?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,(0,C.kB)((()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()}))}async _getEditorItemCandidates(e){var t,i;const{view:a}=this;if(null===a||void 0===a||!a.map)return[];const{map:n}=a,o=null!==(t=n.editableLayers.toArray())&&void 0!==t?t:[],r=null!==(i=n.allTables.toArray().filter(A.Te))&&void 0!==i?i:[];return await Promise.allSettled([...o.map((e=>"subtype-group"===e.type?e.loadAll():Promise.resolve())),...r.map((e=>e.load()))]),(0,s.k_)(e),[...o.reverse(),...r.reverse()].filter((e=>(0,I.K)(e)&&("mesh"!==e.geometryType||"3d"===a.type))).flatMap((e=>"subtype-group"===e.type?e.sublayers.toArray():e))}_drainEditorItems(){this.editorItems.drain((e=>e.destroy()))}async _updateEditorItems(){(0,r.IM)(this._updateItemsTask);const{view:e}=this,t=(0,y.vr)((async t=>{if(null===e||void 0===e||!e.map||null===e||void 0===e||!e.allLayerViews)return;const i=await this._getEditorItemCandidates(t);if(!i.length)return void this._drainEditorItems();const a=[],n=[],o=[],{layerInfos:r}=this;for(const l of i){const t=Ct(r,l),i=await me(e,l).catch((()=>null));(t?a:i?n:o).push(new mt({layer:l,layerInfo:t,layerView:i}))}(null===r||void 0===r?void 0:r.length)&&a.sort(((e,t)=>r.findIndex((t=>{let{layer:i}=t;return i===e.layer}))-r.findIndex((e=>{let{layer:i}=e;return i===t.layer}))));const s=[...a,...n,...o];t.aborted||(this._drainEditorItems(),this.editorItems.addMany(s))}));this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;"create-features"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdateVisible||"awaiting-update-feature-candidate"===t&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(t)return e&&!1===e.force?(await t.cancel(e),void this._set("activeWorkflow",null)):(this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e));(null===e||void 0===e?void 0:e.warnIfNoWorkflow)&&kt("editing:no-active-workflow","There is no active workflow to cancel.")}_createCreateFeaturesWorkflow(e,t){return We.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_createUpdateWorkflow(e){return ot.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(e,t,i)=>this._applyEdits(e,t,i),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_addAttachments(e,t){var i;const a=null!==(i=t.map((t=>this._addAttachment(e,t.feature,t.attachment))))&&void 0!==i?i:[];return Promise.all(a)}async _addAttachment(e,t,i){var a;let n=null;if(!("addAttachment"in e)||null==(null===(a=e.capabilities)||void 0===a?void 0:a.attachment))throw new _.Z("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation((async()=>{var a,o;return n=null!==(a=await(null===(o=e.addAttachment)||void 0===o?void 0:o.call(e,t,i).catch((e=>{throw(null===e||void 0===e?void 0:e.error)||e}))))&&void 0!==a?a:null,n})),n}async _applyEdits(e,t,i){let a=null;const n=e.url?await(0,A.oP)(e.url):null,o={returnServiceEditsOption:n&&(0,E.a5)(n)||RegExp("/hosted/","i").test(e.url)?void 0:"original-and-current-features",...i};return await this._queueOperation((async()=>{const{view:i}=this;if(!i)return null;const n=await me(i,e).catch((()=>null));return a=await e.applyEdits(t,o),n&&await(0,l.whenOnce)((()=>!n.updating)),a})),a}_queueOperation(e){this._activityQueue.push(e);const t=(e,t)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)};return e().then((e=>{if(null!=e&&"error"in e&&null!=e.error)throw e.error;if(null!=e&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:i,updateFeatureResults:a}=e,n=t.find((e=>!!e.error))||a.find((e=>!!e.error))||i.find((e=>!!e.error));if(n)throw n.error}return e})).catch((i=>{kt("editing:operation-error","An error occurred.",{error:i});const a={error:i,retry:()=>(t(a,this.failures),this._queueOperation(e)),cancel:()=>{t(a,this.failures)}};this._set("failures",[...this.failures,a])})).then((()=>{t(e,this._activityQueue)}))}_createUpdatingResolver(){const e=(0,s.hh)();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:i,details:a}=e;kt(null!==t&&void 0!==t?t:"editing:workflow-start-failed",null!==i&&void 0!==i?i:void 0,null!==a&&void 0!==a?a:e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return null!=t&&(!t.visible||t.disabled)}};(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"activeWorkflow",void 0),(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"_activityQueue",void 0),(0,a._)([(0,d.Cb)({value:[..._t]})],Mt.prototype,"allowedWorkflows",null),(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"canCreate",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"canCreateVisible",null),(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"canUpdate",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"canUpdateVisible",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"featureTemplatesLayers",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"editableItems",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"editorItems",void 0),(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"failures",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"hideTemplatesForInactiveLayers",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"attachmentsViewModel",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"featureFormViewModel",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"featureTemplatesViewModel",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"labelOptions",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"layerInfos",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"ownSketchViewModel",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"sketchOptions",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"sketchViewModel",null),(0,a._)([(0,d.Cb)({type:O.Z,nonNullable:!0})],Mt.prototype,"snappingOptions",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"spinnerViewModel",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"state",null),(0,a._)([(0,d.Cb)({readOnly:!0})],Mt.prototype,"syncing",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"updating",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"tooltipOptions",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"valueOptions",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"view",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"pageStack",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"showDiscardEditsPrompt",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"_candidateCommitted",void 0),(0,a._)([(0,d.Cb)()],Mt.prototype,"page",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"featureFormDisabled",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"canGoBack",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"shouldShowDeleteButton",null),(0,a._)([(0,d.Cb)()],Mt.prototype,"hasPendingEdits",null),Mt=(0,a._)([(0,c.j)(bt)],Mt);const Ft=Mt;var It=i(61631),At=i(48346);let Et=class extends D.default{constructor(e){super(e),this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.labelsToggle=!0,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new At.Z,this.tooltipsToggle=!0,this.undoRedoButtons=!1}};(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"createFeaturesSection",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"directionModePicker",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"editFeaturesSection",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"labelsToggle",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"settingsMenu",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"snappingControls",void 0),(0,a._)([(0,d.Cb)({type:At.Z,nonNullable:!0})],Et.prototype,"snappingControlsElements",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"tooltipsToggle",void 0),(0,a._)([(0,d.Cb)({type:Boolean,nonNullable:!0})],Et.prototype,"undoRedoButtons",void 0),Et=(0,a._)([(0,c.j)("esri.widgets.Editor.VisibleElements")],Et);const St=Et;var Wt=i(8905),Ot=i(80975),Vt=i(67005);const Pt="esri-editor__panel-content",Tt={base:Pt,message:"".concat(Pt,"__message"),section:"".concat(Pt,"__section"),sectionGroup:"".concat(Pt,"__section__group"),scrimContainer:"".concat(Pt,"__scrim-container")},Lt=()=>(0,Wt.h)({scrim:()=>Promise.all([i.e(92358),i.e(46895),i.e(99174)]).then(i.bind(i,99174))});function xt(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Vt.u)("div",{class:(0,Ot.Sh)(Tt.base,null!==e&&void 0!==e&&e.showScrimOverlay?Tt.scrimContainer:void 0),key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content"},...a,null!==e&&void 0!==e&&e.showScrimOverlay?(0,Vt.u)("calcite-scrim",null):void 0)}function Ut(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Vt.u)("div",{class:Tt.message,"data-testid":"panel-content-message",key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-message"},...a)}function Ht(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Vt.u)("div",{class:Tt.section,key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-section"},...a)}function Dt(e){for(var t,i=arguments.length,a=new Array(i>1?i-1:0),n=1;n<i;n++)a[n-1]=arguments[n];return(0,Vt.u)("div",{class:Tt.sectionGroup,key:null!==(t=null===e||void 0===e?void 0:e.key)&&void 0!==t?t:"panel-content-section-group"},...a)}function Zt(e){let{helpMessage:t}=e;return(0,Vt.u)(xt,{key:"creating-features-panel-content"},(0,Vt.u)(Ut,{key:"content-message"},t))}var Rt=i(63535);function zt(e){let{editorItems:t,filterText:i,id:a,messagesTemplates:n,onFilterTextChange:o,onSelectFeature:r,workflow:s}=e;const l=new Map,d=s.data.candidates;let c=0;d.map((e=>({label:Gt(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{let{label:a,data:n}=e;const o=i.toLowerCase(),{title:r}=n.layer,s=t.find((e=>e.layer===n.sourceLayer));return s?s.supportsUpdateWorkflow&&(!o||(null===a||void 0===a?void 0:a.toLowerCase().includes(o))||(null===r||void 0===r?void 0:r.toLowerCase().includes(o))):null})).filter(T.pC).forEach((e=>{var t,i;c++;const a=e.data.layer;l.has(a)?null===(t=l.get(a))||void 0===t||t.items.push(e):l.set(a,{id:"".concat(a.id),label:null!==(i=a.title)&&void 0!==i?i:"",items:[e]})}));const u=t.toArray().map((e=>{let{layer:t}=e;return l.get(t)})).filter(T.pC),p=c>10||i.length>0;return(0,Vt.u)(xt,{key:"feature-list"},(0,Vt.u)(Ht,null,(0,Rt.sr)({enableListScroll:!1,filterEnabled:p,filterText:i,id:a,items:u,messages:{filterPlaceholder:n.filterPlaceholder,noItems:n.noItems,noMatches:n.noMatches},onFilterChange:e=>o(e),onItemMouseEnter:e=>r(e.data),onItemMouseLeave:()=>r(null),onItemSelect:e=>r(e.data,!0)})))}function Gt(e){const t=e.layer;if(!t)return null;const i=t.fieldsIndex.get(t.objectIdField),a=i.alias||i.name,{attributes:n}=e,o=(0,B.O5)(t);return o&&n[o]&&"".concat(n[o])||"".concat(a,": ").concat(n[i.name])}const Bt={base:"esri-editor__actions"},Nt=()=>(0,Wt.h)({button:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(14105),i.e(32275)]).then(i.bind(i,32275))});function jt(e){let{buttons:t,key:i}=e;return(0,Vt.u)("div",{class:Bt.base,key:null!==i&&void 0!==i?i:"footer-actions",slot:"footer"},t.filter(T.pC).map(((e,t)=>{let{disabled:i,onClick:a,label:n,...o}=e;return(0,Vt.u)("calcite-button",{disabled:null!==i&&void 0!==i&&i,key:"action-".concat(t),onclick:()=>{i||a()},slot:"footer-actions",width:"full",...o},n)})))}const qt={notice:"esri-editor__notice"},Qt=()=>(0,Wt.h)({notice:()=>Promise.all([i.e(92358),i.e(46895),i.e(15669)]).then(i.bind(i,15669))});function Kt(e){let{workflow:t,messages:i}=e;return(0,Vt.u)(Vt.D,null,null!==t&&void 0!==t&&t.reliesOnOwnerAdminPrivileges?(0,Vt.u)(Jt,{message:i.ownerAdminNotice}):void 0,null!==t&&void 0!==t&&t.hasInvalidFormTemplate?(0,Vt.u)(Jt,{icon:It.t,message:i.formFieldUpdateError}):void 0)}function Jt(e){let{message:t,...i}=e;return(0,Vt.u)("calcite-notice",{class:qt.notice,open:!0,scale:"s",...i},(0,Vt.u)("div",{slot:"message"},t))}var Xt=i(70381),$t=i(29840);const Yt={settingsContainer:"esri-editor__settings"};function ei(e){var t;let{editorViewModel:i,messagesCommon:a,visibleElements:n}=e;const{snappingOptions:o,sketchOptions:r,view:s}=i,l=[],d={directionModePicker:n.directionModePicker,labelsToggle:n.labelsToggle,tooltipsToggle:n.tooltipsToggle};return(0,Ot.Mz)(d)&&l.push((0,Vt.u)(Xt.Z,{sketchOptions:r,viewType:null===s||void 0===s?void 0:s.type,visibleElements:d})),n.snappingControls&&l.push((0,Vt.u)($t.Z,{afterCreate:e=>e.layerListOpen=!1,snappingOptions:o,view:s,visibleElements:null!==(t=n.snappingControlsElements)&&void 0!==t?t:new At.Z})),0===l.length?null:(0,Vt.u)("calcite-accordion",{appearance:"transparent",class:Yt.settingsContainer,key:"settings"},(0,Vt.u)("calcite-accordion-item",{"data-testid":"settings",heading:a.settings,iconStart:"gear"},l))}const ti="esri-editor__panel-toolbar";function ii(e){let{editorViewModel:t,messagesCommon:i,visibleElements:a}=e;const{sketchViewModel:n}=t;return(0,Vt.u)("div",{class:ti,key:"panel-toolbar"},(0,Vt.u)(ei,{editorViewModel:t,messagesCommon:i,visibleElements:a}),a.undoRedoButtons?[(0,Vt.u)("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(null!==n&&void 0!==n&&n.canUndo()),iconStart:"undo",key:"undo-button",kind:"neutral",label:i.undo,onclick:()=>null===n||void 0===n?void 0:n.undo(),scale:"l"},i.undo),(0,Vt.u)("calcite-button",{alignment:"center",appearance:"transparent",disabled:!(null!==n&&void 0!==n&&n.canRedo()),iconStart:"redo",key:"redo-button",kind:"neutral",label:i.redo,onclick:()=>null===n||void 0===n?void 0:n.redo(),scale:"l"},i.redo)]:null)}var ai=i(8234),ni=i(8704),oi=i(96919);function ri(e){let{editorViewModel:t,headingLevel:i,messages:a,messagesCommon:n,onDelete:o,onSave:r,renderAttachments:s,renderFeatureForm:l}=e;const{activeWorkflow:d,featureFormViewModel:c,syncing:u}=t;if(!d||!c)return null;const p=d.type,h="activeWorkflow"in d?d.activeWorkflow:void 0,v=null===h||void 0===h?void 0:h.type,f=h&&!h.hasPendingEdits||"update"===p&&!d.hasPendingEdits||u||c.updating,w="update"===p&&"create-features"!==v?n.update:n.create,m="create-features"===p&&"create-new"===d.createFeatureState,g="create-features"===p?d.numPendingFeatures:0,y=g>1?(0,ni.n)(a.createFeaturesTemplate,{numFeatures:g}):w,b=d.shouldShowAttachments&&!c.activeRelationshipInput,_=c.inputs.every((e=>!e.visible))&&!b?(0,Vt.u)(Ut,{key:"panel-content-message"},(0,ni.n)(a.clickToFinishTemplate,{button:w})):(0,Vt.u)(Ht,{key:"panel-content-section"},(0,Vt.u)(Kt,{messages:a,workflow:d}),(0,Vt.u)(Dt,null,l(),b?(0,Vt.u)("div",{key:"attachments"},(0,Vt.u)(oi.X,{level:(0,oi.M)(i)},a.attachments),s()):null));return(0,Vt.u)(Vt.D,null,(0,Vt.u)(xt,{key:"attribute-panel-content",showScrimOverlay:m},_),(0,Vt.u)(jt,{buttons:[{onClick:r,disabled:f,label:y},t.shouldShowDeleteButton?{appearance:"outline",onClick:o,disabled:u,kind:"danger",label:n.delete}:void 0]}))}var si=i(25889);const li="esri-editor__upload-details",di={base:li,status:"".concat(li,"__status"),titleWrapper:"".concat(li,"__title-wrapper"),title:"".concat(li,"__title"),description:"".concat(li,"__description"),loader:"".concat(li,"__loader"),iconSuccess:"".concat(li,"__icon ").concat(li,"__icon--success"),iconError:"".concat(li,"__icon ").concat(li,"__icon--error"),fileList:"".concat(li,"__file-list"),file:"".concat(li,"__file"),fileIcon:"".concat(li,"__file-icon"),fileName:"".concat(li,"__file-name")};function ci(e){const{messages:t,key:i,upload:a}=e;return(0,Vt.u)(Vt.D,null,(0,Vt.u)(xt,{key:null!==i&&void 0!==i?i:"upload-details"},(0,Vt.u)(Ht,null,function(e){const t=function(e){let{helpMessage:t,messages:i,upload:a}=e;switch(a.state){case"pending":{const{title:e,description:t}=i.modelUploads.pending;return{title:e,description:t,iconContent:(0,Vt.u)("calcite-loader",{"aria-hidden":"true",class:di.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*a.progress),1===a.progress?100:99)})}}case"success":{const{title:e}=i.modelUploads.success;return{title:e,description:t||i.helpMessages3d.mesh,iconContent:(0,Vt.u)("calcite-icon",{class:(0,Ot.Sh)(di.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:e}=i.modelUploads.error;return{title:e,description:ui(a.error,i),iconContent:(0,Vt.u)("calcite-icon",{class:(0,Ot.Sh)(di.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}(e);return t?(0,Vt.u)("div",{class:di.base,"data-testid":"upload-details",key:"upload-details-content"},(0,Vt.u)("div",{class:di.status,key:"status"},t.iconContent,(0,Vt.u)("div",{class:di.titleWrapper,key:"text"},(0,Vt.u)("div",{class:di.title,key:"title"},t.title),(0,Vt.u)("div",{class:di.description,key:"description"},t.description))),function(e){return(0,Vt.u)("div",{class:di.fileList,key:"file-list"},e.files.map((e=>(0,Vt.u)("div",{class:di.file,key:"file-".concat(e.name)},(0,Vt.u)("calcite-icon",{class:di.fileIcon,icon:pi(e),scale:"s"}),(0,Vt.u)("span",{class:di.fileName},function(e){var t,i;return null!==(t=null===(i=e.split("/").pop())||void 0===i?void 0:i.split("\\").pop())&&void 0!==t?t:""}(e.name))))))}(e.upload)):null}(e))),"error"===a.state?(0,Vt.u)(jt,{buttons:[{onClick:()=>a.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function ui(e,t){if(!e)return null;const i=t.modelUploads.error.messages;switch(e.constructor){case si.Q_:return i.noModel;case si.i1:return i.multipleModels;case si.s8:return i.conversionFailed;default:return i.default}}function pi(e){var t,i;const a=null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase();return null!==(i=a?wi[a]:null)&&void 0!==i?i:hi}const hi="file",vi="file-shape",fi="file-image",wi={glb:vi,gltf:vi,jpeg:fi,jpg:fi,png:fi,svg:fi,zip:"file-zip"};var mi=i(7021),gi=i(80532),yi=i(28907);let bi=class extends w.Z{constructor(e,t){var i;super(e,t),i=this,this._featureForm=new h.default,this._attachments=new p.default({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new v.default({enableListScroll:!1,renderItemContentEnd:e=>e.supportsUpload?(0,Vt.u)("calcite-icon",{class:g.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:e=>e.label,renderCustomGroupContent:e=>this._renderCustomTemplateGroupContent(e)}),this._filterText="",this._prompt=null,this._spinner=new f.Z,this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new Ft,this.visibleElements=new St,this._renderSelectIcon=()=>(0,Vt.u)("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=function(e){let{heading:t,key:a}=e;const{visibleElements:n}=i;for(var o=arguments.length,r=new Array(o>1?o-1:0),s=1;s<o;s++)r[s-1]=arguments[s];return(0,Vt.u)("calcite-flow-item",{closable:!1,heading:t,headingLevel:i.headingLevel,key:a,loading:i._loading,onCalciteFlowItemBack:i._onBack},n.settingsMenu?(0,Vt.u)(ii,{editorViewModel:i.viewModel,messagesCommon:i.messagesCommon,visibleElements:n}):null,...r)},this._showDiscardEditsPrompt=()=>{var e;const{messages:t,activeWorkflow:i}=this;return"create-features"===(null===i||void 0===i?void 0:i.type)&&be(i.data.creationInfo)?this._showPromptAndWait("success"===(null===(e=i.data.upload)||void 0===e?void 0:e.state)?t.modelUploads.cancelPlacementPrompt:t.modelUploads.cancelUploadPrompt):this._showPromptAndWait({title:t.cancelEditTitle,message:t.cancelEditWarningMessage,yesLabel:t.discardEdits,noLabel:t.continueEditing})},this._showGenericCancelPrompt=()=>{const{messages:e,messagesCommon:t}=this;return this._showPromptAndWait({title:e.cancelRequestTitle,message:e.cancelRequestWarningMessage,yesLabel:t.form.yes,noLabel:t.form.no})},this._showPrompt=e=>{var t,i;null!==(t=this._prompt)&&void 0!==t&&null!==(i=t.cancel)&&void 0!==i&&i.call(t),this._prompt=e},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:e,messagesCommon:t}=this;this._showPrompt({title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:e.keepFeature,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=e=>(null!==e&&void 0!==e&&e.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var e;const{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type||"update"===t.type&&"create-features"===(null===(e=t.activeWorkflow)||void 0===e?void 0:e.type)?(this._attachments.addFile(),t.back()):this._attachments.addAttachment().then((()=>t.back())))},this._onAttachmentUpdate=()=>{const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.updateFile(),e.back()):this._attachments.updateAttachment().then((()=>e.back())))},this._onAttachmentDelete=()=>{const{messages:e,messagesCommon:t}=this;this._showPrompt({title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:e.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const e=this._attachments,{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type?e.deleteFile():(await e.deleteAttachment(e.viewModel.activeAttachmentInfo),this._clearPrompt()),await t.back(),this._clearPrompt())},this._onAttachmentsError=e=>{this._showPrompt({title:this.messages.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([(0,l.watch)((()=>(0,oi.M)(this.headingLevel)),(e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e}),l.initial),(0,l.on)((()=>this.viewModel.activeWorkflow),"cancel-request",(e=>{let{controller:t}=e;(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then((e=>e?t.allow():t.deny()))})),(0,l.when)((()=>this.viewModel.featureFormViewModel),(e=>{this._featureForm.viewModel=e}),l.initial),(0,l.watch)((()=>this.viewModel),(e=>{var t,i,a;this._attachments.viewModel=null!==(t=null===e||void 0===e?void 0:e.attachmentsViewModel)&&void 0!==t?t:null,this._featureTemplates.viewModel=null!==(i=null===e||void 0===e?void 0:e.featureTemplatesViewModel)&&void 0!==i?i:null,this._spinner.viewModel=null!==(a=null===e||void 0===e?void 0:e.spinnerViewModel)&&void 0!==a?a:null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt}),l.initial),(0,l.watch)((()=>this.view),((e,t)=>{const i="editor-".concat(this.id,"-spinner");null!==t&&void 0!==t&&t.ui.remove(this._spinner,i),null===e||void 0===e||e.ui.add(this._spinner,{key:i,position:"manual"})}),l.initial),(0,l.watch)((()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel]),(e=>{var t;let[i]=e;i&&(this._featureForm.set(i.featureForm),this._attachments.set(i.attachments),this._featureTemplates.set(i.featureTemplates),null===(t=this.viewModel.sketchViewModel)||void 0===t||t.set(i.sketch))}),l.initial),(0,l.when)((()=>{var e;return null===(e=this._attachments)||void 0===e?void 0:e.error}),(e=>this._onAttachmentsError(e))),(0,l.when)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.failures}),(e=>{const{messages:t}=this,[{error:i,retry:a,cancel:n}]=e;this._showPrompt({title:t.errorWarningTitle,message:(0,ni.n)(t.errorWarningMessageTemplate,{errorMessage:i.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{a(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{n(),this._clearPrompt()}}}})})),(0,l.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.state}),(e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}})),(0,l.watch)((()=>this.viewModel.featureFormDisabled),(e=>this._featureForm.disabled=e))])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([(0,Wt.h)({"flow-item":()=>Promise.all([i.e(92358),i.e(46895),i.e(89219),i.e(63839),i.e(65138),i.e(2654),i.e(23635),i.e(89524),i.e(48926)]).then(i.bind(i,48926)),flow:()=>i.e(53049).then(i.bind(i,53049)),icon:()=>Promise.all([i.e(92358),i.e(87474)]).then(i.bind(i,87474)),list:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(34504),i.e(8715),i.e(38782)]).then(i.bind(i,38782))}),Lt(),Lt(),Nt(),Qt(),Lt(),Promise.all([(0,Wt.h)({button:()=>Promise.all([i.e(92358),i.e(46895),i.e(54438),i.e(14105),i.e(32275)]).then(i.bind(i,32275))}),(0,Wt.h)({accordion:()=>i.e(56379).then(i.bind(i,56379)),"accordion-item":()=>Promise.all([i.e(92358),i.e(8865)]).then(i.bind(i,8865))})]),(0,ai.QC)(),Promise.all([Nt(),Qt(),Lt()]),Promise.all([(0,Wt.h)({icon:()=>Promise.all([i.e(92358),i.e(87474)]).then(i.bind(i,87474)),loader:()=>i.e(92382).then(i.bind(i,92382))}),Nt(),Lt()])])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){(0,n.Mr)(o.Z.getLogger(this),"allowedWorkflows",{replacement:"visibleElements",version:"4.29",warnOnce:!0}),this.viewModel.allowedWorkflows=e}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this,t=this.classes(g.base,mi.z.widget,mi.z.panel);return e?(0,Vt.u)("div",{class:t,key:"base"},(0,Vt.u)("calcite-flow",{key:"flow"},e.pageStack.map((e=>this._renderPage(e)))),this._prompt?(0,Vt.u)(ai.NL,{...this._prompt,headingLevel:this.headingLevel}):void 0):(0,Vt.u)("div",{class:t,key:"empty"})}_renderPage(e){switch(e){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return(0,Vt.u)("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:e,messages:t}=this;return(0,Vt.u)(e,{heading:t.selectTemplate,key:"templates-panel"},(0,Vt.u)(xt,{key:"feature-templates"},(0,Vt.u)(Ht,null,this._featureTemplates.render())))}_renderUploadDetails(){const{EditorPanel:e,activeWorkflow:t,messages:i}=this;if("create-features"!==(null===t||void 0===t?void 0:t.type))return null;const a=t.data.upload;return a?(0,Vt.u)(e,{heading:i.createFeatures,key:"upload-details-panel"},(0,Vt.u)(ci,{helpMessage:this._helpMessage,messages:i,upload:a})):null}_renderCreatingFeatures(){var e,t;const{EditorPanel:i,activeWorkflow:a,messages:n,messagesCommon:o,headingLevel:r,viewModel:s}=this;if(!a)return null;const l="create-features"===a.type&&a.numPendingFeatures>0||"update"===a.type&&"create-features"===(null===a||void 0===a||null===(e=a.activeWorkflow)||void 0===e?void 0:e.type)&&(null===(t=a.activeWorkflow)||void 0===t?void 0:t.numPendingFeatures)>0;return(0,Vt.u)(i,{heading:n.createFeatures,key:"create-features-panel"},l?(0,Vt.u)(ri,{editorViewModel:s,headingLevel:r,messages:n,messagesCommon:o,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}):(0,Vt.u)(Zt,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:e,messages:t,messagesCommon:i,headingLevel:a,viewModel:n}=this;return(0,Vt.u)(e,{heading:t.editFeature,key:"update-feature-panel"},(0,Vt.u)(ri,{editorViewModel:n,headingLevel:a,messages:t,messagesCommon:i,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:i}=this,a=(0,r.ei)(e.group.items,(e=>i.itemHasInvalidFormTemplate(e)?t.formFieldCreateError:void 0));return a?(0,Vt.u)(Jt,{icon:It.t,message:a}):null}_renderAttachmentAdding(){const{EditorPanel:e,_attachments:t,messages:i,messagesCommon:a}=this;return(0,Vt.u)(e,{heading:i.addAttachment,key:"attachment-adding-panel"},(0,Vt.u)(xt,{key:"attachments"},t.render()),(0,Vt.u)(jt,{buttons:[{label:t.submitting?a.cancel:a.add,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:e,_attachments:t,activeWorkflow:i,messages:a,messagesCommon:n}=this;return i?(0,Vt.u)(e,{heading:a.editAttachment,key:"attachment-editing-panel"},(0,Vt.u)(xt,{key:"attachments"},t.render()),i.shouldAllowAttachmentEditing?(0,Vt.u)(jt,{buttons:[{label:n.update,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:t.submitting,label:n.delete}]}):void 0):null}_renderReady(){const{EditorPanel:e,messages:t,viewModel:i,visibleElements:a}=this,n=this._helpMessage;return(0,Vt.u)(e,{heading:t.widgetLabel,key:"landing-panel"},(0,Vt.u)(xt,{key:"landing-content"},i.editorItems.length?[a.editFeaturesSection?(0,Vt.u)(Ht,{key:"edit-actions"},this._renderUpdateActions()):null,a.createFeaturesSection&&i.canCreateVisible?(0,Vt.u)(Ht,{key:"create-actions"},this._renderCreateActions()):null]:(0,Vt.u)(Ut,{key:"no-content"},t.noEditableLayers)),n?(0,Vt.u)("div",{class:g.helpMessage,key:"footer-actions",slot:"footer"},n):void 0)}get _helpMessage(){var e;const{activeWorkflow:t,messages:i,view:a}=this,n=null===t||void 0===t?void 0:t.helpMessage;return n?null===(e=i["3d"===(null===a||void 0===a?void 0:a.type)?"helpMessages3d":"helpMessages2d"])||void 0===e?void 0:e[n]:void 0}_renderUpdateActions(){var e;const{messages:t,messagesCommon:i,viewModel:a}=this,n={id:"select",label:i.select};return(0,Vt.u)("div",{class:g.updateActions,key:"update-actions"},(0,Vt.u)(oi.X,{level:(0,oi.M)(this.headingLevel)},t.editFeatures),(0,Vt.u)("calcite-list",{class:g.updateActionsList,selectionAppearance:"border",selectionMode:"single"},(0,Rt.x1)({disabled:!a.canUpdateVisible,grouped:!1,item:n,selectedItem:"awaiting-feature-to-update"===(null===(e=a.activeWorkflow)||void 0===e?void 0:e.stepId)?n:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return(0,Vt.u)("div",{key:"create-actions"},(0,Vt.u)(oi.X,{level:(0,oi.M)(this.headingLevel)},this.messages.createFeatures),(0,Vt.u)("div",{class:g.featureTemplatesContainer,key:"templates"},this._featureTemplates.render()))}_renderFeatureList(){const{EditorPanel:e,viewModel:t}=this,{activeWorkflow:i}=t;if("update"!==(null===i||void 0===i?void 0:i.type))return null;const a=i.data.candidates,n=(0,ni.n)(this.messages.multipleFeaturesTemplate,{total:a.length});return(0,Vt.u)(e,{heading:n,key:"feature-list"},(0,Vt.u)(zt,{editorItems:t.editorItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:e=>this._filterText=e,onSelectFeature:(e,i)=>t.selectFeature(e,i)}))}_showPromptAndWait(e){let{title:t,message:i,yesLabel:a,noLabel:n}=e;const o=(0,s.hh)(),{view:r}=this,l=null===r||void 0===r?void 0:r.focused;return this._showPrompt({title:t,message:i,context:"danger",actions:{primary:{label:a,action:()=>o.resolve(!0)},secondary:{label:n,action:()=>o.resolve(!1)}}}),o.promise.finally((()=>{this._clearPrompt(),l&&(null===r||void 0===r||r.focus())}))}};(0,a._)([(0,d.Cb)()],bi.prototype,"_featureForm",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_attachments",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_featureTemplates",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_filterText",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_prompt",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_spinner",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_deleteButtonCommonInfo",null),(0,a._)([(0,d.Cb)()],bi.prototype,"_loading",null),(0,a._)([(0,d.Cb)({readOnly:!0})],bi.prototype,"activeWorkflow",null),(0,a._)([(0,d.Cb)()],bi.prototype,"allowedWorkflows",null),(0,a._)([(0,d.Cb)()],bi.prototype,"headingLevel",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"hideTemplatesForInactiveLayers",null),(0,a._)([(0,d.Cb)()],bi.prototype,"icon",null),(0,a._)([(0,d.Cb)()],bi.prototype,"label",null),(0,a._)([(0,d.Cb)()],bi.prototype,"labelOptions",null),(0,a._)([(0,d.Cb)()],bi.prototype,"layerInfos",null),(0,a._)([(0,d.Cb)(),(0,gi.H)("esri/widgets/Editor/t9n/Editor")],bi.prototype,"messages",void 0),(0,a._)([(0,d.Cb)(),(0,gi.H)("esri/t9n/common")],bi.prototype,"messagesCommon",void 0),(0,a._)([(0,d.Cb)(),(0,gi.H)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],bi.prototype,"messagesTemplates",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"snappingOptions",null),(0,a._)([(0,d.Cb)()],bi.prototype,"tooltipOptions",null),(0,a._)([(0,d.Cb)()],bi.prototype,"supportingWidgetDefaults",void 0),(0,a._)([(0,d.Cb)({type:u.Z,nonNullable:!0})],bi.prototype,"valueOptions",null),(0,a._)([(0,d.Cb)()],bi.prototype,"view",null),(0,a._)([(0,d.Cb)(),(0,yi.s)(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],bi.prototype,"viewModel",void 0),(0,a._)([(0,d.Cb)({type:St,nonNullable:!0})],bi.prototype,"visibleElements",void 0),(0,a._)([(0,d.Cb)()],bi.prototype,"_helpMessage",null),bi=(0,a._)([(0,c.j)("esri.widgets.Editor")],bi);const _i=bi},45966:(e,t,i)=>{i.d(t,{Z:()=>w});var a=i(27366),n=i(66978),o=i(94172),r=i(49861),s=(i(93169),i(32718),i(84936),i(69912)),l=i(33565),d=i(67354),c=(i(80975),i(67005));const u="esri-spinner",p=u,h="".concat(u,"--start"),v="".concat(u,"--finish");let f=class extends l.Z{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new d.Z}initialize(){this.addHandles((0,o.watch)((()=>this.visible),(e=>this._visibleChange(e))))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:i}=null!==e&&void 0!==e?e:{};t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,a={[h]:e&&i,[v]:!e&&i},n=this._getPositionStyles();return(0,c.u)("div",{class:this.classes(p,a),styles:n})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,n.e4)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(null==t||null==e)return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,a._)([(0,r.Cb)()],f.prototype,"location",null),(0,a._)([(0,r.Cb)()],f.prototype,"view",null),(0,a._)([(0,r.Cb)({type:d.Z})],f.prototype,"viewModel",void 0),(0,a._)([(0,r.Cb)()],f.prototype,"visible",null),f=(0,a._)([(0,s.j)("esri.widgets.Spinner")],f);const w=f},67354:(e,t,i)=>{i.d(t,{Z:()=>l});var a=i(27366),n=i(49861),o=(i(93169),i(32718),i(84936),i(69912)),r=i(70407);let s=class extends r.Z{constructor(e){super(e),this.visible=!1}};(0,a._)([(0,n.Cb)()],s.prototype,"visible",void 0),s=(0,a._)([(0,o.j)("esri.widgets.Spinner.SpinnerViewModel")],s);const l=s},70407:(e,t,i)=>{i.d(t,{Z:()=>c});var a=i(27366),n=i(91505),o=i(94172),r=i(49861),s=(i(93169),i(32718),i(84936),i(69912)),l=i(79803);let d=class extends n.Z.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([(0,o.when)((()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(()=>this.notifyChange("screenLocation"))),(0,o.watch)((()=>this.screenLocation),((e,t)=>{null!=e&&null!=t&&this.emit("view-change")}))])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,a=null===t||void 0===t?void 0:t.spatialReference,n=a?(0,l.projectOrLoad)(e,a).geometry:null;return i&&n&&null!==t&&void 0!==t&&t.ready?t.toScreen(n):null}};(0,a._)([(0,r.Cb)()],d.prototype,"location",void 0),(0,a._)([(0,r.Cb)()],d.prototype,"screenLocation",null),(0,a._)([(0,r.Cb)()],d.prototype,"screenLocationEnabled",void 0),(0,a._)([(0,r.Cb)()],d.prototype,"view",void 0),d=(0,a._)([(0,s.j)("esri.widgets.support.AnchorElementViewModel")],d);const c=d}}]);
//# sourceMappingURL=90856.fb202ff7.chunk.js.map