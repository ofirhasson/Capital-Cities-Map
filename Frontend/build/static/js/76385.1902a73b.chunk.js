"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[76385,55515],{55515:(e,t,n)=>{n.r(t),n.d(t,{createArcadeExecutor:()=>E,createArcadeProfile:()=>I});var i=n(52639),s=n(51064),o=n(97246),a=n(10064),l=n(84652),r=n(84726),u=n(58237),d=n(64326),c=n(7575),p=n(49818),h=n(819);let m=null;function f(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=t.elementType,a="value",l="array"===s.type?[{name:a,type:s.type,elementType:s.elementType}]:"dictionary"===s.type?[{name:a,type:s.type,properties:s.properties}]:[{name:a,type:s.type}];return new o.Z(e.map((e=>{const t={};return _(t,l,{[a]:e},n,i),t[a]})))}function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e instanceof p.Z?new d.default({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return t.constructFeatureSet(i,n.spatialReference,null,!0,n.lruCache,n.interceptor)}function v(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{spatialReference:i,interceptor:s,lruCache:o}=n;return"string"==typeof e?t.createFeatureSetCollectionFromService(e,i,o,s):t.createFeatureSetCollectionFromMap(e,i,o,s)}function g(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s={};return _(s,t.properties,e,n,i),new m.Dictionary(s)}function _(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a={};for(const s of Object.keys(n))a[s.toLowerCase()]=n[s];for(const l of t){const t=l.name.toLowerCase();if(o.variablesPreProcessed)e[t]=a[t];else switch(l.type){case"array":{const n=a[t];e[t]=null==n?null:f(n,l,i,o);break}case"feature":{const n=a[t];e[t]=null==n?null:m.Feature.createFromGraphic(n,null===o||void 0===o?void 0:o.timeZone);break}case"featureSet":{const n=a[t];e[t]=null==n?null:i?y(n,i,o):null;break}case"featureSetCollection":{const n=a[t];e[t]=null==n?null:i?v(n,i,o):null;break}case"dictionary":{const n=a[t];e[t]=null==n?null:g(n,l,i,o);break}case"date":{const n=a[t];e[t]=n?n instanceof s.iG?n:null!==o&&void 0!==o&&o.timeZone?s.iG.dateJSAndZoneToArcadeDate(n,null===o||void 0===o?void 0:o.timeZone):s.iG.dateJSToArcadeDate(n):null;break}case"dateOnly":{const n=a[t];e[t]=n?n instanceof r.u?n:r.u.fromReader(n):null;break}case"time":{const n=a[t];e[t]=n?n instanceof u.n?n:u.n.fromReader(n):null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[t]=a[t]}}}function b(e,t){for(const n of e)t.push(n),"dictionary"===n.type&&b(n.properties,t);return t}function C(e,t,n,i,s){const{spatialReference:o,interceptor:a,lruCache:l,console:r,abortSignal:u,timeZone:d,services:p={portal:c.Z.getDefault()}}=n,h={vars:{},spatialReference:o,interceptor:a,timeZone:d,lrucache:l,useAsync:s,services:p,console:r,abortSignal:u};return t?(_(h.vars,e.variables,t,i,n),h):h}function x(e,t){switch(t.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{const t=(e.type,e),n="geometry"in t?t.geometry():null,s="readAttributes"in t?t.readAttributes():t.attributes;return new i.Z({geometry:n,attributes:s})}case"dictionary":{const n=e,i=n.attributes,s={};for(const e of Object.keys(i))s[e]=x(n.field(e),t);return s}case"array":return("toArray"in e?e.toArray():e).map((e=>x(e,t)))}return e}const w={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"}]},F={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},V=new Map([["aggregate-field",{variables:[{name:"$feature",type:"feature"}]}],["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",w],["popup-element",w],["feature-reduction-popup",F],["feature-reduction-popup-element",F],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function I(e){const t=V.get(e);if(!t){const t=Array.from(V.keys()).map((e=>"'".concat(e,"'"))).join(", ");throw new a.Z("createArcadeProfile:invalid-profile-name","Invalid profile name '".concat(e,"'. You must specify one of the following values: ").concat(t))}return(0,l.d9)(t)}async function E(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};m||(m=await(0,h.LC)());const{arcade:i,arcadeUtils:s}=m,{loadScriptDependencies:o,referencesMember:l,scriptIsAsync:r}=i,u=b(t.variables,[]),d=u.filter((e=>"featureSet"===e.type||"featureSetCollection"===e.type)).map((e=>e.name.toLowerCase())),c=i.parseScript(e,d);if(!c)throw new a.Z("arcade:invalid-script","Unable to create SyntaxTree");const p=s.extractFieldNames(c),f=i.scriptTouchesGeometry(c),y=u.map((e=>e.name.toLowerCase())).filter((e=>l(c,e))),v=r(c,d);await o(c,v,d);const g={vars:{},spatialReference:null,useAsync:v};for(const a of y)g.vars[a]="any";const{lruCache:_}=n,w=i.compileScript(c,g),F=i.featureSetUtils(),{services:V}=n;return{execute:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(v)throw new a.Z("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const i=w(C(t,e,{lruCache:_,...n},F,v));return n.rawOutput?i:x(i,s)},executeAsync:async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=await w(C(t,e,{lruCache:_,services:V,...n},F,v));return n.rawOutput?i:x(i,s)},isAsync:v,variablesUsed:y,fieldsUsed:p,geometryUsed:f,syntaxTree:c}}},97246:(e,t,n)=>{n.d(t,{Z:()=>i});class i{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){return this.slice()}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length();const n=[];for(let i=e;i<t;i++)n.push(this.get(i));return n}}},2622:(e,t,n)=>{n.d(t,{Z:()=>o});var i=n(39052),s=n(56885);class o{constructor(e){this._observable=new s.s,this._set=new Set(e)}get size(){return(0,i.it)(this._observable),this._set.size}add(e){const t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const t=this._set.delete(e);return t&&this._observable.notify(),t}entries(){return(0,i.it)(this._observable),this._set.entries()}forEach(e,t){(0,i.it)(this._observable),this._set.forEach(((n,i)=>e.call(t,n,i,this)),t)}has(e){return(0,i.it)(this._observable),this._set.has(e)}keys(){return(0,i.it)(this._observable),this._set.keys()}values(){return(0,i.it)(this._observable),this._set.values()}[Symbol.iterator](){return(0,i.it)(this._observable),this._set[Symbol.iterator]()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}},8234:(e,t,n)=>{n.d(t,{NL:()=>d,QC:()=>u});var i=n(61631),s=n(8905),o=n(96919),a=(n(80975),n(67005));const l="esri-editor__prompt",r={base:l,header:"".concat(l,"__header"),heading:"".concat(l,"__header__heading"),message:"".concat(l,"__message"),divider:"".concat(l,"__divider"),actions:"".concat(l,"__actions")},u=()=>(0,s.h)({button:()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(14105),n.e(32275)]).then(n.bind(n,32275)),icon:()=>Promise.all([n.e(92358),n.e(87474)]).then(n.bind(n,87474)),scrim:()=>Promise.all([n.e(92358),n.e(46895),n.e(99174)]).then(n.bind(n,99174)),label:()=>Promise.all([n.e(92358),n.e(35738)]).then(n.bind(n,35738)),"radio-button":()=>Promise.all([n.e(92358),n.e(54438),n.e(29033)]).then(n.bind(n,29033)),"radio-button-group":()=>Promise.all([n.e(92358),n.e(4508)]).then(n.bind(n,4508))});function d(e){var t;let{actions:n,context:s,headingLevel:l,message:u,title:d,...p}=e;const{primary:h,secondary:m}=n;let f;switch(s){case"danger":f="danger";break;case"info":f="brand";break;default:f="neutral"}const y=(0,a.u)("calcite-button",{afterCreate:c,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:f,onclick:h.action,width:m?"half":"full"},h.label),v=m&&(0,a.u)("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:f,onclick:m.action,width:"half"},m.label);return(0,a.u)("calcite-scrim",{"data-testid":"prompt",key:"prompt"},(0,a.u)("div",{class:"".concat(r.base,"--").concat(s)},(0,a.u)("div",{class:r.header},(0,a.u)("calcite-icon",{icon:i.t}),(0,a.u)(o.X,{class:r.heading,level:l},d)),(0,a.u)("div",{class:r.message},u),null!==(t=function(e){let{radios:t,onRadioSelection:n,defaultRadioSelection:i}=e;return null!==t&&void 0!==t&&t.length?(0,a.u)("calcite-radio-button-group",{name:"PromptChoiceList"},t.map((e=>(0,a.u)("calcite-label",{layout:"inline"},(0,a.u)("calcite-radio-button",{checked:e.value===i,value:e.value,onCalciteRadioButtonChange:()=>null===n||void 0===n?void 0:n(e.value)}),e.label)))):void 0}(p))&&void 0!==t?t:(0,a.u)("div",{class:r.divider}),(0,a.u)("div",{class:r.actions},v,y)))}function c(e){requestAnimationFrame((()=>e.setFocus()))}},61631:(e,t,n)=>{n.d(t,{t:()=>i});const i="exclamation-mark-triangle"},76385:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var i=n(27366),s=(n(59166),n(63780)),o=(n(93169),n(32718)),a=n(66978),l=n(94172),r=n(49861),u=n(69912),d=n(37270),c=n(33565),p=n(8234);const h="esri-feature-form",m="".concat(h,"__group"),f="".concat(h,"__input"),y="".concat(h,"__related-records"),v={base:h,form:"".concat(h,"__form"),formHeader:"".concat(h,"__form-header"),label:"".concat(h,"__label"),labelTextContent:"".concat(h,"__label-text-content"),fieldInput:"".concat(f),inputRadio:"".concat(f,"--radio"),inputRadioGroup:"".concat(f,"--radio-group"),inputRadioLabel:"".concat(f,"--radio-label"),inputDisabled:"".concat(f,"--disabled"),inputSwitch:"".concat(f,"--switch"),centeredButton:"".concat(h,"__centered-button"),description:"".concat(h,"__description-text"),listObserver:"".concat(h,"__list-observer"),relatedRecordsHeader:"".concat(y,"_header"),relatedRecordsLabel:"".concat(y,"_label"),relatedRecordsList:"".concat(y,"_list"),dateInputContainer:"".concat("".concat(h,"__date"),"-input-container"),textElement:"".concat(h,"__text-element"),group:m,groupSequential:"".concat(m,"--sequential"),groupActive:"".concat(m,"--active")};var g=n(73238),_=n(16458),b=n(8905),C=n(36496),x=n(83651),w=n(7021),F=n(96919),V=(n(80975),n(80532)),I=n(28907),E=n(67005),R=n(8704);const T="data-field-name";let k=class extends c.Z{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver((e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()}),{root:window.document}),this._prompt=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new _.Z,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,relatedRecordCallbacks:n}=this;t&&(null===n||void 0===n?void 0:n.showAllRelatedRecords)&&n.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t)=>{const{feature:n,relatedRecordCallbacks:i}=this;n&&(null===i||void 0===i?void 0:i.addRelatedRecord)&&i.addRelatedRecord({parentFeature:n,relatedLayer:t,relationshipId:e})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([(0,l.watch)((()=>this.feature),(()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),(0,l.whenOnce)((()=>!this.viewModel.updating)).then((()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=(null===e||void 0===e?void 0:e.name)||null,this._attemptFocusOnNextRender=!0}))})),(0,l.watch)((()=>this.groupDisplay),(()=>this._syncGroupInputStates())),this.on("submit",(e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach((e=>this._inputsWithChanges.add(e))),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}})),(0,l.watch)((()=>[this.viewModel.activeRelationshipInput,this._listObserverNode]),(()=>this._onObserverChange()))])}loadDependencies(){return(0,b.h)({block:()=>Promise.all([n.e(92358),n.e(46895),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(23635),n.e(4758)]).then(n.bind(n,4758)),button:()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(14105),n.e(32275)]).then(n.bind(n,32275)),combobox:()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(1579),n.e(34504),n.e(63017),n.e(70419)]).then(n.bind(n,70419)),"combobox-item":()=>Promise.all([n.e(92358),n.e(15862)]).then(n.bind(n,15862)),"combobox-item-group":()=>Promise.all([n.e(92358),n.e(85660)]).then(n.bind(n,85660)),icon:()=>Promise.all([n.e(92358),n.e(87474)]).then(n.bind(n,87474)),input:()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(8715),n.e(16746)]).then(n.bind(n,75655)),"input-date-picker":()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(63839),n.e(96506),n.e(11216)]).then(n.bind(n,11216)),"input-message":()=>Promise.all([n.e(92358),n.e(64058)]).then(n.bind(n,64058)),"input-number":()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(18135),n.e(77244)]).then(n.bind(n,90460)),"input-time-picker":()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(96506),n.e(39094)]).then(n.bind(n,39094)),"input-time-zone":()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(1579),n.e(34504),n.e(63017),n.e(96734)]).then(n.bind(n,96734)),label:()=>Promise.all([n.e(92358),n.e(35738)]).then(n.bind(n,35738)),list:()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(34504),n.e(8715),n.e(38782)]).then(n.bind(n,38782)),"list-item":()=>Promise.all([n.e(92358),n.e(46895),n.e(65138),n.e(21340)]).then(n.bind(n,67994)),loader:()=>n.e(92382).then(n.bind(n,92382)),notice:()=>Promise.all([n.e(92358),n.e(46895),n.e(15669)]).then(n.bind(n,15669)),"radio-button":()=>Promise.all([n.e(92358),n.e(54438),n.e(29033)]).then(n.bind(n,29033)),"radio-button-group":()=>Promise.all([n.e(92358),n.e(4508)]).then(n.bind(n,4508)),switch:()=>Promise.all([n.e(92358),n.e(54438),n.e(40206)]).then(n.bind(n,40206)),"text-area":()=>Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(36127)]).then(n.bind(n,36127))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{var t,n;null!==(t=this._prompt)&&void 0!==t&&null!==(n=t.cancel)&&void 0!==n&&n.call(t),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return(0,E.u)("div",{class:this.classes(v.base,w.z.widget,w.z.panel)},"ready"===e?this._renderForm():null)}_renderForm(){return(0,E.u)("div",null,(0,E.u)("form",{class:v.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?(0,E.u)(p.NL,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=null!=e.formTitle&&(0,E.u)(F.X,{key:"title",level:this.headingLevel},e.formTitle),n=null!=e.formDescription&&(0,E.u)("p",{class:v.description,key:"description"},e.formDescription);return(0,E.u)("div",{class:v.formHeader},t,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.inputs.filter(s.pC).filter((e=>e.visible)).map((e=>this._renderInput(e)))}_renderInput(e){return(0,g.ib)(e)?this._renderGroup(e):(0,g.Vs)(e)?this._renderLabeledField(e):(0,g.V7)(e)?this._renderRelationshipInput(e):(0,g.Wh)(e)?this._renderTextElementInput(e):void 0}_renderDescriptionOrEmpty(e,t){return null==e?null:(0,E.u)("div",{class:this.classes(v.description),id:t},e)}_renderGroup(e){const{disabled:t,formTemplate:n,headingLevel:i}=this,{description:s,id:o,inputs:a,label:l,open:r}=e,u=a.filter((e=>e.visible)),d=this.viewModel.findField(this._focusedFieldName),c=(null===d||void 0===d?void 0:d.group)===e,p="sequential"===this.groupDisplay;return(0,E.u)("calcite-block",{class:this.classes(v.group,p?v.groupSequential:null,c?v.groupActive:null,t?v.inputDisabled:null),collapsible:!0,"data-group":e,description:s||void 0,disabled:t,heading:"".concat(l),headingLevel:null!==n&&void 0!==n&&n.title?(0,F.M)(i):i,id:o,key:o,open:r,onCalciteBlockToggle:t=>{let{target:n}=t;return this._onGroupToggle(n,e)}},u.map((e=>this._renderInput(e))))}_getFocusableInput(e,t){const n=(0,g.Li)(this.viewModel.inputs);let i;if("backward"===e&&n.reverse(),t)if((0,g.ib)(t)){const e=t.inputs.find((e=>e.visible));i=e?n.indexOf(e):0}else{let s;if((0,g._n)(t)&&!t.group.open){const n=t.group.inputs.filter(g.Vs);s="forward"===e?n[n.length-1]:n[0]}else s=t;i=n.indexOf(s)+1}else i=0;for(let s=i;s<n.length;s++){const e=n[s];if(e.visible&&(0,g.Vs)(e))return e}return null}_renderLabeledField(e){var t;const{dataType:n,feature:i,label:s,layer:o,required:a}=e,l={"aria-label":a?(0,R.n)(this.messages.requiredFieldLabel,{name:s}):s,class:v.label,key:"".concat(o.id,"-").concat(i.uid,"-").concat(e.name)},r=[(0,E.u)("div",{class:v.labelTextContent,key:"labelTextContainer"},s,a?(0,E.u)("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==n?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===n&&"coded-value"!==(null===(t=e.domain)||void 0===t?void 0:t.type)?(0,E.u)("label",{...l},r):(0,E.u)("calcite-label",{...l},r)}_renderFieldInput(e){const{dataType:t,domain:n,inputType:i,name:s}=e,o=this.getCommonInputProps(e);if("coded-value"===(null===n||void 0===n?void 0:n.type)){const t=this.viewModel.getFieldValueOptionsForField(s,this.messages.empty);return"switch"!==i||e.hasInvalidSwitchValue?"radio-buttons"===i?this._renderRadioButtonComponents(e,t.flat(),o):this._renderComboBoxComponent(e,t,o):this._renderSwitchComponent(e,o)}return"datetime-picker"===i||"date"===t?this._renderDateComponents(e,o):"number"===t?this._renderNumberComponent(e,o):this._renderStringComponent(e,o)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?(0,E.u)("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)}):(0,E.u)("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.target)}):(0,E.u)("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.target)})}_renderNumberComponent(e,t){return(0,E.u)("calcite-input-number",{...t,integer:(0,d.Vo)(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.target)})}_renderDateComponents(e,t){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,(0,x.sx)(n,t.value,{timeZone:this.timeZone,...(0,x.fu)(n)}))}}_renderDateOnlyFieldComponent(e,t){const{range:n,valid:i,value:s}=e,{class:o,key:a,readOnly:l}=t,{rawMax:r,rawMin:u}=n;return(0,E.u)("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:o,"data-date-part":"date","data-field-name":t[T],key:"".concat(a,"-date-input"),max:(0,C.H)(r)?r:void 0,min:(0,C.H)(u)?u:void 0,numberingSystem:x.T2,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:l,value:null!=s?"".concat(s):void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:n,value:i}=e,{class:s,key:o,readOnly:a}=t;return(0,E.u)("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:s,"data-date-part":"time","data-field-name":t[T],key:"".concat(o,"-time-input"),numberingSystem:x.T2,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,step:e.timeStep,value:null!=i?"".concat(i):void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)})}_renderTimestampOffsetFieldComponents(e,t){var n,i,s,o,a;const{name:l,range:r,timeZone:u,valid:d,value:c}=e,{class:p,key:h,readOnly:m}=t,{rawMax:f,rawMin:y}=r,g={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!d,numberingSystem:x.T2,overlayPositioning:"fixed",readOnly:m,[T]:l,onfocus:this._onComponentFocus},_=(0,x.HB)(f,u),b=(0,x.HB)(y,u),C=(0,x.HB)(c,u);return(0,E.u)("div",{class:v.dateInputContainer,key:"".concat(h,"-date-time-container")},(0,E.u)("calcite-input-date-picker",{...g,class:p,"data-date-part":"date",key:"".concat(h,"-date-input"),max:null!==(n=null===_||void 0===_?void 0:_.date)&&void 0!==n?n:void 0,min:null!==(i=null===b||void 0===b?void 0:b.date)&&void 0!==i?i:void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(s=C.date)&&void 0!==s?s:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),(0,E.u)("calcite-input-time-picker",{...g,class:p,"data-date-part":"time",key:"".concat(h,"-time-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:null!==(o=C.time)&&void 0!==o?o:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}),e.includeTimeOffset?(0,E.u)("calcite-input-time-zone",{...g,class:p,"data-date-part":"timeZone",disabled:m,key:"".concat(h,"-timezone-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(a=C.timeZoneOffset)&&void 0!==a?a:"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderDateFieldComponents(e,t){var n,i,s,o;const{includeTime:a,name:l,valid:r,value:u}=e,{class:d,key:c,max:p,min:h,readOnly:m}=t,{timeZone:f}=this,y={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,numberingSystem:x.T2,overlayPositioning:"fixed",readOnly:m,[T]:l,onfocus:this._onComponentFocus},g=(0,x.w5)(u,f),_=(0,x.w5)(p,f),b=(0,x.w5)(h,f);return(0,E.u)("div",{class:v.dateInputContainer,key:"".concat(c,"-date-time-container")},(0,E.u)("calcite-input-date-picker",{...y,class:d,"data-date-part":"date",key:"".concat(c,"-date-input"),max:null!==(n=null===_||void 0===_?void 0:_.date)&&void 0!==n?n:void 0,min:null!==(i=null===b||void 0===b?void 0:b.date)&&void 0!==i?i:void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:null!==(s=g.date)&&void 0!==s?s:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.target)}),a?(0,E.u)("calcite-input-time-picker",{...y,class:d,"data-date-part":"time",key:"".concat(c,"-time-input"),onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:null!==(o=g.time)&&void 0!==o?o:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.target)}):null)}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return(0,E.u)("calcite-input",{...n,class:this.classes(v.fieldInput,v.inputDisabled),readOnly:!0,type:"text",value:null!=t?"".concat(t):n.value})}_renderComboBoxComponent(e,t,n){const{value:i,name:s}=e,{viewModel:o,_inputsWithChanges:a}=this,l="INSERT"===o.arcadeEditType,r=a.has(s),u=null==i&&(!l||r),d=l&&e.showNoValueOptionEnabled&&!r?()=>{}:n.onblur;return(0,E.u)("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:d,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:t=>{let{target:n}=t;u&&0===n.selectedItems.length?this._ignoreDeselectionOfNoValueOption(n):e.isSubtypeField&&0===n.selectedItems.length?n.value="".concat(e.value):this._saveValueFromComponent(n)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:n,name:i}=e,{messages:s,messagesTemplates:o,viewModel:a,_inputsWithChanges:l}=this,[r,u,d]=t.map((e=>e.map((e=>{let{name:t,value:i}=e;return(0,E.u)("calcite-combobox-item",{key:"#".concat(i),selected:n===i,textLabel:t,value:"".concat(i)})})))),c=[];u.length>0&&c.push((0,E.u)("calcite-combobox-item-group",{key:"other",label:o.other},u)),d.length>0&&c.push((0,E.u)("calcite-combobox-item-group",{key:"unsupported",label:s.subtypes.unsupportedDomainGroupTitle},d)),c.length>0?c.unshift((0,E.u)("calcite-combobox-item-group",{key:"recommended",label:s.recommended},r)):c.push(...r);const p="INSERT"===a.arcadeEditType,h=l.has(i),m=null==n&&(!p||h);return e.showNoValueOptionEnabled&&c.unshift((0,E.u)("calcite-combobox-item",{key:"empty-option",selected:m,textLabel:e.showNoValueLabel||s.empty,value:""})),c}_renderRadioButtonComponents(e,t,n){const{name:i,value:s}=e,o=t.map((e=>{let{name:t,value:o}=e;return this._renderRadioButtonComponent({key:t,label:t,name:i,value:o,selected:o===s,props:n})}));if(e.showNoValueOptionEnabled){const t="",a=e.showNoValueLabel||this.messages.empty,l=s===t||null===s;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:a,name:i,value:t,selected:l,props:n}))}return(0,E.u)("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:v.inputRadioGroup,"data-field-name":n[T],key:"".concat(n.key,"-radio-group"),layout:"vertical",name:n.key,required:n.required},o)}_renderSwitchComponent(e,t){const{value:n}=e,i=!!(0,g.I6)(e.element,"switch")&&n===e.element.input.onValue;return(0,E.u)("calcite-switch",{...t,checked:i,class:v.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.target)})}_renderRadioButtonComponent(e){let{key:t,name:n,value:i,selected:s,label:o,props:a}=e;return(0,E.u)("calcite-label",{class:v.inputRadioLabel,key:t,layout:"inline"},(0,E.u)("calcite-radio-button",{...a,afterCreate:void 0,afterUpdate:void 0,checked:s,class:v.inputRadio,disabled:a.readOnly,name:n,onblur:()=>{this._focusedFieldName=null},value:i,onCalciteRadioButtonChange:e=>{let{target:t}=e;t.checked&&this._saveValueFromComponent(t)}}),o)}_renderAuxiliaryText(e){const t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?(0,g.Je)(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=n?(0,E.u)("calcite-input-message",{icon:!0,status:"invalid"},n):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?(0,E.u)("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:n,showAllActionVisible:i}=e,{relatedRecordCallbacks:s}=this;if(!i||null===s||void 0===s||!s.showAllRelatedRecords)return;const o=this.messages;return(0,E.u)("calcite-list-item",{description:(0,R.n)(o.totalCount,{count:t}),label:o.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},(0,E.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:n,relatedLayer:i}=e,{messages:s,relatedRecordCallbacks:o}=this;if(t&&null!==o&&void 0!==o&&o.addRelatedRecord&&i)return(0,E.u)("calcite-button",{alignment:"center",appearance:"outline-fill",class:v.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:"".concat(n,"-add-button"),onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(n,i)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?s.addRecord:s.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:n,description:i,title:s}=e,{feature:o,relatedRecordCallbacks:a}=this,{highlightHelper:l}=this.viewModel,r=l?()=>l.add(n):void 0,u=l?()=>l.remove(n):void 0;return(0,E.u)("calcite-list-item",{bind:this,description:i,key:"".concat(t,"-").concat(n.uid),label:s,onclick:()=>{null!==l&&void 0!==l&&l.removeAll(),(null===a||void 0===a?void 0:a.editRelatedRecord)&&o&&a.editRelatedRecord({parentFeature:o,relationshipId:t,relatedFeature:n})},onmouseenter:r,onmouseleave:u,value:s},(0,E.u)("calcite-icon",{icon:(0,g.MP)(n),slot:"content-start"}),(0,E.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:n,showAllEnabled:i}=e,s=i?null:this._renderDescriptionOrEmpty(e.description),o=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return(0,E.u)("calcite-label",{class:this.classes(v.label,v.relatedRecordsLabel),key:"relationship-".concat(n,"-container")},(0,E.u)("div",null,this._renderRelatedRecordsHeaderContainer(e),s,o),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var t;const n=e.updating||!e.loaded;return(0,E.u)("div",{class:v.relatedRecordsHeader,key:"relationship-".concat(e.relationshipId,"-header")},(0,E.u)("span",null,e.label),n?(0,E.u)("calcite-loader",{inline:!0,key:"loader",label:null===(t=this.messagesCommon)||void 0===t?void 0:t.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return(0,E.u)("calcite-list",{class:v.relatedRecordsList},e.relatedFeatureInfos.map((e=>this._renderRelatedRecordListItem(e,t))),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var t,n,i;const{messages:s}=this,o=e.relatedLayerIsTable?s.noOriginKeyRecord:s.noOriginKeyFeature,a=null===(t=e.relationship)||void 0===t?void 0:t.keyField,l=this.viewModel.findField(a),r=null===(n=e.layer)||void 0===n?void 0:n.fieldsIndex.get(a),u=(null===l||void 0===l?void 0:l.label)||(null===r||void 0===r?void 0:r.alias)||a,d=(0,R.n)(o,{relatedLayerName:null===(i=e.relatedLayer)||void 0===i?void 0:i.title,originKeyField:u});return(0,E.u)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,E.u)("div",{slot:"message"},d))}_renderNoRelatedRecordsNotice(){return(0,E.u)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,E.u)("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if(null!==(e=this.viewModel.activeRelationshipInput)&&void 0!==e&&e.showAllEnabled)return(0,E.u)("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:v.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return(0,E.u)("div",{class:v.textElement,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:n,hint:i,label:s,maxLength:o,minLength:a,name:l,range:{max:r,min:u},required:d,valid:c,value:p}=e,h=this._inputsWithChanges.has(l),m=!n||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":c?"false":"true",class:this.classes(v.fieldInput,m?v.inputDisabled:null),status:h&&!c?"invalid":"idle",key:l,label:s,max:null!=r?r:void 0,min:null!=u?u:void 0,maxLength:o>-1?o:void 0,minLength:a>-1?a:void 0,placeholder:null!==i&&void 0!==i?i:void 0,readOnly:m,required:d,value:null==p?"":"".concat(p),onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[T]:l}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(T))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value){const n=new ResizeObserver((()=>{var i,s;switch(e.value=void 0,t.field.type){case"date":e.value=null!==(i=(0,x.w5)(t.value,this.timeZone).date)&&void 0!==i?i:"";break;case"timestamp-offset":e.value=null!==(s=(0,x.HB)(t.value,this.timeZone).date)&&void 0!==s?s:"";break;default:e.value="".concat(t.value)}n.unobserve(e)}));n.observe(e)}if(null!=i)switch(n){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);(0,g.ll)(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),i=t||n;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,n=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===n&&(this._attemptFocusOnNextRender=!1,(0,g._n)(n)&&(n.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,n=this._getFieldInputFromHTMLElement(e),i=n.field.type,{name:s,range:o}=n,a=this._dateComponentMap.get(s);if(!a)return;let l=this.viewModel.getValue(s),r=null;"date-only"===i?r=Array.isArray(e.value)?e.value[0]:e.value:"time-only"===i?(l=(0,x.J2)(l),r=(0,x.J2)(e.value)):r="timestamp-offset"===i?null!=e.value?(0,x._t)({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:l,defaultTimeZone:t}):null:null!=e.value?(0,x.Hs)({oldValue:l,dateComponent:a.date,timeComponent:a.time,timeZone:t,max:o.max,min:o.min}):null,null!==r&&e.value?l!==r&&this._updateFieldValue(s,r):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),n=this._parseValue(e),i=t.value;t.isSubtypeField&&(0,g.Pk)(this.layer,i,n)?this._pendingSubtypeChoice||n===i||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,n)):this._updateFieldValue(t.name,n)}async _handleSubtypeChoice(e,t){var n,i,s;const{value:o,name:l}=e,{layer:r,messages:u,viewModel:d,messagesCommon:c}=this;if(this._updateFieldValue(l,t),!r||!("subtypes"in r)||null===(n=r.subtypes)||void 0===n||!n.length)return;const p=r.subtypes.find((e=>e.code===t)),h=null!==(i=null===(s=r.subtypes.find((e=>e.code===o)))||void 0===s?void 0:s.name)&&void 0!==i?i:"".concat(o);if(!p)return;d.hasPendingSubtypeChoice=!0;const m=(0,a.hh)();let f="update-fields";const y=[{label:u.subtypes.useDefaultValuesOption,value:"update-fields"},{label:u.subtypes.keepCurrentValuesOption,value:"keep-existing"}],v={context:"info",title:u.subtypes.changeWarningTitle,message:(0,R.n)(u.subtypes.changeWarning,{originalType:h,newType:p.name}),radios:y,defaultRadioSelection:"update-fields",onRadioSelection:e=>f=e,actions:{primary:{label:c.apply,action:()=>m.resolve(f),type:"positive"},secondary:{label:c.cancel,type:"neutral",action:()=>m.resolve("undo")}},cancel:()=>m.reject()};try{switch(this.showPrompt(v),await m.promise){case"update-fields":d.applySubtypeDefaults(p),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,o)}}finally{d.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown(e){let{key:t,target:n}=e;const i=this._getFieldInputFromHTMLElement(n);"Enter"===t&&(0,g._n)(i)&&!i.group.open&&(i.group.open=!0)}_updateFieldValue(e,t){const n=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),n!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter((e=>{let[t,n]=e;return null!=n})));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),n=e.value;return(0,g.I6)(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==n||""===n?null:"number"===t.dataType?"-0"===n||"-0."===n||"-0,"===n?n:parseFloat(n):"date"===t.field.type?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:n}=e;0===n.length&&t&&"selected"in t?t.selected=!0:o.Z.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=(null===(n=this._getFocusableInput("forward",t))||void 0===n?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach((e=>{e!==t&&(e.open=!1)}))):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;null===e||void 0===e||e.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter((e=>e.open));0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach((e=>e.open=!1))}get test(){return{inputsWithChanges:this._inputsWithChanges}}};(0,i._)([(0,r.Cb)()],k.prototype,"_listObserverNode",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"_relatedRecordsEnabled",null),(0,i._)([(0,r.Cb)()],k.prototype,"_prompt",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"disabled",null),(0,i._)([(0,r.Cb)()],k.prototype,"feature",null),(0,i._)([(0,r.Cb)()],k.prototype,"formTemplate",null),(0,i._)([(0,r.Cb)()],k.prototype,"groupDisplay",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"headingLevel",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"icon",null),(0,i._)([(0,r.Cb)()],k.prototype,"label",null),(0,i._)([(0,r.Cb)()],k.prototype,"layer",null),(0,i._)([(0,r.Cb)()],k.prototype,"map",null),(0,i._)([(0,r.Cb)(),(0,V.H)("esri/widgets/FeatureForm/t9n/FeatureForm")],k.prototype,"messages",void 0),(0,i._)([(0,r.Cb)(),(0,V.H)("esri/t9n/common")],k.prototype,"messagesCommon",void 0),(0,i._)([(0,r.Cb)(),(0,V.H)("esri/widgets/Feature/t9n/Feature")],k.prototype,"messagesFeature",void 0),(0,i._)([(0,r.Cb)(),(0,V.H)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],k.prototype,"messagesTemplates",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"relatedRecordCallbacks",null),(0,i._)([(0,r.Cb)()],k.prototype,"relationshipId",null),(0,i._)([(0,r.Cb)()],k.prototype,"spatialReference",null),(0,i._)([(0,r.Cb)()],k.prototype,"strict",null),(0,i._)([(0,r.Cb)()],k.prototype,"timeZone",null),(0,i._)([(0,r.Cb)()],k.prototype,"showPrompt",null),(0,i._)([(0,r.Cb)()],k.prototype,"clearPrompt",null),(0,i._)([(0,r.Cb)(),(0,I.s)(["value-change","submit"])],k.prototype,"viewModel",void 0),(0,i._)([(0,r.Cb)()],k.prototype,"test",null),k=(0,i._)([(0,u.j)("esri.widgets.FeatureForm")],k);const A=k},16458:(e,t,n)=>{n.d(t,{Z:()=>Te});var i=n(27366),s=n(52639),o=n(41644),a=n(91505),l=n(32718),r=n(92026),u=n(67426),d=n(94172),c=n(643),p=n(49861),h=(n(84936),n(69912)),m=n(46634),f=n(40934),y=n(73813),v=n(7138);n(93169);let g=class extends v.default{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};(0,i._)([(0,p.Cb)()],g.prototype,"objectType",void 0),(0,i._)([(0,p.Cb)()],g.prototype,"maxValue",void 0),(0,i._)([(0,p.Cb)()],g.prototype,"minValue",void 0),(0,i._)([(0,p.Cb)()],g.prototype,"codedValue",void 0),g=(0,i._)([(0,h.j)("esri.layers.support.ContingentValue")],g);const _=g;var b=n(69767),C=n(76200),x=n(63780),w=n(46784),F=n(54472),V=n(25899);let I=class extends v.default{constructor(e){super(e),this.isRetired=!1}};(0,i._)([(0,p.Cb)()],I.prototype,"id",void 0),(0,i._)([(0,p.Cb)()],I.prototype,"isRetired",void 0),(0,i._)([(0,p.Cb)()],I.prototype,"subtype",void 0),(0,i._)([(0,p.Cb)()],I.prototype,"values",void 0),I=(0,i._)([(0,h.j)("esri.layers.support.Contingency")],I);const E=I;let R=class extends v.default{constructor(e){super(e)}};(0,i._)([(0,p.Cb)()],R.prototype,"fieldGroup",void 0),(0,i._)([(0,p.Cb)()],R.prototype,"type",void 0),R=(0,i._)([(0,h.j)("esri.layers.support.ContingencyConstraintViolation")],R);const T=R;let k=class extends v.default{constructor(e){super(e)}};(0,i._)([(0,p.Cb)()],k.prototype,"contingentValuesAllGroups",void 0),(0,i._)([(0,p.Cb)()],k.prototype,"contingentValuesByFieldGroup",void 0),k=(0,i._)([(0,h.j)("esri.layers.support.ContingentValuesResult")],k);const A=k;let O=class extends v.default{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};(0,i._)([(0,p.Cb)()],O.prototype,"name",void 0),(0,i._)([(0,p.Cb)()],O.prototype,"fields",void 0),(0,i._)([(0,p.Cb)()],O.prototype,"isEditingRestrictive",void 0),(0,i._)([(0,p.Cb)()],O.prototype,"contingencies",void 0),O=(0,i._)([(0,h.j)("esri.layers.support.FieldGroup")],O);const S=O;var M,L=n(37270),N=n(93882),D=n(73238);let j=M=class extends((0,w.eC)(F.Z)){constructor(e){super(e),this.request=C.Z,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){return(0,D.ZP)(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(void 0===e.layerId)return null;const n=t.hasContingentValuesDefinition;if(n)return new M({layer:e}).load();if(void 0===n){const t=(0,V.Qc)(e.url);if(null==t)return null;const n=t.url.path;if((await U(n)).supportsQueryDataElements){const t=e.layerId.toString(),i=await H(n,t);if(i){const t=i.map((t=>({name:t.name,isEditingRestrictive:t.isEditingRestrictive,fields:t.fieldNames.names.map((t=>e.fieldsIndex.normalizeFieldName(t)))})));return new M({layer:e,fieldGroupDefinitions:t}).load()}}}return null}async load(e){const t=this.layer.load(e).then((()=>this._initializeContingentValues(this.fieldGroupDefinitions,e)));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const n=Object.keys(e),i=[],s=[];for(const o of this.fieldGroups){const a=o.isEditingRestrictive?"error":"warning";if(t&&!o.fields.some((e=>t.includes(e))))continue;if(!o.fields.every((e=>n.includes(e)))){s.push(new T({fieldGroup:o,type:a}));continue}let l=!1;const r=e[this.subtypeFieldName],u=o.contingencies.filter((e=>!(!e.isRetired&&e.subtype)||e.subtype.code===r));if(0!==u.length){for(const t of u){let n=!0;for(const i in t.values){const s=t.values[i];if("any"!==s.objectType)if("null"===s.objectType){if(null!=e[i]){n=!1;break}}else if("code"===s.objectType){if(e[i]!==s.codedValue.code){n=!1;break}}else if("range"===s.objectType){const t=e[i];if(t<s.minValue||t>s.maxValue){n=!1;break}}}if(n){l=!0;break}}l||i.push(new T({fieldGroup:o,type:a}))}}return{invalid:i,incomplete:s}}getContingentValues(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e[this.subtypeFieldName],s=null!=i,o={};let a=[];const l=this.fieldGroups.filter((e=>e.fields.includes(t)));a.push(new _({objectType:"any"}));for(const r of l){let l=[];const u=r.contingencies.filter((e=>!(e.isRetired||e.subtype&&s&&e.subtype.code!==i)));let d=!1;const c={};for(const n of u){let i,s=!0;for(const o in n.values){const a=n.values[o];if(t!==o){if(void 0!==e[o]&&"any"!==a.objectType)if("null"===a.objectType)null!==e[o]&&(s=!1);else if("code"===a.objectType)e[o]!==a.codedValue.code&&(s=!1);else if("range"===a.objectType){const t=e[o];(t<a.minValue||t>a.maxValue)&&(s=!1)}}else i=a,d=d||"range"===a.objectType}if(i&&s){if("any"===i.objectType){l.length=0,l.push(i);break}const e=P(i);c[e]||l.push(i),c[e]=!0}}d&&(l=Z(l)),o[r.name]=l,a=n?G(a,l):[]}return 1===l.length&&n&&(a=[]),new A({contingentValuesAllGroups:a,contingentValuesByFieldGroup:o})}async _initializeContingentValues(e,t){const n=null!==e&&void 0!==e?e:await this._fetchFieldGroupDefs(t);if(0===n.length)return void(this.fieldGroups=[]);const i=await this._fetchContingentValues(n,t);this.fieldGroups=i}async _fetchFieldGroupDefs(e){if(void 0===this.layer.layerId)return[];const t=this.layer.sourceJSON,n=this.layer.layerId.toString(),i=(0,V.Qc)(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await async function(e,t,n){return(0,C.Z)("".concat(e,"/").concat(t,"/fieldgroups"),{responseType:"json",query:{f:"json"},...n}).then((e=>{var t;return null!==(t=e.data.fieldGroups)&&void 0!==t?t:[]}))}(i,n,e)).map((e=>({name:e.name,isEditingRestrictive:e.restrictive,fields:e.fields.map((e=>this.layer.fieldsIndex.normalizeFieldName(e)))}))):void 0!==t.hasContingentValuesDefinition?[]:U(i,e).then((async t=>t.supportsQueryDataElements?(await H(i,n,e)).map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>this.layer.fieldsIndex.normalizeFieldName(e)))}))):[]))}async _fetchContingentValues(e,t){if(void 0===this.layer.layerId)return[];const n=this.layer.sourceJSON,i=this.layer.layerId.toString(),s=(0,V.Qc)(this.layer.url).url.path;if(n.hasContingentValuesDefinition){const n=await async function(e,t,n){return(0,C.Z)("".concat(e,"/").concat(t,"/contingentValues"),{responseType:"json",query:{f:"json"},...n}).then((e=>e.data))}(s,i,t);return this._constructFieldGroupsAGOL(e,n)}const o=await async function(e,t,n){return(0,C.Z)("".concat(e,"/queryContingentValues"),{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then((e=>{var t;return null===(t=e.data.contingentValueSets)||void 0===t?void 0:t[0]}))}(s,i,t);return this._constructFieldGroupsEnterprise(e,o)}_constructFieldGroupsAGOL(e,t){return e.map((e=>{const n=t.contingentValuesDefinition.fieldGroups.find((t=>t.name===e.name));if(n){let i=[];return i=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(e,t,n.subTypes):this._parseAGOLFieldGroup(e,t,n.contingentValues),new S({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:i})}return null})).filter(x.pC)}_parseAGOLFieldGroupSubtype(e,t,n){let i=[];return null!==n&&void 0!==n&&n.forEach((n=>{const s=this._getSubtypeAGOL(n.name);i=i.concat(this._parseAGOLFieldGroup(e,t,n.contingentValues,s))})),i}_parseAGOLFieldGroup(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=[];for(const o of null!==n&&void 0!==n?n:[]){const n=this._parseAGOLContingency(o,e,t,i);s.push(n)}return s}_parseAGOLContingency(e,t,n,i){const s=e.id,o=!!e.retired&&1===e.retired,a={};for(let l=0,r=0;l<t.fields.length;l++){const s=t.fields[l],o=n.typeCodes[e.types[l]];if("Code"===o){let t=e.values[r];r++;const o=this._getDomain(i,s),l=this.layer.getField(s);if("string"===(null===l||void 0===l?void 0:l.type)){const e=n.stringDicts.find((e=>e.domain===(null===o||void 0===o?void 0:o.name)));e&&(t=e.entries[t])}const u=null===o||void 0===o?void 0:o.codedValues.find((e=>e.code===t)),d=new _({codedValue:u,objectType:"code"});a[s]=d}else if("Range"===o){const t=e.values[r];r++;const n=t.range[0],i=t.range[1],o=new _({minValue:n,maxValue:i,objectType:"range"});a[s]=o}else if("Any"===o){const e=new _({objectType:"any"});a[s]=e}else{const e=new _({objectType:"null"});a[s]=e}}return new E({id:s,isRetired:o,subtype:i,values:a})}_constructFieldGroupsEnterprise(e,t){const n=t.fieldGroups;return e.map((e=>{const i=n.find((t=>t.name===e.name));if(i){const n=i.contingencies.map((n=>{const i=n.id,s=n.isRetired||!1,o=this._getSubtypeEnterprise(n.subtypeCode),a={};for(let l=0;l<e.fields.length;l++){const i=e.fields[l];let s=n.values[l];if("number"==typeof s||"string"==typeof s){const e=this._getDomain(o,i),n=this.layer.getField(i);if((0,L.qN)(n))s=t.stringDictionary[s];else if((0,L.y2)(n)){const e=new Date("".concat(s,"+00:00"));s=e.getTime()}const l=null===e||void 0===e?void 0:e.codedValues.find((e=>e.code===s)),r=new _({codedValue:l,objectType:"code"});a[i]=r}else if("object"==typeof s){const e=s.minValue,t=s.maxValue,n=new _({minValue:e,maxValue:t,objectType:"range"});a[i]=n}else if(s){const e=new _({objectType:"any"});a[i]=e}else{const e=new _({objectType:"null"});a[i]=e}}return new E({id:i,isRetired:s,subtype:o,values:a})}));return new S({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:n})}return null})).filter(x.pC)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find((t=>t.code===e));n=N.Z.fromJSON(i)}return n||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const i=t.subtypes.find((t=>t.name===e));n=N.Z.fromJSON(i)}return n||null}_getDomain(e,t){const n=e?function(e,t){const n=e.domains;if(n){const[e,i]=Object.entries(n).find((e=>{let[n]=e;return n.trim().toLowerCase()===t.trim().toLowerCase()}))||[];return i||null}return null}(e,t):this.layer.getFieldDomain(t);return"inherited"===(null===n||void 0===n?void 0:n.type)?this.layer.getFieldDomain(t):n}};function P(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function Z(e){let t,n;e.sort(((e,t)=>"null"===e.objectType?-1:"null"===t.objectType?1:e.minValue-t.minValue));const i=[];for(const s of e)"null"!==s.objectType?null!=t&&null!=n?n<s.minValue?(i.push(new _({objectType:"range",minValue:t,maxValue:n})),t=s.minValue,n=s.maxValue):n<s.maxValue&&(n=s.maxValue):(t=s.minValue,n=s.maxValue):i.push(s);return i.push(new _({objectType:"range",minValue:t,maxValue:n})),i}function G(e,t){var n,i;if(0===e.length||0===t.length)return[];if("any"===e[0].objectType)return t;if("any"===t[0].objectType)return e;const s="range"===e[0].objectType||"range"===(null===(n=e[1])||void 0===n?void 0:n.objectType),o="range"===t[0].objectType||"range"===(null===(i=t[1])||void 0===i?void 0:i.objectType);return s||o?function(e,t){const n=[];let i,s=0;for(const o of e)for(;s<t.length;s++){const e=t[s];if("null"===o.objectType&&"null"===e.objectType)n.push(new _({objectType:"null"}));else{if("null"===o.objectType)break;if("null"===e.objectType)continue}if(o.maxValue<e.minValue)break;if(o.maxValue===e.minValue){n.push(new _({objectType:"range",minValue:o.maxValue,maxValue:e.minValue}));break}if(!(o.minValue>e.maxValue))if(o.minValue!==e.maxValue){if(i=o.minValue>e.minValue?o.minValue:e.minValue,o.maxValue<e.maxValue){n.push(new _({objectType:"range",minValue:i,maxValue:o.maxValue}));break}n.push(new _({objectType:"range",minValue:i,maxValue:e.maxValue}))}else n.push(new _({objectType:"range",minValue:o.minValue,maxValue:e.maxValue}))}return n}(e,t):function(e,t){const n=[];for(const i of e)t.some((e=>{if(i.objectType===e.objectType)switch(i.objectType){case"any":case"null":return!0;case"code":return i.codedValue.code===e.codedValue.code&&i.codedValue.name===e.codedValue.name}return!1}))&&n.push(i);return n}(e,t)}async function H(e,t,n){return(0,C.Z)("".concat(e,"/queryDataElements"),{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then((e=>{var t,n;return null!==(t=null===(n=e.data.layerDataElements)||void 0===n?void 0:n[0].dataElement.fieldGroups)&&void 0!==t?t:[]}))}async function U(e,t){return(0,C.Z)(e,{responseType:"json",query:{f:"json"},...t}).then((e=>e.data))}(0,i._)([(0,p.Cb)({constructOnly:!0})],j.prototype,"layer",void 0),(0,i._)([(0,p.Cb)({constructOnly:!0})],j.prototype,"request",void 0),(0,i._)([(0,p.Cb)({type:[S]})],j.prototype,"fieldGroups",void 0),(0,i._)([(0,p.Cb)({constructOnly:!0})],j.prototype,"fieldGroupDefinitions",void 0),(0,i._)([(0,p.Cb)()],j.prototype,"subtypeFieldName",null),j=M=(0,i._)([(0,h.j)("esri.layers.support.LayerContingentValuesCache")],j);const B=j;var z,W=n(6701),q=n(74887),$=n(55515),J=n(66978);const K=Symbol("FormExpressionArcadeExecutor");let Q=class extends v.default{constructor(e){super(e),this[z]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new m.R,this._executeAsyncDebounced=(0,J.Ds)((async(e,t,n)=>{const i=await this.executor.executeAsync(e,{...t,abortSignal:n});return n.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=i,this._stale=!1,i)}))}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const n=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=n,n}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,null!==t&&void 0!==t?t:{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};z=K,(0,i._)([(0,p.Cb)()],Q.prototype,"_lastEvaluatedValue",void 0),(0,i._)([(0,p.Cb)()],Q.prototype,"_stale",void 0),(0,i._)([(0,p.Cb)()],Q.prototype,"_updatingTracking",void 0),(0,i._)([(0,p.Cb)({constructOnly:!0})],Q.prototype,"executor",void 0),(0,i._)([(0,p.Cb)()],Q.prototype,"isAsync",null),(0,i._)([(0,p.Cb)()],Q.prototype,"fieldsUsed",null),(0,i._)([(0,p.Cb)()],Q.prototype,"syntaxTree",null),(0,i._)([(0,p.Cb)()],Q.prototype,"updating",null),(0,i._)([(0,p.Cb)()],Q.prototype,"stale",null),(0,i._)([(0,p.Cb)()],Q.prototype,"geometryUsed",null),(0,i._)([(0,p.Cb)()],Q.prototype,"variablesUsed",null),(0,i._)([(0,p.Cb)()],Q.prototype,"lastEvaluatedValue",null),Q=(0,i._)([(0,h.j)("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],Q);var Y=n(77427);const X="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";let ee=class extends v.default{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter((e=>e.isAsync))}get _baseContext(){const{editType:e,layer:t,map:n,originalFeature:i,spatialReference:s,timeZone:o}=this.arcadeContextInfo,a="scene"===(null===t||void 0===t?void 0:t.type)&&null!=t.associatedLayer?t.associatedLayer:t;return[{$originalfeature:i,$editcontext:{editType:e},$layer:a,$featureset:a,$datastore:null===t||void 0===t?void 0:t.url,$map:n},{rawOutput:!0,spatialReference:null!==s&&void 0!==s?s:void 0,timeZone:o}]}set feature(e){this._latestFieldValues={...null===e||void 0===e?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:n,feature:i}=this,s=new Set;for(const o of e)if(n[o]=i.getAttribute(o),t.has(o))for(const e of t.get(o))s.add(e);return this._evaluate([...s])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(X))return this._evaluate([...this._fieldReferencesLookup.get(X)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:n,preserveFieldValuesWhenHidden:i}=this,s=new Map(this.fieldInputs.map((e=>[e.name,e]))),o=!1===i,a=new Map(n.map((e=>[e,new Array])));for(const r of n){for(const n of r.fieldsUsed){var l;(0,Y.s1)(e,n,(()=>new Set)).add(r);const i=s.get(n);[null===i||void 0===i?void 0:i.valueExpressionExecutor,null===i||void 0===i?void 0:i.editableExpressionExecutor,o?null===i||void 0===i||null===(l=i.group)||void 0===l?void 0:l.visibilityExpressionExecutor:null,o?null===i||void 0===i?void 0:i.visibilityExpressionExecutor:null].filter((e=>null!=e&&e!==r)).forEach((e=>{a.get(e).push(r),(0,Y.s1)(t,e,(()=>new Set)).add(i)}))}r.geometryUsed&&(0,Y.s1)(e,X,(()=>new Set)).add(r)}return a}async _evaluate(e){const t=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:i,_latestFieldValues:s}=this;for(const a of e)te(a,t,n);for(const[a,{resolver:l,dependencyPromises:r}]of t)Promise.all(r).then((async()=>{const[e,t]=this._makeContext(s);return a.executeAsync(e,t)})).then((()=>{if(i.has(a))for(const e of i.get(a))this._latestFieldValues[e.name]=e.value;l.resolve()}),(e=>{!e||(0,J.D_)(e)||ne(e)||a.markStale(),l.reject(e)}));const o=(await Promise.allSettled(Array.from(t.values(),(e=>{let{resolver:t}=e;return t.promise})))).filter((e=>"rejected"===e.status&&!((0,J.D_)(e.reason)||ne(e.reason))));if(o.length>0){const e=new AggregateError(o,"One or more expression executions failed. First error message: ".concat(o[0].reason));throw l.Z.getLogger(this).error(e),e}}_makeContext(e){const[t,n]=this._baseContext,i=this.feature.clone();return i.attributes=e,[{...t,$feature:i},n]}get test(){}};(0,i._)([(0,p.Cb)()],ee.prototype,"_asyncExecutors",null),(0,i._)([(0,p.Cb)()],ee.prototype,"_baseContext",null),(0,i._)([(0,p.Cb)()],ee.prototype,"feature",null),(0,i._)([(0,p.Cb)({constructOnly:!0})],ee.prototype,"preserveFieldValuesWhenHidden",void 0),(0,i._)([(0,p.Cb)()],ee.prototype,"executors",void 0),(0,i._)([(0,p.Cb)()],ee.prototype,"fieldInputs",void 0),(0,i._)([(0,p.Cb)()],ee.prototype,"arcadeContextInfo",void 0),ee=(0,i._)([(0,h.j)("esri.widgets.FeatureForm.FormExpressionsManager")],ee);const te=(e,t,n)=>{if(t.has(e))return;const i=(0,J.hh)();t.set(e,{resolver:i,dependencyPromises:[]}),e.abort();const s=n.get(e);for(const o of s)te(o,t,n),t.get(o).dependencyPromises.push(i.promise)},ne=e=>e&&"object"==typeof e&&"message"in e&&"Cancelled"===e.message;var ie=n(44927),se=n(95439),oe=n(170);let ae=class extends oe.Z{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=(0,se.D)().toString(),this.type="group"}initialize(){this.addHandles([(0,d.watch)((()=>[this.visible,this.inputs]),(e=>{let[t]=e;const{inputs:n}=this,i=!!t&&void 0;for(const s of n)(0,D.Vs)(s)&&(s.required=i)}),{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map((e=>(0,d.watch)((()=>e.visible),(()=>this._dirtyEvaluatedVisibilityExpression()))))),this._set("inputs",e)}get label(){return this.element.label}set label(e){const{element:t}=this;t&&(t.label=e)}get open(){return"expanded"===this.initialState}set open(e){this._override("open",e)}get state(){return(0,ie.Mr)(l.Z.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"}set state(e){(0,ie.Mr)(l.Z.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open="expanded"===e}get visible(){return!1!==this.evaluatedVisibilityExpression&&this.inputs&&this.inputs.some((e=>e.visible))}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};(0,i._)([(0,p.Cb)()],ae.prototype,"id",void 0),(0,i._)([(0,p.Cb)()],ae.prototype,"initialState",null),(0,i._)([(0,p.Cb)()],ae.prototype,"inputs",null),(0,i._)([(0,p.Cb)()],ae.prototype,"label",null),(0,i._)([(0,p.Cb)()],ae.prototype,"open",null),(0,i._)([(0,p.Cb)()],ae.prototype,"type",void 0),(0,i._)([(0,p.Cb)()],ae.prototype,"visible",null),ae=(0,i._)([(0,h.j)("esri.widgets.FeatureForm.GroupInput")],ae);const le=ae;var re=n(37933),ue=n(67667),de=n(45276),ce=n(51799);let pe=class extends ce.Z{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([(0,d.watch)((()=>({feature:this.feature,element:this.element,layer:this.layer})),(e=>this._createRelationshipVM(e)),d.initial),(0,d.on)((()=>this.relatedLayer),"edits",(()=>{var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.refresh()}))])}destroy(){var e;null===(e=this._relationshipVM)||void 0===e||e.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,relationship:n}=this;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:i,role:s}=n;return!("one-to-one"===i&&t>0)&&"many-to-many"!==i&&!("one-to-many"===i&&"destination"===s&&t>0)&&e}get displayCount(){var e;return null!==(e=this.element.displayCount)&&void 0!==e?e:3}get displayType(){return this.element.displayType}get editable(){var e;return!!this.relatedLayerAllowsEdits&&(null===(e=this.evaluatedEditableExpression)||void 0===e||e)}get featureCount(){var e,t;return null!==(e=null===(t=this._relationshipVM)||void 0===t?void 0:t.featureCount)&&void 0!==e?e:0}get loaded(){var e;return"loading"!==(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)}get map(){return this._get("map")}set map(e){var t;e&&null!==(t=this._relationshipVM)&&void 0!==t&&t.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var e;const{_relationshipVM:t,timeZone:n}=this;if(null===t||void 0===t||null===(e=t.relatedFeatures)||void 0===e||!e.length||null===t||void 0===t||!t.relatedLayer)return[];const{itemDescriptionFieldName:i,relatedFeatures:s,relatedLayer:o}=t,a=o&&"formTemplate"in o&&o.formTemplate?o.formTemplate.title:void 0;return s.map((e=>{let t;if(i){const s=e.getAttribute(i),a=o.fieldsIndex.get(i);if(a){const e=(0,D.Bl)({values:[s],fields:[a],timeZone:null!==n&&void 0!==n?n:void 0})[i];null!=e&&(t=e.toString())}}return{feature:e,description:t,title:a?(0,D.sq)({label:a,attributes:e.attributes,fieldsIndex:o.fieldsIndex,timeZone:n}):void 0}})).toArray()}get relatedLayer(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!(null===(e=this.relatedLayer)||void 0===e||!e.isTable)}get relatedLayerAllowsAdds(){var e;const{relatedLayer:t}=this;if(!t||!this.relatedLayerAllowsEdits)return!1;const n=(0,re.S1)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsAdd)}get relatedLayerAllowsEdits(){var e;const{relatedLayer:t}=this;if(!t)return!1;const n=(0,re.S1)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var t;null!==(t=this._relationshipVM)&&void 0!==t&&t.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return"many-to-many"!==t&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element)}get updating(){var e,t;return"loading"===(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)||"querying"===(null===(t=this._relationshipVM)||void 0===t?void 0:t.state)}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var t;return null===(t=this._relationshipVM)||void 0===t?void 0:t.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var t;const{feature:n,element:i,layer:s}=e;if(null!==(t=this._relationshipVM)&&void 0!==t&&t.destroy(),!n||!i||!s)return;const{displayCount:o,map:a,orderByFields:l,relationshipId:r,showAllEnabled:u}=this;(0,de.Um)(s)&&(this._relationshipVM=new ue.Z({graphic:n,displayCount:o,layer:s,map:a,orderByFields:l,relationshipId:r,showAllEnabled:u}))}};(0,i._)([(0,p.Cb)()],pe.prototype,"_relationshipVM",void 0),(0,i._)([(0,p.Cb)()],pe.prototype,"canAddRelatedFeature",null),(0,i._)([(0,p.Cb)()],pe.prototype,"displayCount",null),(0,i._)([(0,p.Cb)()],pe.prototype,"displayType",null),(0,i._)([(0,p.Cb)()],pe.prototype,"editable",null),(0,i._)([(0,p.Cb)()],pe.prototype,"featureCount",null),(0,i._)([(0,p.Cb)()],pe.prototype,"group",void 0),(0,i._)([(0,p.Cb)()],pe.prototype,"loaded",null),(0,i._)([(0,p.Cb)()],pe.prototype,"map",null),(0,i._)([(0,p.Cb)()],pe.prototype,"orderByFields",null),(0,i._)([(0,p.Cb)()],pe.prototype,"originHasValidKey",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relationship",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relationshipId",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relatedFeatureInfos",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relatedLayer",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relatedLayerIsTable",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relatedLayerAllowsAdds",null),(0,i._)([(0,p.Cb)()],pe.prototype,"relatedLayerAllowsEdits",null),(0,i._)([(0,p.Cb)()],pe.prototype,"showAllEnabled",null),(0,i._)([(0,p.Cb)()],pe.prototype,"showAllActionVisible",null),(0,i._)([(0,p.Cb)({readOnly:!0})],pe.prototype,"type",void 0),(0,i._)([(0,p.Cb)()],pe.prototype,"visible",null),(0,i._)([(0,p.Cb)()],pe.prototype,"updating",null),pe=(0,i._)([(0,h.j)("esri.widgets.FeatureForm.RelationshipInput")],pe);const he=pe;var me=n(80987),fe=n(18442),ye=n(2622);let ve;const ge=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];async function _e(e){return ve||await async function(){const{Marked:e}=await n.e(13086).then(n.bind(n,33321)),t=e=>'<span style="text-decoration:line-through;">'.concat(e,"</span>"),i=(e,t,n)=>"<a".concat(null!=e?' href="'.concat(e,'"'):"").concat(null!=t?' title="'.concat(t,'"'):"",' target="_blank">').concat(null!==n&&void 0!==n?n:"","</a>"),s=()=>"",o={};for(const n of ge)o[n]=s;ve=new e({renderer:{del:t,link:i,...o}})}(),ve.parse(e)}var be=n(80975);let Ce=class extends oe.Z{constructor(e){super(e),this.group=null,this.id="TextElementInput-".concat((0,se.D)()),this.type="text",this._expressionReferences=new fe.Z,this._expressionsUsed=new ye.Z,this._fieldsUsed=new ye.Z,this._literalParts=new me.Z,this._templateParts=new me.Z,this._updatingHandles=new m.R}initialize(){const{rawText:e}=this;e?"markdown"===this.textFormat?this._updatingHandles.addPromise(_e(e).then((e=>this._initializeTextParts(e)))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map((e=>{var t,n;return"".concat(null!==(t=null===(n=this._expressionReferences.get(e))||void 0===n?void 0:n.lastEvaluatedValue)&&void 0!==t?t:"")}));return be.w3.sanitize(function(e,t){return t.reduce(((t,n,i)=>t.concat(e.at(i),n)),"").concat(e.at(-1))}(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some((e=>null===e||void 0===e?void 0:e.updating))}setExpressionExecutor(e,t){this._expressionReferences.set((0,D.V$)(e),t)}setFieldExecutor(e,t){this._expressionReferences.set((0,D.Lm)(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:n,templates:i}=function(e){const t=/{[^{]+?}/g,n=[...e.matchAll(t)];let i=0;const s=[],o=[];for(const a of n){const t=a[0];s.push(e.slice(i,a.index)),o.push(t),i=a.index+t.length}return s.push(e.slice(i)),{literals:s,templates:o}}(e),s=[],o=[];for(let a=0;a<i.length;a++){const e=n[a],l=(0,L.ld)(i[a])[0];if((0,D.Pr)(l))this._expressionsUsed.add((0,D.of)(l)),this._expressionReferences.set(l,null),s.push(e),o.push(l);else if((0,D.FB)(l)){this._expressionsUsed.add(l);const t=(0,D.V$)(l);this._expressionReferences.set(t,null),s.push(e),o.push(t)}else if(null!==t&&void 0!==t&&t.has(l)){const n=t.normalizeFieldName(l);this._fieldsUsed.add(n);const i=(0,D.Lm)(n);this._expressionReferences.set(i,null),s.push(e),o.push(i)}else n[a+1]=e.concat(l,n[a+1])}s.push(n.at(-1)),this._literalParts.addMany(s),this._templateParts.addMany(o)}};(0,i._)([(0,p.Cb)()],Ce.prototype,"expressionsUsed",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"fieldsIndex",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"fieldsUsed",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"group",void 0),(0,i._)([(0,p.Cb)()],Ce.prototype,"id",void 0),(0,i._)([(0,p.Cb)()],Ce.prototype,"rawText",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"text",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"textFormat",null),(0,i._)([(0,p.Cb)()],Ce.prototype,"type",void 0),(0,i._)([(0,p.Cb)()],Ce.prototype,"updating",null),Ce=(0,i._)([(0,h.j)("esri.widgets.FeatureForm.TextElementInput")],Ce);const xe=new s.Z({attributes:{}}),we={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},Fe="#JSAPI_CONTINGENT_VALUE_ANY_HASH",Ve="esri.widgets.FeatureForm.FeatureFormViewModel",Ie=()=>l.Z.getLogger(Ve);let Ee=class extends((0,u.v)(a.Z.EventedAccessor)){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=xe.clone(),this._initialFeature=xe.clone(),this._timeZone=null,this._updatingHandles=new m.R,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1,this.hasPendingSubtypeChoice=!1}initialize(){const e=(0,d.watch)((()=>{var e;return[this.layer,!(null===(e=this.layer)||void 0===e||!e.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]}),(async e=>{let[t,n]=e;null!=t&&(n?this._updatingHandles.addPromise(this._updateInputs()):t.load().catch((()=>{})))}),{equals:(e,t)=>{let[n,i,s,o,a,l]=e,[r,u,d,c,p,h]=t;return n===r&&i===u&&s===d&&o===c&&a===p&&l===h},initial:!0}),t=(0,d.watch)((()=>this._arcadeContextInfo),(e=>{null!=this._expressionsManager&&(this._expressionsManager.arcadeContextInfo=e,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally((()=>this._afterExpressionsEvaluated()))))})),n=(0,d.watch)((()=>this.layer),(e=>{const t="subtype-sublayer"===(null===e||void 0===e?void 0:e.type)?e.parent:"feature"===(null===e||void 0===e?void 0:e.type)?e:null;t&&this.addResolvingPromise(B.createLoadedLayerContingentValuesCache(t).then((e=>{this._contingentValuesCache=e,this.notifyChange("fieldsWithContingentValues")})))}),{initial:!0});this.addHandles([e,t,n])}destroy(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=(0,r.SC)(this._contingentValuesCache),null!==(e=this.highlightHelper)&&void 0!==e&&e.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var e;return new Map(null===(e=this.formTemplate)||void 0===e||null===(e=e.expressionInfos)||void 0===e?void 0:e.map((e=>[e.name,e])))}get activeRelationshipInput(){return this.allRelationshipInputs.find((e=>e.relationshipId===this.relationshipId))}get _arcadeContextInfo(){const{_initialFeature:e,arcadeEditType:t,layer:n,map:i,spatialReference:s,timeZone:o}=this;return{layer:(0,b.K)(n)?n:null,originalFeature:e,editType:t,map:i,spatialReference:s,timeZone:o}}get allFieldInputs(){return(0,D.IE)(this.inputs)}get allGroupInputs(){return this.inputs.filter(D.ib)}get allRelationshipInputs(){return(0,D.m1)(this.inputs)}get _layerFieldsByName(){var e;return new Map(null===(e=this.layer)||void 0===e?void 0:e.fields.map((e=>[e.name,e])))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():xe.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach((t=>t.feature=e))):(this.inputs.forEach((e=>e.destroy())),this.inputs.length=0),t!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(null==this._contingentValuesCache)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap((e=>e.fields));return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return null!==e&&void 0!==e&&e.description&&t?(0,D.sq)({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return null!==e&&void 0!==e&&e.title&&t?(0,D.sq)({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,formDescription:t,formTitle:n}=this;return!(e||!t&&!n)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var e;return null!==(e=this.feature)&&void 0!==e&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(null!=e&&e===this.relationshipId||t.forEach((e=>e.showAllEnabled=!1)),null!=e){const n=t.find((t=>t.relationshipId===e));n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null}set spatialReference(e){this._override("spatialReference",e)}get state(){var e;return null!==(e=this.layer)&&void 0!==e&&e.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter((e=>!e.valid)).every((e=>{let{submittable:t}=e;return t}))}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return W.pt;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===W._4?t||W.pt:this._timeZone||W.By}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every((e=>{let{valid:t}=e;return t}))}findField(e){return this.allFieldInputs.find((t=>t.name===e))}getFieldValueOptionsForField(e,t){var n;const i=this.findField(e);if(!i)return[[],[],[]];const s="coded-value"===(null===(n=i.domain)||void 0===n?void 0:n.type)?i.domain.codedValues.map((e=>{let{name:t,code:n}=e;return{name:t,value:n}})):[],o=null==i.value||s.some((e=>e.value===i.value))?[]:[{name:"".concat(i.value),value:i.value}],a=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(a.length>0){const e=new Set(a.map((e=>e.value)));return[a,s.filter((t=>!e.has(t.value))),o]}return[s,[],o]}getValue(e){var t,n;const i=null===(t=this.layer)||void 0===t?void 0:t.getField(e);if(null!=i)return null!==(n=this._featureClone.getAttribute(i.name))&&void 0!==n?n:null}setValue(e,t){const{_featureClone:n,strict:i}=this,s=this.findField(e);t=""===t?null:t,s&&n.getAttribute(e)!==t&&(s.value=t,i&&!s.valid||(this._afterValueChange(s),null!=this._expressionsManager&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([s.name]).finally((()=>this._afterExpressionsEvaluated())))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter((e=>e.valid)).map((e=>{let{name:t}=e;return t}))),n=e.filter((e=>!e.valid)).map((e=>{let{name:t}=e;return t})),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[s,o]of this.contingencyConstraintViolations.entries())"error"===o.type&&(t.delete(s),n.push(s));this.emit("submit",{valid:[...t],invalid:n,values:i})}validateContingencyConstraints(e,t){const{_contingentValuesCache:n}=this,i=new Map;if(this.contingencyConstraintViolations=i,null==n)return[];const{invalid:s,incomplete:o}=n.validateContingencyConstraints(e),a=[...s,...null!==t&&void 0!==t&&t.includeIncompleteViolations?o:[]];for(const l of a)for(const e of l.fieldGroup.fields)i.set(e,l);return a}notifyFeatureGeometryChanged(){const{_expressionsManager:e,feature:t,_featureClone:n}=this;n.geometry=t.geometry,null!=e&&this._updatingHandles.addPromise(e.evaluateInvalidatedByGeometry().finally((()=>this._afterExpressionsEvaluated())))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:n}=this;for(const{name:i}of n){const e=t[i];null!=e&&this.setValue(i,e)}}_emitChangeEvent(e){let{name:t,valid:n,value:i}=e;this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:i,valid:n})}async _updateInputs(){this._stopExpressions();const{_featureClone:e,_initialFeature:t,arcadeEditType:n,formTemplate:i,inputs:s,layer:o,timeZone:a}=this;if(!o)return;const l={arcadeEditType:n,feature:e,initialFeature:t,layer:o,timeZone:a},r=s.slice(),u=null!==i&&void 0!==i&&i.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(r,i.elements,l):this._updateInputsUsingLayerFields(r,null===o||void 0===o?void 0:o.fields,l);this.inputs=u,await this._startExpressions()}async _updateInputsUsingFormElements(e,t,n){const i=new Map;for(const a of e)if((0,D.ib)(a)){i.set(a.element,a);for(const e of a.inputs)e.element&&i.set(e.element,e)}else a.element&&i.set(a.element,a);const s=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:t.filter(Re),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:s});for(const[a,l]of i.entries())i.delete(a),l.destroy();return await Promise.all(Array.from(s.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:i,group:s,newExpressionExecutorPromises:o}=e,a=[];for(const l of n){const e=t.has(l),n=e?t.get(l):this._makeInputFromElement(l,i,s);if(n){if(a.push(n),await(0,d.whenOnce)((()=>!n.updating)),this._assignExpressionExecutors(n,l,o),e)if(t.delete(l),(0,D.ib)(n)){const{feature:e,timeZone:t}=i;n.set({feature:e,timeZone:t})}else if((0,D.V7)(n)){const e=this.relationshipId===l.relationshipId;n.set(i),n.set({map:this.map,showAllEnabled:e})}else n.set(i);if((0,y.ah)(l)){const e=l.elements.filter((e=>Re(e)));n.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:e,sharedInitializationProperties:i,group:n,newExpressionExecutorPromises:o})}}}return a}_updateInputsUsingLayerFields(e,t,n){if(!Array.isArray(t))return Ie().warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const u of e)if((0,D.ib)(u)){for(const e of u.inputs)e.destroy();u.inputs.length=0,u.destroy()}else(0,D.V7)(u)?u.destroy():(0,D.Vs)(u)&&(null!==u.element?u.destroy():i.set(u.field,u));const s=[];for(const u of t){var o,a,l,r;const e=null!==(o=null===(a=n.feature)||void 0===a?void 0:a.getAttribute(u.name))&&void 0!==o?o:null,t=null!==(l=i.get(u))&&void 0!==l?l:new q.Z({field:u,preservesValueWhenHidden:null===(r=this.formTemplate)||void 0===r?void 0:r.preserveFieldValuesWhenHidden});s.push(t.set({...n,value:e})),i.delete(u)}for(const[u,d]of i.entries())i.delete(u),d.destroy();return s}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)}_makeInputFromElement(e,t,n){return(0,y.ah)(e)?function(e,t){const{feature:n,layer:i}=t;return new le({element:e,inputs:[],feature:n,layer:i})}(e,t):(0,y.fY)(e)?this._makeFieldInputFromElement(e,t,n):(0,y.V2)(e)?this._makeRelationshipInputFromElement(e,t,n):(0,y.iB)(e)?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{feature:i,layer:s,timeZone:o}=t;return new Ce({element:e,feature:i,group:n,layer:s,timeZone:o})}(e,t):(0,o.Bg)()}_makeFieldInputFromElement(e,t,n){var i,s;const{arcadeEditType:o,feature:a,initialFeature:l,layer:r,timeZone:u}=t,{fieldName:d}=e,c=d&&this._layerFieldsByName.get(d);return c?new q.Z({arcadeEditType:o,element:e,field:c,value:null!==(i=null===a||void 0===a?void 0:a.getAttribute(e.fieldName))&&void 0!==i?i:null,feature:a,initialFeature:l,layer:r,group:n,preservesValueWhenHidden:null===(s=this.formTemplate)||void 0===s?void 0:s.preserveFieldValuesWhenHidden,timeZone:u}):null}_makeRelationshipInputFromElement(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const{map:i}=this,{feature:s,layer:o,timeZone:a}=t,l=new he({element:e,feature:s,group:n,layer:o,map:i,timeZone:a});return l.addHandles((0,d.on)((()=>l.relatedLayer),"edits",(()=>{var e;return null===(e=this._expressionsManager)||void 0===e?void 0:e.evaluateAsyncExpressions()}))),l}_assignExpressionExecutors(e,t,n){const i=we[t.type],s=[];for(const l of i){const i="".concat(l,"Executor");if(e[i]){this._useExecutor(e[i]);continue}const r=t[l];if(null!=r&&""!==r){var o,a;const t=null!==(o=null===(a=this._expressionInfosLookup.get(r))||void 0===a?void 0:a.expression)&&void 0!==o?o:r;s.push(this._getOrCreateExecutorForExpression(t,n).then((t=>{e[i]=this._useExecutor(t)})))}}return(0,D.Wh)(e)&&s.push(...this._assignTextElementExpressionExecutors(e,n)),s}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:n}=this,i=[];for(const s of e.expressionsUsed){const o=n.get(s);null!=o?i.push(this._getOrCreateExecutorForExpression(o.expression,t).then((t=>e.setExpressionExecutor(s,this._useExecutor(t))))):l.Z.getLogger(this).error("feature-form:expression-not-found","Could not find expressionInfo object with name '".concat(s,"'"))}for(const s of e.fieldsUsed){const n="return $feature['".concat(s,"'];");i.push(this._getOrCreateExecutorForExpression(n,t).then((t=>e.setFieldExecutor(s,this._useExecutor(t)))))}return i}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:n}=this;if(n.has(e))return n.get(e);if(t.has(e))return t.get(e);const i=(async(e,t)=>{const n=(0,$.createArcadeProfile)("form-calculation"),i=await(0,$.createArcadeExecutor)(e,n,{});return null!==t&&void 0!==t&&t.fieldsIndex&&(i.fieldsUsed=(0,L.Q0)(t.fieldsIndex,i.fieldsUsed)),new Q({executor:i})})(e,this.layer);t.set(e,i);const s=await i;return n.set(e,s),s}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:n,allFieldInputs:i,formTemplate:s}=this;this._expressionsManager=new ee({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:i,preserveFieldValuesWhenHidden:!0===(null===s||void 0===s?void 0:s.preserveFieldValuesWhenHidden)})}async _startExpressions(){if(0===this._expressionExecutorsInUse.size)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),await this._expressionsManager.evaluateAll().finally((()=>this._afterExpressionsEvaluated()))}_stopExpressions(){this._expressionsManager=(0,r.SC)(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){const{name:t,value:n}=e,{_featureClone:i,formTemplate:s,layer:o}=this;if(!o)return;const a=i.getAttribute(t);i.setAttribute(t,n);const{typeFieldName:l,types:r}=(0,D.ZP)(o);if((e.isSubtypeField||t===l)&&n!==a){if("subtype-sublayer"===o.type){var u;const e=null===(u=o.parent)||void 0===u?void 0:u.findSublayerForFeature(i);i.sourceLayer=this.feature.sourceLayer=e}const e=new Set;for(const t of r)if(t.domains&&"object"==typeof t.domains)for(const n of Object.keys(t.domains))e.add(n);for(const t of e){const e=this.findField(t);e&&e.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(null!=s){const{description:e,title:n}=s;n&&(0,c.pZ)(n,t)&&this.notifyChange("formTitle"),e&&(0,c.pZ)(e,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(null==e)return[];const{typeFieldName:t}=(0,D.ZP)(this.layer),n=t?this.getValue(t):null,i=[];for(const a of e.fieldGroups){const{contingencies:e,fields:t,name:s}=a,o=[];for(const i of e)i.isRetired||null!=i.subtype&&i.subtype.code!==n||o.push({values:i.values});o.length>0&&i.push({name:s,fields:t,contingencies:o})}const[s,o]=this._generateJoinPlan(i);return[...s.flatMap((e=>this._joinFieldGroupContingencies(e))),...o.flatMap((e=>e.contingencies))]}_generateJoinPlan(e){const t=new Map,n=[],i=new Set;for(const r of e)for(const e of r.fields)if(t.has(e)){const s=t.get(e),o=r,a=[s.name,o.name].sort().join("|");if(i.has(a))continue;n.push([s,o]),i.add(a),t.set(e,o)}else t.set(e,r);const s=new Set(n.flat()),o=new Set(e);for(const r of s)o.delete(r);const a=new Map,l=new Map;for(const r of new Set(n.flat())){const e=Symbol(r.name);a.set(e,new Set([r])),l.set(r,e)}for(const[r,u]of n){const e=l.get(r),t=l.get(u);if(e===t)continue;const n=a.get(e),i=a.get(t);for(const s of i)n.add(s),l.set(s,e);a.delete(t)}return[[...a.values()].map((e=>[...e])),[...o]]}_joinFieldGroupContingencies(e){const t=e.slice(),n=t.shift();let i=t.shift(),s=this._generateJoinKey(n.fields,i.fields),o=new Set([...n.fields,...i.fields]),a=new Map;for(const d of n.contingencies){var l;const[e]=this._hashContingency(d,s.codedValueFields,!0);a.has(e)?null===(l=a.get(e))||void 0===l||l.push(d):a.set(e,[d])}for(;t.length>0;){const e=new Map,n=t.shift(),l=this._generateJoinKey(o,n.fields);for(const t of i.contingencies){const[n,i]=this._hashContingency(t,s.codedValueFields),o=i?this._findMatchingContingenciesWithAnyHashMask(a,n):a.get(n);if(a.has(Fe)&&null!==o&&void 0!==o&&o.push(...this._findMatchingContingenciesContainingAny(t,a.get(Fe),s.codedValueFields)),null!=o)for(const a of o){var r;const n=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(a,t,s.rangeFields):this._joinContingencies(a,t);if(null==n)break;const[i]=this._hashContingency(n,l.codedValueFields,!0);e.has(i)?null===(r=e.get(i))||void 0===r||r.push(n):e.set(i,[n])}}a=e,i=n,s=l,o=new Set([...o,...i.fields])}const u=[];for(const d of i.contingencies){const[e,t]=this._hashContingency(d,s.codedValueFields),n=t?this._findMatchingContingenciesWithAnyHashMask(a,e):a.get(e);if(a.has(Fe)&&n.push(...this._findMatchingContingenciesContainingAny(d,a.get(Fe),s.codedValueFields)),null!=n)for(const i of n){const e=s.rangeFields.length>0?this._joinContingenciesWithRangeDomains(i,d,s.rangeFields):this._joinContingencies(i,d);null!=e&&u.push(e)}}return u}_joinContingencies(e,t){const n={values:{...e.values,...t.values}};for(const[i,s]of Object.entries(n.values))"any"===s.objectType&&null!=e.values[i]&&(n.values[i]=e.values[i]);return n}_joinContingenciesWithRangeDomains(e,t,n){const i=this._joinContingencies(e,t);for(const s of n){const n=e.values[s],o=t.values[s],{leftIsNull:a,rightIsNull:l,bothAreNull:r,leftIsAny:u,rightIsAny:d,bothAreAny:c,leftIsRange:p,rightIsRange:h}=this._compareObjectTypes(n.objectType,o.objectType);if(r||c)continue;if(a&&d||l&&u){i.values[s]=new _({objectType:"null"});continue}if(a&&h||l&&p)return null;u?(n.minValue=-1/0,n.maxValue=1/0):d&&(o.minValue=-1/0,o.maxValue=1/0);const m=Math.max(n.minValue,o.minValue),f=Math.min(n.maxValue,o.maxValue);if(m>f)return null;i.values[s]=new _({objectType:"range",minValue:m,maxValue:f})}return i}_findMatchingContingenciesContainingAny(e,t,n){return t.filter((t=>n.every((n=>{var i,s;const o=t.values[n],a=e.values[n];return"any"===o.objectType||"any"===a.objectType||(null===(i=o.codedValue)||void 0===i?void 0:i.code)===(null===(s=a.codedValue)||void 0===s?void 0:s.code)}))))}_findMatchingContingenciesWithAnyHashMask(e,t){const n=RegExp("".concat(t,"$")),i=[];for(const[s,o]of e){if(s===Fe)break;n.test(s)&&i.push(...o)}return i}_generateJoinKey(e,t){const n=Array.isArray(e)?new Set(e):e,i=Array.isArray(t)?new Set(t):t,s=n.size<i.size?n:i,o=s===n?i:n,a=new Set,l=new Set;for(const u of s)if(o.has(u)){var r;const e=null===(r=this.layer)||void 0===r?void 0:r.getFieldDomain(u,{feature:this.feature});if(null==e)continue;switch(e.type){case"coded-value":a.add(u);break;case"range":l.add(u)}}return{codedValueFields:[...a],rangeFields:[...l]}}_contingencyIsValid(e,t){const n={};for(const{name:i,value:s}of this.allFieldInputs)this.fieldsWithContingentValues.has(i)&&null!=s&&i!==e&&(n[i]=s);return Object.entries(n).every((e=>{let[n,i]=e;return!t.values.hasOwnProperty(n)||(0,D.zN)(i,t.values[n])}))}_getContingentValueOptionsForField(e,t){const n=this.joinedContingentValues.slice(),i=new Map,s={code:"",name:null!==t&&void 0!==t?t:"No value"};for(const o of n){const t=o.values[e];if("code"===(null===t||void 0===t?void 0:t.objectType)||"null"===(null===t||void 0===t?void 0:t.objectType)){const{code:n,name:a}=t.codedValue&&"null"!==t.objectType?t.codedValue:s;!i.has(n)&&this._contingencyIsValid(e,o)&&i.set(n,{name:a,value:n})}}return[...i.values()]}_hashContingency(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length<1)return["#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",!1];const i=[];let s=!1;for(const a of t){var o;const t=e.values[a];if("any"===t.objectType){if(n)return[Fe,!0];s=!0,i.push("".concat(a,":.*"))}else"null"===t.objectType?i.push("".concat(a,":").concat("#JSAPI_CONTINGENT_VALUE_NULL_HASH")):i.push("".concat(a,":").concat(null===(o=t.codedValue)||void 0===o?void 0:o.code))}return[i.sort().join("&"),s]}_compareObjectTypes(e,t){return{leftIsNull:"null"===e,rightIsNull:"null"===t,bothAreNull:"null"===e&&"null"===t,leftIsAny:"any"===e,rightIsAny:"any"===t,bothAreAny:"any"===e&&"any"===t,leftIsRange:"range"===e,rightIsRange:"range"===t}}};function Re(e){return"field"===e.type||"group"===e.type||"relationship"===e.type||"text"===e.type||(Ie().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported","Element ".concat(e.label," has unsupported type '").concat(e.type,"'")),!1)}(0,i._)([(0,p.Cb)()],Ee.prototype,"_expressionInfosLookup",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"_featureClone",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"_timeZone",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"activeRelationshipInput",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"_arcadeContextInfo",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"allFieldInputs",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"allGroupInputs",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"allRelationshipInputs",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"_layerFieldsByName",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"arcadeEditType",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"contingencyConstraintViolations",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"disabled",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"feature",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"fieldsWithContingentValues",null),(0,i._)([(0,p.Cb)({type:f.Z})],Ee.prototype,"formTemplate",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"formDescription",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"formTitle",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"formHeaderVisible",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"highlightHelper",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"inputs",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"joinedContingentValues",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"layer",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"map",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"relatedRecordCallbacks",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"relationshipId",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"spatialReference",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"state",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"strict",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"submittable",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"timeZone",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"updating",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"valid",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"hasPendingSubtypeChoice",void 0),(0,i._)([(0,p.Cb)()],Ee.prototype,"getValues",null),(0,i._)([(0,p.Cb)()],Ee.prototype,"submit",null),Ee=(0,i._)([(0,h.j)(Ve)],Ee);const Te=Ee}}]);
//# sourceMappingURL=76385.1902a73b.chunk.js.map