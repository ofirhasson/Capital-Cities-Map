"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[24098],{72291:(e,t,s)=>{s.d(t,{i:()=>x,K:()=>S});s(93169);var o=s(29303),i=s(8768),r=s(10106),n=s(92026),l=s(18722),a=(s(37995),s(73828)),c=(s(32344),s(85269),s(50127)),h=s(44070),y=s(8548),u=s(45412);class d{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let s=1;const o=new Uint32Array(e);this.layerUIDs=[];const i=o[s++];for(let r=0;r<i;r++)this.layerUIDs[r]=o[s++];this.bufferDataOffset=s,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}class f extends d{constructor(e,t){super(e,t),this.type=r.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const s=new Uint32Array(e);let o=this.bufferDataOffset;this.lineIndexStart=s[o++],this.lineIndexCount=s[o++];const i=s[o++];if(i>0){this.patternMap=new Map;for(let e=0;e<i;e++){const e=s[o++],t=s[o++],i=s[o++];this.patternMap.set(e,[t,i])}}this.bufferDataOffset=o}get memoryUsed(){var e,t,s,o;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(o=this.vao)||void 0===o?void 0:o.usedMemory)&&void 0!==s?s:0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=(0,n.M2)(this.vao)}doPrepareForRendering(e,t,s){const o=new Uint32Array(t),i=new Int32Array(o.buffer),r=o[s++],n=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,r));s+=r;const l=o[s++],a=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,l));s+=l;const c=this.layer.lineMaterial;this.vao=new u.U(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:n},a)}}class m extends d{constructor(e,t){super(e,t),this.type=r.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const s=new Uint32Array(e);let o=this.bufferDataOffset;this.fillIndexStart=s[o++],this.fillIndexCount=s[o++],this.outlineIndexStart=s[o++],this.outlineIndexCount=s[o++];const i=s[o++];if(i>0){this.patternMap=new Map;for(let e=0;e<i;e++){const e=s[o++],t=s[o++],i=s[o++];this.patternMap.set(e,[t,i])}}this.bufferDataOffset=o}get memoryUsed(){var e,t,s,o,i,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(o=this.fillVAO)||void 0===o?void 0:o.usedMemory)&&void 0!==s?s:0)+(null!==(i=null===(r=this.outlineVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=(0,n.M2)(this.fillVAO),this.outlineVAO=(0,n.M2)(this.outlineVAO)}doPrepareForRendering(e,t,s){const o=new Uint32Array(t),i=new Int32Array(o.buffer),r=o[s++],n=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,r));s+=r;const l=o[s++],a=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,l));s+=l;const c=o[s++],d=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,c));s+=c;const f=o[s++],m=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,f));s+=f;const p=this.layer,g=p.fillMaterial,b=p.outlineMaterial;this.fillVAO=new u.U(e,g.getAttributeLocations(),g.getLayoutInfo(),{geometry:n},a),this.outlineVAO=new u.U(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:d},m)}}class p extends d{constructor(e,t,s){super(e,t),this.type=r.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const o=new Uint32Array(e),i=new Int32Array(e),n=new Float32Array(e);let l=this.bufferDataOffset;this.isIconSDF=!!o[l++];const h=o[l++],y=o[l++],u=o[l++],d=new a.Z(h,y,u,0),f=o[l++];for(let r=0;r<f;r++){const e=o[l++],t=o[l++],s=o[l++];this.iconPerPageElementsMap.set(e,[t,s])}const m=o[l++];for(let r=0;r<m;r++){const e=o[l++],t=o[l++],s=o[l++];this.glyphPerPageElementsMap.set(e,[t,s])}const p=o[l++],g=o[l++];this.iconOpacity=new Int32Array(p),this.textOpacity=new Int32Array(g),l=(0,c.wB)(o,i,n,l,this.symbols,s,d),this.bufferDataOffset=l}get memoryUsed(){var e,t,s,o,i,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(o=this.iconVAO)||void 0===o?void 0:o.usedMemory)&&void 0!==s?s:0)+(null!==(i=null===(r=this.textVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)+(0,l.Xw)(this.iconOpacity)+(0,l.Xw)(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[t,s]of this.iconPerPageElementsMap)e+=s[1];for(const[t,s]of this.glyphPerPageElementsMap)e+=s[1];return e/3}doDestroy(){this.iconVAO=(0,n.M2)(this.iconVAO),this.textVAO=(0,n.M2)(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,t=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);const s=this.textOpacity,o=this.textVAO.vertexBuffers.opacity;s.length>0&&s.byteLength===o.usedMemory&&o.setSubData(s,0,0,s.length)}doPrepareForRendering(e,t,s){const o=new Uint32Array(t),i=new Int32Array(o.buffer),r=o[s++],n=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,r));s+=r;const l=o[s++],a=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,l));s+=l;const c=o[s++],d=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,c));s+=c;const f=o[s++],m=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,f));s+=f;const p=h.f.createVertex(e,y.l1.STATIC_DRAW,this.iconOpacity.buffer),g=h.f.createVertex(e,y.l1.STATIC_DRAW,this.textOpacity.buffer),b=this.layer,_=b.iconMaterial,x=b.textMaterial;this.iconVAO=new u.U(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:n,opacity:p},a),this.textVAO=new u.U(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:d,opacity:g},m)}}class g extends d{constructor(e,t){super(e,t),this.type=r.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const s=new Uint32Array(e);let o=this.bufferDataOffset;this.circleIndexStart=s[o++],this.circleIndexCount=s[o++],this.bufferDataOffset=o}get memoryUsed(){var e,t,s,o;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(s=null===(o=this.vao)||void 0===o?void 0:o.usedMemory)&&void 0!==s?s:0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=(0,n.M2)(this.vao)}doPrepareForRendering(e,t,s){const o=new Uint32Array(t),i=new Int32Array(o.buffer),r=o[s++],n=h.f.createVertex(e,y.l1.STATIC_DRAW,new Int32Array(i.buffer,4*s,r));s+=r;const l=o[s++],a=h.f.createIndex(e,y.l1.STATIC_DRAW,new Uint32Array(o.buffer,4*s,l));s+=l;const c=this.layer.circleMaterial;this.vao=new u.U(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:n},a)}}var b=s(46618),_=s(72900);class x extends _.I{constructor(e,t,s,o,i,r,n){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;super(e,t,s,o,i,r,4096,4096),this.styleRepository=n,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<b.v7}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<b.v7)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){var t,s;let o=!1;for(const i of e){const e=this.layerData.get(i);e&&(this._memoryUsedByLayerData-=e.memoryUsed,e.type===r.al.SYMBOL&&this.symbols.delete(i)&&(o=!0),e.destroy(),this.layerData.delete(i))}null!==(t=this._memCache)&&void 0!==t&&t.updateSize(this.key.id,this,this._memoryUsedByLayerData),o&&(null!==(s=this.featureIndex)&&void 0!==s&&s.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}dispose(){"unloaded"!==this.status&&(this.featureIndex=null,w.delete(this),x._destroyRenderBuckets(this.layerData),this.layerData.clear(),this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get usedMemory(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var t;null===(t=this.featureIndex)||void 0===t||t.clear();let s=!1;if(e){var o;const{bucketsWithData:t,emptyBuckets:i}=e,n=this._createRenderBuckets(t);if(i&&i.byteLength>0){const e=new Uint32Array(i);for(const t of e)this._deleteLayerData(t)}for(const[e,o]of n)this._deleteLayerData(e),o.type===r.al.SYMBOL&&(this.symbols.set(e,o.symbols),s=!0),this._memoryUsedByLayerData+=o.memoryUsed,this.layerData.set(e,o);null===(o=this._memCache)||void 0===o||o.updateSize(this.key.id,this,this.usedMemory)}this._hasSymbolBuckets=!1;for(const[i,n]of this.layerData)n.type===r.al.SYMBOL&&(this._hasSymbolBuckets=!0);s&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),s=this.width/this.rangeX*t,i=this.height/this.rangeY*t,r=[0,0];e.toScreen(r,[this.x,this.y]);const n=this.transforms.tileUnitsToPixels;(0,o.yR)(n),(0,o.Iu)(n,n,r),(0,o.U1)(n,n,Math.PI*e.rotation/180),(0,o.bA)(n,n,[s,i,1])}_createTransforms(){return{displayViewScreenMat3:(0,i.Ue)(),tileMat3:(0,i.Ue)(),tileUnitsToPixels:(0,i.Ue)()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;for(const s of e.values())t.has(s)||(s.destroy(),t.add(s));e.clear()}_createRenderBuckets(e){const t=new Map,s=new Map;for(const o of e){const e=this._deserializeBucket(o,s);for(const s of e.layerUIDs)t.set(s,e)}return t}_deserializeBucket(e,t){let s=t.get(e);if(s)return s;switch(new Uint32Array(e)[0]){case r.al.FILL:s=new m(e,this.styleRepository);break;case r.al.LINE:s=new f(e,this.styleRepository);break;case r.al.SYMBOL:s=new p(e,this.styleRepository,this);break;case r.al.CIRCLE:s=new g(e,this.styleRepository)}return t.set(e,s),s}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e)}}const w=new Map;function S(){w.forEach(((e,t)=>{console.log("\n".concat(t.key,":")),e[0].forEach((e=>console.log(e))),console.log("========"),e[1].forEach((e=>console.log(e)))}))}},12463:(e,t,s)=>{s.d(t,{g:()=>r});var o=s(46618);function i(e,t){if(e.priority-t.priority)return e.priority-t.priority;const s=e.tile.key,o=t.tile.key;return s.world-o.world?s.world-o.world:s.level-o.level?s.level-o.level:s.row-o.row?s.row-o.row:s.col-o.col?s.col-o.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class r{get running(){return this._running}constructor(e,t,s,o,i,r){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=s,this._assignTileSymbolsOpacity=o,this._symbolLayerSorter=i,this._isLayerVisible=r,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_createSelectionJob(){const e=this._symbolRepository.uniqueSymbols;for(let i=0;i<e.length;i++){const t=e[i];for(let e=0;e<t.uniqueSymbols.length;e++){const s=t.uniqueSymbols[e];for(const e of s.tileSymbols)e.selectedForRendering=!1}}const t=[];let s=0,o=0;const r=this._isLayerVisible;const n=this._symbolLayerSorter;return{work:function(n){let l;const a=performance.now();for(;o<e.length;o++,s=0){const i=e[o],c=i.styleLayerUID;if(!r(c)){t[o]||(t[o]={styleLayerUID:c,symbols:[]});continue}t[o]=t[o]||{styleLayerUID:c,symbols:[]};const h=t[o];for(;s<i.uniqueSymbols.length;s++){if(l=i.uniqueSymbols[s],s%100==99&&performance.now()-a>n)return!1;let e=null,t=!1,o=!1;for(const s of l.tileSymbols)if(!o||!t){const i=s.tile;(!e||i.isCoverage||i.neededForCoverage&&!t)&&(e=s,(i.neededForCoverage||i.isCoverage)&&(o=!0),i.isCoverage&&(t=!0))}if(e.selectedForRendering=!0,o){h.symbols.push(e),l.show=!0;for(const e of l.parts)e.show=!0}else l.show=!1}}for(const e of t)e.symbols.sort(i);return!0},get sortedSymbols(){return t.sort(n)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,t=this._visibleTiles;let s=0;function o(t,s){const i=t.symbols;for(const[e,o]of i)n(o,s);e(t,s);for(const e of t.childrenTiles)o(e,s)}return{work(e){const i=performance.now();for(;s<t.length;s++){if(performance.now()-i>e)return!1;const r=t[s];null==r.parentTile&&o(r,performance.now())}return!0}}}}function n(e,t){for(const s of e){const e=s.unique;for(const s of e.parts){const i=s.targetOpacity>.5?1:-1;s.startOpacity+=i*((t-s.startTime)/o.v7),s.startOpacity=Math.min(Math.max(s.startOpacity,0),1),s.startTime=t,s.targetOpacity=e.show&&s.show?1:0}}}},36210:(e,t,s)=>{s.d(t,{L:()=>i});var o=s(50127);class i{constructor(e,t,s){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=s,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}get uniqueSymbolsReferences(){return this._uniqueSymbolsReferences}add(e,t){this._uniqueSymbolLayerArray=null;let s=this._tiles.get(e.id);s||(s={symbols:new Map},this._tiles.set(e.id,s));const i=new Map;if(t)for(const o of t)s.symbols.has(o)&&(i.set(o,s.symbols.get(o)),s.symbols.delete(o));else for(const[o,l]of e.layerData)s.symbols.has(o)&&(i.set(o,s.symbols.get(o)),s.symbols.delete(o));this._removeSymbols(i);const r=e.symbols,n=new Map;for(const[l,a]of r){let e=a.length;if(e>=32){let t=this.tileCoordRange;do{t/=2,e/=4}while(e>8&&t>64);const i=new o.HX(this.tileCoordRange,this.tileCoordRange,t);n.set(l,{flat:a,index:i}),s.symbols.set(l,{flat:a,index:i});for(const e of a)i.getCell(e.xTile,e.yTile).push(e)}else n.set(l,{flat:a}),s.symbols.set(l,{flat:a})}this._addSymbols(e.key,r)}deleteStyleLayers(e){this._uniqueSymbolLayerArray=null;for(const[t,s]of this._tiles){const o=new Map;for(const t of e)s.symbols.has(t)&&(o.set(t,s.symbols.get(t)),s.symbols.delete(t));this._removeSymbols(o),0===s.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;const t=this._tiles.get(e.id);if(!t)return;const s=new Map;for(const[o,i]of e.symbols)t.symbols.has(o)&&(s.set(o,t.symbols.get(o)),t.symbols.delete(o));this._removeSymbols(s),0===t.symbols.size&&this._tiles.delete(e.id)}querySymbols(e,t,s,i){const r=[],n=this.uniqueSymbols;for(const l of n){const i=l.styleLayerUID,n=l.uniqueSymbols;for(const l of n){const n=l.tileSymbols.find((e=>e.selectedForRendering));n&&(0,o.Fe)(n,e,t*(window.devicePixelRatio||1),s)&&r.push({vtlSymbol:n,styleLayerUID:i,tileKey:n.tile.key})}}return r}_removeSymbols(e){for(const[t,{flat:s}]of e)for(const e of s){const s=e.unique,o=s.tileSymbols,i=o.length-1;for(let t=0;t<i;t++)if(o[t]===e){o[t]=o[i];break}if(o.length=i,0===i){const e=this._uniqueSymbolsReferences.get(t);e.delete(s),0===e.size&&this._uniqueSymbolsReferences.delete(t)}e.unique=null}}_addSymbols(e,t){if(0===t.size)return;const s=this._visibleTiles;for(const o of s)o.parentTile||o.key.world!==e.world||o.key.level===e.level&&!o.key.equals(e)||this._matchSymbols(o,e,t);for(const[o,i]of t)for(const e of i)if(null==e.unique){const t=this._createUnique();e.unique=t,t.tileSymbols.push(e);let s=this._uniqueSymbolsReferences.get(o);s||(s=new Set,this._uniqueSymbolsReferences.set(o,s)),s.add(t)}}_matchSymbols(e,t,s){if(e.key.level>t.level){const s=e.key.level-t.level;if(e.key.row>>s!==t.row||e.key.col>>s!==t.col)return}if(t.level>e.key.level){const s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){for(const o of e.childrenTiles)this._matchSymbols(o,t,s);return}const i=new Map;for(const[r,n]of s){const s=[];for(const i of n){const r=(0,o.co)(this.tileCoordRange,i.xTile,t.level,t.col,e.key.level,e.key.col),n=(0,o.co)(this.tileCoordRange,i.yTile,t.level,t.row,e.key.level,e.key.row);r>=0&&r<this.tileCoordRange&&n>=0&&n<this.tileCoordRange&&s.push({symbol:i,xTransformed:r,yTransformed:n})}const l=[],a=20+(e.key.level<t.level?1:1<<e.key.level-t.level),c=this._tiles.get(e.id).symbols.get(r);if(c){const e=c.flat;for(const t of s){let s,o=!1;const i=t.xTransformed,r=t.yTransformed;s=null!=c.index?c.index.getCell(i,r):e;const n=t.symbol,h=n.hash;for(const e of s)if(h===e.hash&&Math.abs(i-e.xTile)<=a&&Math.abs(r-e.yTile)<=a){const t=e.unique;n.unique=t,t.tileSymbols.push(n),o=!0;break}o||l.push(n)}}l.length>0&&i.set(r,l)}for(const o of e.childrenTiles)this._matchSymbols(o,t,i)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsReferences,t=new Array(e.size);let s,o=0;for(const[i,r]of e){const e=new Array(r.size);s=0;for(const t of r)e[s++]=t;t[o]={styleLayerUID:i,uniqueSymbols:e},o++}return t}}},38684:(e,t,s)=>{s.d(t,{J:()=>i,a:()=>o});class o{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class i{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},42121:(e,t,s)=>{s.d(t,{f:()=>a});var o=s(8768),i=s(46618),r=s(50127),n=s(21391);function l(e,t,s,o,i,r){const{iconRotationAlignment:l,textRotationAlignment:a,iconTranslate:c,iconTranslateAnchor:h,textTranslate:y,textTranslateAnchor:u}=o;let d=0;for(const f of e.colliders){const[e,o]=0===f.partIndex?c:y,m=0===f.partIndex?h:u,p=f.minLod<=r&&r<=f.maxLod;d+=p?0:1,f.enabled=p,f.xScreen=f.xTile*i[0]+f.yTile*i[3]+i[6],f.yScreen=f.xTile*i[1]+f.yTile*i[4]+i[7],m===n.fD.MAP?(f.xScreen+=s*e-t*o,f.yScreen+=t*e+s*o):(f.xScreen+=e,f.yScreen+=o),n.aF.VIEWPORT===(0===f.partIndex?l:a)?(f.dxScreen=f.dxPixels,f.dyScreen=f.dyPixels):(f.dxScreen=s*(f.dxPixels+f.width/2)-t*(f.dyPixels+f.height/2)-f.width/2,f.dyScreen=t*(f.dxPixels+f.width/2)+s*(f.dyPixels+f.height/2)-f.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class a{constructor(e,t,s,n,l,a){this._symbols=e,this._styleRepository=n,this._zoom=l,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new r.HX(t,s,i.cn),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180);for(const i of e)for(const e of i.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,(0,o.d9)(e.tile.transforms.tileUnitsToPixels))}work(e){const t=this._gridIndex;function s(e){const s=e.xScreen+e.dxScreen,o=e.yScreen+e.dyScreen,i=s+e.width,r=o+e.height,[n,l,a,c]=t.getCellSpan(s,o,i,r);for(let h=l;h<=c;h++)for(let e=n;e<=a;e++){const n=t.cells[h][e];for(const e of n){const t=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,l=t+e.width,a=n+e.height;if(!(i<t||s>l||r<n||o>a))return!0}}return!1}const o=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const t=this._symbols[this._currentLayerCursor],i=this._getProperties(t.styleLayerUID);for(;this._currentSymbolCursor<t.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-o>e)return!1;const r=t.symbols[this._currentSymbolCursor];if(!r.unique.show)continue;l(r,this._si,this._co,i,this._allNeededMatrices.get(r.tile),this._zoom);const n=r.unique;if(!n.show)continue;const{iconAllowOverlap:a,iconIgnorePlacement:c,textAllowOverlap:h,textIgnorePlacement:y}=i;for(const e of r.colliders){if(!e.enabled)continue;const t=n.parts[e.partIndex];t.show&&(!(e.partIndex?h:a)&&s(e)&&(e.hard?n.show=!1:t.show=!1))}if(n.show)for(const e of r.colliders){if(!e.enabled)continue;if(e.partIndex?y:c)continue;if(!n.parts[e.partIndex].show)continue;const t=e.xScreen+e.dxScreen,s=e.yScreen+e.dyScreen,o=t+e.width,i=s+e.height,[r,l,a,h]=this._gridIndex.getCellSpan(t,s,o,i);for(let n=l;n<=h;n++)for(let t=r;t<=a;t++)this._gridIndex.cells[n][t].push(e)}}}return!0}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const s=this._zoom,o=this._styleRepository.getStyleLayerByUID(e),i=o.getLayoutValue("symbol-placement",s)!==n.R.POINT;let r=o.getLayoutValue("icon-rotation-alignment",s);r===n.aF.AUTO&&(r=i?n.aF.MAP:n.aF.VIEWPORT);let l=o.getLayoutValue("text-rotation-alignment",s);l===n.aF.AUTO&&(l=i?n.aF.MAP:n.aF.VIEWPORT);const a=o.getPaintValue("icon-translate",s),c=o.getPaintValue("icon-translate-anchor",s),h=o.getPaintValue("text-translate",s),y=o.getPaintValue("text-translate-anchor",s),u={iconAllowOverlap:o.getLayoutValue("icon-allow-overlap",s),iconIgnorePlacement:o.getLayoutValue("icon-ignore-placement",s),textAllowOverlap:o.getLayoutValue("text-allow-overlap",s),textIgnorePlacement:o.getLayoutValue("text-ignore-placement",s),iconRotationAlignment:r,textRotationAlignment:l,iconTranslateAnchor:c,iconTranslate:a,textTranslateAnchor:y,textTranslate:h};return this._styleProps.set(e,u),u}}},50127:(e,t,s)=>{s.d(t,{C$:()=>c,Fe:()=>y,HX:()=>l,co:()=>n,wB:()=>a});var o=s(10106),i=s(99201),r=s(38684);function n(e,t,s,o,i,r){const n=s-i;if(n>=0)return(t>>n)+(o-(r<<n))*(e>>n);const l=-n;return t-(r-(o<<l))*(e>>l)<<l}class l{constructor(e,t,s){this._rows=Math.ceil(t/s),this._columns=Math.ceil(e/s),this._cellSize=s,this.cells=new Array(this._rows);for(let o=0;o<this._rows;o++){this.cells[o]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[o][e]=[]}}getCell(e,t){const s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),o=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[s]&&this.cells[s][o]||null}getCellSpan(e,t,s,o){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(o/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function a(e,t,s,o,i,n,l){const a=t[o++];for(let c=0;c<a;c++){const a=new r.a(n,l);a.xTile=t[o++],a.yTile=t[o++],a.hash=t[o++],a.priority=t[o++],a.featureIndex=t[o++];const c=t[o++];for(let e=0;e<c;e++){const e=t[o++],i=t[o++],r=t[o++],n=t[o++],l=!!t[o++],c=t[o++],h=s[o++],y=s[o++],u=t[o++],d=t[o++];a.colliders.push({xTile:e,yTile:i,dxPixels:r,dyPixels:n,hard:l,partIndex:c,width:u,height:d,minLod:h,maxLod:y})}const h=e[o++];for(let t=0;t<h;t++)a.textVertexRanges.push([e[o++],e[o++]]);const y=e[o++];for(let t=0;t<y;t++)a.iconVertexRanges.push([e[o++],e[o++]]);i.push(a)}return o}function c(e,t,s){for(const[o,i]of e.symbols)h(e,t,s,i,o)}function h(e,t,s,i,r){const n=e.layerData.get(r);if(n.type===o.al.SYMBOL){for(const t of i){const o=t.unique;let i;if(t.selectedForRendering){const t=o.parts[0],r=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*r)|n<<7:n?255:0;i=l<<24|l<<16|l<<8|l}else i=0;for(const[e,s]of t.iconVertexRanges)for(let t=e;t<e+s;t+=4)n.iconOpacity[t/4]=i;if(t.selectedForRendering){const t=o.parts[1],r=t.startOpacity,n=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===n;const l=s?Math.floor(127*r)|n<<7:n?255:0;i=l<<24|l<<16|l<<8|l}else i=0;for(const[e,s]of t.textVertexRanges)for(let t=e;t<e+s;t+=4)n.textOpacity[t/4]=i}n.lastOpacityUpdate=t,n.opacityChanged=!0}}function y(e,t,s,o){const r=e.colliders;let n,l,a,c;for(const h of r)if(e.unique.show&&e.unique.parts[h.partIndex].show&&(n=h.xScreen-o[0]+h.dxScreen,l=h.yScreen-o[1]+h.dyScreen,a=n+h.width,c=l+h.height,(0,i.Px)(s,t.x,t.y,n,l,a,c)))return!0;return!1}},10106:(e,t,s)=>{var o,i,r;s.d(t,{Fr:()=>r,_K:()=>i,al:()=>o}),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(o||(o={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(i||(i={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(r||(r={}))},87071:(e,t,s)=>{s.d(t,{H:()=>r});var o=s(8768),i=s(72900);class r extends i.I{_createTransforms(){return{displayViewScreenMat3:(0,o.Ue)(),tileMat3:(0,o.Ue)()}}}}}]);
//# sourceMappingURL=24098.6a8125b4.chunk.js.map