"use strict";(self.webpackChunknorthwind=self.webpackChunknorthwind||[]).push([[21993,70116,45276],{70116:(e,t,n)=>{var i;n.d(t,{Y:()=>i}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(i||(i={}))},47898:(e,t,n)=>{n.d(t,{Fp:()=>d,GJ:()=>o,M1:()=>a,MQ:()=>p,Ww:()=>f,bA:()=>u,hw:()=>m,mE:()=>c,ne:()=>s,nn:()=>l,qF:()=>v,yG:()=>r,yP:()=>h});var i=n(68860);function a(e){return{value:e}}function r(e,t){return{type:(0,i.UF)(t),value:e,unit:t}}function s(e,t){return{type:(0,i.UF)(t),value:e,unit:t}}function o(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arithmetic";return{type:(0,i.UF)(t),value:e,unit:t,rotationType:n}}function l(e,t){const n=c(e,t);return"angle"===e.type?o(n,t,e.rotationType):function(e,t){return{type:(0,i.UF)(t),value:e,unit:t}}(n,t)}function c(e,t){return(0,i.En)(e.value,e.unit,t)}function d(e,t){return null==e?t:null==t||e.value>(0,i.En)(t.value,t.unit,e.unit)?e:t}function u(e,t){return null==e?null:{...e,value:e.value*t}}function m(e,t,n){if(t===n)return e;switch(n){case"arithmetic":case"geographic":return 90-e}}const h=r(0,"meters"),p=s(0,"square-meters"),f=(o(0,"radians"),o(0,"degrees")),v=o(0,"degrees","geographic")},5163:(e,t,n)=>{n.d(t,{L4:()=>F,LO:()=>m,Qv:()=>d,Rd:()=>h,Ud:()=>g,VG:()=>u,Wv:()=>f,Zv:()=>b,_o:()=>M,aC:()=>_,h9:()=>v,ld:()=>I,mg:()=>p,q6:()=>y,sS:()=>E,yc:()=>w});var i=n(70116),a=n(17768),r=n(16889),s=n(47898),o=n(643),l=n(68860),c=n(6291);function d(e,t,n){return e.units[t][n]}function u(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return"".concat((0,c.uf)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})," ").concat(d(e,n,a))}function m(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return"".concat((0,c.uf)(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:"exceptZero"})," ").concat(d(e,n,a))}function h(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Y8)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}function p(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Y8)(t,n);return m(e,(0,l.En)(t,n,r),r,i,a)}function f(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Dw)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}function v(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Dw)(t,n);return m(e,(0,l.En)(t,n,r),r,i,a)}function g(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Q7)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}function y(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.Q7)(t,n);return m(e,(0,l.En)(t,n,r),r,i,a)}function b(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.jl)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}function _(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.jl)(t,n);return m(e,(0,l.En)(t,n,r),r,i,a)}function I(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.ZI)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}function w(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const r=(0,l.LV)(t,n);return u(e,(0,l.En)(t,n,r),r,i,a)}const A=(e,t)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:t,minimumFractionDigits:t,signDisplay:e>0?"never":"exceptZero"});function F(e,t,n,i,r){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a.BV,d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=o.normalize((0,s.hw)((0,l.En)(e,t,"degrees"),n,i),0,d);const m=A(u,null!==r&&void 0!==r?r:2);return u=T(u,m),(0,c.uf)(u,m)}function M(e,t,n,i,a){var r;n!==i&&(e=-e);const s={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:a=null!==(r=a)&&void 0!==r?r:2,minimumFractionDigits:a,signDisplay:"exceptZero"};let o=(0,l.En)(e,t,"degrees")%360;return o=T(o,s),(0,c.uf)(o,s)}const C=new Map;function T(e,t){const n=JSON.stringify(t);let i=C.get(n);return i||(i=new Intl.NumberFormat("en-US",t),C.set(n,i)),/^[-+]?360\.?0*\xb0?$/.test(i.format(e))?0:e}const k=["B","kB","MB","GB","TB"];function E(e,t){let n=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(i.Y.KILOBYTES));n=(0,r.uZ)(n,0,k.length-1);const a=(0,c.uf)(t/i.Y.KILOBYTES**n,{maximumFractionDigits:2});return(0,o.gx)(e.units.bytes[k[n]],{fileSize:a})}},11812:(e,t,n)=>{n.d(t,{Z:()=>m});var i,a=n(27366),r=n(46784),s=n(49861),o=n(25243),l=(n(84936),n(93169),n(69912));function c(e){const{exifInfo:t,exifName:n,tagName:i}=e;if(!t||!n||!i)return null;const a=t.find((e=>e.name===n));return a?function(e){const{tagName:t,tags:n}=e;if(!n||!t)return null;const i=n.find((e=>e.name===t));return(null===i||void 0===i?void 0:i.value)||null}({tagName:i,tags:a.tags}):null}const d={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let u=i=class extends r.wq{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=c({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return d[t]||null}clone(){return new i({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,a._)([(0,s.Cb)({type:String})],u.prototype,"contentType",void 0),(0,a._)([(0,s.Cb)()],u.prototype,"exifInfo",void 0),(0,a._)([(0,s.Cb)({readOnly:!0})],u.prototype,"orientationInfo",null),(0,a._)([(0,s.Cb)({type:o.z8})],u.prototype,"id",void 0),(0,a._)([(0,s.Cb)({type:String})],u.prototype,"globalId",void 0),(0,a._)([(0,s.Cb)({type:String})],u.prototype,"keywords",void 0),(0,a._)([(0,s.Cb)({type:String})],u.prototype,"name",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],u.prototype,"parentGlobalId",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],u.prototype,"parentObjectId",void 0),(0,a._)([(0,s.Cb)({type:o.z8})],u.prototype,"size",void 0),(0,a._)([(0,s.Cb)({json:{read:!1}})],u.prototype,"url",void 0),u=i=(0,a._)([(0,l.j)("esri.rest.query.support.AttachmentInfo")],u);const m=u},21993:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var i=n(27366),a=n(10064),r=n(94172),s=n(5163),o=n(49861),l=n(89125),c=(n(84936),n(93169),n(69912)),d=n(33565),u=n(4819),m=n(65905);function h(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}var p=n(8905),f=n(7021),v=n(33095),g=n(80975),y=n(80532),b=n(67005);const _={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},I="esri-attachments",w={base:I,loaderContainer:"".concat(I,"__loader-container"),loader:"".concat(I,"__loader"),fadeIn:"".concat(I,"--fade-in"),container:"".concat(I,"__container"),containerList:"".concat(I,"__container--list"),containerPreview:"".concat(I,"__container--preview"),actions:"".concat(I,"__actions"),deleteButton:"".concat(I,"__delete-button"),addAttachmentButton:"".concat(I,"__add-attachment-button"),errorMessage:"".concat(I,"__error-message"),items:"".concat(I,"__items"),item:"".concat(I,"__item"),itemButton:"".concat(I,"__item-button"),itemMask:"".concat(I,"__item-mask"),itemMaskIcon:"".concat(I,"__item-mask--icon"),itemImage:"".concat(I,"__image"),itemImageResizable:"".concat(I,"__image--resizable"),itemLabel:"".concat(I,"__label"),itemFilename:"".concat(I,"__filename"),itemChevronIcon:"".concat(I,"__item-chevron-icon"),itemLink:"".concat(I,"__item-link"),itemLinkOverlay:"".concat(I,"__item-link-overlay"),itemLinkOverlayIcon:"".concat(I,"__item-link-overlay-icon"),itemEditIcon:"".concat(I,"__item-edit-icon"),itemAddIcon:"".concat(I,"__item-add-icon"),itemAddButton:"".concat(I,"__item-add-button"),formNode:"".concat(I,"__form-node"),fileFieldset:"".concat(I,"__file-fieldset"),fileLabel:"".concat(I,"__file-label"),fileName:"".concat(I,"__file-name"),fileInput:"".concat(I,"__file-input"),metadata:"".concat(I,"__metadata"),metadataFieldset:"".concat(I,"__metadata-fieldset"),progressBar:"".concat(I,"__progress-bar")},A=window.CSS;let F=class extends d.Z{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={..._},this._supportsImageOrientation=A&&A.supports&&A.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){var t;return null!==(t=e)&&void 0!==t&&t.viewModel||(e={viewModel:new u.Z,...e}),e}initialize(){this.addHandles([(0,r.on)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.attachmentInfos}),"change",(()=>this.scheduleRender())),(0,r.on)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.fileInfos}),"change",(()=>this.scheduleRender())),(0,r.watch)((()=>{var e;return null===(e=this.viewModel)||void 0===e?void 0:e.mode}),(()=>this._modeChanged()),r.initial)])}loadDependencies(){return(0,p.h)({icon:()=>Promise.all([n.e(92358),n.e(87474)]).then(n.bind(n,87474))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&"auto"!==e?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{..._,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new a.Z("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new a.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new a.Z("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){var t;const n=this.viewModel.deleteFile(e||(null===(t=this.viewModel.activeFileInfo)||void 0===t?void 0:t.file));return this.viewModel.mode="view",n}render(){const{submitting:e,viewModel:t}=this,{state:n}=t;return(0,b.u)("div",{class:this.classes(w.base,f.z.widget)},e?this._renderProgressBar():null,"loading"===n?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?(0,b.u)("div",{class:w.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:n}=this.viewModel;return"add"===t?this._renderAddForm():"edit"===t?this._renderDetailsForm(n||e):this._renderAttachmentContainer()}_renderLoading(){return(0,b.u)("div",{class:w.loaderContainer,key:"loader"},(0,b.u)("div",{class:w.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?(0,b.u)("div",{class:w.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:e,selectedFile:t}=this,n=e||!t,i=this.visibleElements.cancelAddButton?(0,b.u)("button",{bind:this,class:this.classes(f.z.button,f.z.buttonTertiary,f.z.buttonSmall,f.z.buttonHalf,e&&f.z.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,a=this.visibleElements.addSubmitButton?(0,b.u)("button",{class:this.classes(f.z.button,f.z.buttonSecondary,f.z.buttonSmall,f.z.buttonHalf,{[f.z.buttonDisabled]:n}),disabled:n,type:"submit"},this.messages.add):null,r=t?(0,b.u)("span",{class:w.fileName,key:"file-name"},t.name):null,s=(0,b.u)("form",{afterCreate:g.Yo,afterRemoved:g.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,b.u)("fieldset",{class:w.fileFieldset},r,(0,b.u)("label",{class:this.classes(w.fileLabel,f.z.button,f.z.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,(0,b.u)("input",{bind:this,class:w.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),a,i);return(0,b.u)("div",{class:w.formNode,key:"add-form-container"},s)}_renderDetailsForm(e){var t,n,i,a;const{visibleElements:r,viewModel:o,selectedFile:l,submitting:c}=this,{capabilities:d}=o,u=c||!l;let m,h,p,v;l?(m=l.type,h=l.name,p=l.size):e&&"file"in e?(m=e.file.type,h=e.file.name,p=e.file.size):e&&"contentType"in e&&(m=e.contentType,h=e.name,p=e.size,v=e.url);const y=d.editing&&null!==(t=d.operations)&&void 0!==t&&t.delete&&r.deleteButton?(0,b.u)("button",{bind:this,class:this.classes(f.z.button,f.z.buttonSmall,f.z.buttonTertiary,w.deleteButton,{[f.z.buttonDisabled]:c}),disabled:c,key:"delete-button",onclick:t=>this._submitDeleteAttachment(t,e),type:"button"},this.messages.delete):void 0,_=d.editing&&null!==(n=d.operations)&&void 0!==n&&n.update&&r.updateButton?(0,b.u)("button",{class:this.classes(f.z.button,f.z.buttonSmall,f.z.buttonThird,{[f.z.buttonDisabled]:u}),disabled:u,key:"update-button",type:"submit"},this.messages.update):void 0,I=this.visibleElements.cancelUpdateButton?(0,b.u)("button",{bind:this,class:this.classes(f.z.button,f.z.buttonSmall,f.z.buttonTertiary,f.z.buttonThird,{[f.z.buttonDisabled]:c}),disabled:c,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,A=d.editing&&null!==(i=d.operations)&&void 0!==i&&i.update?(0,b.u)("fieldset",{class:w.fileFieldset,key:"file"},(0,b.u)("span",{class:w.fileName,key:"file-name"},h),(0,b.u)("label",{class:this.classes(w.fileLabel,f.z.button,f.z.buttonSecondary)},this.messages.changeFile,(0,b.u)("input",{bind:this,class:w.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,F=(0,b.u)("fieldset",{class:w.metadataFieldset,key:"size"},(0,b.u)("label",null,(0,s.sS)(this.messagesUnits,null!==(a=p)&&void 0!==a?a:0))),M=(0,b.u)("fieldset",{class:w.metadataFieldset,key:"content-type"},(0,b.u)("label",null,m)),C=null!=v?(0,b.u)("a",{class:w.itemLink,href:v,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),(0,b.u)("div",{class:w.itemLinkOverlay},(0,b.u)("span",{class:w.itemLinkOverlayIcon},(0,b.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),T=(0,b.u)("form",{afterCreate:g.Yo,afterRemoved:g.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:t=>this._submitUpdateAttachment(t,e)},(0,b.u)("div",{class:w.metadata},F,M),A,(0,b.u)("div",{class:w.actions},y,I,_));return(0,b.u)("div",{class:w.formNode,key:"edit-form-container"},C,T)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){const{supportsResizeAttachments:n}=this.viewModel,i=function(e){const t=(0,m.V)("esri/themes/base/images/files/");return e?"text/plain"===e?"".concat(t,"text-32.svg"):"application/pdf"===e?"".concat(t,"pdf-32.svg"):"text/csv"===e?"".concat(t,"csv-32.svg"):"application/gpx+xml"===e?"".concat(t,"gpx-32.svg"):"application/x-dwf"===e?"".concat(t,"cad-32.svg"):"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"".concat(t,"code-32.svg"):"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"".concat(t,"zip-32.svg"):e.includes("image/")?"".concat(t,"image-32.svg"):e.includes("audio/")?"".concat(t,"sound-32.svg"):e.includes("video/")?"".concat(t,"video-32.svg"):e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?"".concat(t,"excel-32.svg"):e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?"".concat(t,"word-32.svg"):e.includes("powerpoint")||e.includes("presentationml")?"".concat(t,"report-32.svg"):"".concat(t,"generic-32.svg"):"".concat(t,"generic-32.svg")}(t),a={[w.itemImageResizable]:n};return(0,b.u)("div",{class:this.classes(w.itemMaskIcon,w.itemMask),key:i},(0,b.u)("img",{alt:e,class:this.classes(a,w.itemImage),src:i,title:e}))}_renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:n}=this.viewModel;if(!e)return null;const{contentType:i,name:a,url:r}=e;if(!n||!h(i))return this._renderGenericImageMask(a,i);const s=this._getCSSTransform(e),o=s?{transform:s,"image-orientation":"none"}:{},l="".concat(r).concat(null!==r&&void 0!==r&&r.includes("?")?"&":"?","w=").concat(t),c={[w.itemImageResizable]:n};return(0,b.u)("div",{class:this.classes(w.itemMask),key:l},(0,b.u)("img",{alt:a,class:this.classes(c,w.itemImage),src:l,styles:o,title:a}))}_renderFile(e){const{file:t}=e;return(0,b.u)("li",{class:w.item,key:t},(0,b.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:w.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),(0,b.u)("label",{class:w.itemLabel},(0,b.u)("span",{class:w.itemFilename},t.name||this.messages.noTitle),(0,b.u)("span",{"aria-hidden":"true",class:this.classes(w.itemChevronIcon,(0,g.dZ)(this.container)?v.W.left:v.W.right)}))))}_renderAttachmentInfo(e){let{attachmentInfo:t,displayType:n}=e;const{viewModel:i,effectiveDisplayType:a}=this,{capabilities:r,supportsResizeAttachments:s}=i,{contentType:o,name:l,url:c}=t,d=this._renderImageMask(t,"list"===n?48:400),u=r.editing?(0,b.u)("span",{"aria-hidden":"true",class:this.classes(w.itemChevronIcon,(0,g.dZ)(this.container)?v.W.left:v.W.right)}):null,m=[d,"preview"===a&&s&&h(o)?null:(0,b.u)("label",{class:w.itemLabel},(0,b.u)("span",{class:w.itemFilename},l||this.messages.noTitle),u)],p=r.editing?(0,b.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:w.itemButton,"data-attachment-info-id":t.id,key:"details-button",onclick:()=>this._startEditAttachment(t),title:this.messages.attachmentDetails,type:"button"},m):(0,b.u)("a",{class:w.itemButton,href:null!==c&&void 0!==c?c:void 0,key:"details-link",rel:"noreferrer",target:"_blank"},m);return(0,b.u)("li",{class:w.item,key:t},p)}_renderAttachmentContainer(){var e;const{effectiveDisplayType:t,viewModel:n,visibleElements:i}=this,{attachmentInfos:a,capabilities:r,fileInfos:s}=n,o=!(null===a||void 0===a||!a.length),l=!(null===s||void 0===s||!s.length),c={[w.containerList]:"preview"!==t,[w.containerPreview]:"preview"===t},d=r.editing&&null!==(e=r.operations)&&void 0!==e&&e.add&&i.addButton?(0,b.u)("button",{bind:this,class:this.classes(f.z.button,f.z.buttonTertiary,w.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},(0,b.u)("span",{"aria-hidden":"true",class:this.classes(w.itemAddIcon,v.W.plus)}),this.messages.add):void 0,u=o?(0,b.u)("ul",{class:w.items,key:"attachments-list"},a.toArray().map((e=>this._renderAttachmentInfo({attachmentInfo:e,displayType:t})))):void 0,m=l?(0,b.u)("ul",{class:w.items,key:"file-list"},s.toArray().map((e=>this._renderFile(e)))):void 0,h=l||o?void 0:(0,b.u)("div",{class:f.z.empty},this.messages.noAttachments);return(0,b.u)("div",{class:this.classes(w.container,c),key:"attachments-container"},u,m,h,d)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){var t;const n=null===(t=e.target.files)||void 0===t?void 0:t.item(0);this._set("selectedFile",n)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?"rotate(".concat(t.rotation,"deg)"):"",t.mirrored?"scaleX(-1)":""].join(" "):""}};(0,i._)([(0,o.Cb)()],F.prototype,"capabilities",null),(0,i._)([(0,o.Cb)()],F.prototype,"displayType",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],F.prototype,"effectiveDisplayType",null),(0,i._)([(0,o.Cb)()],F.prototype,"graphic",null),(0,i._)([(0,o.Cb)()],F.prototype,"icon",null),(0,i._)([(0,o.Cb)()],F.prototype,"label",null),(0,i._)([(0,o.Cb)(),(0,y.H)("esri/widgets/Attachments/t9n/Attachments")],F.prototype,"messages",void 0),(0,i._)([(0,o.Cb)(),(0,y.H)("esri/core/t9n/Units")],F.prototype,"messagesUnits",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],F.prototype,"selectedFile",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],F.prototype,"submitting",void 0),(0,i._)([(0,o.Cb)({readOnly:!0})],F.prototype,"error",void 0),(0,i._)([(0,o.Cb)({type:u.Z})],F.prototype,"viewModel",void 0),(0,i._)([(0,o.Cb)()],F.prototype,"visibleElements",void 0),(0,i._)([(0,l.p)("visibleElements")],F.prototype,"castVisibleElements",null),F=(0,i._)([(0,c.j)("esri.widgets.Attachments")],F);const M=F},4819:(e,t,n)=>{n.d(t,{Z:()=>y});var i=n(27366),a=n(52639),r=n(7138),s=n(80987),o=n(10064),l=n(94172),c=n(49861),d=n(89125),u=(n(84936),n(93169),n(69912)),m=n(11812),h=n(99837),p=n(45276);const f={editing:!1,operations:{add:!0,update:!0,delete:!0}},v=s.Z.ofType(m.Z);let g=class extends r.default{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...f},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new v,this.fileInfos=new s.Z,this.graphic=null,this.mode="view",this.filesEnabled=!1,this.addHandles((0,l.watch)((()=>this.graphic),(()=>this._graphicChanged()),l.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...f,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return(null===t||void 0===t?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new o.Z("invalid-layer","getAttachments(): A valid layer is required.");const n=this._getObjectId(),i=new h.Z({objectIds:[n],returnMetadata:!0}),a=[],r=e.queryAttachments(i).then((e=>e[n]||a)).catch((()=>a));this._getAttachmentsPromise=r,this.notifyChange("state");const s=await r;return t.destroyAll(),s.length&&t.addMany(s),this._getAttachmentsPromise=null,this.notifyChange("state"),s}async addAttachment(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.graphic;const{_attachmentLayer:i,attachmentInfos:a,capabilities:r}=this;if(!n)throw new o.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:n});if(!e)throw new o.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(null===(t=r.operations)||void 0===t||!t.add)throw new o.Z("invalid-capabilities","addAttachment(): add capabilities are required.");if(!i||"function"!=typeof i.addAttachment)throw new o.Z("invalid-layer","addAttachment(): A valid layer is required.");const s=i.addAttachment(n,e).then((e=>this._queryAttachment(e.objectId,n))),l=await s;return a.add(l),l}async deleteAttachment(e){var t;const{_attachmentLayer:n,attachmentInfos:i,graphic:a,capabilities:r}=this;if(!e)throw new o.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(null===(t=r.operations)||void 0===t||!t.delete)throw new o.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!n||"function"!=typeof n.deleteAttachments)throw new o.Z("invalid-layer","deleteAttachment(): A valid layer is required.");if(!a)throw new o.Z("invalid-graphic","deleteAttachment(): A graphic is required.");const s=n.deleteAttachments(a,[e.id]).then((()=>e)),l=await s;return i.remove(l),l.destroy(),l}async updateAttachment(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.activeAttachmentInfo;const{_attachmentLayer:i,attachmentInfos:a,graphic:r,capabilities:s}=this;if(!e)throw new o.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!n)throw new o.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:n});if(null===(t=s.operations)||void 0===t||!t.update)throw new o.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");const l=a.indexOf(n);if(!i||"function"!=typeof i.updateAttachment)throw new o.Z("invalid-layer","updateAttachment(): A valid layer is required.");if(!r)throw new o.Z("invalid-graphic","updateAttachment(): A graphic is required.");const c=i.updateAttachment(r,n.id,e).then((e=>this._queryAttachment(e.objectId))),d=await c;return a.splice(l,1,d),d}async commitFiles(){return await Promise.all(this.fileInfos.items.map((e=>this.addAttachment(e.form)))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const n={file:e,form:t};return this.fileInfos.add(n),n}updateFile(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!n)return null;const i=this.fileInfos.indexOf(n);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){const t=this.fileInfos.find((t=>t.file===e));return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:n}=this;if(!e||null===n||void 0===n||!n.queryAttachments)throw new o.Z("invalid-attachment-id","Could not query attachment.");const i=this._getObjectId(t),a=new h.Z({objectIds:[i],attachmentsWhere:"AttachmentId=".concat(e),returnMetadata:!0});return n.queryAttachments(a).then((e=>e[i][0]))}_getObjectId(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(e=null===t||void 0===t?void 0:t.getObjectId())&&void 0!==e?e:null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=(0,p.l$)(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}};(0,i._)([(0,c.Cb)()],g.prototype,"capabilities",void 0),(0,i._)([(0,d.p)("capabilities")],g.prototype,"castCapabilities",null),(0,i._)([(0,c.Cb)()],g.prototype,"activeAttachmentInfo",void 0),(0,i._)([(0,c.Cb)()],g.prototype,"activeFileInfo",void 0),(0,i._)([(0,c.Cb)({readOnly:!0,type:v})],g.prototype,"attachmentInfos",void 0),(0,i._)([(0,c.Cb)()],g.prototype,"fileInfos",void 0),(0,i._)([(0,c.Cb)({type:a.Z})],g.prototype,"graphic",void 0),(0,i._)([(0,c.Cb)()],g.prototype,"mode",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],g.prototype,"state",null),(0,i._)([(0,c.Cb)()],g.prototype,"filesEnabled",void 0),(0,i._)([(0,c.Cb)({readOnly:!0})],g.prototype,"supportsResizeAttachments",null),g=(0,i._)([(0,u.j)("esri.widgets.Attachments.AttachmentsViewModel")],g);const y=g},45276:(e,t,n)=>{n.d(t,{EB:()=>G,Hs:()=>Y,JD:()=>T,K7:()=>W,M3:()=>P,Ns:()=>ne,Qu:()=>q,Rd:()=>C,S$:()=>Z,T2:()=>ie,Tj:()=>U,Um:()=>B,Xh:()=>$,_R:()=>R,ar:()=>L,iJ:()=>E,k6:()=>k,l$:()=>A,oM:()=>J,or:()=>M,qD:()=>H,s5:()=>te,tJ:()=>S,uI:()=>Q,vD:()=>F,wi:()=>se});var i=n(32718),a=n(643),r=n(76969),s=n(6291),o=n(37270),l=n(37933),c=n(62734),d=n(819),u=n(6701);const m=()=>i.Z.getLogger("esri.widgets.Feature.support.featureUtils"),h=/href=(""|'')/gi,p=/(\{([^{\r\n]+)\})/g,f=/'/g,v=/^\s*expression\//i,g=/(\n)/gi,y=/[\u00A0-\u9999<>&]/gim,b=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,_=/^(?:mailto:|tel:)/,I="relationships/",w=(0,r.Ze)("short-date-short-time");function A(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}async function F(e){let{type:t,value:n,event:i}=e;try{return"function"==typeof n?n(i):n}catch(a){return void m().error("error",'An error occurred when calling the "'.concat(t,'" function'),{error:a,graphic:i.graphic,value:n})}}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!_.test(e.trim().toLowerCase())}function C(e){return!!e&&v.test(e)}function T(e,t){const n=function(e,t){if(!t||!C(t)||!e)return;const n=t.replace(v,"").toLowerCase();return e.find((e=>{let{name:t}=e;return t.toLowerCase()===n}))}(t,null===e||void 0===e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function k(e,t){const n=z(t,e);return n?n.name:e}function E(e,t){return e&&e.map((e=>k(e,t)))}function z(e,t){var n;return e&&"function"==typeof e.getField&&t&&null!==(n=e.getField(t))&&void 0!==n?n:null}function x(e){return"".concat(e).trim()}function Z(e){let{attributes:t,globalAttributes:n,layer:i,text:a,expressionAttributes:r,fieldInfoMap:s}=e;return a?L({formattedAttributes:n,template:N(a,{...n,...r,...t},i),fieldInfoMap:s}):""}function L(e){let{formattedAttributes:t,template:n,fieldInfoMap:i}=e;return x(function(e){return e.replaceAll(h,"")}((0,a.gx)((0,a.gx)(n,(e=>function(e,t){const n=t.get(e.toLowerCase());return"{".concat((null===n||void 0===n?void 0:n.fieldName)||e,"}")}(e,i))),t)))}function D(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={...e};return Object.keys(n).forEach((e=>function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t[e];if("string"==typeof i){const a="%27",r=(n?encodeURIComponent(i):i).replaceAll(f,a);t[e]=r}}(e,n,t))),n}function q(e,t){return e.replaceAll(p,((e,n,i)=>{const a=z(t,i);return a?"{".concat(a.name,"}"):n}))}function N(e,t,n){const i=q(e,n);return i?i.replaceAll(b,((e,n,i)=>function(e,t,n){const i=(t=x(t))&&"{"!==t[0];return(0,a.gx)(e,D(n,i||!1))}(e,n||i,t))):i}function B(e){return function(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"sublayer"===e.type)&&"when"in e}(e)&&function(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}(e)}function S(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&B(e.sourceLayer)}function j(e,t){const{fieldInfos:n,fieldName:i,preventPlacesFormatting:a,layer:r,timeZone:l}=t,d=R(n,i),u=z(r,i);if(d&&!(0,o.Ec)(i)){var m;const t=null===u||void 0===u?void 0:u.type,n=null===(m=d.format)||void 0===m?void 0:m.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n)return(0,c.$8)(e,{format:n,fieldType:t,timeZoneOptions:{layerTimeZone:r&&"preferredTimeZone"in r?r.preferredTimeZone:null,viewTimeZone:l,datesInUnknownTimezone:!(!r||!("datesInUnknownTimezone"in r))&&!!r.datesInUnknownTimezone}})}const h=null===d||void 0===d?void 0:d.format;return"string"==typeof e&&(0,o.Ec)(i)&&h?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?O(e,",",", ",t):e.includes(";")?O(e,";","; ",t):e.includes(" ")?O(e," "," ",t):(0,s.uf)(Number(e),(0,s.sh)(t))}(e,h):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,h))||null==e||null==h?H(e):(0,s.uf)(e,a?{...(0,s.sh)(h),minimumFractionDigits:0,maximumFractionDigits:20}:(0,s.sh)(h))}function O(e,t,n,i){return e.trim().split(t).map((e=>(0,s.uf)(Number(e),(0,s.sh)(i)))).join(n)}function R(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find((e=>{var n;return(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()}))}function U(e,t,n,i){const{creatorField:a,creationDateField:s,editorField:o,editDateField:l}=e;if(!t)return;const c=(0,u.Np)(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i))&&!!i.datesInUnknownTimezone,n,w,"date"),d={...w,...c},m=t[l];if("number"==typeof m){const e=t[o];return{type:"edit",date:(0,r.p6)(m,d),user:e}}const h=t[s];if("number"==typeof h){const e=t[a];return{type:"create",date:(0,r.p6)(h,d),user:e}}return null}function G(e,t){const n=new Map;if(!e)return n;for(const i of e){if(!i.fieldName)continue;const e=k(i.fieldName,t);i.fieldName=e,n.set(e.toLowerCase(),i)}return n}function Y(e){const t=[];if(!e)return t;const{fieldInfos:n,content:i}=e;return n&&t.push(...n),i&&Array.isArray(i)?(i.forEach((e=>{if("fields"===e.type){const n=null===e||void 0===e?void 0:e.fieldInfos;n&&t.push(...n)}})),t):t}function P(e){return e.replaceAll(y,(e=>"&#".concat(e.charCodeAt(0),";")))}function H(e){return"string"==typeof e?e.replaceAll(g,'<br class="esri-text-new-line" />'):e}function V(e){var t;const{value:n,fieldName:i,fieldInfos:a,fieldInfoMap:r,layer:s,graphic:l,timeZone:d}=e;if(null==n)return"";const u=function(e){let{fieldName:t,value:n,graphic:i,layer:a}=e;if(J(t))return null;if(!a||"function"!=typeof a.getFieldDomain)return null;const r=i&&a.getFieldDomain(t,{feature:i});return r&&"coded-value"===r.type?r.getName(n):null}({fieldName:i,value:n,graphic:l,layer:s});if(u)return u;const m=function(e){let{fieldName:t,graphic:n,layer:i}=e;if(J(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:a}=i;if(!a||t!==a)return null;const r=i.getFeatureType(n);return r?r.name:null}({fieldName:i,graphic:l,layer:s});if(m)return m;if(r.get(i.toLowerCase()))return j(n,{fieldInfos:a||Array.from(r.values()),fieldName:i,layer:s,timeZone:d});const h=null===s||void 0===s||null===(t=s.fieldsIndex)||void 0===t?void 0:t.get(i);return h&&((0,c.a8)(h)||(0,o.sX)(h))?(0,c.$8)(n,{fieldType:h.type,timeZoneOptions:{layerTimeZone:s&&"preferredTimeZone"in s?s.preferredTimeZone:null,viewTimeZone:d,datesInUnknownTimezone:!(!s||!("datesInUnknownTimezone"in s))&&!!s.datesInUnknownTimezone}}):H(n)}function Q(e){let{fieldInfos:t,attributes:n,layer:i,graphic:a,fieldInfoMap:r,relatedInfos:s,timeZone:o}=e;const l={};return null!==s&&void 0!==s&&s.forEach((e=>function(e){var t,n;let{attributes:i,relatedInfo:a,fieldInfoMap:r,fieldInfos:s,layer:o,timeZone:l}=e;i&&a&&(null!==(t=a.relatedFeatures)&&void 0!==t&&t.forEach((e=>K({attributes:i,graphic:e,relatedInfo:a,fieldInfoMap:r,fieldInfos:s,layer:o,timeZone:l}))),null===(n=a.relatedStatsFeatures)||void 0===n||n.forEach((e=>K({attributes:i,graphic:e,relatedInfo:a,fieldInfoMap:r,fieldInfos:s,layer:o,timeZone:l}))))}({attributes:l,relatedInfo:e,fieldInfoMap:r,fieldInfos:t,layer:i,timeZone:o}))),n&&Object.keys(n).forEach((e=>{const s=n[e];l[e]=V({fieldName:e,fieldInfos:t,fieldInfoMap:r,layer:i,value:s,graphic:a,timeZone:o})})),l}async function W(e,t){var n;const{layer:i,graphic:a,outFields:r,objectIds:s,returnGeometry:o,spatialReference:c}=e,d=s[0];if("number"!=typeof d&&"string"!=typeof d){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:i,graphic:a,objectId:d,requiredFields:r};return m().warn(e,t),null}if(null===(n=(0,l.S1)(i))||void 0===n||null===(n=n.operations)||void 0===n||!n.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:i,graphic:a,requiredFields:r,returnGeometry:o};return m().warn(e,t),null}const u=i.createQuery();return u.objectIds=s,u.outFields=null!==r&&void 0!==r&&r.length?r:[i.objectIdField],u.returnGeometry=!!o,u.returnZ=!!o,u.returnM=!!o,u.outSpatialReference=c,(await i.queryFeatures(u,t)).features[0]}async function $(e,t){let{graphic:n,popupTemplate:i,layer:a,spatialReference:r}=e;if(!a||!i)return;if("function"==typeof a.load&&await a.load(t),!n.attributes)return;const s=a.objectIdField,l=n.attributes[s];if(null==l)return;const c=[l],u=await i.getRequiredFields(a.fieldsIndex),m=(0,o.R9)(u,n),h=m?[]:u.includes(s)?u:[...u,s],p=i.returnGeometry||await async function(e){var t;if(null===(t=e.expressionInfos)||void 0===t||!t.length)return!1;const n=await(0,d.LC)(),{arcadeUtils:{hasGeometryFunctions:i}}=n;return i(e)}(i);if(m&&!p)return;const f=await W({layer:a,graphic:n,outFields:h,objectIds:c,returnGeometry:p,spatialReference:r},t);f&&(f.geometry&&(n.geometry=f.geometry),f.attributes&&(n.attributes={...n.attributes,...f.attributes}))}function J(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(I)}function K(e){let{attributes:t,graphic:n,relatedInfo:i,fieldInfos:a,fieldInfoMap:r,layer:s,timeZone:o}=e;t&&n&&i&&Object.keys(n.attributes).forEach((e=>{const l=function(e){return e?"".concat(I).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:i.relation.id.toString(),fieldName:e}),c=n.attributes[e];t[l]=V({fieldName:l,fieldInfos:a,fieldInfoMap:r,layer:s,value:c,graphic:n,timeZone:o})}))}const X=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},ee=e=>{var t;let{layer:n,method:i,query:a,definitionExpression:r}=e;if(null===(t=n.capabilities)||void 0===t||null===(t=t.query)||void 0===t||!t.supportsCacheHint||"attachments"===i)return;const s=null!=a.where?a.where:null,o=null!=a.geometry?a.geometry:null;X(r)||X(s)||"extent"===(null===o||void 0===o?void 0:o.type)||"tile"===a.resultType||(a.cacheHint=!0)},te=e=>{var t;let{query:n,layer:i,method:a}=e;ee({layer:i,method:a,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})},ne=e=>{var t;let{queryPayload:n,layer:i,method:a}=e;ee({layer:i,method:a,query:n,definitionExpression:"".concat(i.definitionExpression," ").concat(null!==(t=i.serviceDefinitionExpression)&&void 0!==t?t:"")})};function ie(e,t,n){var i,a;return e&&t&&n?"sublayer"===t.type?re({layers:null===(i=t.layer)||void 0===i?void 0:i.sublayers,map:e,relatedLayer:t,relationship:n})||re({layers:null===(a=t.layer)||void 0===a?void 0:a.subtables,map:e,relatedLayer:t,relationship:n}):re({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||re({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function ae(e,t){return null===e||void 0===e?void 0:e.allTables.find((e=>{var n;return"feature"===e.type&&e.layerId===t.id&&e.url===(null===(n=t.layer)||void 0===n?void 0:n.url)}))}function re(e){let{map:t,relationship:n,relationship:{relatedTableId:i},relatedLayer:a,layers:r}=e;if(!r)return null;for(const o of r){var s;if("map-image"===o.type){const e=re({layers:o.sublayers,map:t,relatedLayer:a,relationship:n})||re({layers:o.subtables,map:t,relatedLayer:a,relationship:n});if(e)return e;continue}if(!B(o))continue;if("sublayer"===a.type){if(o!==a&&o.id===i)return o.isTable?ae(t,o):o;continue}const e="scene"===a.type&&a.associatedLayer?a.associatedLayer.url:a.url;if(!e)return null;if("sublayer"!==o.type){if(o!==a&&o.url===e&&o.layerId===i)return o}else if(o!==a&&(null===(s=o.layer)||void 0===s?void 0:s.url)===e&&o.id===i)return o.isTable?ae(t,o):o}return null}function se(e){const t=e.getObjectId();return null!=t?"oid:".concat(t):"uid:".concat(e.uid)}}}]);
//# sourceMappingURL=21993.b6bdb501.chunk.js.map