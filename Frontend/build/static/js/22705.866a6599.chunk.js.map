{"version":3,"file":"static/js/22705.866a6599.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/widgets/OrientedImageryViewer/adapters/OrientedImageryViewerViewModelAdapter3D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport\"../../../geometry.js\";import e from\"../../../Graphic.js\";import{isSome as t}from\"../../../core/arrayUtils.js\";import{throwIfAborted as i,waitTick as r}from\"../../../core/promiseUtils.js\";import{ensureType as o}from\"../../../core/accessorSupport/ensureType.js\";import a from\"../../../geometry/Mesh.js\";import{projectWithZConversion as s}from\"../../../geometry/projection.js\";import{MeshVertexAttributes as n}from\"../../../geometry/support/MeshVertexAttributes.js\";import{projectVertices as l,updateFrustum as c,createCoveragePolygon as m}from\"../../../layers/orientedImagery/core/coverageUtils.js\";import{transformPoints as p}from\"../../../layers/orientedImagery/transformations/imageToGroundUtils.js\";import{activeFrustumSymbol as u,additionalFrustumSymbol as f}from\"../symbols.js\";import g from\"../../../geometry/Point.js\";class w{constructor(g){this.viewModel=g,this.createFootprints=async r=>{const{coverageFrustums:o,currentBestFeature:c,isAdditionalCoverageVisible:m,view:p}=this.viewModel,g=o.filter(t);for(const t of g){let o=t.clone();if(!p.spatialReference.equals(o.spatialReference)){const{components:e,spatialReference:t,origin:c,vertexAttributes:m,vertexSpace:u}=o;if(\"local\"===u.type){const e=await s(c,p.spatialReference,r);i(r),o.centerAt(e)}else{const s=m.position,c=Float64Array.from(await l([...s],t.clone(),p.spatialReference.clone(),r));i(r),o=new a({vertexAttributes:new n({position:c}),components:e,spatialReference:p.spatialReference.clone()})}}t.imageID===c.attributes.objectId?this.viewModel.bestFeatureFootprint=new e({attributes:{imageID:t.imageID},geometry:o,symbol:u.clone(),visible:!1}):this.viewModel.additionalFootprints.push(new e({attributes:{imageID:t.imageID},geometry:o,symbol:f.clone(),visible:m}))}},this.updateFootprint=async(r,n)=>{const{currentBestFeature:l,imagePointsInView:m,activeViewer:f,footprintExtent:g,view:w}=this.viewModel,y=o(a,this.viewModel.getCurrentBestFeaturePolygon().geometry),h=f?.imageSize;if(!(l&&y&&m&&h&&g))return;const{cameraHeight:v,location:b,cameraPitch:F,horizontalFieldOfView:R,verticalFieldOfView:j,cameraRoll:M,imageRotation:V}=l.attributes,I=b.toArray(),{vertexAttributes:{position:A},spatialReference:P}=y,x=await d(A,P,b.spatialReference),z=await p(r,{feature:l,imageProperties:{width:h[0],height:h[1]},options:n,footprintExtent:g});i(n);let C=z.filter(t);if(!C.length)return;C[0].spatialReference.equals(b.spatialReference)||(C=await Promise.all(C.map((async e=>{const t=await s(e,b.spatialReference,n);return i(n),t}))));const O=await c(m.slice(0,4).map((({x:e,y:t})=>[e,t])),C.slice(0,4).map((e=>e.toArray())),{cameraHeight:v,cameraLocation:I,cameraPitch:F,frustumVertices:x,horizontalFieldOfView:R,imageHeight:h[1],imageWidth:h[0],inSRS:{wkid:b.spatialReference.wkid},outSRS:{wkid:w.spatialReference.wkid},verticalFieldOfView:j,cameraRoll:M??0,imageRotation:V??0,options:n});this.viewModel.updateCurrentCoveragePolygon(new e({attributes:{imageID:l.attributes.objectId},geometry:O,symbol:u.clone(),visible:this.viewModel.currentCoverageVisible}))},this.updateFootprintPanorama=async(t,i)=>{await r(i);const{horizontalFieldOfView:o,pitch:a,verticalFieldOfView:s,yaw:n}=t,l=this.viewModel.currentBestFeature?.clone();if(!l)return;const{attributes:c}=l;c.orientedImageryType=null,c.cameraHeading=(n+c.cameraHeading)%360,c.cameraPitch=a,c.horizontalFieldOfView=o,c.verticalFieldOfView=s,c.cameraRoll=0;const{frustum:p}=m(c);p&&this.viewModel.updateCurrentCoveragePolygon(new e({attributes:{imageID:c.objectId},geometry:p,symbol:u.clone(),visible:this.viewModel.currentCoverageVisible}))}}updateGroundElevation(e,t){const{geometry:i}=this.viewModel.currentBestFeature,r=t.queryElevation(i);e.forEach((e=>{const{geometry:t}=e;switch(t?.type){case\"mesh\":{const{vertexAttributes:{position:e}}=t,i=Math.floor(e.length/3);for(let t=0;t<i;t+=1)e[3*t+2]+=r?.z??0;break}case\"point\":t.z=(t.z??0)+(r?.z??0)}}))}}async function d(e,t,i,r){return Float64Array.from((await Promise.all(e.reduce(((e,t,i)=>{const r=Math.floor(i/3);return e[r]=e[r]??[],e[r].push(t),e}),new Array).map((async e=>(await s(new g(e,t),i,r)).toArray())))).flat())}export{w as default};\n"],"names":["w","constructor","g","this","viewModel","createFootprints","async","coverageFrustums","o","currentBestFeature","c","isAdditionalCoverageVisible","m","view","p","filter","t","clone","spatialReference","equals","components","e","origin","vertexAttributes","vertexSpace","u","type","s","r","i","centerAt","position","Float64Array","from","l","a","n","imageID","attributes","objectId","bestFeatureFootprint","geometry","symbol","visible","additionalFootprints","push","f","updateFootprint","imagePointsInView","activeViewer","footprintExtent","y","getCurrentBestFeaturePolygon","h","imageSize","cameraHeight","v","location","b","cameraPitch","F","horizontalFieldOfView","R","verticalFieldOfView","j","cameraRoll","M","imageRotation","V","I","toArray","A","P","x","Promise","all","reduce","_e$r","Math","floor","Array","map","flat","d","z","feature","imageProperties","width","height","options","C","length","O","slice","_ref","cameraLocation","frustumVertices","imageHeight","imageWidth","inSRS","wkid","outSRS","updateCurrentCoveragePolygon","currentCoverageVisible","updateFootprintPanorama","_this$viewModel$curre","pitch","yaw","orientedImageryType","cameraHeading","frustum","updateGroundElevation","queryElevation","forEach","_t$z","_r$z2","_r$z"],"sourceRoot":""}